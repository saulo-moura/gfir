
<style type="text/css">


div#contrato {
    overflow:auto;
    sheight: 380px;
    width : 680px;
    width : 100%;
    float:left;
    font-family : Calibri, Arial, Helvetica, sans-serif;
    font-style: normal;
    font-size: 12px;
    font-weight: bold;
    color:#FF5959;
    background: #FFFFFF;
    margin-top:0px;
}


div#contrato_1 {
    overflow:auto;
    sheight: 360px;
    width : 670px;
    width : 100%;
    float:left;
    font-family : Calibri, Arial, Helvetica, sans-serif;
    font-style: normal;
    font-size: 12px;
    font-weight: bold;
    color:#FF5959;
    padding:0px;
    background: #FFFFFF;
}


table.contrato_table{
    font-family : Calibri, Arial, Helvetica, sans-serif;
    font-style: normal;
    font-size: 12px;
    font-weight: normal;
    color:#000000;
    background: #EFEFEF;
    background: #A2A2A2;
}

tr.contrato_table_tr {


}
td.contrato_titulo_td {
    font-weight : bold;
    color       : #FFFFFF;
    text-align  :center;
    padding-top :5px;
    padding-left:5px;
    border-bottom:1px solid #9D0000;
}
tr.contrato_cab_tr {

}
td.contrato_cab_td {
    font-weight :bold;
    color       :#FFFFFF;
    text-align  :left;
    padding-top :5px;
    padding-left:5px;
    border-bottom:1px solid #9D0000;
}

td.contrato_cab_td_r {
    font-weight :bold;
    color       :#FFFFFF;
    text-align  :left;
    padding-top :5px;
    padding-left:5px;
    border-bottom:1px solid #9D0000;
    text-align: right;
}

tr.contrato_linha_tr {

}
td.contrato_linha_td_t {
    font-weight   : normal;
    color         : #640000;
    background    : #EAEAEA;
    padding-top   : 5px;
    padding-left  : 5px;
    border-bottom : 1px solid #C0C0C0;
}

td.contrato_linha_td_t1 {
    font-weight   : normal;
    color         : #640000;
    background    : #EEEEEE;
    padding-top   : 5px;
    padding-left  : 5px;
    border-bottom : 1px solid #C0C0C0;
}

td.contrato_linha_td_t2 {
    font-weight   : normal;
    color         : #640000;
    background    : #F0F0F0;
    padding-top   : 5px;
    padding-left  : 5px;
    border-bottom : 1px solid #C0C0C0;
}

td.contrato_linha_td_t3 {
    font-weight   : normal;
    color         : #640000;
    background    : #F0F0F0;
    padding-top   : 5px;
    padding-left  : 5px;
    border-bottom : 1px solid #C0C0C0;
}


td.contrato_linha_td_t_r {
    font-weight   : bold;
    color         : #640000;
    background    : #EAEAEA;
    padding-top   : 5px;
    padding-left  : 5px;
    border-bottom : 1px solid #C0C0C0;
    text-align    : right;
}

td.contrato_linha_td_t1_r {
    font-weight   : bold;
    color         : #640000;
    background    : #EEEEEE;
    padding-top   : 5px;
    padding-left  : 5px;
    border-bottom : 1px solid #C0C0C0;
    text-align    : right;
}

td.contrato_linha_td_t2_r {
    font-weight   : bold;
    color         : #640000;
    background    : #F0F0F0;
    padding-top   : 5px;
    padding-left  : 5px;
    border-bottom : 1px solid #C0C0C0;
    text-align    : right;
}

td.contrato_linha_td_t3_r {
    font-weight   : bold;
    color         : #640000;
    background    : #F0F0F0;
    padding-top   : 5px;
    padding-left  : 5px;
    border-bottom : 1px solid #C0C0C0;
    text-align    : right;
}



td.contrato_linha_td_a {
    font-weight :normal;
    color       :#575757;
    background  :#FFFFFF;
    padding-top :5px;
    padding-left:5px;
    border-bottom : 1px solid #C0C0C0;
}

td.contrato_linha_td_a_r {
    font-weight : bold;
    color       :#575757;
    background  :#FFFFFF;
    padding-top :5px;
    padding-left:5px;
    border-bottom : 1px solid #C0C0C0;
    text-align    : right;
}

div#contrato_c {
    background:#FFCCCC;
    background:#FFFFFF;
    width : 680px;
    height:10px;
    margin:0px;
}

div#contrato_r {
    background:#FFCCCC;
    background:#FFFFFF;
    width : 680px;
    height:10px;
    margin:0px;
    float:left;
}


div#legenda {
    width : 670px;
      width : 100%;
    height: 30px;
    float:left;
    font-family : Calibri, Arial, Helvetica, sans-serif;
    font-style: normal;
    font-size: 11px;
    font-weight: bold;
    color:#000000;
    padding:0px;
    background: #EAEAEA;
    margin-bottom:5px;
}

div#legenda_l {
    font-size: 12px;
    color:#000000;
    float:right;
    padding-top:10px;
    margin-left:10px;
    margin-right:5px;
}


div#legenda_i {
    color:#858585;
    sfloat:left;
    float:right;
    padding-top:10px;
    margin-left:5px;
    margin-right:15px;
}


table.legenda_table{
    font-family : Calibri, Arial, Helvetica, sans-serif;
    font-style: normal;
    font-size: 12px;
    font-weight: normal;
    color:#000000;
    background: #EAEAEA;
}

tr.legenda_cab_tr {


}
td.legenda_cab_td {
    font-weight : bold;
    color       : #B9B9B9;
    text-align  :center;
    padding-top :5px;
    padding-left:5px;
    border-bottom: 1px solid #000000;
}


div#voltar_full_m  {
    float:left;
    height:25px;
    background:transparent;
    sbackground:red;
    margin:0px;
    padding:0px;
}

div#voltar_full_m img {
    cursor: pointer;
}

.voltar  {
    float:left;
}


div#area_imprime {
    float:left;
    background: #FFFFFF;
    text-align:right;
    background:blue;

}
div#area_imprime img {
    background: #FFFFFF;
    padding-right:5px;
    cursor: pointer;
}

div#area_excel {
    float:left;
    background: #FFFFFF;
    text-align:right;

}
div#area_excel img {
    background: #FFFFFF;
    padding-right:5px;
    cursor: pointer;
}

div#area_doc {
    float:left;
    background: #FFFFFF;
    text-align:right;

}
div#area_doc img {
    background: #FFFFFF;
    padding-right:5px;
    cursor: pointer;
}


</style>


<?php


if ($_GET['print'] != 's') {
    echo ' <div id="voltar_full_m">';

    echo ' <div class="voltar">';
    echo '         <img src="imagens/menos_full_pco.jpg" title="Voltar"   width="16" height="16"  style="padding:5px; " alt="Voltar" border="0" onclick="self.location = '."'".$url_volta."'".'" style="cursor: pointer;">';
    echo ' </div>';

    $nome_pr   = 'contrato_qualificacao';
    $nome_ex   = 'CONTRATO QUALIFICACAO - ';
    $titulo_rl = 'Avaliação de Fornecedor';
    echo "<div id='area_imprime' >";
   // echo '<a target="_blank" href="conteudo_print.php?prefixo=inc&menu='.$nome_pr.'&print=s&titulo_rel='.$titulo_rl.$parww.'" ><img style="padding:5px; "  src="imagens/impressora.gif" width="16" height="16" title="Preparar para Impressão" alt="Preparar para Impressão"  border="0" /></a>';
    echo '<a href="#"  onclick="return chama_orcamento('."'".$nome_pr."', "."'".$titulo_rl."'".');" ><img style="padding:5px; "  src="imagens/impressora.gif" width="16" height="16" title="Preparar para Impressão" alt="Preparar para Impressão"  border="0" /></a>';
    echo "</div>";

    echo ' </div>';
    echo "<br /><br /><br />";
}




$sql     = 'select  idt, estado, descricao from empreendimento ';
$sql    .= '    order by estado, descricao ';
$Filtro  = Array();
$Filtro['rs'] = execsql($sql);
//p('mmmmmmm'.$_GET['idt0']);

$par_auto=" onChange = 'document.frm.submit();' ";


//if ($_GET['idt0']!='')
//{
    //$Filtro['vlPadrao'] = '';
//}
//else
//{
  //  $Filtro['vlPadrao'] = $_SESSION[CS]['g_idt_obra'];
  //  $_GET['idt0'] = $_SESSION[CS]['g_idt_obra'];
    $Filtro['vlPadrao'] = $_SESSION[CS]['g_idt_obra'];
    $_GET['idt0'] = $_SESSION[CS]['g_idt_obra'];
    $_GET['pri']='S';
//}

$Filtro['LinhaUm']  = ' Listar Todas as Obras ';
$Filtro['id'] = 'idt';
$Filtro['nome'] = 'Empreendimento';
$Filtro['js'] = "style='width:400px;'".$par_auto;
$Filtro['valor'] = trata_id($Filtro);
$vetFiltro['empreendimento'] = $Filtro;



$sql     = 'select  idt, razao_social from fornecedor ';
$sql    .= '    order by razao_social ';
$Filtro  = Array();
$Filtro['rs'] = execsql($sql);
$Filtro['LinhaUm'] = ' Listar Todos os Fornecedores ';
$Filtro['id'] = 'idt';
$Filtro['vlPadrao'] = -1;
$Filtro['js'] = "style='width:400px;'".$par_auto;
$Filtro['nome'] = 'Fornecedor';
$Filtro['valor'] = trata_id($Filtro);
$vetFiltro['fornecedor'] = $Filtro;


//$sql     = 'select  distinct oi.idt , oi.descricao from orcamento_item oi ';
//$sql    .= ' inner join contrato_servico cs on cs.idt_orcamento_item = oi.idt ';
//$sql    .= '    order by oi.descricao ';



$sql     = 'select  distinct oi.idt , oi.classificacao, oi.descricao from orcamento_item oi ';
$sql    .= ' inner join contrato_servico cs on cs.idt_orcamento_item = oi.idt ';
$sql    .= ' inner join contrato co on co.idt = cs.idt_contrato ';

//if ($vetFiltro['fornecedor']['valor']!=-1)
//{
//    $sql .= ' and  co.idt_fornecedor = '.null($vetFiltro['fornecedor']['valor']);
//}

if ($vetFiltro['empreendimento']['valor']!=-1)
{
    $sql .= ' where oi.idt_empreendimento = '.null($vetFiltro['empreendimento']['valor']);
    if ($vetFiltro['fornecedor']['valor']!=-1)
    {
        $sql .= ' and  co.idt_fornecedor = '.null($vetFiltro['fornecedor']['valor']);
    }
}
else
{
    if ($vetFiltro['fornecedor']['valor']!=-1)
    {
        $sql .= ' where  co.idt_fornecedor = '.null($vetFiltro['fornecedor']['valor']);
    }
}


$sql    .= '    order by oi.classificacao ';



$Filtro  = Array();
$Filtro['rs'] = execsql($sql);
$Filtro['LinhaUm'] = ' Listar Todos os Serviços ';
$Filtro['js'] = "style='width:400px;'".$par_auto;
$Filtro['id'] = 'idt';
$Filtro['vlPadrao'] = -1;
$Filtro['nome'] = 'Serviços';
$Filtro['valor'] = trata_id($Filtro);
$vetFiltro['servico'] = $Filtro;



echo '<form name="frm" target="_self" action="conteudo.php?'.substr(getParametro($strPara),1).'" method="post">';


if ($_GET['print'] != 's') {
    $Focus = '';
    codigo_filtro(false,false);
    onLoadPag($Focus);
}


$sql   = 'select ';
$sql  .= '  co.idt            as co_idt, ';
$sql  .= '  co.idt_fornecedor as co_idt_fornecedor, ';
$sql  .= '  co.numero         as co_numero, ';
$sql  .= '  co.valor_contrato as co_valor_contrato, ';
$sql  .= '  co.valor_aditivo  as co_valor_aditivo, ';
$sql  .= '  co.valor_pago     as co_valor_pago, ';
$sql  .= '  cs.descricao      as cs_descricao,   ';
$sql  .= '  em.descricao      as em_descricao, ';
$sql  .= '  cs.valor_unitario as cs_valor_unitario,   ';
$sql  .= '  um.codigo         as um_unidade,   ';
$sql  .= '  fo.fantasia       as fo_fantasia, ';
$sql  .= '  fo.razao_social   as fo_razao_social, ';
$sql  .= '  oi.descricao      as oi_descricao, ';
$sql  .= '  csi.imagem        as csi_imagem,   ';
$sql  .= '  csi.descricao     as csi_descricao,   ';
$sql  .= '  css.descricao     as css_descricao,   ';
$sql  .= '  css.imagem        as css_imagem,   ';
$sql  .= '  co.nota           as co_nota,   ';
$sql  .= '  foa.descricao      as foa_descricao,   ';
$sql  .= '  foa.imagem         as foa_imagem   ';

$sql  .= '  from contrato co ';
$sql  .= '  inner join empreendimento    em  on em.idt           = co.idt_empreendimento ';
$sql  .= '  inner join fornecedor        fo  on fo.idt           = co.idt_fornecedor ';
$sql  .= '  left  join contrato_servico  cs  on cs.idt_contrato  = co.idt ';
$sql  .= '  left  join unidade_medida    um  on um.idt           = cs.idt_unidade_medida ';
$sql  .= '  left  join orcamento_item    oi  on oi.idt           = cs.idt_orcamento_item ';
$sql  .= '  left  join contrato_status   css on css.idt          = fo.idt_status ';
$sql  .= '  inner join contrato_situacao csi on csi.idt          = co.idt_situacao ';
$sql  .= '  inner join contrato_tipo     ct  on ct.idt           = co.idt_tipo     ';
$sql  .= '  left  join fornecedor_avaliacao  foa  on foa.idt         = co.idt_avaliacao     ';



$temw=0;
if ($vetFiltro['empreendimento']['valor']!=-1 and $vetFiltro['empreendimento']['valor']!=0)
{
    if ($temw==0)
    {
        $temw=1;
        $sql .= ' where ';
    }
    else
    {
        $sql .= ' and ';
    }
    $sql .= '    co.idt_empreendimento = '.null($vetFiltro['empreendimento']['valor']);
}



if ($vetFiltro['servico']['valor']!=-1 and $vetFiltro['servico']['valor']!=0)
{
    if ($temw==0)
    {
        $temw=1;
        $sql .= ' where ';
    }
    else
    {
        $sql .= ' and ';
    }
    $sql .= '   oi.idt = '.null($vetFiltro['servico']['valor']);
}

if ($vetFiltro['fornecedor']['valor']!=-1 and $vetFiltro['fornecedor']['valor']!=0)
{
    if ($temw==0)
    {
        $temw=1;
        $sql .= ' where ';
    }
    else
    {
        $sql .= ' and ';
    }
    $sql .= '   fo.idt = '.null($vetFiltro['fornecedor']['valor']);
}



$sql .= ' order by fo.razao_social, em.descricao, oi.descricao, cs.valor_unitario, cs.descricao,  fo.fantasia ';


$rs = execsql($sql);

$path='admin/obj_file/contrato_status/';
//exit();
if ($rs->rows == 0)
{
}
echo " <div id='contrato'> ";

//echo " bbbb ".$vetFiltro['servico']['valor'] ;
//p($sql);



//echo "<div id='contrato_c'> ";
//echo "</div>";

/*
echo "<div id='legenda'> ";
//echo "<table class='legenda_table' width='100%' border='0' cellspacing='0' cellpadding='0' vspace='0' hspace='0'> ";
//echo "<tr class='legenda_cab_tr'>  ";
$sqll   = 'select ';
$sqll  .= '  cst.descricao     as cst_descricao, ';
$sqll  .= '  cst.imagem        as cst_imagem   ';
$sqll  .= '  from contrato_status cst ';
$sqll  .= '  order by codigo desc ';
$rsl = execsql($sqll);
ForEach($rsl->data as $rowl) {
    $cst_imagem         = $rowl['cst_imagem'];
    $cst_descricao      = $rowl['cst_descricao'];
    $classe ='legenda_cab_td';
    $classer='legenda_cab_td';


    echo "<div id='legenda_i'> ";
//    echo "   <td class='{$classe}' >";
         ImagemProd(16 , 16, $path, $cst_imagem, $cst_descricao);
//    echo "</td> ";
//    echo "   <td class='{$classer}' >".$cst_descricao."</td> ";
      echo "   ".$cst_descricao." ";
      echo "</div>";
}

echo "<div id='legenda_l'> ";
echo "Legenda:";
echo "</div>";


//echo "</tr>";
//echo "</table>";
echo "</div>";
*/
echo "<div id='legenda'> ";
$sqll   = 'select ';
$sqll  .= '  foat.descricao     as foat_descricao, ';
$sqll  .= '  foat.imagem        as foat_imagem,   ';
$sqll  .= '  foat.peso          as foat_peso   ';
$sqll  .= '  from fornecedor_avaliacao foat ';
$sqll  .= '  order by peso desc ';
$rsl = execsql($sqll);
$path='admin/obj_file/fornecedor_avaliacao/';
$vet_peso_img=Array();
$vet_peso_des=Array();

ForEach($rsl->data as $rowl) {
    $foat_imagem         = $rowl['foat_imagem'];
    $foat_descricao      = $rowl['foat_descricao'];
    $classe ='legenda_cab_td';
    $classer='legenda_cab_td';
    $vet_peso_img[$rowl['foa_peso']]=$rowl['foa_imagem'];
    $vet_peso_des[$rowl['foa_peso']]=$rowl['foa_descricao'];

    echo "<div id='legenda_i'> ";
    ImagemProd_b64(16 , 16, $path, $foat_imagem, $foat_descricao);
    echo "   ".$foat_descricao." ";
    echo "</div>";
}

echo "<div id='legenda_l'> ";
echo "Legenda:";
echo "</div>";
echo "</div>";



echo " <div id='contrato_1'> ";

echo "<table class='contrato_table' width='100%' border='0' cellspacing='0' cellpadding='0' vspace='0' hspace='0'> ";
echo "<tr class='contrato_cab_tr'>  ";
echo "   <td class='contrato_cab_td' >&nbsp;"."FORNECEDOR"."</td> ";
echo "   <td class='contrato_cab_td' >&nbsp;"."OBRA"."</td> ";

echo "   <td class='contrato_cab_td' >&nbsp;"."SERVIÇO"."</td> ";
//echo "   <td class='contrato_cab_td' >&nbsp;"."QUALIFICAÇÃO"."</td> ";

echo "   <td class='contrato_cab_td' >&nbsp;"."STATUS"."</td> ";
echo "   <td class='contrato_cab_td' >&nbsp;"."AVALIAÇÃO"."</td> ";
echo "</tr>";
$idt_contrato=0;
$separa='';
$oi_descricao_ac='';

$path='admin/obj_file/contrato_status/';

$patha='admin/obj_file/fornecedor_avaliacao/';
$paths='admin/obj_file/contrato_situacao/';


$row = $rs->data[0];

$razao_social_ant = $row['fo_razao_social'];
$em_descricao_ant = $row['em_descricao'];
$servicos='';
ForEach($rs->data as $row) {
   $idt_contrato       = $row['co_idt'];
   $idt_fornecedor     = $row['co_idt_fornecedor'];
   $razao_social       = $row['fo_razao_social'];
   $fantasia           = $row['fo_fantasia'];
   $oi_descricao       = $row['oi_descricao'];
   $cs_descricao       = $row['cs_descricao'];
   $um_unidade         = $row['um_unidade'];
   $cs_valor_unitario  = format_decimal($row['cs_valor_unitario']);
   $oi_descricao       = $oi_descricao.' - '.$cs_descricao;
   $css_imagem         = $row['css_imagem'];
   $css_descricao      = $row['css_descricao'];
   
   $csi_imagem         = $row['csi_imagem'];
   $csi_descricao      = $row['csi_descricao'];

   
   $em_descricao       = $row['em_descricao'];
   $co_nota            = $row['co_nota'];
   $foa_descricao       = $row['foa_descricao'];
   $foa_imagem          = $row['foa_imagem'];

   if ($razao_social_ant.$em_descricao_ant!=$razao_social.$em_descricao)
   {
       echo "<tr  class='contrato_linha_tr' >  ";
       $classe='contrato_linha_td_a';
       $classer='contrato_linha_td_a_r';
       echo "   <td class='{$classe}' >".$razao_social_ant."</td> ";

       echo "   <td class='{$classe}' >".$em_descricao_ant."</td> ";
       echo "   <td class='{$classe}' >".$servicos."</td> ";
       
       
    //   echo "   <td class='{$classe}' >";
    //     ImagemProd(21 , 21, $path, $css_imagemw, '', False, $css_descricaow);
    //   echo "</td> ";


       echo "   <td class='{$classe}' >";
         ImagemProd_b64(21 , 21, $paths, $csi_imagemw, '', False, $csi_descricaow);
       echo "</td> ";

       
       echo "   <td class='{$classe}' >";
        // echo '   <a href="#" onclick="mostra_avaliacao('."'".$idt_fornecedorw."'".');" >';
         ImagemProd_b64(21 , 21, $patha, $foa_imagemw, '', False, $foa_descricaow);
        // echo '   </a> ';
       echo "</td> ";
       echo "</tr>";
       $servicos='';
       $razao_social_ant=$razao_social;
       $em_descricao_ant=$em_descricao;
   }
   
   $idt_fornecedorw= $idt_fornecedor;
   $fantasiaw      = $fantasia;
   $css_imagemw    = $css_imagem;
   $css_descricaow = $css_descricao;

   $csi_imagemw    = $csi_imagem;
   $csi_descricaow = $csi_descricao;

   
   $co_notaw        = $co_nota;
   $foa_descricaow  = $foa_descricao;
   $foa_imagemw     = $foa_imagem;

   
   
   $servicos       = $servicos.$oi_descricao.'<br>';
}
if ($servicos!='')
{
       echo "<tr  class='contrato_linha_tr' >  ";
       $classe='contrato_linha_td_a';
       $classer='contrato_linha_td_a_r';
       echo "   <td class='{$classe}' >".$razao_social_ant."</td> ";
       echo "   <td class='{$classe}' >".$em_descricao_ant."</td> ";
       echo "   <td class='{$classe}' >".$servicos."</td> ";
  //     echo "   <td class='{$classe}' >";
  //        ImagemProd(21 , 21, $path, $css_imagemw, $css_descricaow);
  //     echo "</td> ";
     //  echo "   <td class='{$classe}' >";
     //    ImagemProd(21 , 21, $patha, $foa_imagemw, '', False, $foa_descricaow);
     //  echo "</td> ";
       echo "   <td class='{$classe}' >";
         ImagemProd_b64(21 , 21, $paths, $csi_imagemw, '', False, $csi_descricaow);
       echo "</td> ";

       echo "   <td class='{$classe}' >";
         //   echo '   <a href="#" onclick="mostra_avaliacao('."'".$idt_fornecedorw."'".');" >';
         ImagemProd_b64(21 , 21, $patha, $foa_imagemw, '', False, $foa_descricaow);
      //   echo '   </a> ';
       echo "</td> ";
       
       echo "</tr>";
}

echo "</table>";

echo " </div> ";

//echo "<div id='contrato_r'> ";
//echo "</div>";

echo " </div> ";



if ($_GET['print'] != 's') {

$url_volta = 'conteudo'.$cont_arq.'.php';
echo ' <div id="voltar_full_m">';
echo ' <div class="voltar">';
echo '         <img src="imagens/menos_full_PCO.jpg" title="Voltar"  alt="Voltar" border="0" onclick="self.location = '."'".$url_volta."'".'" style="cursor: pointer;">';
echo ' </div>';
echo ' </div>';


}
else
{
    echo "<div style='height:25px; width:100%; background:#FF0000; display:block; '>";
    echo '&nbsp;&nbsp;<br />';
    echo '&nbsp;&nbsp;';
    echo "</div>";

}




echo '</form>';

?>

