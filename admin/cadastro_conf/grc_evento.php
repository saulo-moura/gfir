<style type="text/css">
    fieldset.class_frame_display {
        background: white;
        border: none;
    }

    fieldset.class_frame_f {
        background:#2F66B8;
        border:1px solid #FFFFFF;
    }

    div.class_titulo_f {
        background: #2F66B8;
        border    : 1px solid #2C3E50;
        color     : #FFFFFF;
        text-align: left;
        padding-top:10px;
    }

    div.class_titulo_f span {
        padding-left:20px;
        text-align: left;
    }

    fieldset.class_frame_p {
        background:#FFFFFF;
        border:0px solid #FFFFFF;
    }

    div.class_titulo_p {
        background: #2F66B8;
        text-align: left;
        border    : 0px solid #2C3E50;
        color     : #FFFFFF;
        color     : #FFFFFF;
        text-align: left;
        height    : 20px;
        font-size : 12px;
        padding-top:5px;
    }

    div.class_titulo_p span {
        padding:10px;
        text-align: left;
    }

    div.class_titulo_p_barra {
        text-align: left;
        background: #c4c9cd;
        border    : none;
        color     : black;
        font-weight: bold;
        line-height: 12px;
        margin: 0;
        padding: 3px;
        padding-left: 20px;
    }

    fieldset.class_frame {
        background:#FFFFFF;
        border:0px solid #2C3E50;
    }

    div.class_titulo {
        text-align: left;
        background: #c4c9cd;
        border    : none;
        color     : black;
        font-weight: bold;
        line-height: 12px;
        margin: 0;
        padding: 3px;
        padding-left: 10px;
    }

    div.class_titulo_c {
        text-align: center;
        background: #FFFFFF;
        color     : #FFFFFF;
        border    : 0px solid #2C3E50;
    }

    div.class_titulo_c span {
        padding-left:10px;
    }

    Select {
        border:0px;
        height:28px;
    }

    .TextoFixo {
        font-size:12px;
        text-align:left;
        border:0px;
        background:#ECF0F1;
        font-weight:normal;
        font-family: Lato Regular, Calibri, Arial,  Helvetica, sans-serif;
        font-style: normal;
        word-spacing: 0px;
        padding-top:5px;
    }

    td#idt_competencia_obj div {
        color:#FF0000;
    }

    .Tit_Campo,
    .Tit_Campo_Obr {
        font-size:12px;
    }

    td.Titulo {
        color:#666666;
    }

    #idt_instrumento_obj {
        width:100%;
        height: 28px;
        overflow: hidden;
        display: block;
    }

    #idt_instrumento_tf {
        text-align:center;
        font-size:2em;
        background:#2C3E50;
        color:#FFFFFF;
        font-weight:bold;
        font-family: Lato Regular, Calibri, Arial,  Helvetica, sans-serif;
    }

    .Texto {
        padding: 3px;
        padding-top: 5px;
        border:0;
    }

    #idt_foco_tematico_tf {
        background: #ffff80;
    }

    div.Barra {
        display: none;
    }

    #lbl_painel_desc {
        text-align: center;
        color: black;
        font-weight: bold;
        font-size: 16px;
        vertical-align: middle;
    }

    #lbl_painel_desc div {
        padding-bottom: 5px;
        border-bottom: 1px solid #2f66b8;
    } 

    #idt_projeto_obj,
    #idt_acao_obj,
    #dt_previsao_inicial_obj,
    #dt_previsao_fim_obj,
    #quantidade_participante_desc,
    #carga_horaria_total_desc {
        white-space: nowrap;
    }

    #divProtocolo {
        color: #FFFFFF;
        font-weight: bold;
        float: right;
        padding-right: 10px;
        position: relative;
        font-size:12px;
        top: -19px;
    }

    #divPendencia {
        color: #FFFFFF;
        font-weight: bold;
        font-size:12px;
        background:#2C3E50;
        padding-left: 10px;
    }

    .frm_evento_situacao {
        display: none;
    }

    Td.Titulo_radio {
        width: 64px;
    }

    .pfo_af_processo_item_frm Td.Titulo_radio {
        width: auto;
    }

    fieldset.frm_sem_margem {
        margin: 0px
    }

    fieldset.frm_sem_margem > table {
        padding: 0px
    }

    fieldset.frm_left > table {
        width: auto;
        float: left;
    }

    #ano_competencia_desc {
        width: 77px;
    }

    #idt_cidade_obj {
        width: 204px;
    }

    #idt_local_tf {
        width: 267px;
        float: left;
    }

    #publica_internet_tf {
        width: 100px;
    }

    input.qtd_atual {
        background: #F6F6F6;
        color: #000000;
        border: 1px solid #508098;
    }

    .campo_disabled {
        background-color: #ffff80;
    }

    #participacao_sebrae_desc {
        width: 102px;
    }

    .habilitado_fe,
    .cmb_evento_concluio {
        border: 1px solid #a2a2a2;
        height: auto;
    }   

    #nome_aprovador_desc {
        width: 500px;
        text-align: center;
        color: #00297b;
        padding-top: 6px;
    }

    #nome_aprovador_desc div.nome {
        color: red;
        font-size: 24px;
    }

    #nome_aprovador_desc div.dt {
        font-size: 16px;
    }

    #nome_aprovador_desc div.dt span {
        color: red;
    }

    #resumo_evento_receita_despesa_desc .resumo_cab td {
        text-align: center;
        background:#0000FF;
        color:#FFFFFF;
        font-size:14px;
        padding: 5px;
    }

    #resumo_evento_receita_despesa_desc .resumo_det td {
        text-align: center;
        background:#F1F1F1;
        color:#000000;
        font-size:14px;
        padding: 5px;
    }

    #resumo_evento_receita_despesa_desc .resumo_cab td.border_r {
        border-right: 1px solid white;
    }

    #resumo_evento_receita_despesa_desc .resumo_det td.border_r {
        border-right: 1px solid black;
    }

    div.class_titulo_pfo {
        background: #C4C9CD;
        border    : 0px solid #2C3E50;
        color     : #2f66b8;
        text-align: left;
    }

    .pfoObs {
        border: 1px solid #2C3E50;
    }

    #grc_evento_desc Td.Titulo_radio {
        width: auto;
    }

    #nao_sincroniza_rm_desc {
        color: red;
        font-size: 20px;
        font-weight: bold;
    }

    #nao_sincroniza_rm {
        font-weight: bold;
        font-size: 20px;
        line-height: 25px;
    }

    .botao_lista_presenca {
        text-align: center;
        height: 35px;
        color: #FFFFFF;
        background: #2F65BB;
        font-size: 14px;
        cursor: pointer;
        display: inline-block;
        margin-bottom: 10px;
        font-weight: bold;
    }

    .botao_lista_presenca:hover {
        background:#0000FF;
    }

    #grc_evento_agenda_desc td.Registro[data-campo="consolidado_siacweb"] {
        white-space: nowrap;
    }    

    span.agenda_real {
        font-weight: bold;
    }

    fieldset.class_frame_msg {
        background:#FFFFFF;
        border:0px solid #FFFFFF;
    }

    div.class_titulo_msg {
        background: none;
        text-align: left;
        border    : 0px solid #2C3E50;
        color     : red;
        text-align: left;
        height    : auto;
        font-size : 30px;
        padding-top: auto;
        line-height: initial;
    }

    fieldset.mes_prev {
        background: #FFFFFF;
        border: 1px solid #508098;
        padding: 5px 10px;
    }

    .botao_fe {
        text-align: center;
        height: 35px;
        color: #FFFFFF;
        background: #2F65BB;
        font-size: 14px;
        cursor: pointer;
        display: inline-block;
        margin-top: 10px;
        margin-right: 10px;
        font-weight: bold;
    }

    .botao_fe:hover {
        background:#0000FF;
    }

    .certificado_pdf {
        margin-left: 5px;
        cursor: pointer;
    }

    .certificado_pdf > span {
        background-image: url(imagens/bt_print_16.png);
        min-height: 16px;
        min-width: 16px;
        display: inline-block;
        background-repeat: no-repeat;
        vertical-align: middle;
    }

    #arq_ordem_servico_desc {
        color: black;
    }
</style>
<?php
$adm_evento_qtd = $_SESSION[CS]['g_id_usuario'];

// veio de pendencia consultar
$pencon = $_GET['pencon'];

$acaoOrg = $acao;

if ($origem_evento_tela == 'combo') {
    $_GET['idt_instrumento'] = 54;
} else {
    if ($_POST['btnAcao'] == $bt_excluir_lbl && $acao == 'exc') {
        $_POST['btnAcao'] = $bt_alterar_lbl;
        $acao = 'alt';
        $_GET['acao'] = $acao;
    }
}

$voltar = $_GET['voltar'];

$barra_bt_top = false;

if ($voltar == 'pendencia_home') {
    $botao_acao = '<script type="text/javascript">self.location = "conteudo.php";</script>';
    $botao_volta = "self.location = 'conteudo.php';";
} else if ($voltar == 'pendencia_listar') {
    $botao_acao = '<script type="text/javascript">self.location = "' . $_SESSION[CS]['pendencia_listar'] . '";</script>';
    $botao_volta = "self.location = '" . $_SESSION[CS]['pendencia_listar'] . "';";
} else if ($origem_evento_tela == 'grc_evento_nf') {
    $botao_acao = '<script type="text/javascript">self.location = "' . $_SESSION[CS]['grc_evento_nf_listar'] . '";</script>';
    $botao_volta = "self.location = '" . $_SESSION[CS]['grc_evento_nf_listar'] . "';";
} else if ($origem_evento_tela == 'combo') {
    $botao_acao = '<script type="text/javascript">self.location = "' . $_SESSION[CS]['grc_evento_combo_listar'] . '";</script>';
    $botao_volta = "self.location = '" . $_SESSION[CS]['grc_evento_combo_listar'] . "';";
} else if ($origem_evento_tela == 'grc_evento_publicar_acao') {
    $botao_acao = '<script type="text/javascript">parent.hidePopWin(false);</script>';
    $botao_volta = "parent.hidePopWin(false);";
} else if ($origem_evento_tela == 'grc_evento_despublicacao_acao') {
    $botao_acao = '<script type="text/javascript">parent.hidePopWin(false);</script>';
    $botao_volta = "parent.hidePopWin(false);";
} else if ($origem_evento_tela != 'compra' && $origem_evento_tela != 'monitor' && $origem_evento_tela != 'grc_evento_acompanhar') {
    $botao_acao = '<script type="text/javascript">self.location = "' . $_SESSION[CS]['grc_evento_listar'] . '";</script>';
    $botao_volta = "self.location = '" . $_SESSION[CS]['grc_evento_listar'] . "';";
}

if ($pencon == "S") {
    $url = "conteudo.php?prefixo=listar&menu=grc_atendimento_pendencia_consulta&origem_tela=painel&cod_volta=grc_funil_painel&RETNI=S";
    $botao_acao = '<script type="text/javascript">self.location = "' . $url . '";</script>';
    $botao_volta = "self.location = '" . $url . "';";
}

if ($_GET['idCad'] != '') {
    $botao_volta = "parent.btFechaCTC('" . $_GET['session_cod'] . "', parent.funcaoFechaCTC_grc_evento_participante);";
    $botao_acao = '<script type="text/javascript">parent.btFechaCTC("' . $_GET['session_cod'] . '", parent.funcaoFechaCTC_grc_evento_participante);</script>';
}

$onSubmitDep = 'grc_evento_dep()';

$tabela = 'grc_evento';
$id = 'idt';

$vetTipoAgenda = Array(
    'Consultoria' => 'Consultoria',
    'Instrutoria' => 'Instrutoria',
    'Ambos' => 'Ambos',
);

$direito_geral = 0;
$grc_es_vai_para = "";
$grc_es_volta_para = "";
$grc_evento_temporario = '';
$idt_unidade = 0;
$idt_evento = 0;
$idt_produto = 0;
$deveaprovar = 0;

$veio = '';

if ($acao != "inc") {
    $idt_evento_situacao = 0;
    $sql = "select grc_e.*, grc_es.codigo as grc_es_codigo, grc_es.vai_para as grc_es_vai_para, grc_es.volta_para as grc_es_volta_para, gec_prog.tipo_ordem";
    $sql .= ' from grc_evento grc_e';
    $sql .= " inner join  grc_evento_situacao grc_es on grc_es.idt =     grc_e.idt_evento_situacao ";
    $sql .= ' left outer join ' . db_pir_gec . 'gec_programa gec_prog on gec_prog.idt = grc_e.idt_programa';
    $sql .= " where grc_e.idt = " . null($_GET['id']);
    $rs = execsql($sql);
    ForEach ($rs->data as $row) {
        $parecer = $row['parecer'];
        $descricao_copia = $row['descricao'];
        $codigo_evento = $row['codigo'];
        $grc_es_codigo = $row['grc_es_codigo'];
        $grc_evento_temporario = $row['temporario'];
        $grc_es_vai_para = $row['grc_es_vai_para'];
        $grc_es_volta_para = $row['grc_es_volta_para'];
        $idt_instrumento = $row['idt_instrumento'];
        $idt_evento_situacao = $row['idt_evento_situacao'];
        $dt_inicio_aprovacao = $row['dt_inicio_aprovacao'];
        $idt_unidade = $row['idt_unidade'];
        $idt_ponto_atendimento_tela = $row['idt_ponto_atendimento_tela'];
        $idt_cidade = $row['idt_cidade'];
        $idt_produto = $row['idt_produto'];
        $idt_responsavel = $row['idt_responsavel'];
        $idt_gestor_evento = $row['idt_gestor_evento'];
        $idt_responsavel_consultor = $row['idt_responsavel_consultor'];
        $consolidacao_mesanocompetencia = $row['mesanocompetencia'];
        $veio = $row['tipo_ordem'];
        $idt_evento_motivo_cancelamento = $row['idt_evento_motivo_cancelamento'];
        $motivo_cancelamento = $row['motivo_cancelamento'];
        $parecer_cancelamento = $row['parecer_cancelamento'];
        $previsao_despesa = $row['previsao_despesa'];
        $sincroniza_loja = $row['sincroniza_loja'];
        $idt_evento_pai = $row['idt_evento_pai'];
        $composto = $row['composto'];
        $publica_internet = $row['publica_internet'];
        $obrigar_pesq_certificado = $row['obrigar_pesq_certificado'];
        $dt_previsao_inicial = $row['dt_previsao_inicial'];
        $hora_inicio = $row['hora_inicio'];
        $dt_previsao_fim = $row['dt_previsao_fim'];
        $hora_fim = $row['hora_fim'];
        $tipo_sincroniza_siacweb = $row['tipo_sincroniza_siacweb'];
        $tipo_sincroniza_siacweb_old = $row['tipo_sincroniza_siacweb_old'];
        $idt_programa = $row['idt_programa'];
        $arq_ordem_servico = $row['arq_ordem_servico'];
        $cred_necessita_credenciado = $row['cred_necessita_credenciado'];
        $siac_at_erro_con = $row['siac_at_erro_con'];
        $nao_sincroniza_rm = $row['nao_sincroniza_rm'];
        $sgtec_modelo = $row['sgtec_modelo'];
        $vl_determinado = $row['vl_determinado'];
        $evento_acesso_descricao = $row['evento_acesso_descricao'];
        $evento_acesso_descricao_md5 = $row['evento_acesso_descricao_md5'];
        $data_criacao = $row['data_criacao'];
        $inc_cliente_prev = $row['inc_cliente_prev'];
        $inc_cliente_dt_ini = $row['inc_cliente_dt_ini'];
    }
    $codigo_atual = $grc_es_codigo;
    $idt_evento = $_GET['id'];

    $tmp = $_SESSION[CS]['g_id_usuario'];
    $tmp = (string) $tmp;

    if ($tmp === $idt_gestor_evento) {
        $login_gestor_evento = 'S';
    } else {
        $login_gestor_evento = 'N';
    }

    if (($voltar == 'pendencia_home' || $voltar == 'pendencia_listar') and $idt_evento_situacao == 6) {
        $deveaprovar = 1;
    }

    if ($idt_evento_situacao != 1 && $idt_evento_situacao != 5) {
        $acao_alt_con = 'S';
    }
} else {
    $idt_evento_situacao = 1;
    $idt_instrumento = $_GET['idt_instrumento'];
    $codigo_atual = '01';
    if ($idt_instrumento == '') {   // é erro assumir como curso
        $idt_instrumento = 40;
    }

    $idt_evento = GravarEvento($idt_instrumento);
    $grc_evento_temporario = 'S';

    if ($_GET['idt_instrumento'] == 54) {
        $urlMenu = 'grc_evento_combo_cad';
    } else {
        $urlMenu = 'grc_evento';
    }

    $href = "conteudo.php?prefixo=cadastro&menu={$urlMenu}&idt_instrumento=" . $_GET['idt_instrumento'] . '&acao=alt' . "&id=" . $idt_evento;
    $botao_acao = '<script type="text/javascript">self.location = "' . $href . '";</script>';
    echo $botao_acao;
}

//Registra as matriculas do Voucher B aprovados
$sql = '';
$sql .= ' select vr.idt, vr.cpf, vr.nome_pessoa';
$sql .= ' from ' . db_pir_grc . 'grc_evento_publicacao_voucher_registro vr';
$sql .= " inner join " . db_pir_grc . "grc_evento_publicacao_voucher v on v.idt = vr.idt_evento_publicacao_voucher";
$sql .= " inner join " . db_pir_grc . "grc_evento_publicacao ep on ep.idt = vr.idt_evento_publicacao";
$sql .= ' where ep.idt_evento = ' . null($idt_evento);
$sql .= " and ep.situacao = 'AP'";
$sql .= ' and v.idt_tipo_voucher = ' . null($vetTipoVoucherCodIDT['B']);
$sql .= " and vr.ativo = 'S'";
$sql .= ' and vr.idt_matricula_utilizado is null';
$rs = execsql($sql);

if ($rs->rows > 0) {
    $row_e = Array(
        'idt' => $idt_evento,
        'idt_instrumento' => $idt_instrumento,
    );

    beginTransaction();

    foreach ($rs->data as $row_par) {
        $row = Array();
        novoInscricaoEvento($row_e, $row, $row_par, 'PIR');

        $sql = 'update grc_evento_publicacao_voucher_registro';
        $sql .= ' set dt_utilizacao = now(),';
        $sql .= ' idt_matricula_utilizado = ' . null($row['idt_atendimento']);
        $sql .= ' where idt = ' . null($row_par['idt']);
        execsql($sql);

        $sql = 'update grc_atendimento_pessoa';
        $sql .= ' set nome = ' . aspa($row_par['nome_pessoa']);
        $sql .= ' where idt = ' . null($row['idt_atendimento_pessoa']);
        $sql .= " and nome = 'Cliente Novo'";
        execsql($sql);
    }

    commit();
}

if ($idt_instrumento == 54) {
    $origem_evento_tela = 'combo';
}

checaMatFEprazo($idt_evento);

$so_inscricao = false;

if ($origem_evento_tela == 'grc_evento_acompanhar') {
    $_GET['acao'] = 'con';
    $acao = 'con';
} else
if ($origem_evento_tela == 'grc_evento_nf') {
    $acao_alt_con = 'S';
} else {
    if (acesso($menu, "'PER'", false)) {
        $acao_alt_con = 'S';
        $so_inscricao = true;
    }
}

if ($origem_evento_tela == 'compra' && $acao != 'con' && ($idt_evento_situacao == 4 || $idt_evento_situacao == 21 || $idt_evento_situacao == 22)) {
    $_GET['acao'] = 'con';
    $acao = 'con';
}

if ($origem_evento_tela == 'combo') {
    if ($_GET['idt_pendencia'] == '' && $idt_evento_situacao == 6) {
        $sql = '';
        $sql .= ' select idt';
        $sql .= ' from grc_atendimento_pendencia';
        $sql .= ' where idt_evento_combo_origem  = ' . null($idt_evento);
        $sql .= ' and idt_responsavel_solucao = ' . null($_SESSION[CS]['g_id_usuario']);
        $sql .= " and ativo = 'S'";
        $sql .= " and tipo = 'Evento Combo'";
        $sql .= whereAtendimentoPendencia();
        $rs = execsql($sql);
        $_GET['idt_pendencia'] = $rs->data[0][0];
    }
} else {
    if ($_GET['idt_pendencia'] == '' && ($idt_evento_situacao == 2 || $idt_evento_situacao == 3 || $idt_evento_situacao == 7)) {
        $sql = '';
        $sql .= ' select idt';
        $sql .= ' from grc_atendimento_pendencia';
        $sql .= ' where idt_evento  = ' . null($idt_evento);
        $sql .= ' and idt_responsavel_solucao = ' . null($_SESSION[CS]['g_id_usuario']);
        $sql .= " and ativo = 'S'";
        $sql .= " and tipo = 'Evento'";
        $sql .= whereAtendimentoPendencia();
        $rs = execsql($sql);
        $_GET['idt_pendencia'] = $rs->data[0][0];
    }
}

if ($origem_evento_tela == '' && $acao == 'alt' && $veio == 'SG' && $sgtec_modelo == 'E' && $vl_determinado == 'N' && $idt_evento_situacao == 8) {
    $alt_projeto = 'S';
} else {
    $alt_projeto = 'N';
}

$campoObr = true;

function parametrosTitulo(&$vetParametros) {
    global $origem_evento_tela;

    if ($origem_evento_tela == 'grc_evento_acompanhar') {
        $vetParametros['controle_fecha'] = 'F';
    }
}

function codigoAgenda() {
    global $idt_evento, $idt_instrumento, $composto, $vetFrm, $veio, $vetSimNao, $origem_evento_tela,
    $tabela, $class_frame, $class_titulo, $titulo_na_linha, $idt_evento_situacao,
    $class_frame_p, $class_titulo_p, $titulo_na_linha_p, $classet, $classer,
    $vetCampo, $campoObr, $sgtec_modelo, $idt_evento_pai, $dt_previsao_inicial, $dt_previsao_fim;

    if ($composto == 'S' || $origem_evento_tela == 'combo') {
        $classPai = ' frm_evento_situacao';
        $agendaObr = false;
    } else {
        $classPai = '';

        if ($idt_evento_pai == '') {
            $agendaObr = $campoObr;
        } else {
            $agendaObr = false;
        }
    }

    if ($idt_instrumento == 2) {
        $vetParametros = Array(
            'codigo_frm' => 'agenda',
            'controle_fecha' => 'A',
        );

        parametrosTitulo($vetParametros);

        if ($veio == 'SG' && $sgtec_modelo == 'E') {
            $titulo = 'Entregas';
        } else {
            $titulo = 'Cronograma / Atividades';
        }

        $vetFrm[] = Frame('<span>' . $titulo . '</span>', '', $class_frame_p . $classPai, $class_titulo_p, $titulo_na_linha_p, $vetParametros);

        $vetCampoLC = Array();
        $vetPadrao = Array(
            'barra_inc_ap' => false,
            'barra_alt_ap' => false,
            'barra_con_ap' => true,
            'barra_exc_ap' => false,
        );

        if ($veio == 'SG' && $sgtec_modelo == 'E') {
            $vetCampoLC['pessoa'] = CriaVetTabela('Cliente');
            $vetCampoLC['codigo'] = CriaVetTabela('Código');
            $vetCampoLC['descricao'] = CriaVetTabela('Atividade');
            $vetCampoLC['mesano'] = CriaVetTabela('Mês/Ano');
            $vetCampoLC['percentual'] = CriaVetTabela('Percentual', 'decimal');

            $TabelaPrinc = "grc_evento_entrega";
            $AliasPric = "grc_ppa";
            $Entidade = "Entregas";
            $Entidade_p = "Entregas";
            $CampoPricPai = "idt_evento";

            $sql = "select {$AliasPric}.*,";
            $sql .= " concat_ws('<br />', grc_atpe.cpf, grc_atpe.nome) as pessoa";
            $sql .= " from {$TabelaPrinc} {$AliasPric}  ";
            $sql .= " left outer join grc_atendimento_pessoa grc_atpe on grc_atpe.tipo_relacao = 'L' and grc_atpe.idt_atendimento = {$AliasPric}.idt_atendimento";
            $sql .= " left outer join grc_evento_participante ep on ep.idt_atendimento = {$AliasPric}.idt_atendimento";
            $sql .= " where {$AliasPric}" . '.idt_evento = $vlID';
            $sql .= whereEventoParticipante();
            $sql .= " order by grc_atpe.nome, {$AliasPric}.ordem";

            $vetCampo['grc_evento_entrega'] = objListarConf('grc_evento_entrega', 'idt', $vetCampoLC, $sql, $titulo, $agendaObr, $vetPadrao);

            $vetCampo['dt_previsao_inicial']['valida'] = false;
            $vetCampo['dt_previsao_fim']['valida'] = false;
            $vetCampo['hora_inicio']['valida'] = false;
            $vetCampo['hora_fim']['valida'] = false;

            $vetCampo['dt_previsao_inicial']['campo_tabela'] = false;
            $vetCampo['dt_previsao_fim']['campo_tabela'] = false;

            $vetCampo['dt_previsao_inicial']['vl_padrao'] = trata_data($dt_previsao_inicial);
            $vetCampo['dt_previsao_fim']['vl_padrao'] = trata_data($dt_previsao_fim);

            $vetFrm[] = Frame('', Array(
                Array($vetCampo['dt_previsao_inicial'], '', $vetCampo['dt_previsao_fim'], '', $vetCampo['hora_inicio'], '', $vetCampo['hora_fim']),
                    ), $class_frame . $classPai . ' frm_evento_situacao', $class_titulo, $titulo_na_linha);

            $vetParametros = Array(
                'codigo_pai' => 'agenda',
            );

            $vetFrm[] = Frame('', Array(
                Array($vetCampo['custo_tot_consultoria'], '', $vetCampo['cep'], '', $vetCampo['idt_cidade']),
                    ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);

            $vetParametros = Array(
                'codigo_pai' => 'agenda',
                'width' => '100%',
            );

            $vetFrm[] = Frame('', Array(
                Array($vetCampo['grc_evento_entrega']),
                    ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);
        } else {
            $vetCampoLC['pessoa'] = CriaVetTabela('Cliente');
            $vetCampoLC['atividade'] = CriaVetTabela('Atividade');
            $vetCampoLC['data_inicial'] = CriaVetTabela('Data do Encontro', 'data');
            $vetCampoLC['hora_inicial'] = CriaVetTabela('Hora Inicial');
            $vetCampoLC['hora_final'] = CriaVetTabela('Hora Final');
            $vetCampoLC['carga_horaria'] = CriaVetTabela('Carga Horária', 'decimal');

            if ($veio != 'SG') {
                $vetCampoLC['valor_hora'] = CriaVetTabela('Valor da Hora', 'decimal');
            }

            $vetCampoLC['tema'] = CriaVetTabela('Tema');
            $vetCampoLC['subtema'] = CriaVetTabela('Sub-tema');
            $vetCampoLC['consolidado_siacweb'] = CriaVetTabela('Status', 'func_trata_dado', ftd_grc_evento_consolidado_siacweb);

            $TabelaPrinc = "grc_evento_agenda";
            $AliasPric = "grc_ppa";
            $Entidade = "Cronograma / Atividades";
            $Entidade_p = "Cronograma / Atividades";
            $CampoPricPai = "idt_evento";

            $sql = "select {$AliasPric}.*, $idt_instrumento as idt_instrumento,";
            $sql .= " ea.consolidado_cred, ea.consolidado_siacweb,";
            $sql .= "       grc_t.descricao as tema, ";
            $sql .= "       grc_ts.descricao as subtema, ";
            $sql .= " concat_ws('<br />', grc_atpe.cpf, grc_atpe.nome) as pessoa";
            $sql .= " from {$TabelaPrinc} {$AliasPric}  ";
            //$sql .= " inner join ".db_pir_siac."cidade c on c.codcid = {$AliasPric}.idt_cidade";
            //$sql .= " inner join grc_evento_local_pa l on l.idt = {$AliasPric}.idt_local";
            $sql .= " left outer join grc_tema_subtema grc_t on grc_t.idt = {$AliasPric}.idt_tema ";
            $sql .= " left outer join grc_tema_subtema grc_ts on grc_ts.idt = {$AliasPric}.idt_subtema ";
            $sql .= " left outer join grc_atendimento_pessoa grc_atpe on grc_atpe.tipo_relacao = 'L' and grc_atpe.idt_atendimento = {$AliasPric}.idt_atendimento";
            $sql .= " left outer join grc_evento_participante ep on ep.idt_atendimento = {$AliasPric}.idt_atendimento";
            $sql .= " left outer join grc_evento_atividade ea on ea.idt = {$AliasPric}.idt_evento_atividade ";
            $sql .= " where {$AliasPric}" . '.idt_evento = $vlID';
            $sql .= whereEventoParticipante();
            $sql .= " and (ep.ativo is null or ep.ativo = 'S')";

            $sql .= " order by {$AliasPric}.data_inicial, {$AliasPric}.atividade";

            $vetCampo['grc_evento_agenda'] = objListarConf('grc_evento_agenda', 'idt', $vetCampoLC, $sql, $titulo, $agendaObr, $vetPadrao);

            $vetFrm[] = Frame('', Array(
                Array($vetCampo['dt_previsao_inicial'], '', $vetCampo['dt_previsao_fim'], '', $vetCampo['hora_inicio'], '', $vetCampo['hora_fim']),
                    ), $class_frame . $classPai . ' frm_evento_situacao', $class_titulo, $titulo_na_linha);

            $vetParametros = Array(
                'codigo_pai' => 'agenda',
            );

            $vetFrm[] = Frame('', Array(
                Array($vetCampo['tot_hora_consultoria'], '', $vetCampo['custo_tot_consultoria'], '', $vetCampo['cep'], '', $vetCampo['idt_cidade']),
                    ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);

            $vetParametros = Array(
                'codigo_pai' => 'agenda',
                'width' => '100%',
            );

            $vetFrm[] = Frame('', Array(
                Array($vetCampo['grc_evento_agenda']),
                    ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);
        }
    } else {
        $vetParametros = Array(
            'codigo_frm' => 'agenda',
            'controle_fecha' => 'A',
        );

        parametrosTitulo($vetParametros);

        $vetFrm[] = Frame('<span>Agenda</span>', '', $class_frame_p . $classPai, $class_titulo_p, $titulo_na_linha_p, $vetParametros);

        $vetCampoLC = Array();
        $vetPadrao = Array();

        if ($veio == 'SG') {
            $vetCampoLC['data_inicial'] = CriaVetTabela('Data do Encontro', 'data');
            $vetCampoLC['carga_horaria'] = CriaVetTabela('Carga Horária', 'decimal');
            $vetCampoLC['observacao'] = CriaVetTabela('Atividade');
            $vetCampoLC['cidade'] = CriaVetTabela('Cidade');
            $vetCampoLC['local'] = CriaVetTabela('Local/Sala');
            $vetCampoLC['alocacao_disponivel'] = CriaVetTabela('Local/Sala disponível?', 'descDominio', $vetSimNao);
        } else {
            $vetCampoLC['data_inicial'] = CriaVetTabela('Data do Encontro', 'data');
            $vetCampoLC['hora_inicial'] = CriaVetTabela('Hora Inicial');
            $vetCampoLC['hora_final'] = CriaVetTabela('Hora Final');
            $vetCampoLC['carga_horaria'] = CriaVetTabela('Carga Horária', 'decimal');
            $vetCampoLC['cidade'] = CriaVetTabela('Cidade');
            $vetCampoLC['local'] = CriaVetTabela('Local/Sala');
            $vetCampoLC['alocacao_disponivel'] = CriaVetTabela('Local/Sala disponível?', 'descDominio', $vetSimNao);
        }

        $titulo = 'Agenda do Evento';

        $TabelaPrinc = "grc_evento_agenda";
        $AliasPric = "grc_ppa";
        $Entidade = "Agenda da Programação de Produto";
        $Entidade_p = "Agendas da Programação de Produto";
        $CampoPricPai = "idt_evento";

        $sql = "select {$AliasPric}.*, c.desccid as cidade, l.descricao as local,";
        $sql .= " concat_ws('<br />', grc_atpe.cpf, grc_atpe.nome) as pessoa";
        $sql .= " from {$TabelaPrinc} {$AliasPric}  ";
        $sql .= " inner join " . db_pir_siac . "cidade c on c.codcid = {$AliasPric}.idt_cidade";
        $sql .= " inner join grc_evento_local_pa l on l.idt = {$AliasPric}.idt_local";
        $sql .= " left outer join grc_atendimento_pessoa grc_atpe on grc_atpe.tipo_relacao = 'L' and grc_atpe.idt_atendimento = {$AliasPric}.idt_atendimento";
        $sql .= " left outer join grc_evento_participante ep on ep.idt_atendimento = {$AliasPric}.idt_atendimento";
        $sql .= " where {$AliasPric}" . '.idt_evento = $vlID';
        $sql .= whereEventoParticipante();
        $sql .= " and (ep.ativo is null or ep.ativo = 'S')";
        $sql .= " order by {$AliasPric}.dt_ini, {$AliasPric}.dt_fim";

        $vetCampo['grc_evento_agenda'] = objListarConf('grc_evento_agenda', 'idt', $vetCampoLC, $sql, $titulo, $agendaObr, $vetPadrao);

        $sql = '';
        $sql .= ' select count(ea.idt) as tot';
        $sql .= ' from grc_evento_agenda ea';
        $sql .= " left outer join grc_evento_participante ep on ep.idt_atendimento = ea.idt_atendimento";
        $sql .= " where ea.alocacao_disponivel = 'N'";
        $sql .= ' and ea.idt_evento = ' . null($idt_evento);
        $sql .= whereEventoParticipante();
        $sql .= " and (ep.ativo is null or ep.ativo = 'S')";
        $rst = execsql($sql);
        $vetCampo['grc_evento_agenda_erro'] = objHidden('grc_evento_agenda_erro', $rst->data[0][0], '', '', false);

        $vetParametros = Array(
            'width' => '100%',
        );

        $vetFrm[] = Frame('', Array(
            Array($vetCampo['dt_previsao_inicial'], '', $vetCampo['dt_previsao_fim'], '', $vetCampo['hora_inicio'], '', $vetCampo['hora_fim'], '', $vetCampo['idt_cidade'], '', $vetCampo['idt_local']),
                ), $class_frame . ' frm_evento_situacao', $class_titulo, $titulo_na_linha, $vetParametros);

        $vetParametros = Array(
            'codigo_pai' => 'agenda',
            'width' => '100%',
        );

        $vetFrm[] = Frame('', Array(
            Array($vetCampo['grc_evento_agenda']),
            Array($vetCampo['grc_evento_agenda_erro']),
                ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);
    }
}

// novo avaliação etrelinha
//// Avaliação
$vet = AvaliacaoEstrelinhaMediaEvento($_GET['id']);
$quantidade = $vet['quantidade'];
$total_pontos = $vet['total_pontos'];
$media = $vet['media'];
$img = $vet['imagem'];
$avaliacao_img = $img;

$texto_evento = "<div style='float:left; font-size:2em; padding-right:10px;'>Quantidade de Avaliações: {$quantidade} Total de Pontos: {$total_pontos} Média: {$media} </div>" . $avaliacao_img;
$vetCampo_av['avaliacao_estrelinha'] = objInclude('avaliacao_estrelinha', $texto_evento);

$sql = "select *";
$sql .= ' from grc_produto';
$sql .= " where idt  = " . null($idt_produto);
$rs = execsql($sql);
$rowp = $rs->data[0];

if ($rowp['generico'] == 'S') {
    $bloquear_descricao = 'N';
} else {
    $bloquear_descricao = 'S';
}

if ($veio == 'SG') {
    $sql = '';
    $sql .= ' select idt';
    $sql .= ' from grc_atendimento';
    $sql .= ' where idt_evento = ' . null($idt_evento);
    $rst = execsql($sql);
    $campoObr = $rst->rows > 0;

    if ($idt_evento_situacao == 14 || $idt_evento_situacao == 16 || $idt_evento_situacao == 19) {
        $sql = '';
        $sql .= ' select p.idt';
        $sql .= ' from grc_evento_participante_pagamento p';
        $sql .= ' inner join grc_atendimento a on a.idt = p.idt_atendimento';
        $sql .= ' where a.idt_evento = ' . null($idt_evento);
        $sql .= " and p.estornado <> 'S'";
        $sql .= " and p.operacao = 'C'";
        $sql .= ' and p.idt_aditivo_participante is null';
        $sql .= ' and p.rm_idmov is null';
        $rs = execsql($sql);

        if ($rs->rows > 0) {
            alert('Favor verificar os Clientes Atendidos que podem ser alterados, pois tem pendencia na integração do pagamento com o RM!');
        }
    }
} else {
    $campoObr = true;
}

if ($idt_evento_pai == '') {
    $obrCompostoHidden = true;
} else {
    $obrCompostoHidden = false;
}

if ($origem_evento_tela == 'combo') {
    $obrCompostoHidden = false;
    $campoObr = false;
}

$vetCampo['situacao'] = objHidden('situacao', '', '', '', false);
$vetCampo['idt_gestor_projeto'] = objHidden('idt_gestor_projeto', '');
$vetCampo['idt_programa'] = objHidden('idt_programa', '');
$vetCampo['dt_inicio_aprovacao'] = objHidden('dt_inicio_aprovacao', '');
$vetCampo['contrapartida_sgtec'] = objHidden('contrapartida_sgtec', '');

$corbloq = "#FFFF80";
$jst = " readonly='true' style='background:{$corbloq}; font-size:12px; xwidth:100%;' ";
$vetCampo['codigo'] = objTexto('codigo', 'Código GRC', false, 10, 45, $jst);
$vetCampo['codigo_siacweb'] = objTexto('codigo_siacweb', 'Código Siacweb', false, 10, 45, $jst);

$vetCampo['copia'] = objInteiro('copia', 'Cópia', false, 5);

$sql = "select idt, descricao from grc_evento_situacao ";
$sql .= " order by codigo";
$vetCampo['idt_evento_situacao'] = objCmbBanco('idt_evento_situacao', 'Status', true, $sql, '', 'width:300px;');

$vetCampo['ativo'] = objCmbVetor('ativo', 'Ativo?', True, $vetSimNao, '');

if ($veio == 'SG') {
    $vetCampo['qtd_vagas_adicional'] = objHidden('qtd_vagas_adicional', '');
} else {
    $vetCampo['qtd_vagas_adicional'] = objInteiro('qtd_vagas_adicional', 'Qtde. adicional de Participantes', true, 10);
}

$vetCampo['gratuito'] = objHidden('gratuito', 'N');

$vetCampo['disponibiliza_portal'] = objCmbVetor('disponibiliza_portal', 'Disponibiliza no Portal?', True, $vetSimNao);
$vetCampo['permite_cancelar'] = objCmbVetor('permite_cancelar', 'Permite Cancelar?', True, $vetSimNao);

$maxlength = 2000;
$style = "width:700px;";
$js = "";

//$vetCampo['objeto'] = objTextArea('objeto', 'Objeto', false, $maxlength, $style, $js);

$maxlength = 1000;
$style = "width:98%;";
$js = " ";
$vetCampo['resultado_esperado'] = objTextArea('resultado_esperado', 'Resultados Esperados (Limitado a 1000 caracteres)', true, $maxlength, $style, $js);

$vetCampo['tipo_consultor'] = objCmbVetor('tipo_consultor', 'Credenciado?', True, $vetSimNao, '');

$js = " disabled='true' readonly='true' style='background:{$corbloq}; font-size:12px;' ";
$vetCampo['valor_hora'] = objDecimal('valor_hora', 'Valor da Hora', true, 15, 15, 2, $js, 0);

$vetCampo['justificativa'] = objHTML('justificativa', 'Justificativa', false, $altura, $largura, $js);

$vetCampo_w['idt_produto'] = objListarCmb('idt_produto', 'grc_produto_evento_cmb', 'Produto', true, '380px');
$vetCampo_w['vinculo_texto'] = objTexto('vinculo_texto', 'Observação Complementar', false, 35, 255);

$vetCampo['etapas_desenvolvimento'] = objInclude('etapas_desenvolvimento', 'cadastro_conf/evento_etapa_desenvolvimento.php');

$style = "width:340px;";
$vetCampo['forma_pagamento'] = objTextArea('forma_pagamento', 'Forma de Pagamento', false, $maxlength, $style, $js);
$vetCampo['previsao_passagem_viagem'] = objTextArea('previsao_passagem_viagem', 'Previsão de Passagem e de Viagem', false, $maxlength, $style, $js);
$vetCampo['direito_autoral'] = objTextArea('direito_autoral', 'Direitos Autorais', false, $maxlength, $style, $js);
$vetCampo['outros'] = objTextArea('outros', 'Outros', false, $maxlength, $style, $js);

$style = "width:700px;";

// SECAO NEGÓCIO SUPERIOR
$sql = "select idt,  descricao from " . db_pir . "sca_organizacao_secao ";
$sql .= " order by codigo";
$vetCampo['idt_secao_negs'] = objCmbBanco('idt_secao_negs', 'Unidade/Escritório', true, $sql, ' ', 'width:200px;');

// SECAO NEGOCIO
$sql = "select idt,  descricao from " . db_pir . "sca_organizacao_secao ";
$sql .= " order by codigo";
$vetCampo['idt_secao_neg'] = objCmbBanco('idt_secao_neg', 'Unidade de Negócio', false, $sql, ' ', 'width:200px;');

$vetCampo['idt_projeto'] = objListarCmb('idt_projeto', 'grc_projeto', 'Projeto', $obrCompostoHidden, '430px');
$vetCampo['idt_acao'] = objListarCmb('idt_acao', 'grc_projeto_acao', '<br />Ação do Projeto', $obrCompostoHidden, '430px');

$vetCampo['lbl_painel'] = objBarraTitulo('lbl_painel', 'Painel Anual');

$vetCampo['peca_padrao'] = objCmbVetor('peca_padrao', 'Qual o estilo de Peça?', True, $vetEventoPecaPadrao, '');

// PEÇA ASSOCIADA AO EVENTO - EMAIL - UAIN
$sql = "select idt,  descricao from grc_agenda_emailsms ";
$sql .= " where origem = 'P'";
$sql .= "   and proprietario = 'UAIN'";
$sql .= " order by codigo";
$vetCampo['idt_peca'] = objCmbBanco('idt_peca', 'Peça Criada pela UAIN', false, $sql, ' ', 'width:200px;');

// PEÇA ASSOCIADA AO EVENTO - EMAIL - GESTOR
$sql = "select idt,  descricao from grc_agenda_emailsms ";
$sql .= " where origem = 'P'";
$sql .= "   and proprietario = 'GESTOR'";
$sql .= "   and idt_responsavel = " . null($_SESSION[CS]['g_id_usuario']);
$sql .= " order by codigo";
$vetCampo['idt_peca_evento'] = objCmbBanco('idt_peca_evento', 'Peça criada pelo Gestor', false, $sql, ' ', 'width:200px;');

$par = 'idt_peca';
$vetDesativa['peca_padrao'][0] = vetDesativa($par, ',S,G');
$vetAtivadoObr['peca_padrao'][0] = vetAtivadoObr($par, 'N');

$par = 'idt_peca_evento';
$vetDesativa['peca_padrao'][1] = vetDesativa($par, ',S,N');
$vetAtivadoObr['peca_padrao'][1] = vetAtivadoObr($par, 'G');


$vetCampo['peca_exibe_padrao'] = objInclude('peca_exibe_padrao', 'cadastro_conf/obj_peca_exibe_padrao.php');
$vetCampo['peca_exibe_uain'] = objInclude('peca_exibe_uain', 'cadastro_conf/obj_peca_exibe_uain.php');
$vetCampo['peca_gestor'] = objInclude('peca_gestor', 'cadastro_conf/obj_peca_gestor.php');

$vetAnoComp = Array();

if ($vetConf['evento_ano_competencia_max'] == '') {
    $vetConf['evento_ano_competencia_max'] = date('Y');
}

for ($index = 2015; $index <= $vetConf['evento_ano_competencia_max']; $index++) {
    $vetAnoComp[$index] = $index;
}

$vetCampo['ano_competencia'] = objCmbVetor('ano_competencia', 'Ano de Competencia', $obrCompostoHidden, $vetAnoComp, ' ', '', '', true, date('Y'));
$vetCampo['gestor_sge'] = objTextoFixo('gestor_sge', '<br />Gestor SGE', '', true);
$vetCampo['fase_acao_projeto'] = objTextoFixo('fase_acao_projeto', '<br />Fase', '', true);

$vetCampo['qtd_previsto'] = objTextoFixo('qtd_previsto', 'Métrica:<br />Previsão (Fonte: SGE)', 17, true);
$vetCampo['qtd_realizado'] = objTextoFixo('qtd_realizado', '<br />Execução (Fonte: CRM)', 15, true);
$vetCampo['qtd_percentual'] = objTextoFixo('qtd_percentual', '<br />(%)', 10, true);
$vetCampo['qtd_saldo'] = objTextoFixo('qtd_saldo', '<br />Saldo (Fonte: SGE - CRM)', 15, true);

$vetCampo['orc_previsto'] = objTextoFixo('orc_previsto', 'Orçamento:<br />Previsão (Fonte: RM)', 17, true);
$vetCampo['orc_realizado'] = objTextoFixo('orc_realizado', '<br />Execução (Fonte: RM)', 15, true);
$vetCampo['orc_percentual'] = objTextoFixo('orc_percentual', '<br />(%)', 10, true);
$vetCampo['orc_saldo'] = objTextoFixo('orc_saldo', '<br />Saldo (Fonte: RM)', 15, true);

$tot_ini = 0;

if ($rowp['carga_horaria_ini'] != '') {
    $tot_ini += $rowp['carga_horaria_ini'];
}

if ($rowp['carga_horaria_2_ini'] != '') {
    $tot_ini += $rowp['carga_horaria_2_ini'];
}

$tot_fim = 0;

if ($rowp['carga_horaria_fim'] != '') {
    $tot_fim += $rowp['carga_horaria_fim'];
}

if ($rowp['carga_horaria_2_fim'] != '') {
    $tot_fim += $rowp['carga_horaria_2_fim'];
}

$vetCampo['carga_horaria_total_ini'] = objHidden('carga_horaria_total_ini', $tot_ini, '', '', false);
$vetCampo['carga_horaria_total_fim'] = objHidden('carga_horaria_total_fim', $tot_fim, '', '', false);

if ($composto == 'S') {
    $obrComposto = false;
    $lbl = 'Carga Horária Total';
} else {
    if ($idt_evento_pai == '') {
        $obrComposto = $campoObr;
    } else {
        $obrComposto = false;
    }

    if ($tot_ini == $tot_fim) {
        $lbl = 'Carga Horária (' . format_decimal($tot_ini) . ')';
    } else {
        $lbl = 'Carga Horária (' . format_decimal($tot_ini) . ' - ' . format_decimal($tot_fim) . ')';
    }
}

$vetCampo['carga_horaria_total'] = objDecimal('carga_horaria_total', $lbl, $obrComposto, 10);

if ($composto == 'S' || $origem_evento_tela == 'combo') {
    $vetCampo['valor_inscricao'] = objHidden('valor_inscricao', '');
} else {
    $vetCampo['valor_inscricao'] = objDecimal('valor_inscricao', 'Valor Inscrição', true, 10);
}

if ($veio == 'SG' || $origem_evento_tela == 'combo') {
    $vetCampo['qtd_minima_pagantes'] = objHidden('qtd_minima_pagantes', 0);
} else {
    $vetCampo['qtd_minima_pagantes'] = objInteiro('qtd_minima_pagantes', 'Qtde. Min. Pagantes', true, 5);
}

$vetCampo['qtd_dias_reservados'] = objHidden('qtd_dias_reservados', 0);

$completapar = " readonly='true' style=' background:{$corbloq}; ' ";
$vetCampo['previsao_receita'] = objDecimal('previsao_receita', 'Previsão de Receita', false, 16, 10, 2, $completapar);

$sql = '';
$sql .= ' select descricao_md5, descricao';
$sql .= ' from grc_evento_acesso';

if ($evento_acesso_descricao_md5 != '') {
    $sql .= ' union';
    $sql .= " select '{$evento_acesso_descricao_md5}' as descricao_md5, '{$evento_acesso_descricao}' as descricao";
}

$sql .= ' order by descricao';
$vetCampo['evento_acesso_descricao_md5'] = objCmbBanco('evento_acesso_descricao_md5', 'Entrega para acesso ao Evento', false, $sql, ' ', 'width:200px;');
$vetCampo['evento_acesso_descricao'] = objHidden('evento_acesso_descricao', '');

$vetCampo['conteudo_programatico'] = objHTML('conteudo_programatico', 'Conteúdo programático', false, 320, 1000);
$vetCampo['descricao_comercial'] = objHTML('descricao_comercial', 'Descrição Comercial', false, 320, 1000);

$vetCampo['evento_aberto'] = objHidden('evento_aberto', 'N');
$vetCampo['comercializar'] = objHidden('comercializar', 'N');

//$vetCampo['publica_internet'] = objFixoVetor('publica_internet', 'Status de Publicação?', True, $vetEventoPublicaInternet, '');
$vetCampo['publica_internet'] = objHidden('publica_internet', 'N');

$vetCampo['publique_imediatamente'] = objCmbVetor('publique_imediatamente', 'Publicar na Internet?', True, $vetNaoSim, '');
$vetCampo['publica_desconto_loja'] = objCmbVetor('publica_desconto_loja', 'Publicar desconto na Loja?', True, $vetSimNao);
$vetCampo['obrigar_pesq_certificado'] = objCmbVetor('obrigar_pesq_certificado', 'Obrigar Responder Pesquisa para Emitir certificado?', True, $vetNaoSim, '');

$maxlength = 1000;
$style = "";
$js = " ";
$vetCampo['observacao'] = objTextArea('observacao', 'Observações (Limitado a 1000 caracteres)', false, $maxlength, $style, $js);

$maxlength = 1000;
$style = "";
$js = " ";
$vetCampo_f['parecer'] = objTextArea('parecer', 'Parecer (Limitado a 1000 caracteres)', false, $maxlength, $style, $js);

switch ($idt_instrumento) {
    case 41:
        $vetCampo['descricao'] = objTexto('descricao', 'Descrição', true, 100, 200);
        $vetCampo['dt_previsao_inicial'] = objData('dt_previsao_inicial', 'Início', true, '', '', 'S');
        $vetCampo['dt_previsao_fim'] = objData('dt_previsao_fim', 'Término', true, '', '', 'S');

        unset($vetParticipacaoEvento['PRMC']);
        unset($vetParticipacaoEvento['ACMC']);
        break;

    case 45:
        $vetCampo['descricao'] = objTexto('descricao', 'Descrição', true, 83, 200);
        $vetCampo['dt_previsao_inicial'] = objData('dt_previsao_inicial', 'Início', true, '', '', 'S');
        $vetCampo['dt_previsao_fim'] = objData('dt_previsao_fim', 'Término', true, '', '', 'S');

        unset($vetParticipacaoEvento['PRFE']);
        unset($vetParticipacaoEvento['ACFE']);
        break;

    default:
        $vetCampo['descricao'] = objTexto('descricao', 'Título Comercial do Evento', True, 60, 200);
        $vetCampo['dt_previsao_inicial'] = objTextoFixo('dt_previsao_inicial', 'Início', 10, true, $obrComposto);
        $vetCampo['dt_previsao_fim'] = objTextoFixo('dt_previsao_fim', 'Término', 10, true, $obrComposto);
        break;
}

if ($origem_evento_tela == 'combo') {
    $vetCampo['descricao']['nome'] = 'Título do Combo';
    $vetCampo['publica_internet'] = objCmbVetor('publica_internet', 'Publicar Combo na Internet?', True, $vetNaoSim, '');
}

$vetCampo['descricao_copia'] = objTextoFixo('descricao_copia', 'Título Comercial do Evento', '', false, false, $descricao_copia);

$vetCampo['par_cep'] = objCEP('par_cep', 'CEP', false, $vetParametrosCEP);
$vetCampo['par_rua'] = objTexto('par_rua', 'Logradouro', false, 60, 120);
$vetCampo['par_numero'] = objTexto('par_numero', 'Número', false, 6, 6);
$vetCampo['par_bairro'] = objTexto('par_bairro', 'Bairro', false, 60, 120);
$vetCampo['par_cidade'] = objTexto('par_cidade', 'Cidade', false, 60, 120);
$vetCampo['par_estado'] = objTexto('par_estado', 'Estado', false, 2, 2);
$vetCampo['tit_comercical'] = objTexto('tit_comercical', 'Título Comercial', True, 69, 100, 'style="width: 318px;"');

$vetCampo['participacao_sebrae'] = objCmbVetor('participacao_sebrae', 'Modo de Participação do Sebrae', true, $vetParticipacaoEvento, '', '', 'width: 102px;');

$vetCampo['hora_inicio'] = objTextoFixo('hora_inicio', 'Hora Início', 5, true, $obrComposto);
$vetCampo['hora_fim'] = objTextoFixo('hora_fim', 'Hora Fim', 5, true, $obrComposto);

$vetCampo['custo_tot_consultoria'] = objTextoFixo('custo_tot_consultoria', 'Custo Total', 15, true, $obrComposto);
$vetCampo['tot_hora_consultoria'] = objTextoFixo('tot_hora_consultoria', 'Total de Horas', 15, true, $obrComposto);

$jst = " readonly='true' style='background:{$corbloq}; ' ";
$vetCampo['maturidade'] = objTexto('maturidade', 'Maturidade Empresarial', false, 30, 45, $jst);

$vetCampo_f['botao_concluir_evento'] = objInclude('botao_concluir_evento', 'cadastro_conf/botao_concluir_evento.php');
$vetCampo_i['resumo_evento_receita_despesa'] = objInclude('resumo_evento_receita_despesa', 'cadastro_conf/resumo_evento_receita_despesa.php');

// UNIDADE ESCRITÓRIO
$sql = "select idt,  descricao from " . db_pir . "sca_organizacao_secao ";
$sql .= " where posto_atendimento <> 'S' ";
$sql .= ' order by classificacao ';

$vetCampo['idt_unidade'] = objCmbBanco('idt_unidade', 'Unidade/Escritório', $obrCompostoHidden, $sql, ' ', 'width:432px;');

// PONTO DE ATENDIMENTO
$sql = "select idt,  descricao from " . db_pir . "sca_organizacao_secao ";
//$sql .= " where (posto_atendimento = 'UR' or posto_atendimento = 'S')";
$sql .= ' where SUBSTRING(classificacao, 1, 5) = ('; //and
$sql .= ' select SUBSTRING(classificacao, 1, 5) as cod';
$sql .= ' from ' . db_pir . 'sca_organizacao_secao';
$sql .= ' where idt = ' . null($idt_unidade);
$sql .= ' )';
$sql .= ' and idt <> ' . null($idt_unidade);
$sql .= ' order by classificacao ';
$rs = execsql($sql);

if ($rs->rows == 0) {
    $linhafixa = '';
} else {
    $linhafixa = ' ';
}

if ($idt_evento_pai == '' && $origem_evento_tela != 'combo') {
    $tmp = true;
} else {
    $tmp = false;
}

$vetCampo['idt_ponto_atendimento_tela'] = objCmbBanco('idt_ponto_atendimento_tela', 'Ponto de Atendimento', $tmp, $sql, $linhafixa, 'width:318px;', '', true, '', false, 'NÃO SE APLICA');
$vetCampo['idt_ponto_atendimento'] = objHidden('idt_ponto_atendimento', '');

// Gestor Evento - tem que ser funcionario de sebrae
$sql = '';
$sql .= ' select id_usuario, nome_completo';
$sql .= ' from plu_usuario';
$sql .= ' where (idt_unidade_lotacao in (';
$sql .= " select idt from " . db_pir . "sca_organizacao_secao ";
$sql .= ' where SUBSTRING(classificacao, 1, 5) = (';
$sql .= ' select SUBSTRING(classificacao, 1, 5) as cod';
$sql .= ' from ' . db_pir . 'sca_organizacao_secao';
$sql .= ' where idt = ' . null($idt_unidade);
$sql .= ' )';
$sql .= ' )';
$sql .= " and ativo = 'S')";
$sql .= ' or id_usuario = ' . null($idt_gestor_evento);
$sql .= ' order by nome_completo';
$vetCampo['idt_gestor_evento'] = objCmbBanco('idt_gestor_evento', 'Responsável pelo Evento', $obrCompostoHidden, $sql, ' ', 'width:200px;');

$vetInstrumento = Array();
$vetInstrumento[1] = 'INFORMAÇÃO';
$vetInstrumento[2] = 'ORIENTAÇÃO TÉCNICA';
$vetInstrumento[3] = 'CONSULTORIA';
$vetInstrumento[4] = 'CURSO';
$vetInstrumento[5] = 'FEIRA';
$vetInstrumento[6] = 'MISSÃO/CARAVANA';
$vetInstrumento[7] = 'OFICINA';
$vetInstrumento[8] = 'PALESTRA';
$vetInstrumento[9] = 'RODADA DE NEGÓCIO';
$vetInstrumento[10] = 'SEMINÁRIO';

$_GET['idt99'] = $idt_instrumento;
$vetCampo['idt_instrumento'] = objFixoBanco('idt_instrumento', '', 'grc_atendimento_instrumento', 'idt', 'descricao', 99, false);

$completapar = " readonly='true' style='background:#FFFF80;' ";

$vetCampo_w['ctotal_minimo'] = objDecimal('ctotal_minimo', 'Custo Total Mínimo', false, 10, '', 2, $completapar);
$vetCampo_w['ctotal_maximo'] = objDecimal('ctotal_maximo', 'Custo Total Máximo', false, 10, '', 2, $completapar);
$vetCampo_w['rtotal_minimo'] = objDecimal('rtotal_minimo', 'Receita Total Mínima', false, 10, '', 2, $completapar);
$vetCampo_w['rtotal_maximo'] = objDecimal('rtotal_maximo', 'Receita Total Máxima', false, 10, '', 2, $completapar);

$vetCampo_w['rmedia'] = objDecimal('rmedia', 'Receita Total Média', false, 10, '', 2, $completapar);
$vetCampo_w['cmedio'] = objDecimal('cmedio', 'Custo Total Médi0', false, 10, '', 2, $completapar);

$vetCampo_w['dif_minimo'] = objDecimal('dif_minimo', 'Despesas - Receita Mínimo', false, 10, '', 2, $completapar);
$vetCampo_w['dif_maximo'] = objDecimal('dif_maximo', 'Despesas - Receita Máximo', false, 10, '', 2, $completapar);
$vetCampo_w['dif_medio'] = objDecimal('dif_medio', 'Despesas - Receita Médio', false, 10, '', 2, $completapar);

if ($veio == 'SG' || $origem_evento_tela == 'combo') {
    $vetCampo['frequencia_min'] = objHidden('frequencia_min', '');
} else {
    $jst = '10" readonly="true" style="background:' . $corbloq . ';"';
    $vetCampo_w['frequencia_min'] = objInteiro('frequencia_min', 'Frequência Mínima (%)', true, 10, $jst);
}

$vetCampo_w['participante_maximo'] = objInteiro('participante_maximo', 'Frequência Máxima (%)', true, 10);

if ($rowp['participante_minimo'] == '' || $rowp['participante_maximo'] == '') {
    $lbl = 'Qtde. Participantes';
} else {
    $lbl = 'Qtde. Participantes (' . $rowp['participante_minimo'] . ' - ' . $rowp['participante_maximo'] . ')';
}

if ($origem_evento_tela == 'combo') {
    $tmp = false;
} else {
    $tmp = true;
}

$vetCampo_w['quantidade_participante'] = objInteiro('quantidade_participante', $lbl, $tmp, 10);
$vetCampo['combo_qtd_evento_insc'] = objInteiro('combo_qtd_evento_insc', 'Quantidade Total de Eventos do Combo', true, 10);
$vetCampo['combo_tipo'] = objCmbVetor('combo_tipo', 'Tipo', true, $vetTipooEventoCombo);

$sql = '';
$sql .= ' select min(e.dt_previsao_inicial) as ini';
$sql .= ' from grc_evento_combo eg';
$sql .= ' inner join grc_evento e on e.idt = eg.idt_evento';
$sql .= ' where eg.idt_evento_origem = ' . null($idt_evento);
$rs = execsql($sql);

$vetCampo['combo_dt_min_ini'] = objHidden('combo_dt_min_ini', trata_data($rs->data[0][0]), '', '', false);
$vetCampo['combo_dt_validade'] = objData('combo_dt_validade', 'Data Validade do Combo', true, '', '', 'S');
$vetCampo['combo_vl_tot_evento'] = objTextoFixo('combo_vl_tot_evento', 'Somatório dos valores das Inscrições nos Eventos', 15, true, false);
$vetCampo['combo_vl_tot_matricula'] = objTextoFixo('combo_vl_tot_matricula', 'Somatório dos valores das Inscrições no Combo', 15, true, false);
$vetCampo['combo_percentual_desc'] = objTextoFixo('combo_percentual_desc', 'Desconto Geral das Inscrições (%)', 15, true, false);

$vetCampo['idt_organizacao'] = objListarCmb('idt_organizacao', 'grc_organizacao_evento_cmb', 'Onde Será?', false);

$vetCampo['cep'] = objTextoFixo('cep', 'CEP', '', true);
$vetCampo['logradouro'] = objTextoFixo('logradouro', 'Logradouro', '', true);
$vetCampo['logradouro_numero'] = objTextoFixo('logradouro_numero', 'Número', '', true);
$vetCampo['logradouro_complemento'] = objTextoFixo('logradouro_complemento', 'Complemento', '', true);
$vetCampo['logradouro_bairro'] = objTextoFixo('logradouro_bairro', 'Bairro', '', true);
$vetCampo['logradouro_municipio'] = objTextoFixo('logradouro_municipio', 'Município', '', true);
$vetCampo['logradouro_estado'] = objTextoFixo('logradouro_estado', 'Estado', '', true);
$vetCampo['logradouro_pais'] = objTextoFixo('logradouro_pais', 'País', '', true);

$vetCampo['local'] = objTexto('local', 'Local (departamento, Setor...) ', false, 50, 120);
$vetCampo['local_sigla'] = objTexto('local_sigla', 'Sigla do Local', false, 30, 120);


$vetCampo['idt_foco_tematico'] = objFixoBanco('idt_foco_tematico', 'Foco Temático do Produto', 'grc_foco_tematico', 'idt', 'codigo, descricao');

$sql = "select idt, codigo, descricao from grc_tema_subtema ";
$sql .= " order by codigo";
$vetCampo['idt_subtema'] = objCmbBanco('idt_subtema', 'Tema/Subtema', true, $sql, ' ', 'width:340px;');

$sql = '';
$sql .= ' select d.idt, d.descricao';
$sql .= ' from grc_publico_alvo d';
$sql .= ' inner join grc_evento_publico_alvo df on d.idt = df.idt_publico_alvo_outro';
$sql .= ' where df.idt = ' . null($_GET['id']);
$sql .= ' order by d.codigo';
$rs = execsql($sql);

if ($rs->rows == 0) {
    $sql = '';
    $sql .= ' select d.idt, d.descricao';
    $sql .= ' from grc_publico_alvo d';
    $sql .= ' order by d.codigo';
}

$vetCampo['idt_publico_alvo'] = objCmbBanco('idt_publico_alvo', 'Público Prioritário', $obrCompostoHidden, $sql, ' ', 'width:220px;');

$desc = 'Público Alvo do Evento';
$vetFrmPA = Array();
$vetTmp = Array();
$colPA = 4 * 2;

$sql = '';
$sql .= ' select pa.idt, pa.descricao, epa.ativo';
$sql .= ' from grc_evento_publico_alvo epa';
$sql .= ' inner join grc_publico_alvo pa on pa.idt = epa.idt_publico_alvo_outro';
$sql .= ' where epa.idt = ' . null($_GET['id']);
$sql .= ' order by pa.descricao';
$rs = execsql($sql);

ForEach ($rs->data as $row) {
    $vetCampo['pa_' . $row['idt']] = objCheckbox('pa[' . $row['idt'] . ']', $desc, 'S', 'N', $row['descricao'], false, $row['ativo']);
    $desc = '';

    $vetTmp[] = $vetCampo['pa_' . $row['idt']];
    $vetTmp[] = '';

    if (count($vetTmp) == $colPA) {
        array_pop($vetTmp);
        $vetFrmPA[] = $vetTmp;
        $vetTmp = Array();
    }
}

if (count($vetTmp) > 0) {
    $idxFim = $colPA - 1 - count($vetTmp);

    for ($index1 = 0; $index1 < $idxFim; $index1++) {
        $vetTmp[] = '';
    }

    $vetFrmPA[] = $vetTmp;
}

$vetCampo['tipo_evento'] = objRadio('tipo_evento', 'Tipo de Evento', true, $vetTipoEvento, '', '', '');

$sql = "select idt, descricao from " . db_pir_gec . "gec_entidade_setor";
$sql .= " order by descricao";
$vetCampo['idt_gec_entidade_setor'] = objCmbBanco('idt_gec_entidade_setor', 'Setor', true, $sql, ' ', 'width:200px;');

$vetCampo['desc_local'] = objTexto('desc_local', 'Local', true, 70, 200);
$vetCampo['desc_perfil'] = objTexto('desc_perfil', 'Perfil', true, 115, 200);
$vetCampo['publico_visitante'] = objTexto('publico_visitante', 'Público Visitante', true, 30, 200);
$vetCampo['vl_metro'] = objDecimal('vl_metro', 'Valor do Metro Quadrado', true, 18, 15);

$maxlength = 1000;
$style = "";
$js = " ";

switch ($idt_instrumento) {
    case 2:
        $vetCampo['objetivo'] = objTextArea('objetivo', 'Objetivo da Consultoria(Limitado a 1000 caracteres)', true, $maxlength, $style, $js);

        $vetParametros = Array(
            'consulta_cep' => true,
            'campo_codcid' => 'idt_cidade',
            'tipo_codcid' => 'cmb_fixo',
        );
        $vetCampo['cep'] = objCEP('cep', 'CEP', true, $vetParametros);
        break;

    default:
        $vetCampo['objetivo'] = objTextArea('objetivo', 'Objetivo (Limitado a 1000 caracteres)', true, $maxlength, $style, $js);
        break;
}

// Cidade
$vetCampo['idt_cidade'] = objFixoBanco('idt_cidade', 'Cidade', db_pir_siac . 'cidade', 'codcid', 'desccid', '', true, '', $obrComposto);

// Local
$vetCampo['idt_local'] = objFixoBanco('idt_local', 'Local/Sala', 'grc_evento_local_pa', 'idt', 'descricao', '', true, '', $obrComposto);

$titulo = 'Tema e Subtema';

$vetCampoLC = Array();
$vetCampoLC['grc_tema'] = CriaVetTabela('Tema');
$vetCampoLC['grc_sub_tema'] = CriaVetTabela('Subtema');

$sql = "select et.*, ";
$sql .= "       grc_t.descricao as grc_tema, ";
$sql .= "       grc_ts.descricao as grc_sub_tema ";
$sql .= " from grc_evento_tema et ";
$sql .= " inner join grc_tema_subtema grc_t on grc_t.idt = et.idt_tema ";
$sql .= " inner join grc_tema_subtema grc_ts on grc_ts.idt = et.idt_sub_tema ";
$sql .= ' where et.idt_evento = $vlID';
$sql .= " order by grc_t.descricao, grc_ts.descricao";

$vetCampo['grc_evento_tema'] = objListarConf('grc_evento_tema', 'idt', $vetCampoLC, $sql, $titulo, true);
$vetCampo['grc_evento_tema_tit'] = objBarraTitulo('grc_evento_tema_tit', mb_strtoupper($titulo), 'class_titulo_p_barra');

$titulo = 'Programação';

$vetCampoLC = Array();
$vetCampoLC['descricao'] = CriaVetTabela('Descrição');
$vetCampoLC['data'] = CriaVetTabela('Data', 'data');
$vetCampoLC['hora'] = CriaVetTabela('Hora');
$vetCampoLC['local'] = CriaVetTabela('Local');
$vetCampoLC['objetivo'] = CriaVetTabela('Objetivo');

$sql = "select et.*";
$sql .= " from grc_evento_programacao et ";
$sql .= ' where et.idt_evento = $vlID';
$sql .= " order by et.descricao";

$vetCampo['grc_evento_programacao'] = objListarConf('grc_evento_programacao', 'idt', $vetCampoLC, $sql, $titulo, true);
$vetCampo['grc_evento_programacao_tit'] = objBarraTitulo('grc_evento_programacao_tit', mb_strtoupper($titulo), 'class_titulo_p_barra');

$titulo = 'Atividade Econômica';

$vetCampoLC = Array();
$vetCampoLC['cnae'] = CriaVetTabela('Código');
$vetCampoLC['setor'] = CriaVetTabela('Setor');
$vetCampoLC['descricao'] = CriaVetTabela('Atividade Econômica');

$sql = "select et.*, c.descricao, es.descricao as setor";
$sql .= " from grc_evento_cnae et ";
$sql .= ' inner join ' . db_pir_gec . 'cnae c on c.subclasse = et.cnae';
$sql .= ' inner join ' . db_pir_gec . 'gec_entidade_setor es on es.idt = c.idt_entidade_setor';
$sql .= ' where et.idt_evento = $vlID';
$sql .= " order by et.cnae";

$vetCampo['grc_evento_cnae'] = objListarConf('grc_evento_cnae', 'idt', $vetCampoLC, $sql, $titulo, true);
$vetCampo['grc_evento_cnae_tit'] = objBarraTitulo('grc_evento_cnae_tit', mb_strtoupper($titulo), 'class_titulo_p_barra');

$titulo = 'Controle de Stand';

$vetCampoLC = Array();
$vetCampoLC['numero'] = CriaVetTabela('Numero');
$vetCampoLC['area'] = CriaVetTabela('Área', 'decimal');
$vetCampoLC['rua'] = CriaVetTabela('Rua');
$vetCampoLC['vl_stand'] = CriaVetTabela('Valor do STAND', 'decimal');
$vetCampoLC['caracteristica'] = CriaVetTabela('Características');
$vetCampoLC['descricao'] = CriaVetTabela('Atividade Econômica');

$sql = "select et.*, c.descricao";
$sql .= " from grc_evento_stand et ";
$sql .= ' inner join ' . db_pir_gec . 'cnae c on c.subclasse = et.cnae';
$sql .= ' where et.idt_evento = $vlID';
$sql .= " order by et.numero";

$vetCampo['grc_evento_stand'] = objListarConf('grc_evento_stand', 'idt', $vetCampoLC, $sql, $titulo, true);
$vetCampo['grc_evento_stand_tit'] = objBarraTitulo('grc_evento_stand_tit', mb_strtoupper($titulo), 'class_titulo_p_barra');

$titulo = 'Arquivo em Anexo';

$vetCampoLC = Array();
$vetCampoLC['descricao'] = CriaVetTabela('Título do Anexo');
$vetCampoLC['arquivo'] = CriaVetTabela('Arquivo anexado', 'arquivo_sem_nome', '', 'grc_evento_anexo');

$sql = "select *";
$sql .= " from grc_evento_anexo";
$sql .= ' where idt_evento = $vlID';
$sql .= " order by descricao";

if ($idt_evento_situacao != 4 && $idt_evento_situacao != 21 && $idt_evento_situacao != 22 && $idt_evento_situacao != 23) {
    $vetParametrosLC = Array(
        'func_trata_row' => ftr_grc_evento_anexo,
        'acao_alt_con_p' => 'S',
    );
} else {
    $vetParametrosLC = Array(
        'func_trata_row' => ftr_grc_evento_anexo,
    );
}

$vetCampo['grc_evento_anexo'] = objListarConf('grc_evento_anexo', 'idt', $vetCampoLC, $sql, $titulo, false, $vetParametrosLC);
$vetCampo['grc_evento_anexo_tit'] = objBarraTitulo('grc_evento_anexo_tit', mb_strtoupper($titulo), 'class_titulo_p_barra');
$vetCampo['bt_ficha'] = objInclude('bt_ficha', 'cadastro_conf/grc_evento_bt_ficha.php');

//Galeria
$vetCampoLC = Array();
$vetCampoLC['tipo'] = CriaVetTabela('Tipo');
$vetCampoLC['descricao'] = CriaVetTabela('Descrição');
$vetCampoLC['conteudo'] = CriaVetTabela('Conteudo', 'func_trata_dado', ftd_grc_evento_galeria);

$titulo = 'Galeria';

$sql = '';
$sql .= ' select pg.*, tg.descricao as tipo';
$sql .= ' from grc_evento_galeria pg';
$sql .= ' inner join grc_tipo_galeria tg on tg.idt = pg.idt_tipo_galeria';
$sql .= ' where pg.idt_evento = $vlID';
$sql .= ' order by tg.descricao, pg.descricao';

if ($idt_evento_situacao != 4 && $idt_evento_situacao != 21 && $idt_evento_situacao != 22 && $idt_evento_situacao != 23) {
    $vetParametrosLC = Array(
        'acao_alt_con_p' => 'S',
    );
} else {
    $vetParametrosLC = Array(
    );
}

$vetCampo['grc_evento_galeria'] = objListarConf('grc_evento_galeria', 'idt', $vetCampoLC, $sql, $titulo, false, $vetParametrosLC);
$vetCampo['grc_evento_galeria_tit'] = objBarraTitulo('grc_evento_galeria_tit', mb_strtoupper($titulo), 'class_titulo_p_barra');

//Remover os 2 campos para colocar o correto
$vetCampo['direito_autoral'] = objHidden('direito_autoral', '');
$vetCampo['outros'] = objHidden('outros', '');

$vetCampo['entrega_prazo_max'] = objTextoFixo('entrega_prazo_max', 'Prazo Máximo para execução do Serviço (dias)', 10, true);
$vetCampo['vl_determinado'] = objFixoVetor('vl_determinado', 'Produto de Venda Imediata?', false, $vetNaoSim);

$vetCampo['qtd_vagas_bloqueadas'] = objTextoFixo('qtd_vagas_bloqueadas', 'Qtd. Bloqueada', 10, true);

if ($origem_evento_tela == 'combo') {
    $vetCampo_w['idt_produto']['mostra_bt'] = false;
    $vetCampo_w['idt_produto']['valida'] = false;

    $vetCampo['idt_projeto']['mostra_bt'] = false;
    $vetCampo['idt_projeto']['valida'] = false;

    $vetCampo['idt_acao']['mostra_bt'] = false;
    $vetCampo['idt_acao']['valida'] = false;
}

$vetCampow = $vetCampo;

$class_frame_f = "class_frame_f";
$class_titulo_f = "class_titulo_f";
$class_frame_p = "class_frame_p";
$class_titulo_p = "class_titulo_p";
$class_frame = "class_frame";
$class_titulo = "class_titulo";

$class_titulo_c = "class_titulo_c";

$titulo_na_linha = false;

$titulo_cadastro = "PROGRAMAÇÃO DE EVENTOS";

$vetFrm = Array();
$vetParametros = Array(
    'codigo_frm' => 'instrumento',
    'controle_fecha' => false,
    'width' => '100%',
);

MesclarCol($vetCampo['idt_gestor_projeto'], 3);

$vetFrm[] = Frame('', Array(
    Array($vetCampo['idt_evento_situacao'], '', $vetCampo['idt_ponto_atendimento'], '', $vetCampo['situacao'], '', $vetCampo['idt_programa'], '', $vetCampo['dt_inicio_aprovacao']),
    Array($vetCampo['carga_horaria_total_ini'], '', $vetCampo['carga_horaria_total_fim'], '', $vetCampo['idt_gestor_projeto'], '', $vetCampo['contrapartida_sgtec']),
        ), $class_frame . ' frm_evento_situacao', $class_titulo_c, $titulo_na_linha, $vetParametros);

if ($origem_evento_tela == 'compra') {
    $cf = $class_frame . ' frm_evento_situacao';
} else {
    $cf = $class_frame;
}

$vetFrm[] = Frame('', Array(
    Array($vetCampo['idt_instrumento']),
        ), $cf, $class_titulo_c, $titulo_na_linha, $vetParametros);

if ($origem_evento_tela != 'combo') {
    $vetFrm[] = Frame('', Array(
        Array($vetCampo_av['avaliacao_estrelinha']),
            ), $cf, $class_titulo_c, $titulo_na_linha, $vetParametros);
}

if ($origem_evento_tela != 'compra' && ($idt_evento_situacao == 21 || $idt_evento_situacao == 22 || $idt_evento_situacao == 23)) {
    $vetCampo['display'] = objInclude('display', 'cadastro_conf/grc_evento_display_cancelamento.php');

    $vetParametros = Array(
        'width' => '100%',
    );

    $vetFrm[] = Frame('', Array(
        Array($vetCampo['display']),
            ), 'class_frame_display', '', $titulo_na_linha, $vetParametros);
}

if ($veio == 'SG' && $origem_evento_tela != 'compra') {
    $sql = '';
    $sql .= ' select evento_sincroniza_rm';
    $sql .= ' from plu_usuario';
    $sql .= ' where id_usuario = ' . null($_SESSION[CS]['g_id_usuario']);
    $rsx = execsql($sql);

    if ($rsx->data[0][0] == 'S') {
        $vetCampo['nao_sincroniza_rm'] = objCmbVetor('nao_sincroniza_rm', 'Evento para meta física?', True, $vetNaoSim, '');

        $vetFrm[] = Frame('', Array(
            Array($vetCampo['nao_sincroniza_rm']),
                ), $cf, $class_titulo_c, $titulo_na_linha);
    }
}

if ($idt_evento_pai == '' && $origem_evento_tela != 'combo') {
    $classPai = '';
} else {
    $classPai = ' frm_evento_situacao';
}

$vetParametros = Array(
    'codigo_frm' => 'monitoramento',
    'controle_fecha' => false,
);
$vetFrm[] = Frame('<span>Monitoramento</span>', '', $class_frame_p . $classPai, $class_titulo_p, $titulo_na_linha_p, $vetParametros);

$vetParametros = Array(
    'codigo_pai' => 'monitoramento',
    'width' => '100%',
);

if ($origem_evento_tela == 'compra') {
    $vetCampo['nome_aprovador'] = objInclude('nome_aprovador', 'cadastro_conf/grc_evento_nome_aprovador.php');
    $vetCampo['nome_aprovador']['linha'] = 4;

    $vetFrm[] = Frame('', Array(
        Array($vetCampo['idt_projeto'], '', $vetCampo['nome_aprovador']),
        Array($vetCampo['idt_acao']),
            ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);
} else {
    MesclarCol($vetCampo['lbl_painel'], 7);

    if ($idt_instrumento == 45 || $idt_instrumento == 41) {
        MesclarCol($vetCampo['idt_projeto'], 7);
        MesclarCol($vetCampo['idt_acao'], 7);

        $vetTmp = Array(
            $vetCampo['ano_competencia'],
            '',
            $vetCampo['participacao_sebrae'],
            '',
            $vetCampo['gestor_sge'],
            '',
            $vetCampo['fase_acao_projeto'],
            '',
            $vetCampo['orc_previsto'],
            '',
            $vetCampo['orc_realizado'],
            '',
            $vetCampo['orc_percentual'],
            '',
            $vetCampo['orc_saldo']
        );
    } else {
        MesclarCol($vetCampo['idt_projeto'], 5);
        MesclarCol($vetCampo['idt_acao'], 5);

        $vetTmp = Array(
            $vetCampo['ano_competencia'],
            '',
            $vetCampo['gestor_sge'],
            '',
            $vetCampo['fase_acao_projeto'],
            '',
            $vetCampo['orc_previsto'],
            '',
            $vetCampo['orc_realizado'],
            '',
            $vetCampo['orc_percentual'],
            '',
            $vetCampo['orc_saldo']
        );
    }

    $vetFrm[] = Frame('', Array(
        Array($vetCampo['idt_projeto'], '', $vetCampo['lbl_painel']),
        Array($vetCampo['idt_acao'], '', $vetCampo['qtd_previsto'], '', $vetCampo['qtd_realizado'], '', $vetCampo['qtd_percentual'], '', $vetCampo['qtd_saldo']),
        $vetTmp,
            ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);
}

$vetParametros = Array(
    'codigo_frm' => 'formulario',
    'controle_fecha' => false,
);

$vetFrm[] = Frame('<span>Formulário de Abertura de Evento</span>', '', $class_frame_p . $classPai, $class_titulo_p, $titulo_na_linha_p, $vetParametros);

$vetParametros = Array(
    'codigo_pai' => 'formulario',
    'width' => '100%',
);

$vetParametrosPA = $vetParametros;
$vetParametrosPA['width'] = '';
$vetParametrosPA['align'] = 'left';

$sql = "select idt, codigo, descricao from grc_evento_grupo order by descricao";
$vetCampo['idt_grupo'] = objCmbBanco('idt_grupo', 'Grande Evento', true, $sql, '');

if ($origem_evento_tela == 'compra') {
    MesclarCol($vetCampo['observacao'], 3);

    $vetFrm[] = Frame('', Array(
        Array($vetCampo['idt_unidade'], '', $vetCampo['idt_ponto_atendimento_tela'], '', $vetCampo['idt_gestor_evento']),
        Array($vetCampo_w['idt_produto'], '', $vetCampo['observacao']),
        Array($vetCampo['descricao']),
            ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);

    $vetTMP = $vetParametros;
    unset($vetTMP['width']);
    $vetTMP['align'] = 'left';

    $vetFrm[] = Frame('', Array(
        Array($vetCampo['carga_horaria_total'], '', $vetCampo_w['quantidade_participante']),
            ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetTMP);
} else {
    switch ($idt_instrumento) {
        case 41: // feira
            $vetFrm[] = Frame('', Array(
                Array($vetCampo['idt_unidade'], '', $vetCampo['idt_ponto_atendimento_tela'], '', $vetCampo['idt_gestor_evento']),
                    ), $class_frame . $classPai . ' frm_sem_margem', $class_titulo, $titulo_na_linha, $vetParametros);

            $vetFrm[] = Frame('', Array(
                Array($vetCampo['descricao'], '', $vetCampo['dt_previsao_inicial'], '', $vetCampo['dt_previsao_fim']),
                    ), $class_frame . $classPai . ' frm_sem_margem', $class_titulo, $titulo_na_linha, $vetParametros);

            $vetCampo['desc_local']['size'] = 40;

            $vetFrm[] = Frame('', Array(
                Array($vetCampo['desc_local'], '', $vetCampo['vl_metro'], '', $vetCampo['publico_visitante'], '', $vetCampo['obrigar_pesq_certificado']),
                    ), $class_frame . $classPai . ' frm_sem_margem', $class_titulo, $titulo_na_linha, $vetParametros);

            $vetFrm[] = Frame('', Array(
                Array($vetCampo['idt_grupo']),
                    ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);

            /*
              $vetFrm[] = Frame('', Array(
              Array($vetCampo['direito_autoral'], '', $vetCampo['outros']),
              ), $class_frame.$classPai.' frm_sem_margem frm_left', $class_titulo, $titulo_na_linha, $vetParametros);
             * 
             */

            $vetFrm[] = Frame('', Array(
                Array($vetCampo['observacao']),
                    ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);

            $vetFrm[] = Frame('', Array(
                Array($vetCampo['grc_evento_tema_tit']),
                Array($vetCampo['grc_evento_tema']),
                    ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);

            $vetFrm[] = Frame('', Array(
                Array($vetCampo['grc_evento_cnae_tit']),
                Array($vetCampo['grc_evento_cnae']),
                    ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);

            $vetFrm[] = Frame('', Array(
                Array($vetCampo['grc_evento_stand_tit']),
                Array($vetCampo['grc_evento_stand']),
                    ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);
            break;

        case 45: // Missão e Caravana
            $vetFrm[] = Frame('', Array(
                Array($vetCampo['idt_unidade'], '', $vetCampo['idt_ponto_atendimento_tela'], '', $vetCampo['idt_gestor_evento']),
                    ), $class_frame . $classPai . ' frm_sem_margem', $class_titulo, $titulo_na_linha, $vetParametros);

            $vetFrm[] = Frame('', Array(
                Array($vetCampo['tipo_evento'], '', $vetCampo['dt_previsao_inicial'], '', $vetCampo['dt_previsao_fim'], '', $vetCampo['idt_gec_entidade_setor'], '', $vetCampo['obrigar_pesq_certificado']),
                    ), $class_frame . $classPai . ' frm_sem_margem', $class_titulo, $titulo_na_linha, $vetParametros);

            MesclarCol($vetCampo['idt_grupo'], 3);
            MesclarCol($vetCampo['objetivo'], 3);

            $vetFrm[] = Frame('', Array(
                Array($vetCampo['descricao'], '', $vetCampo['desc_local']),
                Array($vetCampo['idt_grupo']),
                Array($vetCampo['objetivo']),
                    ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);

            $vetFrm[] = Frame('', Array(
                Array($vetCampo['grc_evento_tema_tit']),
                Array($vetCampo['grc_evento_tema']),
                    ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);

            $vetFrm[] = Frame('', Array(
                Array($vetCampo_w['quantidade_participante'], '', $vetCampo['qtd_vagas_bloqueadas'], '', $vetCampo['desc_perfil']),
                    ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);

            $vetFrm[] = Frame('', Array(
                Array($vetCampo['grc_evento_programacao_tit']),
                Array($vetCampo['grc_evento_programacao']),
                    ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);
            break;

        case 2: // Consultoria de Longa Duração
            if ($idt_evento_pai == '') {
                if ($veio == 'SG' && $sgtec_modelo == 'E') {
                    MesclarCol($vetCampo['idt_ponto_atendimento_tela'], 3);
                    MesclarCol($vetCampo['idt_foco_tematico'], 3);
                    MesclarCol($vetCampo['comercializar'], 3);

                    $vetFrm[] = Frame('', Array(
                        Array($vetCampo['idt_unidade'], '', $vetCampo['idt_ponto_atendimento_tela'], '', $vetCampo['idt_gestor_evento']),
                        Array($vetCampo_w['idt_produto'], '', $vetCampo['idt_foco_tematico'], '', $vetCampo['maturidade']),
                        Array($vetCampo['descricao'], '', $vetCampo['vl_determinado'], '', $vetCampo['entrega_prazo_max'], '', $vetCampo['obrigar_pesq_certificado']),
                        Array($vetCampo['evento_aberto'], '', $vetCampo['comercializar'], '', $vetCampo['qtd_vagas_adicional']),
                            ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);

                    $vetFrm[] = Frame('', Array(
                        Array($vetCampo['idt_grupo']),
                            ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);

                    $vetFrm[] = Frame('', $vetFrmPA, $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametrosPA);

                    $vetFrm[] = Frame('', Array(
                        Array($vetCampo_w['quantidade_participante'], '', $vetCampo['qtd_vagas_bloqueadas'], '', $vetCampo['valor_inscricao'], '', $vetCampo['qtd_minima_pagantes'], '', $vetCampo['previsao_receita'], '', $vetCampo['idt_publico_alvo']),
                            ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);
                } else {
                    MesclarCol($vetCampo['idt_ponto_atendimento_tela'], 3);
                    MesclarCol($vetCampo['idt_foco_tematico'], 3);
                    MesclarCol($vetCampo['evento_aberto'], 3);
                    MesclarCol($vetCampo['comercializar'], 3);

                    $vetFrm[] = Frame('', Array(
                        Array($vetCampo['idt_unidade'], '', $vetCampo['idt_ponto_atendimento_tela'], '', $vetCampo['idt_gestor_evento']),
                        Array($vetCampo_w['idt_produto'], '', $vetCampo['idt_foco_tematico'], '', $vetCampo['maturidade']),
                        Array($vetCampo['descricao'], '', $vetCampo['valor_hora'], '', $vetCampo['carga_horaria_total'], '', $vetCampo['obrigar_pesq_certificado']),
                        Array($vetCampo['evento_aberto'], '', $vetCampo['comercializar']),
                            ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);

                    $vetFrm[] = Frame('', Array(
                        Array($vetCampo['idt_grupo']),
                            ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);

                    $vetFrm[] = Frame('', $vetFrmPA, $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametrosPA);

                    MesclarCol($vetCampo['obrigar_pesq_certificado'], 3);

                    $vetFrm[] = Frame('', Array(
                        Array($vetCampo_w['quantidade_participante'], '', $vetCampo['qtd_vagas_adicional'], '', $vetCampo['qtd_vagas_bloqueadas'], '', $vetCampo['valor_inscricao'], '', $vetCampo['qtd_minima_pagantes'], '', $vetCampo['previsao_receita'], '', $vetCampo['idt_publico_alvo']),
                            ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);

                    $vetFrm[] = Frame('', Array(
                        Array($vetCampo['vl_determinado'], '', $vetCampo['entrega_prazo_max']),
                            ), $class_frame . ' display_none', $class_titulo, $titulo_na_linha, $vetParametros);
                }
            } else {
                $vetCampo_w['idt_produto']['mostra_bt'] = false;

                $sql = '';
                $sql .= ' select min(ea.data_inicial) as dt_ini';
                $sql .= ' from grc_evento_agenda ea';
                $sql .= " left outer join grc_evento_participante ep on ep.idt_atendimento = ea.idt_atendimento";
                $sql .= ' where ea.idt_evento in (';
                $sql .= ' select idt';
                $sql .= ' from grc_evento';
                $sql .= ' where idt_evento_pai = ' . null($idt_evento_pai);
                $sql .= ' and idt <> ' . null($idt_evento);
                $sql .= ')';
                $sql .= " and (ep.contrato is null or ep.contrato <> 'IC')";
                $sql .= " and (ep.ativo is null or ep.ativo = 'S')";
                $rs = execsql($sql);

                if ($rs->data[0][0] == '') {
                    alert('Favor informar a agenda do subevento de Instrutoria!', 'E');
                } else {
                    $dt_ini = substr($rs->data[0][0], 0, 8) . '01';

                    if ($inc_cliente_dt_ini <> $dt_ini) {

                        $vetDT = DatetoArray(trata_data($dt_ini));
                        $mes = $vetDT['mes'];
                        $ano = $vetDT['ano'];

                        beginTransaction();

                        $sql = 'delete from grc_evento_agenda_prev where idt_evento = ' . null($idt_evento);
                        execsql($sql);

                        for ($idx = 0; $idx < 12; $idx++) {
                            //ultimo dia
                            $dia = cal_days_in_month(CAL_GREGORIAN, $mes, $ano);
                            $data = $ano . '-' . $mes . '-'.$dia;
                            $descricao = $vetMesAbr[$mes] . '/' . $ano;
                            $dt_fim = $data;

                            $sql = '';
                            $sql .= ' insert into grc_evento_agenda_prev (idt_evento, descricao, data) values (';
                            $sql .= null($idt_evento) . ', ' . aspa($descricao) . ', ' . aspa($data) . ')';
                            execsql($sql);

                            $mes++;

                            if ($mes == 13) {
                                $mes = 1;
                                $ano++;
                            }

                            if ($mes < 10) {
                                $mes = '0' . $mes;
                            }
                        }

                        $sql = '';
                        $sql .= ' update grc_evento set';
                        $sql .= ' inc_cliente_dt_ini = ' . aspa($dt_ini) . ',';
                        $sql .= ' inc_cliente_dt_fim = ' . aspa($dt_fim);
                        $sql .= ' where idt = ' . null($idt_evento);
                        execsql($sql);

                        commit();
                    }
                }

                $vetPar = Array();
                $vetPrev = Array();

                $sql = '';
                $sql .= ' select idt, descricao, qtd';
                $sql .= ' from grc_evento_agenda_prev';
                $sql .= ' where idt_evento = ' . null($idt_evento);
                $sql .= ' order by data';
                $rs = execsql($sql);

                foreach ($rs->data as $row) {
                    $idx = 'inc_cliente_mes_' . $row['idt'];

                    if ($row['qtd'] == '') {
                        $row['qtd'] = '0,00';
                    }

                    $vetPar[] = $idx;
                    $vetPrev[] = objDecimal($idx, $row['descricao'], false, 6, 6, 2, '', $row['qtd'], 'inc_cliente_mes[' . $row['idt'] . ']', false);
                    $vetPrev[] = '';
                }

                array_pop($vetPrev);

                $vetCampo['inc_cliente_prev'] = objCmbVetor('inc_cliente_prev', 'Incluir clientes previamente?', True, $vetNaoSim, '');

                $par = implode(',', $vetPar);
                $vetDesativa['inc_cliente_prev'][0] = vetDesativa($par, ',S');
                $vetAtivadoObr['inc_cliente_prev'][0] = vetAtivadoObr($par, 'N');

                MesclarCol($vetCampo_w['idt_produto'], 3);
                MesclarCol($vetCampo['idt_foco_tematico'], 3);

                $vetFrm[] = Frame('', Array(
                    Array($vetCampo_w['idt_produto'], '', $vetCampo['idt_foco_tematico']),
                    Array($vetCampo['descricao'], '', $vetCampo['valor_hora'], '', $vetCampo['valor_inscricao'], '', $vetCampo['previsao_receita']),
                        ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);

                $vetFrm[] = Frame('', Array(
                    Array($vetCampo['carga_horaria_total'], '', $vetCampo['inc_cliente_prev'], '', $vetCampo_w['quantidade_participante'], '', $vetCampo['qtd_vagas_adicional'], '', $vetCampo['qtd_minima_pagantes']),
                        ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);

                $vetParametrosMes = $vetParametros;
                $vetParametrosMes['espaco_img_size'] = 10;

                $vetFrm[] = Frame('Cronograma Prevísto de Execução: (Informar nº de horas mensais)', Array(
                    $vetPrev,
                        ), 'mes_prev', $class_titulo, true, $vetParametrosMes);

                $vetFrm[] = Frame('', $vetFrmPA, $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametrosPA);

                $vetFrm[] = Frame('', Array(
                    Array($vetCampo['idt_unidade'], '', $vetCampo['idt_ponto_atendimento_tela'], '', $vetCampo['idt_gestor_evento'], '', $vetCampo['maturidade']),
                    Array($vetCampo['evento_aberto'], '', $vetCampo['comercializar'], '', $vetCampo['idt_publico_alvo'], '', $vetCampo['obrigar_pesq_certificado']),
                        ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);
            }

            $vetFrm[] = Frame('', Array(
                Array($vetCampo['objetivo'], '', $vetCampo['resultado_esperado']),
                    ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);
            break;

        default:
            if ($origem_evento_tela == 'combo') {
                MesclarCol($vetCampo['descricao'], 3);
                MesclarCol($vetCampo['combo_percentual_desc'], 3);
                MesclarCol($vetCampo['publica_internet'], 7);

                $vetFrm[] = Frame('', Array(
                    Array($vetCampo['descricao'], '', $vetCampo['combo_qtd_evento_insc'], '', $vetCampo['combo_tipo'], '', $vetCampo['publica_desconto_loja']),
                    Array($vetCampo['combo_dt_validade'], '', $vetCampo['combo_vl_tot_evento'], '', $vetCampo['combo_vl_tot_matricula'], '', $vetCampo['combo_percentual_desc']),
                    Array($vetCampo['publica_internet']),
                        ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);

                MesclarCol($vetCampo_w['idt_produto'], 3);
                MesclarCol($vetCampo['idt_foco_tematico'], 3);

                $vetFrm[] = Frame('', Array(
                    Array($vetCampo_w['idt_produto'], '', $vetCampo['idt_foco_tematico']),
                    Array($vetCampo['idt_unidade'], '', $vetCampo['idt_ponto_atendimento_tela'], '', $vetCampo['idt_gestor_evento'], '', $vetCampo['maturidade']),
                    Array($vetCampo['idt_publico_alvo'], '', $vetCampo['evento_aberto'], '', $vetCampo['gratuito'], '', $vetCampo['comercializar']),
                    Array($vetCampo['carga_horaria_total'], '', $vetCampo['qtd_vagas_adicional'], '', $vetCampo_w['frequencia_min'], '', $vetCampo['qtd_minima_pagantes']),
                    Array($vetCampo_w['quantidade_participante'], '', $vetCampo['previsao_receita'], '', $vetCampo['qtd_dias_reservados'], '', $vetCampo['valor_inscricao']),
                        ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);

                $vetFrm[] = Frame('', Array(
                    Array($vetCampo['combo_dt_min_ini']),
                    Array($vetCampo['observacao']),
                        ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);
            } else {
                if ($idt_evento_pai == '') {
                    if ($composto == 'S') {
                        $vetFrm[] = Frame('', $vetFrmPA, $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametrosPA);

                        $vetFrm[] = Frame('', Array(
                            Array($vetCampo['idt_unidade'], '', $vetCampo['idt_ponto_atendimento_tela'], '', $vetCampo['idt_gestor_evento']),
                            Array($vetCampo['descricao'], '', $vetCampo['tit_comercical'], '', $vetCampo['maturidade']),
                            Array($vetCampo['idt_publico_alvo'], '', $vetCampo['obrigar_pesq_certificado'], '', $vetCampo['carga_horaria_total']),
                                ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);

                        $vetFrm[] = Frame('', Array(
                            Array($vetCampo['evento_aberto'], '', $vetCampo['gratuito'], '', $vetCampo['comercializar'], '', $vetCampo['valor_inscricao']),
                                ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);

                        $vetFrm[] = Frame('', Array(
                            Array($vetCampo['idt_grupo']),
                            Array($vetCampo['observacao']),
                                ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);
                    } else {
                        MesclarCol($vetCampo['obrigar_pesq_certificado'], 3);

                        $vetFrm[] = Frame('', Array(
                            Array($vetCampo['idt_unidade'], '', $vetCampo['idt_ponto_atendimento_tela'], '', $vetCampo['idt_gestor_evento']),
                            Array($vetCampo_w['idt_produto'], '', $vetCampo['idt_foco_tematico'], '', $vetCampo['maturidade']),
                            Array($vetCampo['descricao'], '', $vetCampo['obrigar_pesq_certificado']),
                            Array($vetCampo['evento_aberto'], '', $vetCampo['gratuito'], '', $vetCampo['comercializar']),
                                ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);

                        MesclarCol($vetCampo_w['frequencia_min'], 3);

                        $vetFrm[] = Frame('', Array(
                            Array($vetCampo['carga_horaria_total'], '', $vetCampo_w['quantidade_participante'], '', $vetCampo['qtd_vagas_adicional'], '', $vetCampo['qtd_vagas_bloqueadas'], '', $vetCampo['qtd_dias_reservados']),
                            Array($vetCampo['valor_inscricao'], '', $vetCampo['qtd_minima_pagantes'], '', $vetCampo['previsao_receita'], '', $vetCampo_w['frequencia_min']),
                                ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);

                        $vetFrm[] = Frame('', Array(
                            Array($vetCampo['idt_grupo']),
                                ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);

                        $vetFrm[] = Frame('', $vetFrmPA, $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametrosPA);

                        $vetCampo['observacao']['style'] .= ' width: 750px;';

                        $vetFrm[] = Frame('', Array(
                            Array($vetCampo['idt_publico_alvo'], '', $vetCampo['observacao']),
                                ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);
                    }
                } else {
                    $vetCampo_w['idt_produto']['mostra_bt'] = false;
                    $vetCampo['descricao']['size'] = '54';

                    $vetFrm[] = Frame('', Array(
                        Array($vetCampo_w['idt_produto'], '', $vetCampo['idt_foco_tematico'], '', $vetCampo['carga_horaria_total'], '', $vetCampo_w['frequencia_min'], '', $vetCampo['previsao_receita']),
                        Array($vetCampo['descricao'], '', $vetCampo_w['quantidade_participante'], '', $vetCampo['qtd_vagas_adicional'], '', $vetCampo['valor_inscricao'], '', $vetCampo['qtd_minima_pagantes']),
                            ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);

                    $vetFrm[] = Frame('', $vetFrmPA, $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametrosPA);

                    MesclarCol($vetCampo['comercializar'], 3);

                    $vetFrm[] = Frame('', Array(
                        Array($vetCampo['idt_unidade'], '', $vetCampo['idt_ponto_atendimento_tela'], '', $vetCampo['idt_gestor_evento'], '', $vetCampo['maturidade'], '', $vetCampo['qtd_dias_reservados']),
                        Array($vetCampo['idt_publico_alvo'], '', $vetCampo['evento_aberto'], '', $vetCampo['gratuito'], '', $vetCampo['comercializar']),
                            ), $class_frame . $classPai, $class_titulo, $titulo_na_linha, $vetParametros);

                    $vetFrm[] = Frame('', Array(
                        Array($vetCampo['observacao']),
                            ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);
                }
            }
            break;
    }
}

if ($origem_evento_tela != 'compra') {
    if ($origem_evento_tela == 'combo') {
        $colocaAgenda = true;
    } else {
    // Assentos
    $vetParametros = Array(
        'codigo_frm' => 'assento_marcado_tit',
        'controle_fecha' => 'A',
    );

    $vetFrm[] = Frame('<span>MAPA DO LOCAL</span>', '', $class_frame_p, $class_titulo_p, $titulo_na_linha_p, $vetParametros);

    $vetCampoFC = Array();
    $vetCampoFC['sala'] = CriaVetTabela('Sala');
    $vetCampoFC['descricao'] = CriaVetTabela('Descrição');

    $titulo = 'Mapa do Local';

    $sql = '';
    $sql .= ' select epm.idt, l.descricao as sala, epm.descricao';
    $sql .= ' from grc_evento_mapa epm';
    $sql .= ' inner join grc_evento_local_pa l on l.idt = epm.idt_local_pa';
    $sql .= ' where epm.idt_evento = $vlID';
    $sql .= ' order by l.descricao, epm.descricao';

    $vetParametrosLC = Array(
        'barra_inc_ap' => false,
        'barra_exc_ap' => false,
    );

    $vetCampo['grc_evento_mapa'] = objListarConf('grc_evento_mapa', 'idt', $vetCampoFC, $sql, $titulo, false, $vetParametrosLC);

    $vetParametros = Array(
        'codigo_pai' => 'assento_marcado_tit',
        'width' => '100%',
    );

    $vetCampo['assento_marcado'] = objCmbVetor('assento_marcado', 'Assento Marcado?', true, $vetNaoSim, '');

    $vetFrm[] = Frame('', Array(
        Array($vetCampo['assento_marcado']),
            ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);

    $vetFrm[] = Frame('', Array(
        Array($vetCampo['grc_evento_mapa']),
            ), $class_frame . ' assento_marcado_frm', $class_titulo, $titulo_na_linha, $vetParametros);

    $vetParametros = Array(
        'codigo_frm' => 'inf_publicacao',
        'controle_fecha' => false,
    );

    $vetFrm[] = Frame('<span>Informações para Publicação</span>', '', $class_frame_p, $class_titulo_p, $titulo_na_linha_p, $vetParametros);

    $vetParametros = Array(
        'codigo_pai' => 'inf_publicacao',
        'width' => '100%',
    );

    $colocaAgenda = false;

    $maxlength = 2000;
    $style = "";
    $js = "";
    $vetCampo['tag_busca'] = objTextArea('tag_busca', 'TAGs Busca', false, $maxlength, $style, $js);

    $vetCampo['data_publicacao_de'] = objDataHora('data_publicacao_de', 'Publicar De', false, '', '', 'S');
    $vetCampo['data_publicacao_ate'] = objDataHora('data_publicacao_ate', 'Publicar  Até', false, '', '', 'S');
    $vetCampo['data_hora_fim_inscricao_ec'] = objDataHora('data_hora_fim_inscricao_ec', 'Data Fim inscrição loja Virtual', false, '', '', 'S');
    $vetCampo['restrito'] = objCmbVetor('restrito', 'Evento Restrito?', false, $vetSimNao, '');

    $par = 'data_publicacao_de,data_publicacao_ate,data_hora_fim_inscricao_ec';
    $vetDesativa['publique_imediatamente'][0] = vetDesativa($par);
    $vetAtivadoObr['publique_imediatamente'][0] = vetAtivadoObr($par);

    switch ($idt_instrumento) {
        case 41: // feira
            $vetFrm[] = Frame('', Array(
                Array($vetCampo['descricao_copia'], '', $vetCampo['evento_acesso_descricao_md5'], '', $vetCampo['evento_acesso_descricao']),
                    ), $class_frame . ' frm_sem_margem', $class_titulo, $titulo_na_linha, $vetParametros);

            $vetFrm[] = Frame('', Array(
                Array($vetCampo['descricao_comercial']),
                Array($vetCampo['conteudo_programatico']),
                    ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);
            break;

        case 45: // Missão e Caravana
            $vetFrm[] = Frame('', Array(
                Array($vetCampo['descricao_copia'], '', $vetCampo['evento_acesso_descricao_md5'], '', $vetCampo['evento_acesso_descricao']),
                    ), $class_frame . ' frm_sem_margem', $class_titulo, $titulo_na_linha, $vetParametros);
            break;

        case 2: // Consultoria de Longa Duração
            $vetFrm[] = Frame('', Array(
                Array($vetCampo['descricao_copia'], '', $vetCampo['publique_imediatamente'], '', $vetCampo['publica_internet'], '', $vetCampo['evento_acesso_descricao_md5'], '', $vetCampo['evento_acesso_descricao']),
                    ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);

            $vetFrm[] = Frame('', Array(
                Array($vetCampo['data_publicacao_de'], '', $vetCampo['data_publicacao_ate'], '', $vetCampo['data_hora_fim_inscricao_ec'], '', $vetCampo['restrito']),
                    ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);

            $colocaAgenda = true;
            break;

        default:
            if ($origem_evento_tela == 'combo') {
                $vetFrm[] = Frame('', Array(
                    Array($vetCampo['descricao_copia'], '', $vetCampo['publique_imediatamente'], '', $vetCampo['publica_internet']),
                        ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);

                $vetFrm[] = Frame('', Array(
                    Array($vetCampo['data_publicacao_de'], '', $vetCampo['data_publicacao_ate'], '', $vetCampo['data_hora_fim_inscricao_ec'], '', $vetCampo['restrito']),
                        ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);
            } else {
                $vetFrm[] = Frame('', Array(
                    Array($vetCampo['descricao_copia'], '', $vetCampo['publique_imediatamente'], '', $vetCampo['publica_internet'], '', $vetCampo['evento_acesso_descricao_md5'], '', $vetCampo['evento_acesso_descricao']),
                        ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);

                $vetFrm[] = Frame('', Array(
                    Array($vetCampo['data_publicacao_de'], '', $vetCampo['data_publicacao_ate'], '', $vetCampo['data_hora_fim_inscricao_ec'], '', $vetCampo['restrito']),
                        ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);

                if ($composto != 'S') {
                    $vetFrm[] = Frame('', Array(
                        Array($vetCampo['descricao_comercial']),
                        Array($vetCampo['conteudo_programatico']),
                            ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);

                    $vetFrm[] = Frame('<span>Endereço local agendado</span>', Array(
                        Array($vetCampo['cep'], '', $vetCampo['logradouro'], '', $vetCampo['logradouro_numero'], '', $vetCampo['logradouro_complemento']),
                        Array($vetCampo['logradouro_bairro'], '', $vetCampo['logradouro_municipio'], '', $vetCampo['logradouro_estado'], '', $vetCampo['logradouro_pais']),
                            ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);
                }
            }

            $colocaAgenda = true;
            break;
    }

    $vetFrm[] = Frame('', Array(
        Array($vetCampo['tag_busca']),
            ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);
    }

    if ($veio == 'SG') {
        $vetFrm[] = Frame('', Array(
            Array($vetCampo['grc_evento_anexo_tit'], ''),
            Array($vetCampo['grc_evento_anexo'], '', $vetCampo['bt_ficha']),
                ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);
    } else {
        $vetFrm[] = Frame('', Array(
            Array($vetCampo['grc_evento_anexo_tit']),
            Array($vetCampo['grc_evento_anexo']),
                ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);
    }

    $vetFrm[] = Frame('', Array(
        Array($vetCampo['grc_evento_galeria_tit']),
        Array($vetCampo['grc_evento_galeria']),
            ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);

    if ($colocaAgenda) {
        codigoAgenda();
    }
}

//SubEvento
if ($composto == 'S') {
    $vetParametros = Array(
        'codigo_frm' => 'subevento',
        'controle_fecha' => 'A',
    );

    parametrosTitulo($vetParametros);

    $vetFrm[] = Frame('<span>Eventos Associados</span>', '', $class_frame_p, $class_titulo_p, $titulo_na_linha_p, $vetParametros);

    $vetCampoLC = Array();
    $vetPadrao = Array();

    $vetCampoLC['instrumento'] = CriaVetTabela('Instrumento');
    $vetCampoLC['codigo'] = CriaVetTabela('Código');
    $vetCampoLC['descricao'] = CriaVetTabela('Descrição');

    $titulo = 'Evento Associados';

    $sql = '';
    $sql .= ' select e.idt, e.codigo, e.descricao, i.descricao as instrumento';
    $sql .= ' from grc_evento e';
    $sql .= ' inner join grc_atendimento_instrumento i on i.idt = e.idt_instrumento';
    $sql .= ' where e.idt_evento_pai = $vlID';
    $sql .= ' order by i.ordem_composto, e.codigo';

    $vetPadrao = Array(
        'barra_inc_ap' => false,
        'barra_alt_ap' => true,
        'barra_con_ap' => true,
        'barra_exc_ap' => false,
    );

    $vetCampo['grc_evento'] = objListarConf('grc_evento', 'idt', $vetCampoLC, $sql, $titulo, true, $vetPadrao);

    $vetParametros = Array(
        'codigo_pai' => 'subevento',
        'width' => '100%',
    );

    $vetFrm[] = Frame('', Array(
        Array($vetCampo['grc_evento']),
            ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);
}

//Evento do Combo
if ($origem_evento_tela == 'combo') {
    $vetParametros = Array(
        'codigo_frm' => 'subevento',
        'controle_fecha' => 'A',
    );

    parametrosTitulo($vetParametros);

    $vetFrm[] = Frame('<span>Eventos Associados</span>', '', $class_frame_p, $class_titulo_p, $titulo_na_linha_p, $vetParametros);

    $vetParametros = Array(
        'codigo_pai' => 'subevento',
        'width' => '100%',
    );

    $vetCampoLC = Array();

    $vetCampoLC['instrumento'] = CriaVetTabela('Instrumento');
    $vetCampoLC['unidade'] = CriaVetTabela('Unidade');
    $vetCampoLC['evento'] = CriaVetTabela('Evento');
    $vetCampoLC['matricula_obr'] = CriaVetTabela('Evento Obrigatório?', 'descDominio', $vetSimNao);
    $vetCampoLC['assento_marcado'] = CriaVetTabela('Assento Marcado?', 'func_trata_dado', ftd_grc_evento_combo);
    $vetCampoLC['qtd_vaga'] = CriaVetTabela('Qtde. Vagas');
    $vetCampoLC['qtd_utilizada'] = CriaVetTabela('Qtde. Utilizada');
    //$vetCampoLC['perc_desconto'] = CriaVetTabela('Desconto na Inscrição', 'decimal');
    //$vetCampoLC['vl_evento'] = CriaVetTabela('Valor Inscrição no Evento', 'decimal');
    $vetCampoLC['vl_matricula'] = CriaVetTabela('Valor Inscrição no Combo', 'decimal');
    $vetCampoLC['situacao'] = CriaVetTabela('Situação', 'descDominio', $vetSitEventoComboAss);

    $titulo = 'Evento Associados';

    if ($idt_evento_situacao == 15) {
        $vetParametrosLC = Array(
            'barra_icone' => true,
            'acao_alt_con_p' => 'S',
            'barra_inc_ap' => false,
            'barra_alt_ap' => true,
            'barra_con_ap' => true,
            'barra_exc_ap' => false,
        );
    } else {
        $vetParametrosLC = Array();
    }

    if ($_GET['idt_pendencia'] != '') {
        $sql = '';
        $sql .= ' select idt_responsavel_unidade_lotacao';
        $sql .= ' from grc_atendimento_pendencia';
        $sql .= ' where idt = ' . null($_GET['idt_pendencia']);
        $rst = execsql($sql);
        $idt_responsavel_unidade_lotacao = $rst->data[0][0];

        $vetParametrosLC['campo_linha_cor'] = 'linha_cor';
        $vetParametrosLC['func_trata_rs'] = ftr_grc_evento_combo;
    }

    $sql = '';
    $sql .= " select eg.*, concat_ws('<br />', e.codigo, e.descricao) as evento, i.descricao as instrumento,";
    $sql .= ' e.idt_unidade, e.assento_marcado, u.descricao as unidade, null as linha_cor';
    $sql .= ' from grc_evento_combo eg';
    $sql .= ' inner join grc_evento e on e.idt = eg.idt_evento';
    $sql .= ' inner join grc_atendimento_instrumento i on i.idt = e.idt_instrumento';
    $sql .= ' inner join ' . db_pir . 'sca_organizacao_secao u on u.idt = e.idt_unidade';
    $sql .= ' where eg.idt_evento_origem = $vlID';
    $sql .= ' order by i.ordem_composto, e.codigo';

    $vetCampo['grc_evento_combo'] = objListarConf('grc_evento_combo', 'idt', $vetCampoLC, $sql, $titulo, true, $vetParametrosLC);

    $vetFrm[] = Frame('', Array(
        Array($vetCampo['grc_evento_combo']),
            ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);

    $vetCampoLC = Array();
    $vetCampoLC['instrumento'] = CriaVetTabela('Instrumento');
    $vetCampoLC['qtd_min'] = CriaVetTabela('Qtde. Mínima');
    $vetCampoLC['qtd_max'] = CriaVetTabela('Qtde. Máxima');
    $vetCampoLC['qtd_atual'] = CriaVetTabela('Qtde. Mínima na Inscrição', 'func_trata_dado', ftd_grc_evento_combo_instrumento);

    $titulo = 'Instrumento Associados';

    $sql = '';
    $sql .= ' select eg.*, i.descricao as instrumento';
    $sql .= ' from grc_evento_combo_instrumento eg';
    $sql .= ' inner join grc_atendimento_instrumento i on i.idt = eg.idt_instrumento';
    $sql .= ' where eg.idt_evento = $vlID';
    $sql .= ' order by i.ordem_composto';

    $vetParametrosLC = Array(
        'comcontrole' => '0',
        'global' => Array(
            'acao' => $acao,
            'acao_alt_con' => $acao_alt_con,
        ),
    );

    $vetCampo['grc_evento_combo_instrumento'] = objListarConf('grc_evento_combo_instrumento', 'idt', $vetCampoLC, $sql, $titulo, false, $vetParametrosLC);

    $vetFrm[] = Frame('<span>' . $titulo . '</span>', Array(
        Array($vetCampo['grc_evento_combo_instrumento']),
            ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);

    if ($_GET['idt_pendencia'] != '' || $idt_evento_situacao == 6 || $idt_evento_situacao >= 14) {
        $vetCampoLC = Array();
        $vetCampoLC['unidade'] = CriaVetTabela('Unidade');
        $vetCampoLC['qtd_evento'] = CriaVetTabela('Qtde. Evento');
        $vetCampoLC['aprovador'] = CriaVetTabela('Aprovador');
        $vetCampoLC['dt_aprovacao'] = CriaVetTabela('Dt. Aprovação', 'datahora');
        $vetCampoLC['situacao'] = CriaVetTabela('Situação', 'descDominio', $vetSitEventoComboAss);

        $titulo = 'Unidades Associadas';

        $sql = '';
        $sql .= ' select eg.*, u.descricao as unidade, plu_u.nome_completo as aprovador';
        $sql .= ' from grc_evento_combo_unidade eg';
        $sql .= ' inner join ' . db_pir . 'sca_organizacao_secao u on u.idt = eg.idt_unidade';
        $sql .= ' left outer join plu_usuario plu_u on plu_u.id_usuario = eg.idt_usuario_aprovacao';
        $sql .= ' where eg.idt_evento = $vlID';
        $sql .= ' order by u.descricao';

        $vetParametrosLC = Array(
            'comcontrole' => '0',
        );

        $vetCampo['grc_evento_combo_unidade'] = objListarConf('grc_evento_combo_unidade', 'idt', $vetCampoLC, $sql, $titulo, false, $vetParametrosLC);

        $vetFrm[] = Frame('<span>' . $titulo . '</span>', Array(
            Array($vetCampo['grc_evento_combo_unidade']),
                ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);
    }
}

if ($idt_evento_pai == '' && $origem_evento_tela != 'combo') {
    $vetParametros = Array(
        'codigo_frm' => 'prev_insumo',
        'controle_fecha' => 'A',
    );

    parametrosTitulo($vetParametros);

    $vetFrm[] = Frame('<span>Previsão de Despesas e Receitas</span>', '', $class_frame_p, $class_titulo_p, $titulo_na_linha_p, $vetParametros);

    $vetParametros = Array(
        'codigo_pai' => 'prev_insumo',
        'width' => '100%',
    );

    $vetFrm[] = Frame('', Array(
        Array($vetCampo_i['resumo_evento_receita_despesa']),
            ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);

    if ($idt_instrumento != 41 && $idt_instrumento != 45 && $origem_evento_tela != 'compra') {   // consultoria
        $vetParametros = Array(
            'codigo_frm' => 'receita',
            'controle_fecha' => 'A',
        );

        parametrosTitulo($vetParametros);

        $vetFrm[] = Frame('<span>Previsão de Receitas</span>', '', $class_frame_p, $class_titulo_p, $titulo_na_linha_p, $vetParametros);


        $vetCampoLC = Array();
//        $vetCampoLC['grc_iec_descricao'] = CriaVetTabela('Tipo de Custo');
        //$vetCampoLC['sca_os_descricao'] = CriaVetTabela('Área de Suporte');
        $vetCampoLC['grc_pp_descricao'] = CriaVetTabela('Insumo');
        $vetCampoLC['descricao'] = CriaVetTabela('Complemento Descrição');
        $vetCampoLC['grc_iu_descricao'] = CriaVetTabela('Unid.');
        $vetCampoLC['quantidade'] = CriaVetTabela('Quant.', 'decimal');
        $vetCampoLC['custo_unitario_real'] = CriaVetTabela('Receita Unit. (R$)', 'decimal');
        $vetCampoLC['por_participante'] = CriaVetTabela('Por parti.?', 'descDominio', $vetSimNao);
        $vetCampoLC['quantidade_evento'] = CriaVetTabela('Quant. a ser Atendida', 'decimal');
        $vetCampoLC['receita_total'] = CriaVetTabela('Receita Total (R$)', 'decimal');
        $vetCampoLC['rtotal_minimo'] = CriaVetTabela('Receita Mínimo (R$)', 'decimal');
        $vetCampoLC['rtotal_maximo'] = CriaVetTabela('Receita Máximo (R$)', 'decimal');
        $vetCampoLC['ativo'] = CriaVetTabela('Ativo?', 'descDominio', $vetSimNao);

        $titulo = 'Receita Associada';

        $TabelaPrinc = "grc_evento_insumo";
        $AliasPric = "grc_eveins";
        $Entidade = "Insumo da Programação de Produto";
        $Entidade_p = "Insumos da Programação de Produto";

        $CampoPricPai = "idt_evento";


        $orderby = "grc_pp.classificacao";

        $sql = "select {$AliasPric}.*, ";
        $sql .= "       grc_pp.classificacao as grc_pp_classificacao, ";
        $sql .= "       grc_pp.descricao as grc_pp_descricao, ";
        $sql .= "       grc_pp.sinal as grc_pp_sinal, ";
        $sql .= "       grc_iu.descricao as grc_iu_descricao ";
        $sql .= " from {$TabelaPrinc} {$AliasPric}  ";
        $sql .= " inner join grc_insumo grc_pp on grc_pp.idt = {$AliasPric}.idt_insumo ";
        $sql .= " left join grc_insumo_elemento_custo grc_iec on grc_iec.idt = grc_pp.idt_insumo_elemento_custo ";
        $sql .= " inner join grc_insumo_unidade grc_iu on grc_iu.idt = {$AliasPric}.idt_insumo_unidade ";
        $sql .= " where {$AliasPric}" . '.idt_evento = $vlID';
        $sql .= " and grc_pp.sinal = " . aspa('N'); // receita
        $sql .= " order by {$orderby}";

        $vetParametrosLC = Array(
            'func_trata_row' => trata_row_grc_evento_receita,
        );

        $vetCampo['grc_evento_receita'] = objListarConf('grc_evento_receita', 'idt', $vetCampoLC, $sql, $titulo, false, $vetParametrosLC);

        $vetParametros = Array(
            'codigo_pai' => 'receita',
            'width' => '100%',
        );

        $vetFrm[] = Frame('', Array(
            Array($vetCampo['grc_evento_receita']),
                ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);
    }
}

// INSUMOS
if ($origem_evento_tela != 'combo') {
    $vetParametros = Array(
        'codigo_frm' => 'insumo',
        'controle_fecha' => 'F',
    );

    if ($origem_evento_tela == 'compra') {
        $vetParametros['controle_fecha'] = 'A';
    }

    parametrosTitulo($vetParametros);

    $vetFilho = Array();

    if ($composto == 'S') {
        $lbl = 'Demandas de Contratação de Credenciados';

        $sql = '';
        $sql .= ' select e.idt, e.codigo, e.descricao, e.idt_instrumento, i.descricao as instrumento, e.quantidade_participante, p.participante_minimo, p.participante_maximo';
        $sql .= ' from grc_evento e';
        $sql .= ' inner join grc_atendimento_instrumento i on i.idt = e.idt_instrumento';
        $sql .= ' inner join grc_produto p on p.idt = e.idt_produto';
        $sql .= ' where e.idt_evento_pai = ' . null($_GET['id']);
        $sql .= ' order by e.codigo';
        $rs = execsql($sql);

        foreach ($rs->data as $row) {
            $vetFilho[] = $row;
        }
    } else {
        $lbl = 'Demandas às Unidades de Suporte';
        $vetFilho[] = $idt_evento;
    }

    $vetFrm[] = Frame('<span>' . $lbl . '</span>', '', $class_frame_p, $class_titulo_p, $titulo_na_linha_p, $vetParametros);

    foreach ($vetFilho as $rowFilho) {
        if ($composto == 'S') {
            $barra_inc_ap = false;
            $titFrame = '<span>' . $rowFilho['instrumento'] . ' - ' . $rowFilho['descricao'] . '</span>';
            $titulo = 'Insumo Associado do ' . $rowFilho['instrumento'] . ' - ' . $rowFilho['descricao'];
            $id_w = $rowFilho['idt'];
            $menu_listarConf = 'grc_evento_insumo';
            $campo_listarConf = 'grc_evento_insumo_' . $rowFilho['idt'];

            $input_data = Array(
                'quantidade_participante' => $rowFilho['quantidade_participante'],
                'participante_minimo' => $rowFilho['participante_minimo'],
                'participante_maximo' => $rowFilho['participante_maximo'],
                'idt_instrumento' => $rowFilho['idt_instrumento'],
            );
        } else {
            $barra_inc_ap = true;
            $titFrame = '';
            $titulo = 'Insumo Associado';
            $id_w = $_GET['id'];
            $menu_listarConf = '';
            $campo_listarConf = 'grc_evento_insumo';

            $input_data = Array(
                'quantidade_participante' => '',
                'participante_minimo' => $rowp['participante_minimo'],
                'participante_maximo' => $rowp['participante_maximo'],
                'idt_instrumento' => $idt_instrumento,
            );
        }

        $vetCampoLC = Array();
        $vetCampoLC['sca_os_descricao'] = CriaVetTabela('Unidade de Suporte');
        $vetCampoLC['grc_pp_descricao'] = CriaVetTabela('Insumo');
        $vetCampoLC['descricao'] = CriaVetTabela('Complemento Descrição');
        $vetCampoLC['grc_iu_descricao'] = CriaVetTabela('Unid.');
        $vetCampoLC['quantidade'] = CriaVetTabela('Quant.', 'decimal');
        $vetCampoLC['custo_unitario_real'] = CriaVetTabela('Custo Unit. (R$)', 'decimal');
        $vetCampoLC['por_participante'] = CriaVetTabela('Por parti.?', 'descDominio', $vetSimNao);
        $vetCampoLC['quantidade_evento'] = CriaVetTabela('Quant. a ser Atendida', 'decimal');
        $vetCampoLC['custo_total'] = CriaVetTabela('Custo Total (R$)', 'decimal');
        $vetCampoLC['ctotal_minimo'] = CriaVetTabela('Custo Mínimo (R$)', 'decimal');
        $vetCampoLC['ctotal_maximo'] = CriaVetTabela('Custo Máximo (R$)', 'decimal');
        $vetCampoLC['ativo'] = CriaVetTabela('Ativo?', 'descDominio', $vetSimNao);

        if ($idt_evento_situacao >= 14) {
            $vetCampoLC['status'] = CriaVetTabela('Status');
        }

        if ($origem_evento_tela == 'compra') {
            $vetCampoLC['estocavel'] = CriaVetTabela('Estocavel?', 'descDominio', $vetSimNao);
        }

        $TabelaPrinc = "grc_evento_insumo";
        $AliasPric = "grc_eveins";
        $Entidade = "Insumo da Programação de Produto";
        $Entidade_p = "Insumos da Programação de Produto";

        $CampoPricPai = "idt_evento";

        $orderby = "sca_os_descricao, grc_pp.classificacao";

        $sql = "select {$AliasPric}.*, ";
        $sql .= "       sca_os.descricao as sca_os_descricao, ";
        $sql .= "       grc_pp.classificacao as grc_pp_classificacao, ";
        $sql .= "       grc_pp.descricao as grc_pp_descricao, ";
        $sql .= "       grc_pp.sinal as grc_pp_sinal, ";
        $sql .= "       grc_iu.descricao as grc_iu_descricao ";
        $sql .= " from {$TabelaPrinc} {$AliasPric}  ";
        $sql .= " inner join grc_insumo grc_pp on grc_pp.idt = {$AliasPric}.idt_insumo ";
        $sql .= " left join grc_insumo_elemento_custo grc_iec on grc_iec.idt = grc_pp.idt_insumo_elemento_custo ";
        $sql .= " left join " . db_pir . "sca_organizacao_secao sca_os on sca_os.idt = grc_eveins.idt_area_suporte ";
        $sql .= " inner join grc_insumo_unidade grc_iu on grc_iu.idt = {$AliasPric}.idt_insumo_unidade ";
        $sql .= " where {$AliasPric}" . '.idt_evento = ' . null($id_w);
        $sql .= " and grc_pp.sinal = " . aspa('S'); // despesa

        if ($composto == 'S') {
            $sql .= " and {$AliasPric}.idt_profissional is not null";
        } else {
            if ($origem_evento_tela == 'compra') {
                $sql .= " and {$AliasPric}.idt_profissional is null";
            }

            if ($_GET['fil_estocavel7'] != "" && $_GET['fil_estocavel7'] != "0" && $_GET['fil_estocavel7'] != "-1") {
                $sql .= " and {$AliasPric}.estocavel = " . aspa($_GET['fil_estocavel7']);
            }

            if ($_GET['fil_idt_insumo8'] != "" && $_GET['fil_idt_insumo8'] != "0" && $_GET['fil_idt_insumo8'] != "-1") {
                $sql .= " and {$AliasPric}.idt_insumo = " . null($_GET['fil_idt_insumo8']);
            }
        }

        $sql .= " order by {$orderby}";

        if ($origem_evento_tela == 'compra') {
            $vetParametrosLC = Array(
                'acao_alt_con_p' => 'S',
                'barra_inc_ap' => false,
                'barra_exc_ap' => false,
            );
        } else if ($idt_evento_situacao == 1 || $idt_evento_situacao == 5) {
            $vetParametrosLC = Array(
                'func_trata_row' => bloqueia_row_grc_evento_insumo,
                'barra_icone' => true,
            );
        }

        $vetPadrao = Array(
            'menu_acesso' => 'grc_evento_insumo',
            'barra_inc_ap' => $barra_inc_ap,
            'idCadPer' => $id_w,
            'input_data' => $input_data,
        );

        $vetParametrosLC = array_merge($vetParametrosLC, $vetPadrao);

        $vetCampo[$campo_listarConf] = objListarConf($campo_listarConf, 'idt', $vetCampoLC, $sql, $titulo, false, $vetParametrosLC, $menu_listarConf);

        $vetParametros = Array(
            'codigo_pai' => 'insumo',
            'width' => '100%',
        );

        $vetFrm[] = Frame($titFrame, Array(
            Array($vetCampo[$campo_listarConf]),
                ), $class_frame, 'class_titulo_p_barra', $titulo_na_linha, $vetParametros);
    }
}

//Contratação de Credenciado
if ($origem_evento_tela != 'compra' && $idt_evento_pai == '') {
    if ($veio == 'SG' || $origem_evento_tela == 'combo') {
        $classDisplay = ' display_none';
    } else {
        $classDisplay = '';
    }

    $vetParametros = Array(
        'codigo_frm' => 'contratacao_credenciado',
        'controle_fecha' => 'A',
    );

    parametrosTitulo($vetParametros);

    $vetFrm[] = Frame('<span>Contratação de Credenciado</span>', '', $class_frame_p . $classDisplay, $class_titulo_p, $titulo_na_linha_p, $vetParametros);

    $vetParametros = Array(
        'codigo_pai' => 'contratacao_credenciado',
        'align' => 'left',
    );

    $vetCampo['cred_necessita_credenciado'] = objCmbVetor('cred_necessita_credenciado', 'Necessita Credenciado(s)?', true, $vetNaoSim, '');
    $vetCampo['cred_rodizio_auto'] = objCmbVetor('cred_rodizio_auto', 'Realizar Rodízio Automático?', false, $vetSimNao, '');
    $vetCampo['cred_credenciado_sgc'] = objCmbVetor('cred_credenciado_sgc', 'É Credenciado SGC?', false, $vetSimNao);

    $sql = '';
    $sql .= ' select id_usuario, nome_completo';
    $sql .= ' from plu_usuario';
    $sql .= ' where (idt_unidade_lotacao is not null';
    $sql .= " and ativo = 'S')";
    $sql .= ' or id_usuario = ' . null($idt_responsavel_consultor);
    $sql .= ' order by nome_completo';
    $vetCampo['idt_responsavel_consultor'] = objCmbBanco('idt_responsavel_consultor', 'Consultor/Responsável', false, $sql, ' ', 'width:660px;');

    $vetFrm[] = Frame('', Array(
        Array($vetCampo['cred_necessita_credenciado'], '', $vetCampo['cred_rodizio_auto'], '', $vetCampo['cred_credenciado_sgc'], '', $vetCampo['idt_responsavel_consultor']),
            ), $class_frame . $classDisplay, $class_titulo, $titulo_na_linha, $vetParametros);

    $js = 'onblur="return validaCPFCNPJ(this);" onkeyup="return formataCPFCNPJ(this,event);"';
    $vetCampo['cred_escolhido_cnpj_cpf'] = objTexto('cred_escolhido_cnpj_cpf', 'CNPJ / CPF', false, 18, 18, $js);
    $vetCampo['cred_escolhido_nome'] = objTexto('cred_escolhido_nome', 'Razão Social / Nome', false, 60, 200);
    $vetCampo['cred_escolhido_telefone'] = objTelefone('cred_escolhido_telefone', 'Telefone', false);
    $vetCampo['cred_escolhido_email'] = objEmail('cred_escolhido_email', 'Email', false, 50);
    $vetCampo['cred_escolhido_justificativa'] = objTextArea('cred_escolhido_justificativa', 'Justificativa', false, 2000);

    MesclarCol($vetCampo['cred_escolhido_justificativa'], 7);

    $vetFrm[] = Frame('', Array(
        Array($vetCampo['cred_escolhido_cnpj_cpf'], '', $vetCampo['cred_escolhido_nome'], '', $vetCampo['cred_escolhido_telefone'], '', $vetCampo['cred_escolhido_email']),
        Array($vetCampo['cred_escolhido_justificativa']),
            ), $class_frame . $classDisplay, $class_titulo, $titulo_na_linha, $vetParametros);

    $vetCampo['cred_contratacao_cont'] = objCmbVetor('cred_contratacao_cont', 'É Contratação Continuada?', false, $vetNaoSim, '');
    $vetCampo['cred_cod_evento'] = objTexto('cred_cod_evento', 'Código do Evento', false, 20);
    $vetCampo['cred_idt_evento'] = objHidden('cred_idt_evento', '');
    $vetCampo['cred_contratacao_cont_obs'] = objTexto('cred_contratacao_cont_obs', 'Observação', false, 106, 255);

    MesclarCol($vetCampo['cred_idt_evento'], 5);

    $vetFrm[] = Frame('', Array(
        Array($vetCampo['cred_contratacao_cont'], '', $vetCampo['cred_cod_evento'], '', $vetCampo['cred_contratacao_cont_obs']),
        Array($vetCampo['cred_idt_evento']),
            ), $class_frame . $classDisplay, $class_titulo, $titulo_na_linha, $vetParametros);

    //Logica dos campos
    if ($classDisplay == '') {
        $par = 'cred_rodizio_auto';
        $vetDesativa['cred_necessita_credenciado'][0] = vetDesativa($par, ',N', true, true, 'S');
        $vetAtivadoObr['cred_necessita_credenciado'][0] = vetAtivadoObr($par);

        $par = 'idt_responsavel_consultor';
        $vetDesativa['cred_necessita_credenciado'][1] = vetDesativa($par, ',S');
        $vetAtivadoObr['cred_necessita_credenciado'][1] = vetAtivadoObr($par, 'N');

        $par = 'cred_credenciado_sgc';
        $vetDesativa['cred_rodizio_auto'][0] = vetDesativa($par, ',S');
        $vetAtivadoObr['cred_rodizio_auto'][0] = vetAtivadoObr($par, 'N');

        $par = 'cred_escolhido_cnpj_cpf,cred_escolhido_nome,cred_escolhido_telefone,cred_escolhido_email,cred_escolhido_justificativa';
        $vetDesativa['cred_credenciado_sgc'][0] = vetDesativa($par, ',S');
        $vetAtivadoObr['cred_credenciado_sgc'][0] = vetAtivadoObr($par, 'N');

        $par = 'cred_contratacao_cont';
        $vetDesativa['cred_credenciado_sgc'][1] = vetDesativa($par, ',N', true, true, 'N');
        $vetAtivadoObr['cred_credenciado_sgc'][1] = vetAtivadoObr($par);

        $par = 'cred_cod_evento,cred_contratacao_cont_obs';
        $vetDesativa['cred_contratacao_cont'][0] = vetDesativa($par);
        //$vetAtivadoObr['cred_contratacao_cont'][0] = vetAtivadoObr($par);
    }
}

//Modelo Certificado
//52: Composto
//54: Combo
if ($idt_instrumento <> 52 && $idt_instrumento <> 54) {
    $vetParametros = Array(
        'codigo_frm' => 'certificado_modelo',
        'controle_fecha' => 'F',
    );

    parametrosTitulo($vetParametros);

    $titulo = 'Modelo do Certificado';

    $vetFrm[] = Frame('<span>' . $titulo . '</span>', '', $class_frame_p, $class_titulo_p, $titulo_na_linha_p, $vetParametros);

    $vetParametros = Array(
        'codigo_pai' => 'certificado_modelo',
        'width' => '100%',
    );

    $sql = '';
    $sql .= ' select idt, descricao';
    $sql .= ' from grc_evento_certificado_modelo';
    $sql .= ' where idt_instrumento is null or idt_instrumento = ' . null($idt_instrumento);
    $sql .= ' order by descricao';
    $vetCampo['idt_evento_certificado_modelo'] = objCmbBanco('idt_evento_certificado_modelo', 'Copiar o Modelo do Certificado para o Evento', false, $sql, ' ', '', '', false);

    $vetCampo['grc_evento_certificado_modelo_parametro'] = objInclude('grc_evento_certificado_modelo_parametro', 'cadastro_conf/grc_evento_certificado_modelo_parametro.php');

    $vetCampo['html_corpo'] = objHTML('html_corpo', 'Corpo do PDF', false, 320, 950, '', false, false, true);
    $vetCampo['html_header'] = objHTML('html_header', 'Cabeçalho do PDF', false, 320, 950, '', false, false, true);
    $vetCampo['html_footer'] = objHTML('html_footer', 'Rodapé do PDF', false, 320, 950, '', false, false, true);

    $vetCampo['mpdf_me'] = objTextoFixo('mpdf_me', 'Margem Esquerda', 5, true);
    $vetCampo['mpdf_md'] = objTextoFixo('mpdf_md', 'Margem Direita', 5, true);
    $vetCampo['mpdf_ms'] = objTextoFixo('mpdf_ms', 'Margem Superior', 5, true);
    $vetCampo['mpdf_mb'] = objTextoFixo('mpdf_mb', 'Margem Inferior', 5, true);
    $vetCampo['mpdf_mh'] = objTextoFixo('mpdf_mh', 'Margem Cabeçalho', 5, true);
    $vetCampo['mpdf_mf'] = objTextoFixo('mpdf_mf', 'Margem Rodapé', 5, true);
    $vetCampo['mpdf_papel_orientacao'] = objFixoVetor('mpdf_papel_orientacao', 'Orientação do Papel', false, $vetPapelOrientacao);

    MesclarCol($vetCampo['idt_evento_certificado_modelo'], 13);
    MesclarCol($vetCampo['grc_evento_certificado_modelo_parametro'], 13);
    MesclarCol($vetCampo['html_corpo'], 13);
    MesclarCol($vetCampo['html_header'], 13);
    MesclarCol($vetCampo['html_footer'], 13);

    $vetFrm[] = Frame('', Array(
        Array($vetCampo['idt_evento_certificado_modelo']),
        Array($vetCampo['mpdf_papel_orientacao'], '', $vetCampo['mpdf_me'], '', $vetCampo['mpdf_md'], '', $vetCampo['mpdf_ms'], '', $vetCampo['mpdf_mb'], '', $vetCampo['mpdf_mh'], '', $vetCampo['mpdf_mf']),
        Array($vetCampo['grc_evento_certificado_modelo_parametro']),
        Array($vetCampo['html_corpo']),
        Array($vetCampo['html_header']),
        Array($vetCampo['html_footer']),
            ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);
}

//Público
$vetParametros = Array(
    'codigo_frm' => 'publico_ab_fe_tit',
    'controle_fecha' => 'A',
);

$vetFrm[] = Frame('<span>Público Fechado</span>', '', $class_frame_p, $class_titulo_p, $titulo_na_linha_p, $vetParametros);

$vetCampoFC = Array();
$vetCampoFC['cpf'] = CriaVetTabela('CPF');
$vetCampoFC['nome_pessoa'] = CriaVetTabela('NOME DO CLIENTE');

$titulo = 'Público Fechado';
$TabelaPrinc = "grc_evento_publico";
$AliasPric = "grc_epc";
$Entidade = "Público Fechado";
$Entidade_p = "Público Fechado";
$CampoPricPai = "idt_evento";

$sql = "select {$AliasPric}.*";
$sql .= " from {$TabelaPrinc} {$AliasPric} ";
$sql .= " where {$AliasPric}" . '.idt_evento = $vlID';
$sql .= " order by {$AliasPric}.nome_pessoa";

$vetCampo['grc_evento_publico'] = objListarConf('grc_evento_publico', 'idt', $vetCampoFC, $sql, $titulo, false);

$vetParametros = Array(
    'codigo_pai' => 'publico_ab_fe_tit',
    'width' => '100%',
);

$vetCampo['publico_ab_fe'] = objCmbVetor('publico_ab_fe', 'Público', true, $vetEventoPubPublico, '');

$vetFrm[] = Frame('', Array(
    Array($vetCampo['publico_ab_fe']),
        ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);

$vetFrm[] = Frame('', Array(
    Array($vetCampo['grc_evento_publico']),
        ), $class_frame . ' publico_ab_fe_frm', $class_titulo, $titulo_na_linha, $vetParametros);

//Participante
if ($origem_evento_tela != 'compra' && $idt_evento_pai == '') {
    //echo " idt_instrumento = $idt_instrumento  veio = $veio<br />";
    //p($_GET);
    // AGENDADO, EM EXECUÇÃO, PENDENTE, CONSOLIDADO ou CANCELADO depois a aprovação   
    if ($idt_evento_situacao >= 14 || $idt_instrumento == 2 || $veio == 'SG' || $composto == 'S') { // || $idt_evento_situacao == 5
        $vetParametros = Array(
            'codigo_frm' => 'participante',
            'controle_fecha' => 'A',
        );

        if ($veio == 'SG') {
            $titulo = 'Clientes Atendidos';
        } else if ($idt_instrumento == 2) {
            $titulo = 'Inserir Participantes';
        } else {
            $titulo = 'Inscrições e Encerramento';
        }

        $vetFrm[] = Frame('<span>' . $titulo . '</span>', '', $class_frame_p, $class_titulo_p, $titulo_na_linha_p, $vetParametros);

        $vetCampoLC = Array();
        $vetCampoLC['grc_at_protocolo'] = CriaVetTabela('Protocolo');
        $vetCampoLC['pessoa'] = CriaVetTabela('Nome do Cliente / CPF');
        $vetCampoLC['empreendimento'] = CriaVetTabela('Nome do Empreendimento / CNPJ');
        $vetCampoLC['gec_mid_descricao'] = CriaVetTabela('Mídia');

        if ($veio == 'SG') {
            $vetCampoLC['grc_evpa_vl_tot_pagamento'] = CriaVetTabela('Valor', 'decimal');
        } else {
            $vetCampoLC['grc_atpe_evento_cortesia'] = CriaVetTabela('Cortesia?', 'descDominio', $vetSimNao);
        }

        $vetCampoLC['grc_evpa_contrato'] = CriaVetTabela('Contrato', 'func_trata_dado', ftd_grc_evento_participante);
        $vetCampoLC['grc_atpe_evento_alt_siacweb'] = CriaVetTabela('Modificado pelo SiacWEB?', 'func_trata_dado', ftd_grc_evento_participante);

        if ($origem_evento_tela == 'grc_evento_acompanhar') {
            $vetCampoLC['grc_atpe_evento_concluio'] = CriaVetTabela('Concluinte?', 'func_trata_dado', ftd_evento_concluio);
        } else {
            //PENDENTE
            if ($idt_evento_situacao == 19 && $idt_instrumento != 2) {
                if ($_POST['btnAcao'] == '') {
                    conParticipanteEventoConcluidoSiacWeb($idt_evento);
                }

                $vetCampoLC['grc_atpe_evento_concluio'] = CriaVetTabela('Concluinte?', 'func_trata_dado', ftd_evento_pendente);
            }

            //CONSOLIDADO
            if ($idt_evento_situacao == 20) {
                if ($idt_instrumento != 2) {
                    $vetCampoLC['grc_atpe_evento_concluio'] = CriaVetTabela('Concluinte?', 'func_trata_dado', ftd_evento_concluio);
                }

                if ($obrigar_pesq_certificado == 'S') {
                    $vetCampoLC['evento_resp_pesq_certificado'] = CriaVetTabela('Pesquisa Respondida?', 'func_trata_dado', ftd_evento_resp_pesq_certificado);
                } else {
                    $vetCampoLC['evento_resp_pesq_certificado'] = CriaVetTabela('Certificado', 'func_trata_dado', ftd_evento_certificado);
                }
            }
        }

//        $vetCampo['funil'] = CriaVetTabela('Funil de Atendimento');


        $TabelaPrinc = "grc_atendimento";
        $AliasPric = "grc_at";
        $Entidade = $titulo;
        $Entidade_p = $titulo;
        $CampoPricPai = "idt_evento";

        $sql = "select {$AliasPric}.*, ";
        $sql .= "       grc_at.protocolo      as grc_at_protocolo, ";
        $sql .= "       grc_atpe.idt          as grc_atpe_idt, ";
        $sql .= "       concat_ws('<br />', grc_atpe.nome, grc_atpe.cpf) as pessoa,";
        $sql .= "       concat_ws('<br />', grc_ator.razao_social, grc_ator.cnpj) as empreendimento,";
        $sql .= "       grc_ator.cnpj, ";
        $sql .= "       grc_ator.funil_idt_cliente_classificacao, ";
        $sql .= "       grc_ator.funil_cliente_nota_avaliacao, ";
        $sql .= "       grc_atpe.siacweb_hist_erro_cod, ";
        $sql .= "       grc_atpe.siacweb_hist_erro_msg, ";
        $sql .= "       grc_atpe.evento_cortesia as grc_atpe_evento_cortesia, ";
        $sql .= "       grc_atpe.evento_alt_siacweb as grc_atpe_evento_alt_siacweb, ";
        $sql .= "       grc_atpe.evento_exc_siacweb as grc_atpe_evento_exc_siacweb, ";
        $sql .= "       grc_atpe.evento_inscrito as grc_atpe_evento_inscrito, ";
        $sql .= "       grc_atpe.evento_concluio as grc_atpe_evento_concluio, ";
        $sql .= "       grc_atpe.evento_resp_pesq_certificado, ";
        $sql .= "       grc_evpa.contrato as grc_evpa_contrato, ";
        $sql .= "       grc_evpa.vl_tot_pagamento as grc_evpa_vl_tot_pagamento, ";
        $sql .= "       grc_evpa.fe_situacao, ";
        $sql .= "       grc_evpa.fe_dt_validade, ";
        $sql .= "       null                  as funil, ";
        $sql .= "       gec_mid.descricao     as gec_mid_descricao ";
        $sql .= " from {$TabelaPrinc} {$AliasPric}  ";
        $sql .= " left  join grc_atendimento_pessoa            grc_atpe on grc_atpe.idt_atendimento = {$AliasPric}.idt ";
        $sql .= " left  join grc_atendimento_organizacao       grc_ator on grc_ator.idt_atendimento = {$AliasPric}.idt ";
        $sql .= " left  join grc_evento_participante           grc_evpa on grc_evpa.idt_atendimento = {$AliasPric}.idt ";
        $sql .= " left  join " . db_pir_gec . "gec_meio_informacao gec_mid  on gec_mid.idt = grc_evpa.idt_midia ";
        $sql .= " where {$AliasPric}" . '.idt_evento = $vlID';
        $sql .= "   and (grc_evpa.contrato is null or grc_evpa.contrato <> 'FE')";
        //$sql .= " and (grc_evpa.ativo is null or grc_evpa.ativo = 'S')";
        $sql .= " order by {$AliasPric}.protocolo, grc_atpe.tipo_relacao";

        if ($idt_instrumento == 2 && $veio != 'SG') {
            $vetParametrosLC = Array();
        } else if ($idt_evento_situacao == 14 || $idt_evento_situacao == 15 || $idt_evento_situacao == 16 || $idt_evento_situacao == 19) {
            if ($veio == 'SG') {
                $vetParametrosLC = Array(
                    'acao_alt_con_p' => 'SG',
                    'barra_inc_ap' => false,
                    'barra_alt_ap' => false,
                    'barra_con_ap' => true,
                    'barra_exc_ap' => false,
                    'func_trata_row' => trata_row_grc_evento_participante,
                );
            } else {
                $vetParametrosLC = Array(
                    'acao_alt_con_p' => 'S',
                    'func_trata_row' => trata_row_grc_evento_participante_funil,
                );
            }
        } else if ($idt_evento_situacao == 8 || ($idt_evento_situacao == 24 && $sgtec_modelo == 'H')) {
            $vetParametrosLC = Array(
                'acao_alt_con_p' => 'S',
                'barra_inc_ap' => false,
                'barra_alt_ap' => true,
                'barra_con_ap' => true,
                'barra_exc_ap' => false,
            );
        } else {
            $vetParametrosLC = Array();
        }

        //Liberação do cadastro de Participante para o Legado
        if ($idt_instrumento == 2 && $tipo_sincroniza_siacweb != 'P' && ($idt_evento_situacao == 14 || $idt_evento_situacao == 16 || $idt_evento_situacao == 19)) {
            $vetParametrosLC = Array(
                'acao_alt_con_p' => 'S',
            );
        }

		$vetParametrosLC['func_trata_rs'] = ftr_grc_evento_matricula;

        $vetCampo['grc_evento_participante'] = objListarConf('grc_evento_participante', 'grc_atpe_idt', $vetCampoLC, $sql, $titulo, false, $vetParametrosLC);

        $vetParametros = Array(
            'codigo_pai' => 'participante',
            'width' => '100%',
        );
        $vetFrm[] = Frame('', Array(
            Array($vetCampo['grc_evento_participante']),
                ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);

        //Resumo Canal
        $vetParametros = Array(
            'codigo_frm' => 'resumo_canal',
            'controle_fecha' => 'A',
        );

        $titulo = 'Inscritos por Canal';

        $vetFrm[] = Frame('<span>' . $titulo . '</span>', '', $class_frame_p, $class_titulo_p, $titulo_na_linha_p, $vetParametros);

        $vetParametros = Array(
            'codigo_pai' => 'resumo_canal',
            'width' => '100%',
        );

        $vetCampoLC = Array();
        $vetCampoLC['canal_registro'] = CriaVetTabela('Canal');
        $vetCampoLC['qtd'] = CriaVetTabela('Quantidade');

        $sql = '';
        $sql .= ' select a.canal_registro, count(a.idt) as qtd';
        $sql .= ' from grc_atendimento a';
        $sql .= ' left outer join grc_evento_participante ep on ep.idt_atendimento = a.idt';
        $sql .= ' where a.idt_evento = $vlID';
        $sql .= whereEventoParticipante();
        $sql .= ' group by a.canal_registro';
        $sql .= ' order by a.canal_registro';

        $vetParametrosLC = Array(
            'comcontrole' => '0',
        );

        $vetCampo['tab_reumo_canal'] = objListarConf('tab_reumo_canal', 'grc_atpe_idt', $vetCampoLC, $sql, $titulo, false, $vetParametrosLC);

        $vetFrm[] = Frame('', Array(
            Array($vetCampo['tab_reumo_canal']),
                ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);
    }
}

// Participantes da Fila de Espera
if ($origem_evento_tela != 'compra' && $idt_evento_pai == '') {
    $filaOK = true;

    if ($idt_instrumento == 2 || $idt_instrumento == 52 || $idt_instrumento == 54) {
        $filaOK = false;
    }

    if ($idt_evento_situacao >= 14 && $veio == 'GC' && $filaOK) {
        $vetParametros = Array(
            'codigo_frm' => 'participante_filaespera',
            'controle_fecha' => 'A',
        );

        $titulo = 'Fila de Espera';

        $vetFrm[] = Frame('<span>' . $titulo . '</span>', '', $class_frame_p, $class_titulo_p, $titulo_na_linha_p, $vetParametros);

        $vetCampoLC = Array();
        $vetCampoLC['grc_at_protocolo'] = CriaVetTabela('Protocolo');
        $vetCampoLC['pessoa'] = CriaVetTabela('Nome do Cliente / CPF');
        $vetCampoLC['empreendimento'] = CriaVetTabela('Nome do Empreendimento / CNPJ');
        $vetCampoLC['gec_mid_descricao'] = CriaVetTabela('Mídia');
        $vetCampoLC['grc_atpe_evento_cortesia'] = CriaVetTabela('Cortesia?', 'descDominio', $vetSimNao);
        $vetCampoLC['fe_situacao'] = CriaVetTabela('Situação', 'func_trata_dado', ftd_grc_evento_participante_filaespera);

        if ($origem_evento_tela != 'grc_evento_acompanhar' && acesso('grc_evento_participante_filaespera', "'PER'", false)) {
            $vetCampoLC['habilitado'] = CriaVetTabela('Habilitado?', 'func_trata_dado', ftd_grc_evento_participante_filaespera);
        }

        $TabelaPrinc = "grc_atendimento";
        $AliasPric = "grc_at";
        $Entidade = $titulo;
        $Entidade_p = $titulo;
        $CampoPricPai = "idt_evento";

        $sql = "select {$AliasPric}.*, ";
        $sql .= "       grc_at.protocolo      as grc_at_protocolo, ";
        $sql .= "       grc_atpe.idt          as grc_atpe_idt, ";
        $sql .= "       concat_ws('<br />', grc_atpe.nome, grc_atpe.cpf) as pessoa,";
        $sql .= "       concat_ws('<br />', grc_ator.razao_social, grc_ator.cnpj) as empreendimento,";
        $sql .= "       grc_atpe.siacweb_hist_erro_cod, ";
        $sql .= "       grc_atpe.siacweb_hist_erro_msg, ";
        $sql .= "       grc_atpe.evento_cortesia as grc_atpe_evento_cortesia, ";
        $sql .= "       grc_atpe.evento_alt_siacweb as grc_atpe_evento_alt_siacweb, ";
        $sql .= "       grc_atpe.evento_exc_siacweb as grc_atpe_evento_exc_siacweb, ";
        $sql .= "       grc_atpe.evento_inscrito as grc_atpe_evento_inscrito, ";
        $sql .= "       null as habilitado, ";
        $sql .= "       grc_evpa.fe_situacao, ";
        $sql .= "       grc_evpa.fe_dt_validade, ";
        $sql .= "       grc_evpa.contrato as grc_evpa_contrato, ";
        $sql .= "       grc_evpa.vl_tot_pagamento as grc_evpa_vl_tot_pagamento, ";
        $sql .= "       gec_mid.descricao     as gec_mid_descricao ";
        $sql .= " from {$TabelaPrinc} {$AliasPric}  ";
        $sql .= " left  join grc_atendimento_pessoa            grc_atpe on grc_atpe.idt_atendimento = {$AliasPric}.idt ";
        $sql .= " left  join grc_atendimento_organizacao       grc_ator on grc_ator.idt_atendimento = {$AliasPric}.idt ";
        $sql .= " left  join grc_evento_participante           grc_evpa on grc_evpa.idt_atendimento = {$AliasPric}.idt ";
        $sql .= " left  join " . db_pir_gec . "gec_meio_informacao gec_mid  on gec_mid.idt = grc_evpa.idt_midia ";
        $sql .= " where {$AliasPric}" . '.idt_evento = $vlID';
        $sql .= "   and grc_evpa.contrato = 'FE'";
        $sql .= " order by {$AliasPric}.protocolo, grc_atpe.tipo_relacao";

        $vetParametrosLC = Array(
            'acao_alt_con_p' => 'S',
        );

        $vetCampo['grc_evento_participante_filaespera'] = objListarConf('grc_evento_participante_filaespera', 'grc_atpe_idt', $vetCampoLC, $sql, $titulo, false, $vetParametrosLC);

        $vetParametros = Array(
            'codigo_pai' => 'participante_filaespera',
            'width' => '100%',
        );
        $vetFrm[] = Frame('', Array(
            Array($vetCampo['grc_evento_participante_filaespera']),
                ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);
    }
}

////////////////////////////publicacao
if ($origem_evento_tela != 'compra' && $origem_evento_tela != 'combo' && $veio != 'SG' && $idt_evento_pai == '') {
    $vetParametros = Array(
        'codigo_frm' => 'publicacao_despublicacao',
        'controle_fecha' => 'A',
    );

    parametrosTitulo($vetParametros);

    $titulo = 'Política de Desconto';

    $vetFrm[] = Frame('<span>' . $titulo . '</span>', '', $class_frame_p, $class_titulo_p, $titulo_na_linha_p, $vetParametros);

    $vetCampoLC = Array();
    $vetCampoLC['data_publicacao_de'] = CriaVetTabela('Data de Inicio', 'data');
    $vetCampoLC['data_publicacao_ate'] = CriaVetTabela('Data de Termino', 'data');
    $vetCampoLC['descricao'] = CriaVetTabela('Título');
    $vetCampoLC['observacao'] = CriaVetTabela('Observações');
    $vetCampoLC['plu_u_nome_completo'] = CriaVetTabela('Responsável');
    $vetCampoLC['data_responsavel'] = CriaVetTabela('Data Cadastro', 'data');
    $vetCampoLC['situacao'] = CriaVetTabela('Situação', 'descDominio', $vetEventoPubSituacao);
    $vetCampoLC['ativo'] = CriaVetTabela('Ativo', 'descDominio', $vetSimNao);

    $TabelaPrinc = "grc_evento_publicacao";
    $AliasPric = "grc_ep";
    $Entidade = $titulo;
    $Entidade_p = $titulo;
    $CampoPricPai = "idt_evento";

    $sql = "select {$AliasPric}.*, ";
    $sql .= " plu_u.nome_completo as  plu_u_nome_completo";
    $sql .= " from {$TabelaPrinc} {$AliasPric}  ";
    $sql .= "   inner join plu_usuario plu_u on plu_u.id_usuario = {$AliasPric}" . '.idt_responsavel';
    $sql .= " where {$AliasPric}" . '.idt_evento = $vlID';
    $sql .= " order by {$AliasPric}.ativo desc, {$AliasPric}.data_responsavel desc ";

    if ($idt_evento_situacao == 1 || $idt_evento_situacao == 5 || $idt_evento_situacao == 8 || $idt_evento_situacao == 9 || $idt_evento_situacao == 14 || $idt_evento_situacao == 16 || $idt_evento_situacao == 19 || $idt_evento_situacao == 24) {
        $vetParametrosLC = Array(
            'acao_alt_con_p' => 'S',
            'func_trata_row' => trata_row_grc_evento_publicacao,
            'barra_icone' => true,
        );
    } else {
        $vetParametrosLC = Array();
    }

    $vetCampo['grc_evento_publicacao'] = objListarConf('grc_evento_publicacao', 'idt', $vetCampoLC, $sql, $titulo, false, $vetParametrosLC);

    $vetParametros = Array(
        'codigo_pai' => 'publicacao_despublicacao',
        'width' => '100%',
    );


    $vetFrm[] = Frame('', Array(
        Array($vetCampo['peca_padrao'], $vetCampo['peca_exibe_padrao'], '', '', $vetCampo['idt_peca'], $vetCampo['peca_exibe_uain'], '', '', $vetCampo['idt_peca_evento'], $vetCampo['peca_gestor'], ''),
            ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);

    $vetFrm[] = Frame('', Array(
        Array($vetCampo['grc_evento_publicacao']),
            ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);
}

/////////////// NOVA avaliação Estrelinha
// Essa Aba esta neutralizada porém pode vir a ser utilizada para registrar avaliações pelo CRM - em 10-11-2017 não esta no escopo
if ($origem_evento_tela != 'compra' && $idt_evento_pai == '' && $idt_evento_pai == -300) {
    $vetParametros = Array(
        'codigo_frm' => 'avaliacao_estrelinha',
        'controle_fecha' => 'A',
    );

    $titulo = 'Avaliação do Evento - Estrelinha';

    $vetFrm[] = Frame('<span>' . $titulo . '</span>', '', $class_frame_p, $class_titulo_p, $titulo_na_linha_p, $vetParametros);

    $vetCampoLC = Array();
    $vetCampoLC['codigo'] = CriaVetTabela('Código');
    $vetCampoLC['plu_u_nome_completo'] = CriaVetTabela('Cliente');
    $vetCampoLC['data_registro'] = CriaVetTabela('Data Registro', 'data');
    $vetCampoLC['grc_fr_codigo'] = CriaVetTabela('Avaliação');

    $TabelaPrinc = "grc_avaliacao";
    $AliasPric = "grc_a";
    $Entidade = $titulo;
    $Entidade_p = $titulo;
    $CampoPricPai = "idt_evento";

    $sql = "select {$AliasPric}.*, ";
    $sql .= " grc_fr.codigo as grc_fr_codigo, ";
    $sql .= " plu_u.nome_completo as  plu_u_nome_completo";
    $sql .= " from {$TabelaPrinc} {$AliasPric}  ";
    $sql .= "   inner join grc_avaliacao_resposta grc_ar on grc_ar.idt_avaliacao = {$AliasPric}" . ".idt";
    $sql .= "   inner join grc_formulario_resposta grc_fr on grc_fr.idt = grc_ar.idt_resposta";
    $sql .= "   inner join plu_usuario plu_u on plu_u.id_usuario = {$AliasPric}.idt_avaliador ";

    $sql .= "   inner join grc_formulario grc_f on grc_f.idt = {$AliasPric}.idt_formulario ";

    $sql .= " where {$AliasPric}" . '.idt_evento = $vlID';
    //$sql .= " and {$AliasPric}" . '.idt_formulario = 14';

    $sqlt .= " and grc_f.codigo = '700' ";


    $sql .= " order by {$AliasPric}.codigo  ";

    if ($idt_evento_situacao == 1 || $idt_evento_situacao == 5 || $idt_evento_situacao == 8 || $idt_evento_situacao == 9 || $idt_evento_situacao == 14 || $idt_evento_situacao == 16 || $idt_evento_situacao == 19 || $idt_evento_situacao == 24) {
        $vetParametrosLC = Array(
            'acao_alt_con_p' => 'S',
            'func_trata_row' => trata_row_grc_evento_avaliacao_estrelinha,
            'barra_icone' => true,
        );
    } else {
        $vetParametrosLC = Array();
    }

    $vetCampo['grc_avaliacao_resposta'] = objListarConf('grc_avaliacao_resposta', 'idt', $vetCampoLC, $sql, $titulo, false, $vetParametrosLC);

    $vetParametros = Array(
        'codigo_pai' => 'avaliacao_estrelinha',
        'width' => '100%',
    );
    $vetFrm[] = Frame('', Array(
        Array($vetCampo['grc_avaliacao_resposta']),
            ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);
}






//Prestação de Contas
if ($origem_evento_tela == '' && $idt_evento_situacao == 19 && $idt_instrumento == 2 && $tipo_sincroniza_siacweb == 'P' && ($cred_necessita_credenciado == 'N' || $nao_sincroniza_rm == 'S')) {
    $vetParametros = Array(
        'codigo_frm' => 'prestacao_contas',
        'controle_fecha' => 'A',
    );

    $vetFrm[] = Frame('<span>Prestação de Contas</span>', '', $class_frame_p, $class_titulo_p, $titulo_na_linha_p, $vetParametros);

    $vetCampoLC = Array();
    $vetCampoLC['protocolo'] = CriaVetTabela('Protocolo');
    $vetCampoLC['pessoa'] = CriaVetTabela('Nome do Cliente / CPF');
    $vetCampoLC['empreendimento'] = CriaVetTabela('Nome do Empreendimento / CNPJ');
    $vetCampoLC['atividade'] = CriaVetTabela('Atividade');
    $vetCampoLC['atv_dtfim'] = CriaVetTabela('Data Finalização da Atividade', 'data');
    $vetCampoLC['consolidado_cred'] = CriaVetTabela('Aprovada', 'descDominio', $vetSimNao);

    $titulo = 'Atividades do Evento';

    $sql = '';
    $sql .= ' select ea.idt, ea.atividade, ea.consolidado_cred, a.protocolo,';
    $sql .= ' max(ag.dt_fim) as atv_dtfim,';
    $sql .= " concat_ws('<br />', p.nome, p.cpf) as pessoa,";
    $sql .= " concat_ws('<br />', o.razao_social, o.cnpj) as empreendimento";
    $sql .= ' from ' . db_pir_grc . 'grc_evento_atividade ea';
    $sql .= ' inner join ' . db_pir_grc . 'grc_evento_agenda ag on ag.idt_evento_atividade = ea.idt';
    $sql .= " inner join " . db_pir_grc . "grc_atendimento a on a.idt = ea.idt_atendimento";
    $sql .= " inner join " . db_pir_grc . "grc_atendimento_pessoa p on p.tipo_relacao = 'L' and p.idt_atendimento = ea.idt_atendimento";
    $sql .= " left outer join " . db_pir_grc . "grc_atendimento_organizacao o on o.idt_atendimento = ea.idt_atendimento";
    $sql .= " left outer join " . db_pir_grc . "grc_evento_participante ep on ep.idt_atendimento = ea.idt_atendimento";
    $sql .= ' where a.idt_evento = ' . null($idt_evento);
    $sql .= whereEventoParticipante();
    $sql .= ' group by ea.idt, ea.atividade, ea.consolidado_cred, a.protocolo, pessoa, empreendimento';
    $sql .= ' order by a.protocolo';

    $vetPadrao = Array(
        'menu_acesso' => 'grc_evento_agenda',
        'acao_alt_con_p' => 'S',
        'barra_inc_ap' => false,
        'barra_alt_ap' => true,
        'barra_con_ap' => true,
        'barra_exc_ap' => false,
    );

    $vetCampo['grc_evento_atividade_valida'] = objListarConf('grc_evento_atividade_valida', 'idt', $vetCampoLC, $sql, $titulo, false, $vetPadrao);

    $vetParametros = Array(
        'codigo_pai' => 'prestacao_contas',
        'width' => '100%',
    );

    $vetFrm[] = Frame('', Array(
        Array($vetCampo['grc_evento_atividade_valida']),
            ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);
}

//Informações do Envio
if ($origem_evento_tela == 'compra') {
    $vetParametros = Array(
        'codigo_frm' => 'informacao_envio',
        'controle_fecha' => 'A',
    );

    $vetFrm[] = Frame('<span>Informações do Envio</span>', '', $class_frame_p, $class_titulo_p, $titulo_na_linha_p, $vetParametros);

    $vetParametros = Array(
        'codigo_pai' => 'informacao_envio',
        'align' => 'left',
    );

    $vetCampo['envio_sts_entrega'] = objCmbVetor('envio_sts_entrega', 'Status da Entrega', true, $vetEventoStsEntrega);
    $vetCampo['envio_opcao'] = objCmbVetor('envio_opcao', 'Opção do Envio', false, $vetEventoEnvioOpcao);
    $vetCampo['envio_num_rastreio'] = objTexto('envio_num_rastreio', 'Número do Rastreio', false, 40);
    $vetCampo['envio_resp_retirada'] = objTexto('envio_resp_retirada', 'Responsável pela Retirada', false, 67, 200);
    $vetCampo['envio_obs'] = objTextArea('envio_obs', 'Observação', false, 2000);

    //Logica dos campos
    $par = 'envio_opcao';
    $vetDesativa['envio_sts_entrega'][0] = vetDesativa($par, '');
    $vetAtivadoObr['envio_sts_entrega'][0] = vetAtivadoObr($par, 'EN,RE');

    $par = 'envio_num_rastreio';
    $vetDesativa['envio_opcao'][0] = vetDesativa($par, ',RL');
    $vetAtivadoObr['envio_opcao'][0] = vetAtivadoObr($par, 'SE,MA');

    $par = 'envio_resp_retirada';
    $vetDesativa['envio_opcao'][1] = vetDesativa($par, ',SE,MA');
    $vetAtivadoObr['envio_opcao'][1] = vetAtivadoObr($par, 'RL');

    MesclarCol($vetCampo['envio_obs'], 7);

    $vetFrm[] = Frame('', Array(
        Array($vetCampo['envio_sts_entrega'], '', $vetCampo['envio_opcao'], '', $vetCampo['envio_num_rastreio'], '', $vetCampo['envio_resp_retirada']),
        Array($vetCampo['envio_obs']),
            ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);
}

$sql = '';
$sql .= ' select idt_pfo_af_processo, idt_usuario';
$sql .= ' from grc_atendimento_pendencia';
$sql .= ' where idt = ' . null($_GET['idt_pendencia']);
$sql .= ' and idt_responsavel_solucao = ' . null($_SESSION[CS]['g_id_usuario']);
$sql .= " and ativo = 'S'";
$sql .= " and tipo = 'Pagamento a Credenciado'";
$sql .= whereAtendimentoPendencia();
$rst = execsql($sql);
$idt_pfo_af_processo = $rst->data[0]['idt_pfo_af_processo'];

if ($idt_pfo_af_processo != '') {
    $pfo_idt_usuario = IdUsuarioPIR($rst->data[0]['idt_usuario'], db_pir_grc, db_pir_pfo);

    $sql = '';
    $sql .= ' select afp.cnpjcpf, afp.nomefantasia, afp.sebraebacpf, afp.sebraebanome, afp.valorbruto, afp.protocolo, afp.data_registro, ord_rm.mesano,';
    $sql .= ' p.descricao as projeto, a.descricao as acao, afp.obs_validacao, afp.situacao_reg, afp.autorizar_nf_sem_doc, afp.valida_nf_sem_doc';
    $sql .= ' from ' . db_pir_pfo . 'pfo_af_processo afp';
    $sql .= ' inner join grc_evento e on e.idt = afp.idt_evento';
    $sql .= ' inner join grc_projeto p on p.idt = e.idt_projeto';
    $sql .= ' inner join grc_projeto_acao a on a.idt = e.idt_acao';
    $sql .= ' inner join ' . db_pir_gec . "gec_contratacao_credenciado_ordem_rm ord_rm on ord_rm.rm_idmov = afp.idmov";
    $sql .= ' where afp.idt = ' . null($idt_pfo_af_processo);
    $rsPFO = execsql($sql);
    $rowPFO = $rsPFO->data[0];

    $vetParametros = Array(
        'codigo_frm' => 'pfo',
        'controle_fecha' => false,
    );

    $vetFrm[] = Frame('<span>Atestado em Processo de Pagamento</span>', '', $class_frame_p, $class_titulo_p, $titulo_na_linha_p, $vetParametros);

    $vetParametros = Array(
        'codigo_pai' => 'pfo',
        'width' => '100%',
    );

    if ($rowPFO['autorizar_nf_sem_doc'] == 'S') {
        $vetFrm[] = Frame(msgAutorizar_nf_sem_doc($rowPFO['valida_nf_sem_doc'], true), '', 'class_frame_msg', 'class_titulo_msg', false, $vetParametros);
    }

    $vetCampoPFO['pfo_cnpjcpf'] = objTextoFixo('pfo_cnpjcpf', 'CNPJ do Contratado', '', false, false, $rowPFO['cnpjcpf']);
    $vetCampoPFO['pfo_nomefantasia'] = objTextoFixo('pfo_nomefantasia', 'Nome Fantasia', '', false, false, $rowPFO['nomefantasia']);
    $vetCampoPFO['pfo_sebraebacpf'] = objTextoFixo('pfo_sebraebacpf', 'CPF do Contratado', '', false, false, $rowPFO['sebraebacpf']);
    $vetCampoPFO['pfo_sebraebanome'] = objTextoFixo('pfo_sebraebanome', 'Nome do Contratado', '', false, false, $rowPFO['sebraebanome']);

    $vetCampoPFO['pfo_valorbruto'] = objTextoFixo('pfo_valorbruto', 'Valor', '', false, false, format_decimal($rowPFO['valorbruto']));
    $vetCampoPFO['pfo_protocolo'] = objTextoFixo('pfo_protocolo', 'Compromentimento RM', '', false, false, $rowPFO['protocolo']);
    $vetCampoPFO['pfo_data_registro'] = objTextoFixo('pfo_data_registro', 'Data do Compromentimento', '', false, false, trata_data($rowPFO['data_registro'], false, true));
    $vetCampoPFO['pfo_idt_projeto'] = objTextoFixo('pfo_idt_projeto', 'Projeto', '', false, false, $rowPFO['projeto']);
    $vetCampoPFO['pfo_idt_acao'] = objTextoFixo('pfo_idt_acao', 'Ação', '', false, false, $rowPFO['acao']);

    $vetFrm[] = Frame('<span>Gestão de Credenciados</span>', Array(
        Array($vetCampoPFO['pfo_cnpjcpf'], '', $vetCampoPFO['pfo_nomefantasia'], '', $vetCampoPFO['pfo_sebraebacpf'], '', $vetCampoPFO['pfo_sebraebanome']),
            ), $class_frame, 'class_titulo_pfo', $titulo_na_linha, $vetParametros);

    $vetFrm[] = Frame('', Array(
        Array($vetCampoPFO['pfo_valorbruto'], '', $vetCampoPFO['pfo_protocolo'], '', $vetCampoPFO['pfo_data_registro'], '', $vetCampoPFO['pfo_idt_projeto'], '', $vetCampoPFO['pfo_idt_acao']),
            ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);

    $vetDocN1 = Array();
    $vetDocN2 = Array();

    $sql = '';
    $sql .= ' select distinct a.protocolo, o.razao_social, o.cnpj, ee.idt, ee.codigo, ee.descricao';
    $sql .= ' from ' . db_pir_pfo . 'pfo_af_processo_item afpi';
    $sql .= ' left outer join ' . db_pir_grc . 'grc_evento_entrega_documento ed on ed.idt = afpi.idt_evento_entrega_documento';
    $sql .= ' left outer join ' . db_pir_grc . 'grc_evento_entrega ee on ee.idt = ed.idt_evento_entrega';
    $sql .= ' left outer join ' . db_pir_grc . 'grc_atendimento a on a.idt = ee.idt_atendimento';
    $sql .= ' left outer join ' . db_pir_grc . 'grc_atendimento_organizacao o on o.idt_atendimento = ee.idt_atendimento';
    $sql .= ' where afpi.idt_processo = ' . null($idt_pfo_af_processo);
    $sql .= ' and afpi.idt_atendimento is null';
    $sql .= ' order by a.protocolo, o.razao_social, o.cnpj, ee.codigo, ee.descricao';
    $rsDoc = execsql($sql);

    foreach ($rsDoc->data as $rowDoc) {
        $vetDocN1[$rowDoc['protocolo']] = Array(
            'protocolo' => $rowDoc['protocolo'],
            'razao_social' => $rowDoc['razao_social'],
            'cnpj' => $rowDoc['cnpj'],
        );

        $vetDocN2[$rowDoc['protocolo']][$rowDoc['idt']] = Array(
            'idt' => $rowDoc['idt'],
            'codigo' => $rowDoc['codigo'],
            'descricao' => $rowDoc['descricao'],
        );
    }

    $idxN1 = 0;

    foreach ($vetDocN1 as $rowDocN1) {
        $idxN1++;
        $idxN2 = 0;

        if ($rowDocN1['protocolo'] == '') {
            $lbl = 'DOCUMENTOS DO PROCESSO';
        } else {
            $lbl = '[' . $rowDocN1['protocolo'] . '] ' . $rowDocN1['cnpj'] . ' - ' . $rowDocN1['razao_social'];
        }

        $vetParametros = Array(
            'codigo_frm' => 'pfo_documentos_' . $idxN1,
            'controle_fecha' => 'A',
        );
        $vetFrm[] = Frame('<span>' . $lbl . '</span>', '', $class_frame_p, $class_titulo_p, $titulo_na_linha_p, $vetParametros);

        $vetParametros = Array(
            'codigo_pai' => 'pfo_documentos_' . $idxN1,
            'width' => '100%',
        );

        foreach ($vetDocN2[$rowDocN1['protocolo']] as $rowDocN2) {
            $idxN2++;

            $campo_listarConf = 'pfo_af_processo_item_' . $idxN1 . $idxN2;

            if ($rowDocN2['idt'] == '') {
                $titulo = 'Documentos do Processo';
                $titFrame = '';
            } else {
                $titulo = 'Documentos da Entraga: ' . $rowDocN2['codigo'] . ' - ' . $rowDocN2['descricao'];
                $titFrame = '<span>' . $titulo . '</span>';
            }

            $vetCampoLC = Array();
            $vetCampoLC['arquivo'] = CriaVetTabela('Arquivo', 'func_trata_dado', fnc_grc_evento_pfo_af_processo_item);
            $vetCampoLC['gec_d_descricao'] = CriaVetTabela('Documento');
            $vetCampoLC['data_registro'] = CriaVetTabela('Data Registro', 'data');
            $vetCampoLC['data_vencimento'] = CriaVetTabela('Validade', 'data');
            $vetCampoLC['doc_obr'] = CriaVetTabela('Obrigatório?', 'descDominio', $vetSimNao);
            $vetCampoLC['situacao'] = CriaVetTabela('Situacão', 'func_trata_dado', fnc_grc_evento_pfo_af_processo_item);
            $vetCampoLC['dt_validacao'] = CriaVetTabela('Data Validação', 'data');
            $vetCampoLC['nome_completo'] = CriaVetTabela('Validador');

            $TabelaPrinc = "pfo_af_processo_item";
            $AliasPric = "pfo_afpi";
            $Entidade = "Documento do Processo";
            $Entidade_p = "Documentos do Processo";
            $CampoPricPai = "idt_processo";

            $orderby = "gec_d.descricao ";

            $sql = "select {$AliasPric}.*, ";
            $sql .= ' u.nome_completo,';
            $sql .= ' gec_d.tipo_documento,';
            $sql .= ' gec_d.obrigatorio as doc_obr,';
            $sql .= " gec_d.descricao as gec_d_descricao";
            $sql .= " from " . db_pir_pfo . "{$TabelaPrinc} {$AliasPric}  ";
            $sql .= " inner join " . db_pir_gec . "gec_documento gec_d on  gec_d.idt = {$AliasPric}.idt_documento ";
            $sql .= " left outer join " . db_pir_pfo . "plu_usuario u on  u.id_usuario = {$AliasPric}.idt_validador ";
            $sql .= ' left outer join ' . db_pir_grc . 'grc_evento_entrega_documento ed on ed.idt = ' . $AliasPric . '.idt_evento_entrega_documento';
            $sql .= " where {$AliasPric}" . '.idt_processo = ' . null($idt_pfo_af_processo);
            $sql .= " and {$AliasPric}.idt_atendimento is null";

            if ($rowDocN2['idt'] == '') {
                $sql .= ' and ' . $AliasPric . '.idt_evento_entrega_documento is null';
            } else {
                $sql .= ' and ed.idt_evento_entrega = ' . null($rowDocN2['idt']);
            }

            if ($rowPFO['autorizar_nf_sem_doc'] == 'S' && $rowPFO['valida_nf_sem_doc'] == 'N') {
                if ($rowPFO['situacao_reg'] == 'ED') {
                    $sql .= " and gec_d.tipo_documento in ('SD', 'NF')";
                } else {
                    $sql .= " and gec_d.tipo_documento = 'SD'";
                }
            } else if ($rowPFO['situacao_reg'] != 'ED') {
                $sql .= " and (gec_d.tipo_documento is null or gec_d.tipo_documento <> 'NF')";
            }

            $sql .= " order by {$orderby}";

            $vetPadrao = Array(
                'menu_acesso' => 'pfo_af_processo_item',
                'barra_inc_ap' => false,
                'barra_alt_ap' => true,
                'barra_con_ap' => true,
                'barra_exc_ap' => false,
            );

            $vetCampoPFO[$campo_listarConf] = objListarConf($campo_listarConf, 'idt', $vetCampoLC, $sql, $titulo, true, $vetPadrao, 'pfo_af_processo_item');

            $vetFrm[] = Frame($titFrame, Array(
                Array($vetCampoPFO[$campo_listarConf]),
                    ), $class_frame . ' pfo_af_processo_item_frm', 'class_titulo_pfo', $titulo_na_linha, $vetParametros);
        }
    }

    //Declaração de Entregas
    $sql = "select distinct gec_d.idt, gec_d.descricao ";
    $sql .= " from " . db_pir_pfo . "pfo_af_processo_item pfo_afpi  ";
    $sql .= " inner join " . db_pir_gec . "gec_documento gec_d on  gec_d.idt = pfo_afpi.idt_documento ";
    $sql .= ' where pfo_afpi.idt_processo = ' . null($idt_pfo_af_processo);
    $sql .= ' and pfo_afpi.idt_atendimento is not null';
    $sql .= " and gec_d.tipo_documento = 'DS'";
    $sql .= ' order by gec_d.descricao';
    $rsDS = execsql($sql);

    if ($rsDS->rows > 0) {
        $vetParametros = Array(
            'codigo_frm' => 'documentos_ds',
            'controle_fecha' => 'A',
        );
        $vetFrm[] = Frame('<span>DECLARAÇÃO DE ENTREGA DO SERVIÇO</span>', '', $class_frame_p, $class_titulo_p, $titulo_na_linha_p, $vetParametros);

        $vetParametros = Array(
            'codigo_pai' => 'documentos_ds',
            'width' => '100%',
        );

        foreach ($rsDS->data as $rowDS) {
            $campo_listarConf = 'pfo_af_processo_item_ds_' . $rowDS['idt'];
            $titulo = $rowDS['descricao'];
            $titFrame = '<span>' . $titulo . '</span>';

            $vetCampoLC = Array();
            $vetCampoLC['arquivo'] = CriaVetTabela('Arquivo', 'func_trata_dado', fnc_grc_evento_pfo_af_processo_item);
            $vetCampoLC['protocolo'] = CriaVetTabela('Matricula');
            $vetCampoLC['empresa'] = CriaVetTabela('Cliente');
            $vetCampoLC['data_registro'] = CriaVetTabela('Data Registro', 'data');
            $vetCampoLC['data_vencimento'] = CriaVetTabela('Validade', 'data');
            $vetCampoLC['doc_obr'] = CriaVetTabela('Obrigatório?', 'descDominio', $vetSimNao);
            $vetCampoLC['situacao'] = CriaVetTabela('Situacão', 'func_trata_dado', fnc_grc_evento_pfo_af_processo_item);
            $vetCampoLC['dt_validacao'] = CriaVetTabela('Data Validação', 'data');
            $vetCampoLC['nome_completo'] = CriaVetTabela('Validador');

            $sql = "select pfo_afpi.*, a.protocolo, concat_ws('<br />', o.cnpj, o.razao_social) as empresa,";
            $sql .= " gec_d.obrigatorio as doc_obr,";
            $sql .= " gec_d.codigo as doc_codigo,";
            $sql .= " plu_usu.nome_completo";
            $sql .= " from " . db_pir_pfo . "pfo_af_processo_item pfo_afpi  ";
            $sql .= " inner join " . db_pir_gec . "gec_documento gec_d on  gec_d.idt = pfo_afpi.idt_documento ";
            $sql .= ' inner join ' . db_pir_grc . 'grc_atendimento a on a.idt = pfo_afpi.idt_atendimento';
            $sql .= ' inner join ' . db_pir_grc . 'grc_atendimento_organizacao o on o.idt_atendimento = pfo_afpi.idt_atendimento';
            $sql .= " left outer join " . db_pir_pfo . "plu_usuario plu_usu on plu_usu.id_usuario = pfo_afpi.idt_validador ";
            $sql .= ' where pfo_afpi.idt_processo = ' . null($idt_pfo_af_processo);
            $sql .= ' and pfo_afpi.idt_atendimento is not null';
            $sql .= ' and pfo_afpi.idt_documento = ' . null($rowDS['idt']);
            $sql .= " order by a.protocolo, o.razao_social, o.cnpj";

            $vetPadrao = Array(
                'menu_acesso' => 'pfo_af_processo_item',
                'barra_inc_ap' => false,
                'barra_alt_ap' => true,
                'barra_con_ap' => true,
                'barra_exc_ap' => false,
                'func_botao_per' => fnc_grc_evento_pfo_af_processo_item_ds_per,
            );

            $vetCampoPFO[$campo_listarConf] = objListarConf($campo_listarConf, 'idt', $vetCampoLC, $sql, $titulo, true, $vetPadrao, 'pfo_af_processo_item');

            $vetFrm[] = Frame($titFrame, Array(
                Array($vetCampoPFO[$campo_listarConf]),
                    ), $class_frame . ' pfo_af_processo_item_frm', $class_titulo, $titulo_na_linha, $vetParametros);
        }
    }

    if ($veio != 'SG' && $vetConf['evento_upload_os'] == 'Sim') {
        $arq_ordem_servico_msg = '';
        $arq_ordem_servico_msg .= '<div style="color:red;">';
        $arq_ordem_servico_msg .= 'Prezado ' . $_SESSION[CS]['g_nome_completo'] . ', é necessário assinar a Ordem de Serviço (OS) anexada acima pela empresa credenciada, para que o processo possa seguir para pagamento.';
        $arq_ordem_servico_msg .= '</div>';
        $arq_ordem_servico_msg .= 'Após assinatura, clique no botão abaixo para carregar a O.S. no sistema.';
        $vetCampoPFO['arq_ordem_servico'] = objFile('arq_ordem_servico', 'Ordem de Serviço (OS)', true, 120, 'todos');

        $vetFrm[] = Frame('', Array(
            Array($vetCampoPFO['arq_ordem_servico']),
                ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);
    }

    $vetCampoPFO['pfo_obs_validacao'] = objTextArea('pfo_obs_validacao', 'Observação', false, 5000, '', '', false, $rowPFO['obs_validacao']);
    $vetCampoPFO['idt_pfo_af_processo'] = objHidden('idt_pfo_af_processo', $idt_pfo_af_processo, '', '', false);
    $vetCampoPFO['pfo_idt_usuario'] = objHidden('pfo_idt_usuario', $pfo_idt_usuario, '', '', false);
    $vetCampoPFO['pfo_mesano'] = objHidden('pfo_mesano', $rowPFO['mesano'], '', '', false);

    $vetFrm[] = Frame('', Array(
        Array($vetCampoPFO['pfo_obs_validacao']),
        Array($vetCampoPFO['idt_pfo_af_processo']),
        Array($vetCampoPFO['pfo_idt_usuario']),
        Array($vetCampoPFO['pfo_mesano']),
            ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);
}

$vetParametros = Array(
    'width' => '100%',
);

if ($idt_evento_situacao == 2 || $idt_evento_situacao == 3 || $idt_evento_situacao == 5 || $idt_evento_situacao == 6 || $idt_evento_situacao == 7) {
    $vetFrm[] = Frame('', Array(
        Array($vetCampo_f['parecer']),
            ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);
} else if ($idt_evento_situacao == 8 && $parecer != '') {
    $vetCampo_f['parecer'] = objTextoFixo('parecer', 'Parecer (Limitado a 1000 caracteres)', '', true);

    $vetFrm[] = Frame('', Array(
        Array($vetCampo_f['parecer']),
            ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);
}

if ($origem_evento_tela == 'grc_evento_nf') {
    $vetParametros = Array(
        'codigo_frm' => 'parteRM',
        'controle_fecha' => 'A',
    );
    $vetFrm[] = Frame('<span>Autorizar entrada da Nota Fiscal sem Documentação</span>', '', $class_frame_p, $class_titulo_p, $titulo_na_linha_p, $vetParametros);

    $vetCampoLC = Array();
    $vetCampoLC['mesano'] = CriaVetTabela('Parcela');
    $vetCampoLC['datasaida'] = CriaVetTabela('Data', 'data');
    $vetCampoLC['valor_prev'] = CriaVetTabela('Valor Prev. (R$)', 'decimal');
    $vetCampoLC['valor_real'] = CriaVetTabela('Valor Real (R$)', 'decimal');
    $vetCampoLC['autorizar_nf_sem_doc'] = CriaVetTabela('Autorizado', 'func_trata_dado', fnc_grc_evento_rm);

    $titulo = 'RM da Ordem de Contratação';

    $sql = '';
    $sql .= ' select rm.*';
    $sql .= ' from ' . db_pir_gec . 'gec_contratacao_credenciado_ordem_rm rm';
    $sql .= ' inner join ' . db_pir_gec . 'gec_contratacao_credenciado_ordem o on o.idt = rm.idt_gec_contratacao_credenciado_ordem';
    $sql .= ' where o.idt_evento = $vlID';
    $sql .= " and o.ativo = 'S'";
    $sql .= " and rm.rm_cancelado = 'N'";
    $sql .= ' order by rm.datasaida';

    $vetParametrosLC = Array(
        'comcontrole' => '0',
    );

    $vetCampo['gec_contratacao_credenciado_ordem_rm'] = objListarConf('gec_contratacao_credenciado_ordem_rm', 'idt', $vetCampoLC, $sql, $titulo, false, $vetParametrosLC);

    $vetParametros = Array(
        'codigo_pai' => 'parteRM',
        'width' => '100%',
    );

    $vetFrm[] = Frame('', Array(
        Array($vetCampo['gec_contratacao_credenciado_ordem_rm']),
            ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);
} else {
    if ($acaoOrg == 'exc') {
        if ($origem_evento_tela != 'combo') {
            $sql = 'select idt, descricao from grc_evento_motivo_cancelamento';
            $sql .= " where ativo = 'S'";
            $sql .= ' order by descricao';
            $vetCampo_f['idt_evento_motivo_cancelamento'] = objCmbBanco('idt_evento_motivo_cancelamento', 'Motivo da Rescisão', true, $sql);

            $vetCampo_f['motivo_cancelamento'] = objTextArea('motivo_cancelamento', 'Motivo do Cancelamento (Limitado a 1000 caracteres)', true, 1000);

            $vetFrm[] = Frame('', Array(
                Array($vetCampo_f['idt_evento_motivo_cancelamento']),
                Array($vetCampo_f['motivo_cancelamento']),
                    ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);
        }
    } else if ($idt_evento_situacao == 23) {
        $vetCampo_f['idt_evento_motivo_cancelamento'] = objFixoBanco('idt_evento_motivo_cancelamento', 'Motivo da Rescisão', 'grc_evento_motivo_cancelamento', 'idt', 'descricao');
        $vetCampo_f['motivo_cancelamento'] = objTextArea('motivo_cancelamento', 'Motivo do Cancelamento (Limitado a 1000 caracteres)', false, 1000);
        $vetCampo_f['parecer_cancelamento'] = objTextArea('parecer_cancelamento', 'Parecer do Cancelamento (Limitado a 1000 caracteres)', false, 1000);

        $vetFrm[] = Frame('', Array(
            Array($vetCampo_f['idt_evento_motivo_cancelamento']),
            Array($vetCampo_f['motivo_cancelamento']),
            Array($vetCampo_f['parecer_cancelamento']),
                ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);
    } else if ($login_gestor_evento == 'S' && ($idt_evento_motivo_cancelamento != '' || $motivo_cancelamento != '' || $parecer_cancelamento != '')) {
        $vetCampo_f['idt_evento_motivo_cancelamento'] = objFixoBanco('idt_evento_motivo_cancelamento', 'Motivo da Rescisão', 'grc_evento_motivo_cancelamento', 'idt', 'descricao');
        $vetCampo_f['motivo_cancelamento'] = objTextoFixo('motivo_cancelamento', 'Motivo do Cancelamento (Limitado a 1000 caracteres)', '', false, false, $motivo_cancelamento);
        $vetCampo_f['parecer_cancelamento'] = objTextoFixo('parecer_cancelamento', 'Parecer do Cancelamento (Limitado a 1000 caracteres)', '', false, false, $parecer_cancelamento);

        $vetFrm[] = Frame('', Array(
            Array($vetCampo_f['idt_evento_motivo_cancelamento']),
            Array($vetCampo_f['motivo_cancelamento']),
            Array($vetCampo_f['parecer_cancelamento']),
                ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);
    }

    if ($idt_evento_situacao == 19 && $idt_instrumento == 2 && $idt_pfo_af_processo == '') {
        $vetCampo_f['resultados_obtidos'] = objTextArea('resultados_obtidos', 'Resultados Obtidos (Limitado a 1000 caracteres)', true, 1000);

        $vetFrm[] = Frame('', Array(
            Array($vetCampo_f['resultados_obtidos']),
                ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);
    }

    if ($origem_evento_tela == '') {
        if ($idt_evento_situacao == 19 && $idt_instrumento != 2) {
            $sql = '';
            $sql .= ' select evento_muda_dt_real_ini_hist';
            $sql .= ' from plu_usuario';
            $sql .= ' where id_usuario = ' . null($_SESSION[CS]['g_id_usuario']);
            $rsx = execsql($sql);

            if ($rsx->data[0][0] == 'S') {
                $vetCampo['dt_prev_ini'] = objTextoFixo('dt_prev_ini', 'Data de Início do Evento', 12, false, false, trata_data($dt_previsao_inicial . ' ' . $hora_inicio));
                $vetCampo['dt_prev_fim'] = objTextoFixo('dt_prev_fim', 'Data de Fim do Evento', 12, false, false, trata_data($dt_previsao_fim . ' ' . $hora_fim));

                $vetCampo['dt_real_ini'] = objDataHora('dt_real_ini', 'Data de Realização do Início do Evento', false);
                $vetCampo['dt_real_fim'] = objDataHora('dt_real_fim', 'Data de Realização do Final do Evento', false);

                $vetCampo['muda_dt_hist'] = objCmbVetor('muda_dt_hist', 'Mudar as datas de Realização do Evento?', True, $vetSimNao);

                $par = 'dt_real_ini,dt_real_fim';
                $vetDesativa['muda_dt_hist'][0] = vetDesativa($par);
                $vetAtivadoObr['muda_dt_hist'][0] = vetAtivadoObr($par);

                $vetFrm[] = Frame('<span>Data que vai ser utilizada para integração com o SiacWEB (Histórico - Meta)</span>', Array(
                    Array('', '', $vetCampo['dt_prev_ini'], '', $vetCampo['dt_prev_fim']),
                    Array($vetCampo['muda_dt_hist'], '', $vetCampo['dt_real_ini'], '', $vetCampo['dt_real_fim']),
                        ), $class_frame_p, $class_titulo_p, $titulo_na_linha);
            }
        }

        if (($idt_evento_situacao == 19 || $idt_evento_situacao == 20) && ($_SESSION[CS]['g_id_usuario'] == 1 || $_SESSION[CS]['g_id_usuario'] == 90 || $_SESSION[CS]['g_id_usuario'] == 111)) {
            $vetCampo['sincroniza_loja'] = objCmbVetor('sincroniza_loja', 'Sincronizar com o SiacWEB?', True, $vetSimNao);

            $vetFrm[] = Frame('', Array(
                Array($vetCampo['sincroniza_loja']),
                    ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);
        }
    }
}

$vetFrm[] = Frame('', Array(
    Array($vetCampo_f['botao_concluir_evento']),
        ), $class_frame, $class_titulo, $titulo_na_linha, $vetParametros);

$vetCad[] = $vetFrm;

$sql = '';
$sql .= ' select u.nome_completo';
$sql .= ' from grc_atendimento_pendencia ap';
$sql .= ' inner join plu_usuario u  on u.id_usuario = ap.idt_usuario_update';
$sql .= ' where ap.idt_evento = ' . null($idt_evento);
$sql .= ' and ap.idt_evento_situacao_para = ' . null($idt_evento_situacao);
$sql .= ' order by ap.dt_update desc limit 1';
$rs = execsql($sql);
$divProtocolo = $rs->data[0][0];

if ($divProtocolo != '') {
    $divProtocolo = ' por ' . $divProtocolo;
}

$sql = '';
$sql .= ' select distinct u.nome_completo';
$sql .= ' from grc_atendimento_pendencia ap';
$sql .= ' inner join plu_usuario u on u.id_usuario = ap.idt_responsavel_solucao';
$sql .= ' where ap.idt_evento = ' . null($idt_evento);
$sql .= ' and ap.idt_evento_situacao_de = ' . null($idt_evento_situacao);
$sql .= " and ap.ativo = 'S'";
$sql .= ' order by u.nome_completo';
$rs = execsql($sql);

$divPendencia = '';
$vetPendencia = Array();

foreach ($rs->data as $rowPEN) {
    $vetPendencia[] = $rowPEN['nome_completo'];
}

if (count($vetPendencia) > 0) {
    $divPendencia = 'Aguardando interação dos colaboradores ' . implode(', ', $vetPendencia) . '!';
}
?>
<script type="text/javascript">
    if ('<?php echo $_POST['btnAcao']; ?>' == '') {
        var veio = '<?php echo $veio; ?>';
        var sgtec_modelo = '<?php echo $sgtec_modelo; ?>';
        var idt_evento_situacao = '<?php echo $idt_evento_situacao; ?>';
        var idt_evento = '<?php echo $idt_evento; ?>';
        var idt_instrumento = '<?php echo $idt_instrumento; ?>';
        var origem_evento_tela = '<?php echo $origem_evento_tela; ?>';
        var idt_pfo_af_processo = '<?php echo $idt_pfo_af_processo; ?>';
        var composto = '<?php echo $composto; ?>';
        var idt_evento_pai = '<?php echo $idt_evento_pai; ?>';
        var tipo_calculo = '<?php echo $rowp['tipo_calculo']; ?>';
        var situacao_submit = '';

        acao = '<?php echo $acao; ?>';
        //valida_nao_visivel = '<?php echo $idt_evento_pai == '' ? 'S' : 'N'; ?>';

        $(document).ready(function () {
            if ($('#arq_ordem_servico_desc').length > 0) {
                $('#arq_ordem_servico_desc span.desc_per').html('<?php echo $arq_ordem_servico_msg; ?>');
            }

            if (origem_evento_tela == 'compra') {
                $('#observacao_obj').attr('rowspan', 4);

                if (acao == 'alt') {
                    setTimeout(function () {
                        $('#envio_sts_entrega, #envio_obs').removeProp("disabled").removeClass("campo_disabled");
                        $('#envio_sts_entrega').change();
                        $('#envio_opcao').change();
                    }, 500);

                    setTimeout(function () {
                        $('#envio_sts_entrega, #envio_obs').removeProp("disabled").removeClass("campo_disabled");
                        $('#envio_sts_entrega').change();
                        $('#envio_opcao').change();
                    }, 2000);
                }
            } else {
                if (acao == 'alt') {
                    setTimeout(function () {
                        $('#muda_dt_hist').removeProp("disabled").removeClass("campo_disabled");
                    }, 500);

                    setTimeout(function () {
                        $('#muda_dt_hist').removeProp("disabled").removeClass("campo_disabled");
                    }, 2000);

                    if ($('#muda_dt_hist').val() == 'S') {
                        setTimeout(function () {
                            $('#dt_real_ini, #dt_real_fim').removeProp("disabled").removeClass("campo_disabled");
                        }, 500);

                        setTimeout(function () {
                            $('#dt_real_ini, #dt_real_fim').removeProp("disabled").removeClass("campo_disabled");
                        }, 2000);
                    }
                }
            }

            //$('#avaliacao_estrelinha_desc').css('width', '13%');

            var divPendencia = '<?php echo $divPendencia; ?>';

            if (divPendencia != '') {
                divPendencia = $('<div id="divPendencia">' + divPendencia + '</div>');
                $('#idt_instrumento_obj').append(divPendencia);
                $('#idt_instrumento_obj').css('height', '44px');
            }

            var divProtocolo = $('<div id="divProtocolo">Status: ' + $('#idt_evento_situacao option:selected').text() + '<?php echo $divProtocolo; ?></div>');
            $('#idt_instrumento_obj').append(divProtocolo);
            $('#idt_instrumento_tf').text($('#idt_instrumento_tf').text() + ' - <?php echo $codigo_evento; ?>');

            $("#idt_ponto_atendimento_tela").cascade("#idt_unidade", {
                ajax: {
                    url: ajax_sistema + '?tipo=pa_unidade&cas=' + conteudo_abrir_sistema
                }
            });

            $("#idt_gestor_evento").cascade("#idt_unidade", {
                ajax: {
                    url: ajax_sistema + '?tipo=usuario_pa&todos=n&cas=' + conteudo_abrir_sistema
                }
            });

            $('#idt_ponto_atendimento_tela').bind('cascade', function (event, chain) {
                travaPontoAtendimento();
            });

            $('#idt_ponto_atendimento_tela').change(function () {
                var roda = false;

                if ($('#idt_ponto_atendimento_tela').find('option').length == 1) {
                    roda = true;
                } else if ($('#idt_unidade').val() != '') {
                    roda = true;
                }

                if (roda && $('#idt_cidade').val() == '') {
                    processando();

                    $.ajax({
                        dataType: 'json',
                        type: 'POST',
                        url: ajax_sistema + '?tipo=grc_evento_unidade_cidade',
                        data: {
                            cas: conteudo_abrir_sistema,
                            idt_unidade: $('#idt_unidade').val(),
                            idt_ponto_atendimento_tela: $('#idt_ponto_atendimento_tela').val()
                        },
                        success: function (response) {
                            if (response.erro == '') {
                                $('#idt_cidade').val(url_decode(response.cod));

                                if ($('#idt_cidade_tf').length > 0) {
                                    $('#idt_cidade_tf').html(url_decode(response.desc));
                                }
                            } else {
                                alert(url_decode(response.erro));
                            }
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                            alert('Erro no ajax no: ' + textStatus + ' - ' + errorThrown);
                        },
                        async: false
                    });

                    $('#dialog-processando').remove();
                }
            });

            $('#idt_gestor_evento').bind('cascade', function (event, chain) {
                $(this).removeProp("disabled");
            });

            travaPontoAtendimento();

            $('#valor_inscricao').change(function () {
                var vl = str2float($(this).val());

                if (vl == 0) {
                    $('#gratuito').val('S');
                } else {
                    $('#gratuito').val('N');
                }
            });

            $('#valor_inscricao, #quantidade_participante').change(function () {
                if (idt_instrumento != 45 && idt_instrumento != 54) {
                    processando();

                    $.ajax({
                        dataType: 'json',
                        type: 'POST',
                        url: ajax_sistema + '?tipo=grc_evento_insumo_insc',
                        data: {
                            cas: conteudo_abrir_sistema,
                            idt_evento: idt_evento,
                            gratuito: $('#gratuito').val(),
                            quantidade: $('#quantidade_participante').val(),
                            custo_unitario_real: $('#valor_inscricao').val()
                        },
                        success: function (response) {
                            btFechaCTC($('#grc_evento_insumo').data('session_cod'));
                            btFechaCTC($('#grc_evento_receita').data('session_cod'), atualizaPrevisaoReceita);

                            if (response.erro != '') {
                                alert(url_decode(response.erro));
                            }
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                            alert('Erro no ajax no: ' + textStatus + ' - ' + errorThrown);
                        },
                        async: false
                    });

                    $('#dialog-processando').remove();
                }
            });

            $('#cred_cod_evento').change(function () {
                if ($('#cred_cod_evento').val() == '') {
                    $('#cred_idt_evento').val('');
                } else {
                    processando();

                    $.ajax({
                        dataType: 'json',
                        type: 'POST',
                        url: ajax_sistema + '?tipo=grc_evento_cred_cod_evento',
                        data: {
                            cas: conteudo_abrir_sistema,
                            idt_evento: idt_evento,
                            cred_cod_evento: $('#cred_cod_evento').val()
                        },
                        success: function (response) {
                            $('#cred_idt_evento').val(response.idt);

                            $('#dialog-processando').remove();

                            if (response.erro == '') {
                                if (response.idt == '' || response.idt == null) {
                                    alert('Código do Evento inválido!');
                                    $('#cred_cod_evento').val('');
                                    $('#cred_cod_evento').focus();
                                }
                            } else {
                                alert(url_decode(response.erro));
                            }
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                            $('#dialog-processando').remove();
                            alert('Erro no ajax no: ' + textStatus + ' - ' + errorThrown);
                        },
                        async: false
                    });

                    $('#dialog-processando').remove();
                }
            });

            $('#vl_metro').change(function () {
                processando();

                $.ajax({
                    dataType: 'json',
                    type: 'POST',
                    url: ajax_sistema + '?tipo=grc_evento_vl_metro',
                    data: {
                        cas: conteudo_abrir_sistema,
                        idt_evento: idt_evento,
                        vl_metro: $('#vl_metro').val()
                    },
                    success: function (response) {
                        btFechaCTC($('#grc_evento_stand').data('session_cod'));

                        if (response.erro != '') {
                            $('#dialog-processando').remove();
                            alert(url_decode(response.erro));
                        }
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        $('#dialog-processando').remove();
                        alert('Erro no ajax no: ' + textStatus + ' - ' + errorThrown);
                    },
                    async: false
                });

                $('#dialog-processando').remove();
            });

            $('#ano_competencia').change(function () {
                fncListarCmbMuda_idt_acao($('#idt_acao').val());
            });

            $('#participacao_sebrae').change(function () {
                fncListarCmbMuda_idt_acao($('#idt_acao').val());
            });

            $('#dt_previsao_inicial').change(function () {
                if ($('#dt_previsao_fim').val() == '') {
                    $('#dt_previsao_fim').val($(this).val());
                }
            });

            $('#dt_real_fim').change(function () {
                if (validaDataMaior(true, $(this), 'Término', $('#dt_real_ini'), 'Início') === false) {
                    $(this).focus();
                    return false;
                }
            });

            $('#dt_previsao_fim').change(function () {
                if (validaDataMaior(false, $(this), 'Término', $('#dt_previsao_inicial'), 'Início') === false) {
                    $(this).focus();
                    return false;
                }
            });

            $('#hora_fim').change(function () {
                if ($('#hora_inicio').val() == '') {
                    alert('Favor informar a Hora Início!');
                    $('#hora_inicio').focus();
                    return false;
                }

                var dt_ini = newDataHoraStr(true, $('#dtBancoObj').val() + ' ' + $('#hora_fim').val());
                var dt_fim = newDataHoraStr(true, $('#dtBancoObj').val() + ' ' + $('#hora_inicio').val());

                if (dt_fim - dt_ini > 0) {
                    alert('A Hora Fim não pode ser menor que a Hora Início!');
                    $(this).val('');
                    $(this).focus();
                    return false;
                }
            });

            $('#sincroniza_loja').change(function () {
                if ($(this).val() == '') {
                    alert('Favor informar a Sincronizar com o SiacWEB!');
                    $(this).focus();
                    return false;
                }

                processando();

                $.ajax({
                    dataType: 'json',
                    type: 'POST',
                    url: ajax_sistema + '?tipo=grc_evento_sincroniza_loja',
                    data: {
                        cas: conteudo_abrir_sistema,
                        idt_evento: idt_evento,
                        valor: $(this).val()
                    },
                    success: function (response) {
                        if (response.erro != '') {
                            $('#dialog-processando').remove();
                            alert(url_decode(response.erro));
                        }
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        $('#dialog-processando').remove();
                        alert('Erro no ajax no: ' + textStatus + ' - ' + errorThrown);
                    },
                    async: false
                });

                $('#dialog-processando').remove();
            });

            $('#nao_sincroniza_rm').change(function () {
                if ($(this).val() != '') {
                    $.ajax({
                        type: 'POST',
                        url: ajax_sistema + '?tipo=grc_evento_nao_sincroniza_rm',
                        data: {
                            cas: conteudo_abrir_sistema,
                            idt_evento: idt_evento,
                            valor: $(this).val()
                        },
                        async: true
                    });
                }
            });

            $('#combo_tipo').change(function () {
                if ($('#combo_tipo').val() == 'F') {
                    processando();

                    $.ajax({
                        dataType: 'json',
                        type: 'POST',
                        url: ajax_sistema + '?tipo=grc_evento_combo_tipo',
                        data: {
                            cas: conteudo_abrir_sistema,
                            idt: idt_evento
                        },
                        success: function (response) {
                            btFechaCTC($('#grc_evento_combo').data('session_cod'));
                            btFechaCTC($('#grc_evento_combo_instrumento').data('session_cod'));

                            if (response.erro != '') {
                                alert(url_decode(response.erro));
                            }
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                            alert('Erro no ajax no: ' + textStatus + ' - ' + errorThrown);
                        },
                        async: false
                    });

                    $('#dialog-processando').remove();
                }
            });

            $('input[name^="pa["').change(function () {
                var cmb = document.frm.idt_publico_alvo;
                var vl = $(this).attr('id').substr(2);

                if ($(this).prop('checked')) {
                    if ($('#idt_publico_alvo').find('option[value="' + vl + '"]').length == 0) {
                        var txt = $(this).parent().find('label').text().trim();
                        cmb.options[cmb.length] = new Option(txt, vl);
                    }
                } else {
                    $('#idt_publico_alvo').find('option[value="' + vl + '"]').remove();
                }
            });

            $('#descricao').change(function () {
                $('#descricao_copia_fix').html($(this).val());
            });

            $('#idt_evento_certificado_modelo').change(function () {
                if (confirm('Desejá copiar o modelo do certificado para o evento?')) {
                    processando();

                    $.ajax({
                        dataType: 'json',
                        type: 'POST',
                        url: ajax_sistema + '?tipo=evento_certificado_modelo',
                        data: {
                            cas: conteudo_abrir_sistema,
                            idt: $(this).val()
                        },
                        success: function (response) {
                            var campo = $('#mpdf_me, #mpdf_md, #mpdf_ms, #mpdf_mb, #mpdf_mh, #mpdf_mf, #mpdf_papel_orientacao');

                            campo.each(function () {
                                var id = $(this).attr('id');

                                $(this).val(url_decode(response[id]));
                                $('#' + id + '_fix').html(url_decode(response[id]));
                            });

                            $('#mpdf_papel_orientacao_tf').html(url_decode(response['mpdf_papel_orientacao_tf']));

                            //Para Visualização
                            $('#html_corpo').val(url_decode(response.html_corpo));
                            $('#html_header').val(url_decode(response.html_header));
                            $('#html_footer').val(url_decode(response.html_footer));

                            document.getElementById('html_corpo___Frame').contentWindow.location.reload(true);
                            document.getElementById('html_header___Frame').contentWindow.location.reload(true);
                            document.getElementById('html_footer___Frame').contentWindow.location.reload(true);

                            /*
                             //Para Edição
                             if (typeof (FCKeditorAPI) !== "undefined") {
                             oEditor = FCKeditorAPI.GetInstance('html_corpo');
                             
                             if (oEditor != undefined) {
                             oEditor.SetHTML(url_decode(response.html_corpo));
                             }
                             
                             oEditor = FCKeditorAPI.GetInstance('html_header');
                             
                             if (oEditor != undefined) {
                             oEditor.SetHTML(url_decode(response.html_header));
                             }
                             
                             oEditor = FCKeditorAPI.GetInstance('html_footer');
                             
                             if (oEditor != undefined) {
                             oEditor.SetHTML(url_decode(response.html_footer));
                             }
                             }
                             */

                            if (response.erro != '') {
                                $('#dialog-processando').remove();
                                alert(url_decode(response.erro));
                            }
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                            $('#dialog-processando').remove();
                            alert('Erro no ajax no: ' + textStatus + ' - ' + errorThrown);
                        },
                        async: false
                    });

                    $('#dialog-processando').remove();
                }

                $(this).val('');
            });

            $('#publico_ab_fe').change(function () {
                if ($(this).val() == 'F') {
                    $('fieldset.publico_ab_fe_frm').show();
                    $('fieldset.publico_ab_fe_frm').data('bt_controle_fecha_estado', 'A');
                    $('#grc_evento_publico_desc').addClass("Tit_Campo_Obr").removeClass("Tit_Campo");
                } else {
                    $('fieldset.publico_ab_fe_frm').hide();
                    $('fieldset.publico_ab_fe_frm').data('bt_controle_fecha_estado', 'F');
                    $('#grc_evento_publico_desc').addClass("Tit_Campo").removeClass("Tit_Campo_Obr");
                }
            }).change();

            $('#assento_marcado').change(function () {
                processando();

                if ($(this).val() == 'S') {
                    $('fieldset.assento_marcado_frm').show();
                    $('fieldset.assento_marcado_frm').data('bt_controle_fecha_estado', 'A');
                    $('#grc_evento_mapa_desc').addClass("Tit_Campo_Obr").removeClass("Tit_Campo");
                } else {
                    $('fieldset.assento_marcado_frm').hide();
                    $('fieldset.assento_marcado_frm').data('bt_controle_fecha_estado', 'F');
                    $('#grc_evento_mapa_desc').addClass("Tit_Campo").removeClass("Tit_Campo_Obr");
                }

                $.ajax({
                    dataType: 'json',
                    type: 'POST',
                    url: ajax_sistema + '?tipo=geraMapaAssento',
                    data: {
                        cas: conteudo_abrir_sistema,
                        idt: $('#id').val(),
                        assento_marcado: $('#assento_marcado').val()
                    },
                    success: function (response) {
                        btFechaCTC($('#grc_evento_mapa').data('session_cod'));

                        if (response.erro != '') {
                            $('#dialog-processando').remove();
                            alert(url_decode(response.erro));
                        }
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        alert('Erro no ajax no: ' + textStatus + ' - ' + errorThrown);
                    },
                    async: false
                });

                $('#dialog-processando').remove();

            }).change();

            $('#inc_cliente_prev').change(function () {
                if ($(this).val() == 'N') {
                    $('input[name^=inc_cliente_mes]').each(function () {
                        if ($(this).val() == '') {
                            $(this).val('0,00');
                        }
                    });
                }
            });

            mudaStyleCampos();

            if ('<?php echo $bloquear_descricao; ?>' == 'S' && origem_evento_tela != 'combo') {
                $('#descricao').prop("disabled", true).addClass("campo_disabled");
            }

            $("#carga_horaria_total").prop("disabled", true).addClass("campo_disabled");

            if (idt_evento_situacao == '2' || idt_evento_situacao == '3' || idt_evento_situacao == '6' || idt_evento_situacao == '7') {
                setTimeout(function () {
                    $('#parecer').removeProp("disabled").removeClass("campo_disabled");
                    $('#parecer_desc').addClass("Tit_Campo_Obr").removeClass("Tit_Campo");
                }, 100);
            } else {
                setTimeout(function () {
                    $('#parecer').prop("disabled", 'true').addClass("campo_disabled");
                    $('#parecer_desc').addClass("Tit_Campo").removeClass("Tit_Campo_Obr");
                }, 100);
            }

            if ('<?php echo $login_gestor_evento; ?>' == 'S' && acao == 'alt' && (idt_evento_situacao == '14' || idt_evento_situacao == '16' || idt_evento_situacao == '19')) {
                setTimeout(function () {
                    $('#qtd_vagas_adicional').removeProp("disabled").removeClass("campo_disabled");
                }, 100);
            }

            if (acao == 'exc' && idt_evento_situacao != '22') {
                setTimeout(function () {
                    $('#idt_evento_motivo_cancelamento, #motivo_cancelamento').removeProp("disabled").removeClass("campo_disabled");
                }, 100);
            }

            if (idt_evento_situacao == '23') {
                setTimeout(function () {
                    $('#parecer_cancelamento').removeProp("disabled").removeClass("campo_disabled");
                }, 100);
            }

            if (idt_evento_pai != '' && acao == 'alt' && idt_instrumento == 2 && idt_evento_situacao == '1') {
                if (tipo_calculo == 'E') {
                    setTimeout(function () {
                        $('#carga_horaria_total').removeProp("disabled").removeClass("campo_disabled");
                    }, 100);
                } else {
                    $('#quantidade_participante, #qtd_vagas_adicional').change(function () {
                        var tot = 0;

                        if ($('#quantidade_participante').val() != '') {
                            tot += str2float($('#quantidade_participante').val());
                        }

                        if ($('#qtd_vagas_adicional').val() != '') {
                            tot += str2float($('#qtd_vagas_adicional').val());
                        }

                        tot = tot * str2float($('#carga_horaria_total_ini').val());

                        $('#carga_horaria_total').val(float2str(tot));
                    });
                }
            }

            if (veio == 'SG') {
                setTimeout(function () {
                    $('#quantidade_participante, #valor_inscricao').prop("disabled", 'true').addClass("campo_disabled");
                    $('#quantidade_participante_desc, #valor_inscricao_desc').addClass("Tit_Campo").removeClass("Tit_Campo_Obr");
                }, 100);

                if ('<?php echo $alt_projeto; ?>' == 'S') {
                    setTimeout(function () {
                        var campo = $('#idt_projeto, #idt_acao, #idt_gestor_evento');
                        var obr = $('#idt_projeto_desc, #idt_acao_desc, #idt_gestor_evento_desc');

                        func_AtivaDesativa('s', ",n".split(","), campo, obr, "s".split(","), "S", "S");

                        if ($('#idt_unidade').val() == '' || $('#idt_unidade').val() == null) {
                            $('#idt_unidade').removeProp("disabled").removeClass("campo_disabled");
                        }

                        $('#idt_unidade').change();
                    }, 100);
                }
            } else {
                if ('<?php echo $adm_evento_qtd; ?>' == '90' && acao == 'alt' && idt_instrumento != 52 && idt_instrumento != 54 && (idt_evento_situacao == '14' || idt_evento_situacao == '16' || idt_evento_situacao == '19')) {
                    setTimeout(function () {
                        $('#quantidade_participante, #qtd_vagas_adicional, #carga_horaria_total').removeProp("disabled").removeClass("campo_disabled");
                    }, 100);
                }
            }

            setTimeout(function () {
                $('#sincroniza_loja').removeProp("disabled").removeClass("campo_disabled");
            }, 100);

            if (origem_evento_tela == 'grc_evento_nf') {
                $('#gec_contratacao_credenciado_ordem_rm_desc td[data-campo="autorizar_nf_sem_doc"] > :checkbox').click(function () {
                    var lbl = 'Não';

                    if ($(this).prop('checked')) {
                        lbl = 'Sim';
                    }

                    $(this).parent().find('label').html(lbl);
                });

                setTimeout(function () {
                    $('#gec_contratacao_credenciado_ordem_rm_desc td[data-campo="autorizar_nf_sem_doc"] > :checkbox[data-liberado="S"]').removeProp("disabled").removeClass("campo_disabled");
                }, 100);
            }

            if (origem_evento_tela != 'compra' && origem_evento_tela != 'grc_evento_nf' && '<?php echo $sincroniza_loja; ?>' == 'S') {
                processando('Favor aguardar. Sincronizando Inscrições do evento!');

                $.ajax({
                    type: 'POST',
                    url: ajax_sistema + '?tipo=conParticipanteEventoSiacWeb',
                    data: {
                        cas: conteudo_abrir_sistema,
                        idt: idt_evento
                    },
                    success: function (response) {
                        btFechaCTC($('#grc_evento_participante').data('session_cod'));

                        if (response != '') {
                            alert(url_decode(response));
                        }
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        alert('Erro no ajax no: ' + textStatus + ' - ' + errorThrown);
                    },
                    async: false
                });

                $('#dialog-processando').remove();
            }

            if (idt_evento_situacao == '19' && $(".cmb_evento_concluio").length > 0) {
                var chkTodo = '<br /><input type="checkbox" id="cmb_evento_concluio_tot"><label id="lbl_evento_concluio_tot" for="cmb_evento_concluio_tot" class="Tit_Campo">&nbsp;Todos</label>';

                $('td.td_cab_acao[data-campo="grc_atpe_evento_concluio"]').data("sorter", false).append(chkTodo);

                setTimeout(function () {
                    $('#cmb_evento_concluio_tot').click(function () {
                        $('.cmb_evento_concluio').prop('checked', $(this).prop('checked'));
                    });

                    $("#cmb_evento_concluio_tot, .cmb_evento_concluio").removeProp("disabled").removeClass("campo_disabled");
                }, 1000);
            }

            if (idt_evento_situacao == '20' && $(".cmb_evento_resp_pesq_certificado").length > 0) {
                var chkTodo = '<br /><input type="checkbox" id="cmb_evento_resp_pesq_certificado_tot"><label id="lbl_evento_resp_pesq_certificado_tot" for="cmb_evento_resp_pesq_certificado_tot" class="Tit_Campo">&nbsp;Todos</label>';

                $('td.td_cab_acao[data-campo="evento_resp_pesq_certificado"]').data("sorter", false).append(chkTodo);

                setTimeout(function () {
                    $('#cmb_evento_resp_pesq_certificado_tot').click(function () {
                        $('.cmb_evento_resp_pesq_certificado').prop('checked', $(this).prop('checked'));

                        var idt = $('.cmb_evento_resp_pesq_certificado').map(function () {
                            return this.value;
                        }).get();

                        var val = 'N';

                        if ($(this).prop('checked')) {
                            val = 'S';
                        }

                        if (val == 'S') {
                            $('.certificado_pdf').html('<span title="Imprimir Certificado"></span>');
                        } else {
                            $('.certificado_pdf > span').remove();
                        }

                        cmb_evento_resp_pesq_certificado_ajax(val, idt);
                    });

                    $("#cmb_evento_resp_pesq_certificado_tot, .cmb_evento_resp_pesq_certificado").removeProp("disabled").removeClass("campo_disabled");
                }, 1000);

                $('.cmb_evento_resp_pesq_certificado').click(function () {
                    var idt = $(this).val();
                    var val = 'N';

                    if ($(this).prop('checked')) {
                        val = 'S';
                    }

                    if (val == 'S') {
                        $(this).parent().find('.certificado_pdf').html('<span title="Imprimir Certificado"></span>');
                    } else {
                        $(this).parent().find('.certificado_pdf > span').remove();
                    }

                    cmb_evento_resp_pesq_certificado_ajax(val, idt);
                });
            }

            $('#grc_evento_participante_desc').on('click', '.certificado_pdf > span', function () {
                var idt = $(this).parent().data('idt');
                var url = 'conteudo_pdf.php?prefixo=cadastro&menu=grc_evento_certificado&print_tela=S&id=' + idt;
                listar_rel_pdf_url(url);
            });

            if ($("#grc_evento_participante_filaespera_desc").length > 0) {
                var chkTodo = '<center><div class="botao_fe" onclick="return habilitado_fe();"><div style="margin:8px;">Liberar Participante para Matrícula</div></div></center>';
                $('#grc_evento_participante_filaespera_desc').append(chkTodo);

                funcaoFechaCTCAjaxDep_grc_evento_participante_filaespera();

                setTimeout(function () {
                    $('#habilitado_fe_tot').click(function () {
                        $('.habilitado_fe').prop('checked', $(this).prop('checked'));
                    });

                    $("#habilitado_fe_tot, .habilitado_fe").removeProp("disabled").removeClass("campo_disabled");
                }, 1000);
            }

            if (idt_evento_situacao == '19' && idt_instrumento == 2) {
                setTimeout(function () {
                    $("#resultados_obtidos").removeProp("disabled").removeClass("campo_disabled");
                }, 1000);
            }

            //if (origem_evento_tela == 'grc_evento_acompanhar') {
            var chkTodo = '<center><div class="botao_lista_presenca" onclick="return acaoListaPresenca();"><div style="margin:8px;">Emitir Lista de Presença</div></div></center>';
            $('#grc_evento_participante_desc').prepend(chkTodo);
            //}

            if (idt_pfo_af_processo != '') {
                $('.pfo_af_processo_item_frm td[data-campo=situacao] > :checkbox').click(function () {
                    var lbl = 'Pendente';

                    if ($(this).prop('checked')) {
                        lbl = 'Conferido';
                    }

                    $(this).parent().find('label').html(lbl);
                });

                setTimeout(function () {
                    $('#arq_ordem_servico, #pfo_obs_validacao, .pfo_af_processo_item_frm td[data-campo=situacao] > input').removeProp("disabled").removeClass("campo_disabled");
                }, 100);
            }
        });

        function acaoListaPresenca() {
            var url = 'conteudo_cadastro.php?prefixo=cadastro&menu=grc_evento_acompanhar_lista&id=' + idt_evento;
            var titulo = 'Emitir Lista de Presença';
            showPopWin(url, titulo, $('div.showPopWin_width').width() - 10, $(window).height() - 100, null, false);
        }

        function habilitado_fe() {
            if ($('.habilitado_fe:checked').length == 0) {
                alert('Favor selecionar um registro para poder hablitar a inscrição!');
                return false;
            }

            if (confirm('Deseja hablitar as inscrições selecionadas?')) {
                processando();

                var idts = $('.habilitado_fe:checked').map(function () {
                    return this.value;
                }).get();

                $.ajax({
                    dataType: 'json',
                    type: 'POST',
                    url: ajax_sistema + '?tipo=grc_evento_habilitado_fe',
                    data: {
                        cas: conteudo_abrir_sistema,
                        idt_evento: idt_evento,
                        idts: idts
                    },
                    success: function (response) {
                        btFechaCTC($('#grc_evento_participante').data('session_cod'));
                        btFechaCTC($('#grc_evento_participante_filaespera').data('session_cod'));

                        if (response.erro != '') {
                            $('#dialog-processando').remove();
                            alert(url_decode(response.erro));
                        }
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        $('#dialog-processando').remove();
                        alert('Erro no ajax no: ' + textStatus + ' - ' + errorThrown);
                    },
                    async: false
                });

                $('#dialog-processando').remove();
            }
        }

        function parListarCmb_idt_projeto() {
            var par = '';

            par += '&veiocad=grc_evento';

            return par;
        }

        function fncListarCmbMuda_idt_projeto(idt_projeto) {
            processando();

            $('#idt_acao_bt_limpar').click();

            $.ajax({
                dataType: 'json',
                type: 'POST',
                url: ajax_sistema + '?tipo=projeto_dados',
                data: {
                    cas: conteudo_abrir_sistema,
                    idt_projeto: idt_projeto
                },
                success: function (response) {
                    $('#fase_acao_projeto').val(url_decode(response.etapa));
                    $('#fase_acao_projeto_fix').html(url_decode(response.etapa));

                    if (response.erro != '') {
                        alert(url_decode(response.erro));
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    alert('Erro no ajax no: ' + textStatus + ' - ' + errorThrown);
                },
                async: false
            });

            $('#dialog-processando').remove();
        }

        function parListarCmb_idt_acao() {
            var par = '';

            if ($('#idt_projeto').val() == '') {
                alert('Favor informar o Projeto!');
                return false;
            } else {
                par += '&idt_projeto=' + $('#idt_projeto').val();
            }

            return par;
        }

        function fncListarCmbMuda_idt_acao(idt_acao) {
            var campo = $('#gestor_sge, #idt_gestor_projeto, #idt_unidade, #qtd_previsto, #qtd_realizado, #qtd_percentual, #qtd_saldo, #orc_previsto, #orc_realizado, #orc_percentual, #orc_saldo, #contrapartida_sgtec');

            var participacao_sebrae = true;

            if (idt_instrumento == 45 || idt_instrumento == 41) {
                participacao_sebrae = $('#participacao_sebrae').val() != '';
            }

            if ($('#ano_competencia').val() != '' && participacao_sebrae && idt_acao != '') {
                processando();

                $.ajax({
                    dataType: 'json',
                    type: 'POST',
                    url: 'ajax_atendimento.php?tipo=acao_dados',
                    data: {
                        cas: conteudo_abrir_sistema,
                        idt_instrumento: idt_instrumento,
                        idt_evento: idt_evento,
                        ano_competencia: $('#ano_competencia').val(),
                        participacao_sebrae: $('#participacao_sebrae').val(),
                        idt_acao: idt_acao
                    },
                    success: function (response) {
                        campo.each(function () {
                            var id = $(this).attr('id');

                            $(this).val(url_decode(response[id]));
                            $('#' + id + '_fix').html(url_decode(response[id]));
                        });

                        if ($('#idt_unidade').val() == '' || $('#idt_unidade').val() == null) {
                            $('#idt_unidade').removeProp("disabled").removeClass("campo_disabled");
                        } else {
                            $('#idt_unidade').prop("disabled", true).addClass("campo_disabled");
                        }

                        $('#idt_unidade').change();

                        if (response.erro == '') {
                            if (veio == 'SG' && sgtec_modelo == 'E') {
                                //Reload da tela
                                onSubmitMsgTxt = false;
                                valida_cust = 'N';
                                situacao_submit = 'alt_programa';
                                $(':submit:first').click();
                            }
                        } else {
                            alert(url_decode(response.erro));
                        }
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        alert('Erro no ajax no: ' + textStatus + ' - ' + errorThrown);
                    },
                    async: false
                });

                $('#dialog-processando').remove();
            } else {
                campo.each(function () {
                    var id = $(this).attr('id');

                    $(this).val('');
                    $('#' + id + '_fix').html('');
                });
            }
        }

        function parListarCmb_idt_produto() {
            var par = '&idt_instrumento_prod_cmb=' + idt_instrumento;
            return par;
        }

        function fncListarCmbMuda_idt_produto(valorAtu, descAtu, valorAnt, descAnt) {
            processando();

            $.ajax({
                dataType: 'json',
                type: 'POST',
                url: ajax_sistema + '?tipo=TipoProgramaGECProdutos',
                data: {
                    cas: conteudo_abrir_sistema,
                    idt_produto_atu: valorAtu,
                    idt_produto_ant: valorAnt
                },
                success: function (response) {
                    if (response.erro == '') {
                        var ok = true;
                        var aviso = '';
                        var tipo_atu = response.tipo_atu;
                        var tipo_ant = response.tipo_ant;
                        var prod_composto_atu = response.prod_composto_atu;
                        var prod_composto_ant = response.prod_composto_ant;

                        if (tipo_atu == 'SG' && idt_instrumento != 2 && idt_instrumento != 50 && idt_instrumento != 40) {
                            ok = false;
                            alert('O produto selecionado é do Programa Credenciado SGTEC!\n\nO instrumento deste evento não aceita este tipo de produto!');
                        } else {
                            if (tipo_atu == 'SG' || tipo_ant == 'SG') {
                                if (tipo_atu != tipo_ant) {
                                    if (tipo_atu == 'SG' || tipo_ant != 'SG') {
                                        aviso += "Confirma a modificação do evento de SGC para SGTEC?\n";
                                    }

                                    if (tipo_atu != 'SG' || tipo_ant == 'SG') {
                                        aviso += "Confirma a modificação do evento de SGTEC para SGC?\n";
                                    }
                                }
                            }

                            if (prod_composto_atu == 'S' || prod_composto_ant == 'S') {
                                if (prod_composto_atu != prod_composto_ant) {
                                    if (prod_composto_atu == 'S' || prod_composto_ant != 'S') {
                                        aviso += "Confirma a modificação do evento para um Evento Composto?\n";
                                    }

                                    if (prod_composto_atu != 'S' || prod_composto_ant == 'S') {
                                        aviso += "Confirma a modificação do evento para um Evento Simples?\n";
                                    }
                                }
                            }
                        }

                        if (aviso != '') {
                            ok = confirm(aviso);
                        }

                        if (ok) {
                            $.ajax({
                                dataType: 'json',
                                type: 'POST',
                                url: 'ajax_atendimento.php?tipo=produto_dados',
                                data: {
                                    cas: conteudo_abrir_sistema,
                                    idt_instrumento: idt_instrumento,
                                    idt_evento: idt_evento,
                                    idt_produto: valorAtu
                                },
                                success: function (response) {
                                    html_resumo_evento_receita_despesa();
                                    btFechaCTC($('#grc_evento_insumo').data('session_cod'));

                                    var lstCampo = '';
                                    lstCampo += ' #idt_foco_tematico, #maturidade, #descricao, #carga_horaria_total, #carga_horaria_total_ini, #carga_horaria_total_fim,';
                                    lstCampo += ' #quantidade_participante, #frequencia_min, #qtd_minima_pagantes, #idt_publico_alvo, #valor_hora, #cred_necessita_credenciado,';
                                    lstCampo += ' #idt_programa, #entrega_prazo_max, #vl_determinado';
                                    var campo = $(lstCampo);

                                    campo.each(function () {
                                        var id = $(this).attr('id');

                                        $(this).val(url_decode(response[id]));
                                        $('#' + id + '_fix').html(url_decode(response[id]));
                                    });

                                    $('#idt_foco_tematico_tf').html(url_decode(response['idt_foco_tematico_tf']));
                                    $('#vl_determinado_tf').html(url_decode(response['vl_determinado_tf']));
                                    $('#quantidade_participante_desc > label').html(url_decode(response['quantidade_participante_lbl']));
                                    $('#carga_horaria_total_desc > label').html(url_decode(response['carga_horaria_total_lbl']));

                                    if (url_decode(response['bloquear_descricao']) == 'S') {
                                        $('#descricao').prop("disabled", true).addClass("campo_disabled");
                                    } else {
                                        $('#descricao').removeProp("disabled").removeClass("campo_disabled");
                                    }

                                    $('#descricao').change();
                                    $('#valor_inscricao').change();
                                    $('#cred_necessita_credenciado').change();

                                    if (typeof (FCKeditorAPI) !== "undefined") {
                                        oEditor = FCKeditorAPI.GetInstance('conteudo_programatico');

                                        if (oEditor != undefined) {
                                            oEditor.SetHTML(url_decode(response['conteudo_programatico']));
                                        }

                                        oEditor = FCKeditorAPI.GetInstance('descricao_comercial');

                                        if (oEditor != undefined) {
                                            oEditor.SetHTML(url_decode(response['descricao_comercial']));
                                        }
                                    }

                                    if (response.erro != '') {
                                        ok = false;
                                        alert(url_decode(response.erro));
                                    }
                                },
                                error: function (jqXHR, textStatus, errorThrown) {
                                    ok = false;
                                    alert('Erro no ajax no: ' + textStatus + ' - ' + errorThrown);
                                },
                                async: false
                            });

                            if (ok) {
                                //Reload da tela
                                onSubmitMsgTxt = false;
                                valida_cust = 'N';
                                situacao_submit = 'reload_tela';
                                $(':submit:first').click();
                            } else {
                                $('#idt_produto').val(valorAnt);
                                $('#idt_produto_obj > div').text(descAnt);
                            }
                        } else {
                            $('#idt_produto').val(valorAnt);
                            $('#idt_produto_obj > div').text(descAnt);
                        }
                    } else {
                        $('#dialog-processando').remove();
                        alert(url_decode(response.erro));
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    $('#dialog-processando').remove();
                    alert('Erro no ajax no: ' + textStatus + ' - ' + errorThrown);
                },
                async: false
            });

            $('#dialog-processando').remove();
        }

        function atualizaPrevisaoReceita() {
            processando();

            $.ajax({
                dataType: 'json',
                type: 'POST',
                url: ajax_sistema + '?tipo=grc_evento_atualizaPrevisaoReceita',
                data: {
                    cas: conteudo_abrir_sistema,
                    idt_evento: idt_evento
                },
                success: function (response) {
                    $('#previsao_receita').val(response.valor);

                    if (response.erro != '') {
                        alert(url_decode(response.erro));
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    alert('Erro no ajax no: ' + textStatus + ' - ' + errorThrown);
                },
                async: false
            });

            html_resumo_evento_receita_despesa();

            $('#dialog-processando').remove();
        }

        function parListarConf_grc_evento_agenda() {
            var par = '';

            par += '&idt_local=' + $('#idt_local').val();
            par += '&idt_cidade=' + $('#idt_cidade').val();
            par += '&valor_hora=' + $('#valor_hora').val();
            par += '&idt_instrumento=' + idt_instrumento;
            par += '&veio=' + veio;

            return par;
        }

        function parListarConf_grc_evento_mapa() {
            var par = '';

            par += '&idt_local=' + $('#idt_local').val();
            par += '&idt_cidade=' + $('#idt_cidade').val();

            return par;
        }

        function parListarConf_grc_evento_programacao() {
            var par = '';

            par += '&ini=' + $('#dt_previsao_inicial').val();
            par += '&fim=' + $('#dt_previsao_fim').val();

            return par;
        }

        function parListarConf_grc_evento_stand() {
            var par = '';

            par += '&vl_metro=' + $('#vl_metro').val();

            return par;
        }

        function parListarConf_grc_evento_participante() {
            var par = '';

            par += '&idt_instrumento=' + idt_instrumento;
            par += '&valor_inscricao=' + $('#valor_inscricao').val();
            par += '&veio=' + veio;
            par += '&idt_produto=' + $('#idt_produto').val();
            par += '&gratuito=' + $('#gratuito').val();

            return par;
        }

        function funcaoFechaCTCAjaxDep_grc_evento_participante() {
            btFechaCTC($('#tab_reumo_canal').data('session_cod'));
        }

        function funcaoFechaCTCAjaxDep_grc_evento_participante_filaespera() {
            var chkTodo = '<br /><input type="checkbox" id="habilitado_fe_tot"><label id="lbl_habilitado_fe_tot" for="habilitado_fe_tot" class="Tit_Campo">&nbsp;Todos</label>';
            $('td.td_cab_acao[data-campo="habilitado"]').data("sorter", false).append(chkTodo);
        }

        function parListarConf_grc_evento_participante_filaespera() {
            return parListarConf_grc_evento_participante();
        }

        function parListarConf_grc_evento_insumo(idCad, id, objCampo) {
            var par = '';

            var quantidade_participante = objCampo.data('quantidade_participante');

            if (quantidade_participante == '') {
                quantidade_participante = $('#quantidade_participante').val();
            }

            par += '&origem_evento_tela=' + origem_evento_tela;
            par += '&quantidade_participante=' + quantidade_participante;
            par += '&participante_minimo=' + objCampo.data('participante_minimo');
            par += '&participante_maximo=' + objCampo.data('participante_maximo');

            return par;
        }

        function funcaoFechaCTC_grc_evento_agenda(returnVal) {
            $('#grc_evento_agenda_erro').val(url_decode(returnVal.grc_evento_agenda_erro));

            $('#dt_previsao_inicial').val(url_decode(returnVal.dt_ini));
            $('#dt_previsao_fim').val(url_decode(returnVal.dt_fim));
            $('#hora_inicio').val(url_decode(returnVal.hr_ini));
            $('#hora_fim').val(url_decode(returnVal.hr_fim));

            $('#dt_previsao_inicial_fix').html(url_decode(returnVal.dt_ini));
            $('#dt_previsao_fim_fix').html(url_decode(returnVal.dt_fim));
            $('#hora_inicio_fix').html(url_decode(returnVal.hr_ini));
            $('#hora_fim_fix').html(url_decode(returnVal.hr_fim));

            if ($('#dt_prev_ini').length > 0) {
                var dt = url_decode(returnVal.dt_ini) + ' ' + url_decode(returnVal.hr_ini);
                $('#dt_prev_ini').val(dt);
                $('#dt_prev_ini_fix').html(dt);

                dt = url_decode(returnVal.dt_fim) + ' ' + url_decode(returnVal.hr_fim);
                $('#dt_prev_fim').val(dt);
                $('#dt_prev_fim_fix').html(dt);
            }

            if (idt_instrumento != 2) {
                if ($('#idt_cidade_tf').length > 0) {
                    $('#idt_cidade').val(url_decode(returnVal.idt_cidade));
                    $('#idt_cidade_tf').html(url_decode(returnVal.idt_cidade_tf));
                }
            }

            $('#idt_local').val(url_decode(returnVal.idt_local));
            $('#idt_local_tf').html(url_decode(returnVal.idt_local_tf));

            $('#carga_horaria_total').val(url_decode(returnVal.tot_hora_consultoria));

            $('#tot_hora_consultoria').val(url_decode(returnVal.tot_hora_consultoria));
            $('#tot_hora_consultoria_fix').html(url_decode(returnVal.tot_hora_consultoria));

            $('#custo_tot_consultoria').val(url_decode(returnVal.custo_tot_consultoria));
            $('#custo_tot_consultoria_fix').html(url_decode(returnVal.custo_tot_consultoria));

            $('#qtd_dias_reservados').val(url_decode(returnVal.qtd_dias_reservados));

            var campo = $('#cep, #logradouro, #logradouro_numero, #logradouro_complemento, #logradouro_bairro, #logradouro_municipio, #logradouro_estado, #logradouro_pais');

            campo.each(function () {
                var id = $(this).attr('id');

                $(this).val(url_decode(returnVal[id]));
                $('#' + id + '_fix').html(url_decode(returnVal[id]));
            });

            $('#assento_marcado').change();
            btFechaCTC($('#grc_evento_insumo').data('session_cod'));
            btFechaCTC($('#grc_evento_receita').data('session_cod'), atualizaPrevisaoReceita);
        }

        function funcaoFechaCTC_grc_evento_participante_combo() {
            processando();
            btFechaCTC($('#grc_evento_combo').data('session_cod'));
            $('#dialog-processando').remove();
        }

        function funcaoFechaCTC_grc_evento_participante() {
            processando();

            $('input[id ^= "grc_evento_insumo"][data-tipo="ListarConf"]').each(function () {
                btFechaCTC($(this).data('session_cod'));
            });

            btFechaCTC($('#grc_evento_receita').data('session_cod'), atualizaPrevisaoReceita);
            btFechaCTC($('#grc_evento_agenda').data('session_cod'));

            $.ajax({
                dataType: 'json',
                type: 'POST',
                url: ajax_sistema + '?tipo=grc_evento_dados',
                data: {
                    cas: conteudo_abrir_sistema,
                    idt_evento: idt_evento
                },
                success: function (r) {
                    $('#valor_inscricao').val(url_decode(r.valor_inscricao));
                    $('#quantidade_participante').val(url_decode(r.quantidade_participante));

                    if (idt_instrumento != 2) {
                        if ($('#idt_cidade_tf').length > 0) {
                            $('#idt_cidade').val(url_decode(r.idt_cidade));
                            $('#idt_cidade_tf').html(url_decode(r.idt_cidade_tf));
                        }
                    }

                    if (idt_instrumento == 52) {
                        $('#carga_horaria_total').val(url_decode(r.carga_horaria_total));

                        $('#dt_previsao_inicial').val(url_decode(r.dt_ini));
                        $('#dt_previsao_fim').val(url_decode(r.dt_fim));
                        $('#hora_inicio').val(url_decode(r.hr_ini));
                        $('#hora_fim').val(url_decode(r.hr_fim));

                        $('#dt_previsao_inicial_fix').html(url_decode(r.dt_ini));
                        $('#dt_previsao_fim_fix').html(url_decode(r.dt_fim));
                        $('#hora_inicio_fix').html(url_decode(r.hr_ini));
                        $('#hora_fim_fix').html(url_decode(r.hr_fim));
                    }

                    $('#idt_local').val(url_decode(r.idt_local));
                    $('#idt_local_tf').html(url_decode(r.idt_local_tf));

                    if (r.erro != '') {
                        $('#dialog-processando').remove();
                        alert(url_decode(r.erro));
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    $('#dialog-processando').remove();
                    alert('Erro no ajax no: ' + textStatus + ' - ' + errorThrown);
                },
                async: false
            });

            $('#dialog-processando').remove();
        }

        function parListarConf_grc_evento_combo() {
            var par = '';

            par += '&combo_tipo=' + $('#combo_tipo').val();

            return par;
        }

        function funcaoFechaCTC_grc_evento_combo(returnVal) {
            processando();

            $('#combo_vl_tot_evento').val(url_decode(returnVal.combo_vl_tot_evento));
            $('#combo_vl_tot_evento_fix').html(url_decode(returnVal.combo_vl_tot_evento));

            $('#combo_vl_tot_matricula').val(url_decode(returnVal.combo_vl_tot_matricula));
            $('#combo_vl_tot_matricula_fix').html(url_decode(returnVal.combo_vl_tot_matricula));

            $('#combo_percentual_desc').val(url_decode(returnVal.combo_percentual_desc));
            $('#combo_percentual_desc_fix').html(url_decode(returnVal.combo_percentual_desc));

            $('#combo_dt_min_ini').val(url_decode(returnVal.combo_dt_min_ini));

            btFechaCTC($('#grc_evento_combo_instrumento').data('session_cod'));
            btFechaCTC($('#grc_evento_combo_unidade').data('session_cod'));

            $('#dialog-processando').remove();
        }

        function grc_evento_dep() {
            var msg = '';

            if (origem_evento_tela != 'compra' && valida_cust != 'N') {
                if (veio != 'SG' && composto != 'S' && tipo_calculo != 'P') {
                    if (validaCargaHoraria() == false) {
                        return false;
                    }
                }

                if ($('#dt_previsao_inicial').val() != '' && $('#dt_previsao_inicial').val().substr(6) != $('#ano_competencia').val()) {
                    alert('A Data Início tem que estar no Ano de Competência!');
                    return false;
                }

                if ($('#data_publicacao_de').length > 0 && $('#data_publicacao_ate').length > 0) {
                    if ($('#data_publicacao_de').val() != '' && $('#data_publicacao_ate').val() != '') {
                    if ($('#dt_previsao_inicial').val() != '') {
                        if (validaDataMenorStr(false, $('#data_publicacao_ate'), 'Publicar Até', $('#dt_previsao_inicial').val(), 'Início do Evento') === false) {
                            return false;
                        }
                    }

                    var dt_ini = newDataHoraStr(false, $('#data_publicacao_de').val());
                    var dt_fim = newDataHoraStr(false, $('#data_publicacao_ate').val());

                    if (dt_fim - dt_ini < 0) {
                        alert('A Data Publicar Até não pode ser menor que a Data Publicar De!');
                        $('#data_publicacao_ate').val('');
                        $('#data_publicacao_ate').focus();
                        return false;
                    }

                    if ($('#data_hora_fim_inscricao_ec').val() != '') {
                        if (validaDataMaior(true, $('#data_hora_fim_inscricao_ec'), 'Data Fim inscrição loja Virtual', $('#data_publicacao_de'), 'Publicar De') === false) {
                            return false;
                        }

                        if (validaDataMenor(true, $('#data_hora_fim_inscricao_ec'), 'Data Fim inscrição loja Virtual', $('#data_publicacao_ate'), 'Publicar Até') === false) {
                            return false;
                        }
                    }
                }
                }

                if ($('#muda_dt_hist').val() == 'S') {
                    if (validaDataMaior(true, $('#dt_real_fim'), 'Término', $('#dt_real_ini'), 'Início') === false) {
                        $('#dt_real_fim').focus();
                        return false;
                    }
                }

                if ($('#grc_evento_agenda_erro').length > 0) {
                    if ($('#grc_evento_agenda_erro').val() != 0) {
                        alert('Favor verificar ' + $('#grc_evento_agenda_erro').val() + ' registros com erro de alocação na agenda!');
                        return false;
                    }
                }

                if (veio != 'SG') {
                    if ($('#quantidade_participante').val() != '' && $('#qtd_minima_pagantes').val() != '') {
                        if (parseInt($('#qtd_minima_pagantes').val()) > parseInt($('#quantidade_participante').val())) {
                            alert('A Qtde. Min. Pagantes tem que ser menor ou igual Qtde. Participantes!');
                            $('#qtd_minima_pagantes').focus();
                            return false;
                        }
                    }

                    $('#valor_inscricao').change();

                    if ($('#gratuito').val() == 'N' && composto != 'S' && origem_evento_tela != 'combo') { // && valida_nao_visivel == 'S'
                        var vl = str2float($('#valor_inscricao').val());

                        if (vl <= 0 || isNaN(vl)) {
                            alert('O Valor Inscrição tem que ser maior que zero!');
                            $('#valor_inscricao').focus();
                            return false;
                        }
                    }
                }

                if (idt_evento_pai != '' && $('#inc_cliente_prev').val() == 'N') {
                    var totMes = 0;

                    $('input[name^=inc_cliente_mes]').each(function () {
                        var vl = str2float($(this).val());

                        if (isNaN(vl)) {
                            vl = 0;
                        }

                        totMes += vl;
                    });

                    var vl = str2float($('#carga_horaria_total').val());

                    if (isNaN(vl)) {
                        vl = 0;
                    }

                    if (vl != totMes) {
                        alert('A distribuição das horas nos meses não esta certa!\nSoma das Horas nos meses: ' + float2str(totMes));
                        return false;
                    }
                }

                if (origem_evento_tela == 'combo') {
                    if ($('#grc_evento_combo_tot').val() < 2) {
                        alert('A quantidade de Eventos Associados tem que ser maior que um!');
                        return false;
                    }

                    if (validaDataMenor(false, $('#combo_dt_validade'), 'Validade do Combo', $('#combo_dt_min_ini'), 'Menor data de Início dos Eventos Associados') === false) {
                        return false;
                    }

                    var OK = true;
                    var totInst = 0;

                    $('#grc_evento_combo_instrumento_desc input.qtd_atual').each(function () {
                        if ($(this).val() == '' && OK) {
                            $(this).val('0');
                        }

                        if (OK) {
                            if ($(this).val() < $(this).data('min')) {
                                alert('Favor o valor deste campo tem que ser maior ou igual a ' + $(this).data('min') + '!');
                                $(this).focus();
                                OK = false;
                            }
                        }

                        if (OK) {
                            if ($(this).val() > $(this).data('max')) {
                                alert('Favor o valor deste campo tem que ser menor ou igual a ' + $(this).data('max') + '!');
                                $(this).focus();
                                OK = false;
                            }
                        }

                        if (OK) {
                            totInst += str2float($(this).val());
                        }
                    });

                    if (OK === false) {
                        return false;
                    }

                    if (totInst > $('#combo_qtd_evento_insc').val()) {
                        alert('A Qtde da distribuição por Instrumento esta maior que a Quantidade Total de Eventos do Combo!');
                        $('#combo_qtd_evento_insc').focus();
                        return false;
                    }

                    if (str2float($('#combo_qtd_evento_insc').val()) > str2float($('#grc_evento_combo_tot').val())) {
                        alert('A Quantidade Total de Eventos do Combo não pode se maior que a quantidade de Eventos Associados!');
                        $('#combo_qtd_evento_insc').focus();
                        return false;
                    }
                }

                processando();

                if ($('#grc_evento_programacao').length > 0) {
                    msg = '';

                    $.ajax({
                        dataType: 'json',
                        type: 'POST',
                        url: ajax_sistema + '?tipo=grc_evento_valida_programacao',
                        data: {
                            cas: conteudo_abrir_sistema,
                            ini: $('#dt_previsao_inicial').val(),
                            fim: $('#dt_previsao_fim').val(),
                            idt_evento: idt_evento
                        },
                        success: function (response) {
                            if (response.erro != '') {
                                msg += 'Favor verificar os registros de Programação que estão com as datas:\n\n';
                                msg += url_decode(response.erro);
                                msg += '\n\nEstes datas não estão no intervalo do evento!';
                            }
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                            $('#dialog-processando').remove();
                            alert('Erro no ajax no: ' + textStatus + ' - ' + errorThrown);
                        },
                        async: false
                    });

                    if (msg != '') {
                        $('#dialog-processando').remove();
                        alert(msg);
                        return false;
                    }
                }

                if ($('#grc_evento_stand').length > 0) {
                    msg = '';

                    $.ajax({
                        dataType: 'json',
                        type: 'POST',
                        url: ajax_sistema + '?tipo=grc_evento_valida_stand',
                        data: {
                            cas: conteudo_abrir_sistema,
                            idt_evento: idt_evento
                        },
                        success: function (response) {
                            if (response.erro != '') {
                                msg += 'Favor verificar os registros de Controle de Stand que estão com as Atividade Econômica:\n\n';
                                msg += url_decode(response.erro);
                                msg += '\n\nEstas Atividade Econômica não estão cadastrado no evento!';
                            }
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                            $('#dialog-processando').remove();
                            alert('Erro no ajax no: ' + textStatus + ' - ' + errorThrown);
                        },
                        async: false
                    });

                    if (msg != '') {
                        $('#dialog-processando').remove();
                        alert(msg);
                        return false;
                    }
                }

                msg = '';
                var erro = '';

                if (situacao_submit != '' && idt_instrumento == 2 && '<?php echo $tipo_sincroniza_siacweb_old[0]; ?>' == 'L') {
                    $.ajax({
                        dataType: 'json',
                        type: 'POST',
                        url: ajax_sistema + '?tipo=grc_evento_valida_legado',
                        data: {
                            cas: conteudo_abrir_sistema,
                            idt_evento: idt_evento
                        },
                        success: function (response) {
                            if (response.erro != '') {
                                erro += url_decode(response.erro);
                            }
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                            $('#dialog-processando').remove();
                            alert('Erro no ajax no: ' + textStatus + ' - ' + errorThrown);
                        },
                        async: false
                    });
                }

                if (erro != '') {
                    $('#dialog-processando').remove();
                    alert(erro);
                    return false;
                }

                if (situacao_submit != 5 && situacao_submit != 8 && situacao_submit != 20 && situacao_submit != 21) {
                    $.ajax({
                        dataType: 'json',
                        type: 'POST',
                        url: ajax_sistema + '?tipo=grc_evento_valida_geral',
                        data: {
                            cas: conteudo_abrir_sistema,
                            idt_evento: idt_evento,
                            situacao_submit: situacao_submit,
                            idt_produto: $('#idt_produto').val(),
                            cred_necessita_credenciado: $('#cred_necessita_credenciado').val(),
                            carga_horaria_total: $('#carga_horaria_total').val(),
                            dt_previsao_inicial: $('#dt_previsao_inicial').val(),
                            quantidade_participante: $('#quantidade_participante').val()
                        },
                        success: function (response) {
                            msg += url_decode(response.msg);

                            if (response.erro != '') {
                                erro += url_decode(response.erro);
                            }
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                            $('#dialog-processando').remove();
                            alert('Erro no ajax no: ' + textStatus + ' - ' + errorThrown);
                        },
                        async: false
                    });
                }

                if (erro != '') {
                    $('#dialog-processando').remove();
                    alert(erro);
                    return false;
                }

                if (situacao_submit == 20) {
                    $.ajax({
                        dataType: 'json',
                        type: 'POST',
                        url: ajax_sistema + '?tipo=grc_evento_valida_consolidacao',
                        data: {
                            cas: conteudo_abrir_sistema,
                            idt_evento: idt_evento
                        },
                        success: function (response) {
                            if (response.erro != '') {
                                erro += url_decode(response.erro);
                            }
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                            $('#dialog-processando').remove();
                            alert('Erro no ajax no: ' + textStatus + ' - ' + errorThrown);
                        },
                        async: false
                    });
                }

                if (erro != '') {
                    $('#dialog-processando').remove();
                    alert(erro);
                    return false;
                }

                if (composto == 'S') {
                    $.ajax({
                        dataType: 'json',
                        type: 'POST',
                        url: ajax_sistema + '?tipo=grc_evento_valida_composto',
                        data: {
                            cas: conteudo_abrir_sistema,
                            idt_evento: idt_evento
                        },
                        success: function (response) {
                            if (response.erro != '') {
                                erro += url_decode(response.erro);
                            }
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                            $('#dialog-processando').remove();
                            alert('Erro no ajax no: ' + textStatus + ' - ' + errorThrown);
                        },
                        async: false
                    });

                    if (erro != '') {
                        $('#dialog-processando').remove();
                        alert(erro);
                        return false;
                    }
                }

                $('#dialog-processando').remove();

                if (origem_evento_tela != 'combo') {
                    if ((idt_evento_situacao == 1 || idt_evento_situacao == 5) && !(veio == 'SG' && sgtec_modelo == 'E')) {
                        if ($('#cred_credenciado_sgc').val() == 'N') {
                            if (confirm('Será necessário abrir uma solicitação ECM para a contratação deste fornecedor. Deseja fazer isto agora?')) {
                                OpenWin('http://ecm.ba.sebrae.com.br:8080/webdesk', 'ECM', screen.width, screen.height, 0, 0, 'yes');
                            }
                        }
                    }
                }
            }

            $('#situacao').val(situacao_submit);

            if (msg == '') {
                return true;
            } else {
                onSubmitMsgTxt = false;
                return confirm(msg);
            }
        }

        function travaPontoAtendimento() {
            if (idt_evento_pai == '') {
                $('#idt_ponto_atendimento_tela').removeProp("disabled").removeClass("campo_disabled");
                $('#idt_ponto_atendimento_tela_desc').addClass("Tit_Campo_Obr").removeClass("Tit_Campo");

                if ($('#idt_ponto_atendimento_tela').find('option').length == 1) {
                    $('#idt_ponto_atendimento_tela').find('option:first').prop('selected', 'true');

                    $('#idt_ponto_atendimento_tela').prop("disabled", true).addClass("campo_disabled");
                    $('#idt_ponto_atendimento_tela_desc').addClass("Tit_Campo").removeClass("Tit_Campo_Obr");
                }
            }
        }

        function grc_evento_participante_fecha_ant(idt, filadeespera) {
            processando();

            $.ajax({
                dataType: 'json',
                type: 'POST',
                url: ajax_sistema + '?tipo=grc_evento_participante_fecha_ant',
                data: {
                    cas: conteudo_abrir_sistema,
                    idt_evento: idt_evento,
                    filadeespera: filadeespera,
                    idt: idt
                },
                success: function (response) {
                    if (response.erro == '') {
                    } else {
                        $("#dialog-processando").remove();
                        alert(url_decode(response.erro));
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    $("#dialog-processando").remove();
                    alert('Erro no ajax no: ' + textStatus + ' - ' + errorThrown);
                },
                async: false
            });

            $("#dialog-processando").remove();
        }

        function validaCargaHoraria() {
            if ($('#carga_horaria_total').length == 0) {
                return true;
            }

            var vl = str2float($('#carga_horaria_total').val());
            var ini = str2float($('#carga_horaria_total_ini').val());
            var fim = str2float($('#carga_horaria_total_fim').val());

            if (isNaN(vl)) {
                vl = 0;
            }

            if (isNaN(ini)) {
                ini = 0;
            }

            if (isNaN(fim)) {
                fim = 0;
            }

            if (ini == fim) {
                if (vl != ini) {
                    alert('A Carga Horária tem que ser ' + float2str(ini) + '!');
                    return false;
                }
            } else {
                if (vl < ini || vl > fim) {
                    alert('A Carga Horária tem que estar dentro da faixa de ' + float2str(ini) + ' a ' + float2str(fim) + '!');
                    return false;
                }
            }

            return true;
        }

        function html_resumo_evento_receita_despesa() {
            $.ajax({
                dataType: 'json',
                type: 'POST',
                url: ajax_sistema + '?tipo=html_resumo_evento_receita_despesa',
                data: {
                    cas: conteudo_abrir_sistema,
                    idt_evento: idt_evento
                },
                success: function (response) {
                    $('#resumo_evento_receita_despesa_desc').html(url_decode(response.html));

                    if (response.erro != '') {
                        alert(url_decode(response.erro));
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    alert('Erro no ajax no: ' + textStatus + ' - ' + errorThrown);
                },
                async: false
            });
        }

        function mudaStyleCampos() {
            objd = document.getElementById('idt_evento_situacao');
            if (objd != null)
            {
                $(objd).css('background', '#FFFF80');
                $(objd).attr('disabled', 'disabled');
            }

            objd = document.getElementById('gestor_sge_fix');
            if (objd != null)
            {
                $(objd).css('height', '15px');

                $(objd).css('background', '#FFFF80');
            }

            objd = document.getElementById('fase_acao_projeto_fix');
            if (objd != null)
            {
                $(objd).css('height', '15px');
                $(objd).css('background', '#FFFF80');
            }

            objd = document.getElementById('qtd_previsto');
            if (objd != null)
            {
                $(objd).css('height', '15px');
                $(objd).css('width', '128px');
            }
            objd = document.getElementById('qtd_previsto_obj');
            if (objd != null)
            {

                $(objd).css('height', '15px');
                $(objd).css('width', '128px');
            }
            objd = document.getElementById('qtd_previsto_fix');
            if (objd != null)
            {
                $(objd).css('height', '15px');
                $(objd).css('background', '#FFFF80');
                $(objd).css('width', '100%');
            }

            objd = document.getElementById('orc_previsto');
            if (objd != null)
            {
                $(objd).css('height', '15px');
                $(objd).css('width', '128px');
            }
            objd = document.getElementById('orc_previsto_obj');
            if (objd != null)
            {
                $(objd).css('height', '15px');
                $(objd).css('width', '128px');
            }
            objd = document.getElementById('orc_previsto_fix');
            if (objd != null)
            {
                $(objd).css('height', '15px');
                $(objd).css('background', '#FFFF80');
                $(objd).css('width', '100%');
            }

            objd = document.getElementById('qtd_percentual');
            if (objd != null)
            {
                $(objd).css('height', '15px');
                $(objd).css('width', '3%');
            }
            objd = document.getElementById('qtd_percentual_obj');
            if (objd != null)
            {
                $(objd).css('height', '15px');
                $(objd).css('width', '3%');
            }
            objd = document.getElementById('qtd_percentual_fix');
            if (objd != null)
            {
                $(objd).css('height', '15px');
                $(objd).css('background', '#FFFF80');
                $(objd).css('width', '100%');
            }

            objd = document.getElementById('orc_percentual');
            if (objd != null)
            {
                $(objd).css('height', '15px');
                $(objd).css('width', '3%');
            }
            objd = document.getElementById('orc_percentual_obj');
            if (objd != null)
            {
                $(objd).css('height', '15px');
                $(objd).css('width', '3%');
            }
            objd = document.getElementById('orc_percentual_fix');
            if (objd != null)
            {
                $(objd).css('height', '15px');
                $(objd).css('background', '#FFFF80');
                $(objd).css('width', '100%');
            }

            objd = document.getElementById('qtd_realizado');
            if (objd != null)
            {
                $(objd).css('height', '15px');
                $(objd).css('width', '128px');
            }
            objd = document.getElementById('qtd_realizado_obj');
            if (objd != null)
            {
                $(objd).css('height', '15px');
                $(objd).css('width', '134px');
            }
            objd = document.getElementById('qtd_realizado_fix');
            if (objd != null)
            {
                $(objd).css('height', '15px');
                $(objd).css('background', '#FFFF80');
                $(objd).css('width', '100%');
            }

            objd = document.getElementById('orc_realizado');
            if (objd != null)
            {
                $(objd).css('height', '15px');
                $(objd).css('width', '128px');
            }
            objd = document.getElementById('orc_realizado_obj');
            if (objd != null)
            {
                $(objd).css('height', '15px');
                $(objd).css('width', '128px');
            }
            objd = document.getElementById('orc_realizado_fix');
            if (objd != null)
            {
                $(objd).css('height', '15px');
                $(objd).css('background', '#FFFF80');
                $(objd).css('width', '100%');
            }

            objd = document.getElementById('qtd_saldo');
            if (objd != null)
            {
                $(objd).css('height', '15px');
                $(objd).css('width', '128px');
            }
            objd = document.getElementById('qtd_saldo_obj');
            if (objd != null)
            {
                $(objd).css('height', '15px');
                $(objd).css('width', '146px');
            }
            objd = document.getElementById('qtd_saldo_fix');
            if (objd != null)
            {
                $(objd).css('height', '15px');
                $(objd).css('background', '#FFFF80');
                $(objd).css('width', '100%');
            }
            objd = document.getElementById('orc_saldo');
            if (objd != null)
            {
                $(objd).css('height', '15px');
                $(objd).css('width', '128px');
            }
            objd = document.getElementById('orc_saldo_obj');
            if (objd != null)
            {
                $(objd).css('height', '15px');
                $(objd).css('width', '128px');
            }
            objd = document.getElementById('orc_saldo_fix');
            if (objd != null)
            {
                $(objd).css('height', '15px');
                $(objd).css('background', '#FFFF80');
                $(objd).css('width', '100%');
            }
        }

        function parListarConf_grc_evento_publicacao() {
            var par = '';

            if ($('#descricao').val() == '') {
                alert('Favor informar o Título Comercial do Evento!');
                $('#descricao').focus();
                return false;
            }

            if ($('#dt_previsao_inicial').val() == '') {
                alert('Favor informar a Data de Início do Evento!');
                return false;
            }

            if ($('#quantidade_participante').val() == '') {
                alert('Favor informar a Qtde. Participantes!');
                $('#quantidade_participante').focus();
                return false;
            }

            if ($('#idt_gestor_evento').val() == '') {
                alert('Favor informar o Responsável pelo Evento!');
                $('#idt_gestor_evento').focus();
                return false;
            }

            if ($('#idt_cidade').val() == '') {
                alert('Favor informar a Cidade do Evento!');
                return false;
            }

            if ($('#idt_local').val() == '') {
                alert('Favor informar a Local/Sala do Evento!');
                return false;
            }

            par += '&descricao=' + url_encode($('#descricao').val());
            par += '&ini=' + $('#dt_previsao_inicial').val();
            par += '&idt_gestor_evento=' + $('#idt_gestor_evento').val();
            par += '&quantidade_participante=' + $('#quantidade_participante').val();
            par += '&idt_local=' + $('#idt_local').val();
            par += '&idt_cidade=' + $('#idt_cidade').val();

            return par;
        }

        function func_AtivaDesativa_inc_cliente_prev(idx_regra) {
            if ($('#inc_cliente_prev').val() == 'S') {
                processando();

                $.ajax({
                    dataType: 'json',
                    type: 'POST',
                    url: ajax_sistema + '?tipo=grc_evento_inc_cliente_prev',
                    data: {
                        cas: conteudo_abrir_sistema,
                        idt_evento: idt_evento
                    },
                    success: function (response) {
                        if (response.erro == '') {
                            $.each(response.dados, function (i, val) {
                                $('#inc_cliente_mes_' + i).val(val);
                            });
                        } else {
                            alert(url_decode(response.erro));
                        }
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        alert('Erro no ajax no: ' + textStatus + ' - ' + errorThrown);
                    },
                    async: false
                });

                $('#dialog-processando').remove();
            }
        }

        function cmb_evento_resp_pesq_certificado_ajax(val, idt) {
            $("*").addClass('ajaxLoading');

            $.ajax({
                dataType: 'json',
                type: 'POST',
                url: ajax_sistema + '?tipo=evento_resp_pesq_certificado',
                data: {
                    cas: conteudo_abrir_sistema,
                    idt: idt,
                    val: val
                },
                success: function (response) {
                    if (response.erro != '') {
                        alert(url_decode(response.erro));
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    alert('Erro no ajax no: ' + textStatus + ' - ' + errorThrown);
                },
                async: false
            });

            $("*").removeClass('ajaxLoading');
        }
    }

    function bt_controle_fecha_estado() {
        if ($('fieldset.publico_ab_fe_frm').data('bt_controle_fecha_estado') == 'F') {
            $('fieldset.publico_ab_fe_frm').hide();
        } else if ($('fieldset.publico_ab_fe_frm').data('bt_controle_fecha_estado') == 'A') {
            if ($('fieldset.publico_ab_fe_tit:first').is(":visible")) {
                $("fieldset.publico_ab_fe_frm").show();
            }
        }

        if ($('fieldset.assento_marcado_frm').data('bt_controle_fecha_estado') == 'F') {
            $('fieldset.assento_marcado_frm').hide();
        } else if ($('fieldset.assento_marcado_frm').data('bt_controle_fecha_estado') == 'A') {
            if ($('fieldset.assento_marcado_tit:first').is(":visible")) {
                $("fieldset.assento_marcado_frm").show();
            }
        }
    }
</script>