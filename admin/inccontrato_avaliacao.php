
<style type="text/css">


div#contrato {
    soverflow:auto;
    sheight: 380px;
    swidth : 680px;
    width : 100%;
    float:left;
    font-family : Calibri, Arial, Helvetica, sans-serif;
    font-style: normal;
    font-size: 12px;
    font-weight: bold;
    color:#FF5959;
    background: #FFFFFF;
    margin-top:0px;
}


div#contrato_1 {
    soverflow:auto;
    sheight: 360px;
    width : 670px;
    width : 100%;
    float:left;
    font-family : Calibri, Arial, Helvetica, sans-serif;
    font-style: normal;
    font-size: 12px;
    font-weight: bold;
    color:#FF5959;
    padding:0px;
    background: #FFFFFF;
}


table.contrato_table{
    font-family : Calibri, Arial, Helvetica, sans-serif;
    font-style: normal;
    font-size: 12px;
    font-weight: normal;
    color:#000000;
    background: #EFEFEF;
    background: #A2A2A2;
}

tr.contrato_table_tr {


}
td.contrato_titulo_td {
    font-weight : bold;
    color       : #FFFFFF;
    text-align  :center;
    padding-top :5px;
    padding-left:5px;
    border-bottom:1px solid #9D0000;
}
tr.contrato_cab_tr {

}
td.contrato_cab_td {
    font-weight :bold;
    color       :#FFFFFF;
    text-align  :left;
    padding-top :5px;
    padding-left:5px;
    border-bottom:1px solid #9D0000;
}

td.contrato_cab_td_r {
    font-weight :bold;
    color       :#FFFFFF;
    text-align  :left;
    padding-top :5px;
    padding-left:5px;
    border-bottom:1px solid #9D0000;
    text-align: right;
}

tr.contrato_linha_tr {

}
td.contrato_linha_td_t {
    font-weight   : normal;
    color         : #640000;
    background    : #EAEAEA;
    padding-top   : 5px;
    padding-left  : 5px;
    border-bottom : 1px solid #C0C0C0;
}

td.contrato_linha_td_t1 {
    font-weight   : normal;
    color         : #640000;
    background    : #EEEEEE;
    padding-top   : 5px;
    padding-left  : 5px;
    border-bottom : 1px solid #C0C0C0;
}

td.contrato_linha_td_t2 {
    font-weight   : normal;
    color         : #640000;
    background    : #F0F0F0;
    padding-top   : 5px;
    padding-left  : 5px;
    border-bottom : 1px solid #C0C0C0;
}

td.contrato_linha_td_t3 {
    font-weight   : normal;
    color         : #640000;
    background    : #F0F0F0;
    padding-top   : 5px;
    padding-left  : 5px;
    border-bottom : 1px solid #C0C0C0;
}


td.contrato_linha_td_t_r {
    font-weight   : bold;
    color         : #640000;
    background    : #EAEAEA;
    padding-top   : 5px;
    padding-left  : 5px;
    border-bottom : 1px solid #C0C0C0;
    text-align    : right;
}

td.contrato_linha_td_t1_r {
    font-weight   : bold;
    color         : #640000;
    background    : #EEEEEE;
    padding-top   : 5px;
    padding-left  : 5px;
    border-bottom : 1px solid #C0C0C0;
    text-align    : right;
}

td.contrato_linha_td_t2_r {
    font-weight   : bold;
    color         : #640000;
    background    : #F0F0F0;
    padding-top   : 5px;
    padding-left  : 5px;
    border-bottom : 1px solid #C0C0C0;
    text-align    : right;
}

td.contrato_linha_td_t3_r {
    font-weight   : bold;
    color         : #640000;
    background    : #F0F0F0;
    padding-top   : 5px;
    padding-left  : 5px;
    border-bottom : 1px solid #C0C0C0;
    text-align    : right;
}



td.contrato_linha_td_a {
    font-weight :normal;
    color       :#575757;
    background  :#FFFFFF;
    padding-top :5px;
    padding-left:5px;
    border-bottom : 1px solid #C0C0C0;
}

td.contrato_linha_td_a_r {
    font-weight : normal;
    color       :#575757;
    background  :#FFFFFF;
    padding-top :5px;
    padding-left:5px;
    border-bottom : 1px solid #C0C0C0;
    text-align    : right;
}

td.contrato_linha_td_a_r a {
    font-weight : bold;
    color       :#900000;
    text-decoration:none;
}

div#contrato_c {
    background:#FFCCCC;
    background:#FFFFFF;
    width : 680px;
    height:10px;
    margin:0px;
}

div#contrato_r {
    background:#FFCCCC;
    background:#FFFFFF;
    width : 680px;
    sheight:10px;
    margin:0px;
    float:left;
    padding-bottom:20px;
}


.quantidade_contrato {
    background:#E9E9E9;
    swidth : 100%;
    font-family :  Arial, Calibri, Helvetica, sans-serif;
    font-style: normal;
    font-size: 14px;
    font-weight: bold;
    color:#666666;

}


div#mostra_aditivo {
    position:absolute;
    
    left:240px;
    top:150px;
    
    width :700px;
    height:200px;
    
    background-color: white;
    border:2px solid #808040;
    display:none;

    z-index:2000000;
    font-family : Calibri, Arial, Helvetica, sans-serif;
    font-size: 14px;
    font-style: normal;
    font-weight: bold;
    color: #004080;
    text-align:center;
    background: #EBEBEB;
    overflow:auto;
}

div#mostra_aditivo img{
    float:right;
    padding-top:5px;
    padding-right:5px;
    padding-bottom:5px;
}

div#mostra_aditivo_cab {
    width :696px;
    height:30px;
    border:2px solid #C0C0C0;
    color:white;
    background: #004080 ;
}

div#mostra_aditivo_det {
    padding-top:5px;
    padding-left:3px;
    font-family : Calibri, Arial, Helvetica, sans-serif;
    font-size: 14px;
    font-style: normal;
    font-weight: normal;
    color: #A6A6A6;
    text-align:left;

}

div#mostra_aditivo_det img {
    float:left;
    padding-top:0px;
    padding-left:10px;

}

td.cabecalho_campo {
   color: #FFFFFF;
   font-weight: bold;
   padding-bottom:10px;
   border-bottom:1px;
   background:#808080;

}
td.linha_campo {
   color: #202020;
}


div#posicao_periodo {
    width : 670px;
    sheight: 30px;
    float:left;
    font-family : Arial, Calibri,  Helvetica,  sans-serif;
    font-style: normal;
    font-size: 12px;
    font-weight: bold;
    color:#000000;
    padding:0px;
    background: #EAEAEA;
    margin-bottom:5px;
}

div#legenda {
    width : 670px;
    width : 100%;
    height: 30px;
    float:left;
    font-family : Calibri, Arial, Helvetica,  sans-serif;
    font-style: normal;
    font-size: 11px;
    font-weight: bold;
    color:#000000;
    padding:0px;
    background: #EAEAEA;
    margin-bottom:5px;
}

div#legenda_l {
    font-size: 11px;
    color:#000000;
    float:right;
    padding-top:10px;
    margin-left:5px;
    margin-right:5px;
}


div#legenda_i {
    font-size: 11px;
    color:#858585;
    sfloat:left;
    float:right;
    padding-top:10px;
    margin-left:5px;
    margin-right:5px;
}
div#legenda_i img {
    color:#858585;
    font-weight: bold;
}
div#legenda_i span {
    color:#858585;
    font-weight: bold;
}


table.legenda_table{
    font-family : Calibri, Arial, Helvetica, sans-serif;
    font-style: normal;
    font-size: 12px;
    font-weight: normal;
    color:#000000;
    background: #EAEAEA;
}

tr.legenda_cab_tr {


}
td.legenda_cab_td {
    font-weight : bold;
    color       : #B9B9B9;
    text-align  :center;
    padding-top :5px;
    padding-left:5px;
    border-bottom: 1px solid #000000;
}


div#legenda_maior {
    width : 670px;
    sheight: 30px;
    float:left;
    font-family : Calibri, Arial, Helvetica,  sans-serif;
    font-style: normal;
    font-size: 11px;
    font-weight: bold;
    color:#000000;
    padding:0px;
    background: #EAEAEA;
    margin-bottom:5px;
}




div#contrato_edoc {
    position:absolute;

    left:240px;
    top:150px;

    width :700px;
    height:200px;

    background-color: white;
    border:2px solid #808040;
    display:none;

    z-index:2000000;
    font-family : Calibri, Arial, Helvetica, sans-serif;
    font-size: 14px;
    font-style: normal;
    font-weight: bold;
    color: #004080;
    text-align:center;
    background: #EBEBEB;
    overflow:auto;
}

div#contrato_edoc img{
    float:right;
    padding-top:5px;
    padding-right:5px;
    padding-bottom:5px;
}

div#contrato_edoc_cab {
    width :696px;
    height:30px;
    border:2px solid #C0C0C0;
    color:white;
    background: #004080 ;
}

div#contrato_edoc_det {
    padding-top:5px;
    padding-left:3px;
    font-family : Calibri, Arial, Helvetica, sans-serif;
    font-size: 14px;
    font-style: normal;
    font-weight: normal;
    color: #A6A6A6;
    text-align:left;

}

div#contrato_edoc_det img {
    float:left;
    padding-top:0px;
    padding-left:10px;

}


div#voltar_full_m  {
    float:left;
    height:25px;
    background:transparent;
    sbackground:red;
    margin:0px;
    padding:0px;
}

div#voltar_full_m img {
    cursor: pointer;
}

.voltar  {
    float:left;
}


div#area_imprime {
    float:left;
    background: #FFFFFF;
    text-align:right;
    background:blue;

}
div#area_imprime img {
    background: #FFFFFF;
    padding-right:5px;
    cursor: pointer;
}

div#area_excel {
    float:left;
    background: #FFFFFF;
    text-align:right;

}
div#area_excel img {
    background: #FFFFFF;
    padding-right:5px;
    cursor: pointer;
}

div#area_doc {
    float:left;
    background: #FFFFFF;
    text-align:right;

}
div#area_doc img {
    background: #FFFFFF;
    padding-right:5px;
    cursor: pointer;
}


</style>


<?php


/*
if ($_GET['print'] != 's') {
    echo ' <div id="voltar_full_m">';

    echo ' <div class="voltar">';
    echo '         <img src="imagens/menos_full_pco.jpg" title="Voltar"   width="16" height="16"  style="padding:5px; " alt="Voltar" border="0" onclick="self.location = '."'".$url_volta."'".'" style="cursor: pointer;">';
    echo ' </div>';

    $nome_pr   = 'contrato_avaliacao';
    $nome_ex   = 'CONTRATO AVALIAÇÃO - ';
    $titulo_rl = 'Avaliação de Contrato';
    echo "<div id='area_imprime' >";
   // echo '<a target="_blank" href="conteudo_print.php?prefixo=inc&menu='.$nome_pr.'&print=s&titulo_rel='.$titulo_rl.$parww.'" ><img style="padding:5px; "  src="imagens/impressora.gif" width="16" height="16" title="Preparar para Impressão" alt="Preparar para Impressão"  border="0" /></a>';
    echo '<a href="#"  onclick="return chama_orcamento('."'".$nome_pr."', "."'".$titulo_rl."'".');" ><img style="padding:5px; "  src="imagens/impressora.gif" width="16" height="16" title="Preparar para Impressão" alt="Preparar para Impressão"  border="0" /></a>';
    echo "</div>";

    echo ' </div>';
    echo "<br /><br /><br />";
}
*/


$sql     = 'select  idt, estado, descricao from empreendimento ';
$sql    .= '    where idt = '.null($_SESSION[CS]['g_idt_obra']);
$sql    .= '    order by estado, descricao ';
$Filtro  = Array();
$Filtro['rs'] = execsql($sql);

$par_auto=" onChange = 'document.frm.submit();' ";


//if ($_GET['idt0']!='')
//{
    //$Filtro['vlPadrao'] = $_SESSION[CS]['g_idt_obra'];
//}
//else
//{
    $Filtro['vlPadrao'] = $_SESSION[CS]['g_idt_obra'];
    $_GET['idt0'] = $_SESSION[CS]['g_idt_obra'];
    $_GET['pri']='S';
//}

//$Filtro['LinhaUm']  = ' Listar Todas as Obras ';
$Filtro['id'] = 'idt';
$Filtro['js'] = $par_auto;
$Filtro['nome'] = 'Empreendimento';
$Filtro['valor'] = trata_id($Filtro);
$vetFiltro['empreendimento'] = $Filtro;

//$sql     = 'select  idt, razao_social from fornecedor ';
//$sql    .= '    order by razao_social ';

$sql     = 'select distinct fo.idt, fo.razao_social from fornecedor fo ';
$sql    .= ' inner join contrato co on co.idt_fornecedor = fo.idt ';
$sql    .= ' where co.idt_empreendimento = '.null($vetFiltro['empreendimento']['valor']);
$sql    .= '    order by razao_social ';


$Filtro  = Array();
$Filtro['rs'] = execsql($sql);
$Filtro['LinhaUm'] = ' Listar Todos os Fornecedores ';
$Filtro['id'] = 'idt';
$Filtro['vlPadrao'] = -1;

$Filtro['js'] = "style='width:400px;'".$par_auto;
$Filtro['nome'] = 'Fornecedor';
$Filtro['valor'] = trata_id($Filtro);
$vetFiltro['fornecedor'] = $Filtro;




$sql     = 'select  distinct oi.idt , oi.classificacao, oi.descricao from orcamento_item oi ';
$sql    .= ' inner join contrato_servico cs on cs.idt_orcamento_item = oi.idt ';
$sql    .= ' inner join contrato co on co.idt = cs.idt_contrato ';

if ($vetFiltro['empreendimento']['valor']!=-1)
{
    $sql .= ' where oi.idt_empreendimento = '.null($vetFiltro['empreendimento']['valor']);
    if ($vetFiltro['fornecedor']['valor']!=-1)
    {
        $sql .= ' and  co.idt_fornecedor = '.null($vetFiltro['fornecedor']['valor']);
    }
}
else
{
    if ($vetFiltro['fornecedor']['valor']!=-1)
    {
        $sql .= ' where  co.idt_fornecedor = '.null($vetFiltro['fornecedor']['valor']);
    }
}

$sql    .= '    order by oi.classificacao ';




$Filtro  = Array();
$Filtro['rs'] = execsql($sql);
$Filtro['LinhaUm'] = ' Listar Todos os Serviços ';
$Filtro['vlPadrao'] = -1;

$Filtro['id'] = 'idt';
$Filtro['js'] = "style='width:400px;'".$par_auto;
$Filtro['nome'] = 'Serviços';
$Filtro['valor'] = trata_id($Filtro);
$vetFiltro['servico'] = $Filtro;




$sql      = "select distinct pe.idt , resumo from periodo pe ";
$sql     .= " inner join contrato_avaliacao ca on ca.idt_periodo = pe.idt ";
$sql     .= " order by ano desc, mes desc ";
$Filtro  = Array();
$Filtro['rs'] = execsql($sql);
//$Filtro['LinhaUm'] = ' Listar Todos os Serviços ';
//$Filtro['vlPadrao'] = -1;

$Filtro['id'] = 'idt';
$Filtro['js'] = "style='width:400px;'".$par_auto;
$Filtro['nome'] = 'Periodos';
$Filtro['valor'] = trata_id($Filtro);
$vetFiltro['periodo'] = $Filtro;


/*
$sql       = "select cs.idt , cs.descricao  ";
$sql      .= " from contrato_situacao cs" ;
$sql      .= " where avalia = ".aspa('S');


$Filtro  = Array();
$Filtro['rs'] = execsql($sql);
//$Filtro['LinhaUm'] = ' Listar Todos os Serviços ';
//$Filtro['vlPadrao'] = -1;
$Filtro['id'] = 'idt';
$Filtro['js'] = "style='width:400px;'".$par_auto;
$Filtro['nome'] = 'Status';
$Filtro['valor'] = trata_id($Filtro);
$vetFiltro['status'] = $Filtro;
*/



$sql       = "select cs.idt , cs.descricao  ";
$sql      .= " from contrato_situacao cs" ;
$sql      .= " where avalia = ".aspa('S');

$vet_fil_avaliados=Array();
$vet_fil_avaliados['T']="Todos";
$vet_fil_avaliados['A']="Avaliados";
$vet_fil_avaliados['N']="Não Avaliados";
$Filtro  = Array();
$Filtro['rs'] = $vet_fil_avaliados;
//$Filtro['LinhaUm'] = ' Listar Todos os Serviços ';
//$Filtro['vlPadrao'] = -1;
$Filtro['id'] = 'idt';
$Filtro['js'] = "style='width:400px;'".$par_auto;
$Filtro['nome'] = 'Filtro Avaliados';
$Filtro['valor'] = trata_id($Filtro);
$vetFiltro['naoavaliados'] = $Filtro;


$naoavaliados  = $vetFiltro['naoavaliados']['valor'];

//$idt_periodo  = 176;
$idt_periodo  = $vetFiltro['periodo']['valor'];
//echo ' periodo '.$idt_periodo;
if  ($idt_periodo<=0)
{
     echo "<div style='font-size:18px; text-align:center; background:#900000; color:#FFFFFF; width:100%;'>";
     echo ' NÃO EXISTEM PERIODOS PROJETADOS PARA AVALIAÇÃO.'.'<br />';
     echo ' FAVOR SOLICITAR AO ADMINISTRADOR DO SISTEMA PARA PROJETAR UM PERIODO.'.'<br />';
     echo ' OBRIGADO.'.'<br />';
     echo "</div>";
     EXIT();

}

//$idt_periodo = tabela_indice_atual();
//formatar_avaliacao($idt_periodo,1);
    
    
//p(' vvvvvv '.$idt_periodo);
    $vetMes = Array(
    '01' => 'Jan',
    '02' => 'Fev',
    '03' => 'Mar',
    '04' => 'Abr',
    '05' => 'Mai',
    '06' => 'Jun',
    '07' => 'Jul',
    '08' => 'Ago',
    '09' => 'Set',
    '10' => 'Out',
    '11' => 'Nov',
    '12' => 'Dez'
    );
$sql  = "select pe.idt , mes, ano, resumo from periodo pe ";
$sql .= " where pe.idt = ". null($idt_periodo);
$result = execsql($sql);
$row    = $result->data[0];
$anomes = $row['resumo'];
echo "<div id='mostra_aditivo'>";
echo "    <div id='mostra_aditivo_cab'>";
echo "         <img onclick='desativa_mostra_aditivo();' src='imagens/fechar.gif' border='0'>";
echo "          Aditivos do Contrato";
echo "    </div>";
echo "    <div id='mostra_aditivo_det'>";
echo "    <img src='imagens/carregando_1.gif' />";
echo "    </div>";
echo "</div>";

echo "<div id='contrato_edoc'>";
echo "    <div id='contrato_edoc_cab'>";
echo "         <img onclick='desativa_contrato_edoc();' src='imagens/fechar.gif' border='0'>";
echo "          Aguarde carregando Contratos do e_doc";
echo "    </div>";
echo "    <div id='contrato_edoc_det'>";
echo "    <a><img src='imagens/carregando_1.gif' />Aguarde...</a>";
echo "    </div>";
echo "</div>";

$idt_usuario         = $_SESSION[CS]['g_id_usuario'];
$parecer_fornecedor  = 'N';
$avalia_contrato     = 'N';
$ret=avaliacao_direitos($idt_usuario,$parecer_fornecedor,$avalia_contrato);
$avacontrato=0;
if ($avalia_contrato=='S')
{
    $avacontrato=1;
}

echo '<form name="frm" target="_self" action="conteudo.php?'.substr(getParametro($strPara),1).'" method="post">';


if ($_GET['print'] != 's') {
    $Focus = '';
    codigo_filtro(false,false);
    onLoadPag($Focus);
}

echo '</form>';

$idt0=$vetFiltro['empreendimento']['valor'];
$idt1=$vetFiltro['fornecedor']['valor'];
$idt2=$vetFiltro['servico']['valor'];
$idt3=$vetFiltro['periodo']['valor'];
$idt4=$vetFiltro['naoavaliados']['valor'];

$link_refresh = "conteudo.php?idt0={$idt0}&idt1={$idt1}&idt2={$idt2}&idt3={$idt3}&idt4={$idt4}&prefixo=inc&menu=contrato_avaliacao&pri=S";


echo "<br />";

///////////////////////////// informar posição
$idt_empreendimento = null($_SESSION[CS]['g_idt_obra']);
$sqlw   = 'select ';
$sqlw  .= '  epa.* ';
$sqlw  .= '  from empreendimento_periodo_avaliacao epa ';
$sqlw  .= ' where ';
$sqlw  .= '       epa.idt_empreendimento = '.null($idt_empreendimento);
$sqlw  .= '   and epa.idt_periodo        = '.null($idt_periodo);
$rsw = execsql($sqlw);
//p($sqlw);
echo "<div id='posicao_periodo'> ";

//p($link_refresh);


echo "<table class='contrato_table' width='100%' border='0' cellspacing='0' cellpadding='0' vspace='0' hspace='0'> ";
if ($rsw->rows == 0)
{
    echo "<tr class='contrato_cab_tr'>  ";
    echo "   <td class='contrato_cab_td' style='background:#CC0000; text-align:center; width:10%;' ><span style='font-size:18px;'>&nbsp;".$anomes."</span></td> ";
    
    if ($naoavaliados=='T')
    {
        echo "   <td class='contrato_cab_td' style='background:#CC0000; text-align:center;' >&nbsp;"."EMPREENDIMENTO SEM NENHUMA AVALIAÇÃO</td> ";
    }
    else
    {

    }
    echo "   <td class='contrato_cab_td' style='background:#CC0000; text-align:center;' >&nbsp;</td> ";
    
    echo "   <td class='contrato_cab_td' style='background:#CC0000; text-align:center;' >&nbsp;</td> ";

    
    echo "</tr>";
}
else
{
    $row             = $rsw->data[0];
    $idt_epa         = $row['idt'];
    $status          = $row['status'];
    $data_fechamento = $row['data_fechamento'];
    $observacao      = $row['observacao'];
    if ($status=='S')
    {
        echo "<tr class='contrato_cab_tr'>  ";
        echo "   <td class='contrato_cab_td' style='background:#004080; text-align:center; width:10%;' ><span style='font-size:18px;'>&nbsp;".$anomes."</span></td> ";
        if ($naoavaliados=='T')
        {
            echo "   <td class='contrato_cab_td' style='background:#004080; text-align:center;' >&nbsp;"."EMPREENDIMENTO COM TODOS OS CONTRATOS AVALIADOS EM ".trata_data($data_fechamento)."</td> ";
        }
        else
        {
            if ($naoavaliados=='A')
            {
                echo "   <td class='contrato_cab_td' style='background:#CC0000; text-align:center;' >&nbsp;"."ATENÇÃO... VISUALIZANDO CONTRATOS AVALIADOS PARA O PERIODO </td> ";
            }
            else
            {
                echo "   <td class='contrato_cab_td' style='background:#CC0000; text-align:center;' >&nbsp;"."ATENÇÃO... VISUALIZANDO CONTRATOS NÃO AVALIADOS PARA O PERIODO </td> ";
            }
        }

           $path_dir='imagens/';
           $foa_imagempw='parecer_observacao.gif';
           $foa_descricaopw='Observação da Avaliação do Período da Obra';
           echo "   <td class='{$classe}' style='width:5%; text-align:center; sborder:1px solid #F0F0F0; background:#004080' >";
           echo '   <a href="#" onclick="return mostra_observacao_avaliacao('."'".$idt_epa."'".');" >';
           // ImagemProd_b64(21 , 21, $path_dir, $foa_imagempw, '', False, $foa_descricaopw);
           ImagemProd(21 , 21, $path_dir, $foa_imagempw, '', False, $foa_descricaopw);
           echo '   </a> ';
           echo "</td> ";


       if ($_GET['print'] != 's') {


           $path_dir='imagens/';
           $foa_imagempw='refresh.gif';
           $foa_descricaopw='Atualiza tela (Refresh F5)';
           echo "   <td class='{$classe}' style='width:5%; text-align:center; sborder:1px solid #F0F0F0; background:#600000;' >";
           echo '   <a href="#" onclick="return refresh_avalia_contrato('."'".$link_refresh."'".');" >';
          // ImagemProd_b64(21 , 21, $path_dir, $foa_imagempw, '', False, $foa_descricaopw);
           ImagemProd(21 , 21, $path_dir, $foa_imagempw, '', False, $foa_descricaopw);
           echo '   </a> ';
           
           echo "</td> ";
         }
         else
         {
           echo "   <td class='{$classe}' style='width:5%; text-align:center; sborder:1px solid #F0F0F0; background:#600000;' >";
           echo '   &nbsp; >';
           echo '   </a> ';
         }
        
        echo "</tr>";
    }
    else
    {
        echo "<tr class='contrato_cab_tr'>  ";
        echo "   <td class='contrato_cab_td' style='background:#CC0000; text-align:center; width:10%;' ><span style='font-size:18px;'>&nbsp;".$anomes."</span></td> ";
        if ($naoavaliados=='T')
        {

//            echo "   <td class='contrato_cab_td' style='background:#CC0000; text-align:center;' >&nbsp;"."EMPREENDIMENTO COM PENDENCIA DE AVALIAÇÃO PARA O PERÍODO </td> ";
            echo "   <td class='contrato_cab_td' style='background:#CC0000; text-align:center;' >&nbsp;"."ATENÇÃO... VISUALIZANDO CONTRATOS AVALIADOS E NÃO AVALIADOS PARA O PERIODO </td> ";
            
        }
        else
        {
            if ($naoavaliados=='A')
            {
                echo "   <td class='contrato_cab_td' style='background:#CC0000; text-align:center;' >&nbsp;"."ATENÇÃO... VISUALIZANDO CONTRATOS AVALIADOS PARA O PERIODO </td> ";
            }
            else
            {
                echo "   <td class='contrato_cab_td' style='background:#CC0000; text-align:center;' >&nbsp;"."ATENÇÃO... VISUALIZANDO CONTRATOS NÃO AVALIADOS PARA O PERIODO </td> ";
            }

        }

        
           $path_dir='imagens/';
           $foa_imagempw='parecer_observacao.gif';
           $foa_descricaopw='Observação da Avaliação do Período da Obra';
           echo "   <td class='{$classe}' style='width:5%; padding-top:3px; text-align:center; sborder:1px solid #F0F0F0; background:#CC0000;' >";
           echo '   <a href="#" onclick="return mostra_observacao_avaliacao('."'".$idt_epa."'".');" >';
          // ImagemProd_b64(21 , 21, $path_dir, $foa_imagempw, '', False, $foa_descricaopw);
           ImagemProd(21 , 21, $path_dir, $foa_imagempw, '', False, $foa_descricaopw);
           echo '   </a> ';
           echo "</td> ";



           if ($_GET['print'] != 's') {


               $path_dir='imagens/';
               $foa_imagempw='refresh.gif';
               $foa_descricaopw='Atualiza tela (Refresh F5)';
               echo "   <td class='{$classe}' style='width:5%; padding-top:3px; text-align:center; sborder:1px solid #F0F0F0; background:#CC0000;' >";
               echo '   <a href="#" onclick="return refresh_avalia_contrato('."'".$link_refresh."'".');" >';
            //   ImagemProd_b64(21 , 21, $path_dir, $foa_imagempw, '', False, $foa_descricaopw);
               ImagemProd(21 , 21, $path_dir, $foa_imagempw, '', False, $foa_descricaopw);
               echo '   </a> ';

           echo "</td> ";
           }
           else
           {
               echo "   <td class='{$classe}' style='width:5%; text-align:center; sborder:1px solid #F0F0F0; background:#600000;' >";
               echo '   &nbsp; >';
               echo '   </a> ';
           }


        
        echo "</tr>";
    }
}

   //     echo "<tr class='contrato_cab_tr'>  ";
   //     echo "   <td class='contrato_cab_td' style='background:#600000; text-align:center; width:5%;' ><span style='font-size:18px;'>&nbsp;".$anomes."</span></td> ";
   //     echo "   <td class='contrato_cab_td' style='background:#600000; text-align:center;' >&nbsp;"."EMPREENDIMENTO COM PENDENCIA DE AVALIAÇÃO PARA O PERÍODO </td> ";
   //     echo "</tr>";

    // observação sobre a avaliação da obra

    echo "<tr  id='observacao_avaliacao_obra{$idt_epa}' class='contrato_cab_tr' style='display:none;' >  ";
  //  echo "<td   style='width:10%; background:#F2F2F2;' >";
    echo "<td colspan='4'  style=' background:#F2F2F2;' >";
    echo  "Observações: ";
  //  echo "</td> ";
 //   echo "<td  style='background:#00FF00;'  >";
 //   echo  "Observações2: ";
 //   echo "</td> ";

  //  echo "<td class='vvv{$classe}'  style='background:#F2F2F2; padding-left:5px;  border-bottom:2px solid #666666;' >";
    if ($observacao=='')
    {
       // echo  " SEM OBSERVAÇÕES SOBRE A AVALIAÇÃO DO PERÍODO ";
    }
    $idta="idt_epa_{$idt_epa}";
    
    $ronlyw=" enabled:true; ";
    $jsw=" readonly='readonly' ";

    if ($avacontrato==1)
    {
        $ronlyw='';
        $jsw="";
    }
    echo "<textarea id='".$idta."' rows='2' style='width:98%; $ronlyw ' ".$jsw.">";
//    echo '<textarea id="'.$idta.'" rows="2" style="width:98%;">';
    echo  $observacao;
    echo '</textarea>';


    if ($avacontrato==1)
    {
        $btconfirma = "<input type='button' name='btnAcao' value='Registrar Observação' title='Registrar Observação sobre a Avaliação do Período da Obra'  style='width:150px; height:25px; margin-left:10px; cursor: pointer;' onclick='return registra_observacao_avaliacao(".$idt_epa.");'  />";
        echo "<table class='xxcontrato_table' width='100%' border='0' cellspacing='0' cellpadding='0' vspace='0' hspace='0'> ";
        echo "  <tr  class='xxcontrato_linha_tr' >  ";
        echo "    <td class='xx{$classe}'  style='color:#B00000; background:#F2F2F2; font-weight: bold; font-size:14px; text-align:center;' >{$btconfirma}<br /><br /></td> ";
        echo "  </tr>  ";
        echo "</table>";
    }
    echo "</td> ";


    echo "</tr>";



echo "</table>" ;
echo "</div>";

echo "<div id='legenda'> ";
$sqll   = 'select ';
$sqll  .= '  foat.descricao     as foat_descricao, ';
$sqll  .= '  foat.imagem        as foat_imagem,   ';
$sqll  .= '  foat.peso          as foat_peso,   ';
$sqll  .= '  foat.cor           as foat_cor   ';
$sqll  .= '  from fornecedor_avaliacao foat ';
$sqll  .= '  order by peso desc ';
$rsl = execsql($sqll);
$path_l='admin/obj_file/fornecedor_avaliacao/';
$vet_peso_img=Array();
$vet_peso_des=Array();
$vet_peso_cor=Array();

ForEach($rsl->data as $rowl) {
    $foat_imagem         = $rowl['foat_imagem'];
    $foat_descricao      = $rowl['foat_descricao'];
    $classe ='legenda_cab_td';
    $classer='legenda_cab_td';
    $vet_peso_img[$rowl['foat_peso']]=$rowl['foat_imagem'];
    $vet_peso_des[$rowl['foat_peso']]=$rowl['foat_descricao'];
    $vet_peso_cor[$rowl['foat_peso']]=$rowl['foat_cor'];
    echo "<div id='legenda_i'> ";
   // ImagemProd_b64(16 , 16, $path_l, $foat_imagem, $foat_descricao);
    ImagemProd(16 , 16, $path_l, $foat_imagem, $foat_descricao);
    $pesof=format_decimal($rowl['foat_peso'],0);
    echo "<span>"." ({$pesof}) ".$foat_descricao." "."</span>";
    echo "</div>";
}

echo "<div id='legenda_l'> ";

$link_legenda  ="<a href='#' onclick='return legenda_maior();' style='text-decoration:none; font-size:12px; color:CC0000; '>";
$link_legenda .="Legenda:";
$link_legenda .="</a>";

echo $link_legenda;

echo "</div>";
echo "</div>";

echo "<div id='legenda_maior' style='display:none;'> ";
$sqll   = 'select ';
$sqll  .= '  texto  ';
$sqll  .= '  from avaliacao_legenda  ';
$sqll  .= '  where codigo = '. aspa('AVFOR');
$rsl = execsql($sqll);
$texto='';
ForEach($rsl->data as $rowl) {
    $texto = $rowl['texto'];
}
echo $texto;
echo "</div>";



$vet_peso_imgs=$vet_peso_img;
$vet_peso_dess=$vet_peso_des;
$vet_peso_cors=$vet_peso_cor;

ksort($vet_peso_imgs);
ksort($vet_peso_dess);
ksort($vet_peso_cors);


//p($vet_peso_cors);

//p($vet_peso_imgs);


//p($vet_peso_imgs);

$sqll   = 'select ';
$sqll  .= '  foc.* ';
$sqll  .= '  from fornecedor_criterio foc ';
$sqll  .= '  order by codigo ';
$rsl = execsql($sqll);

$vet_criterio_idt       = Array();
$vet_criterio_codigo    = Array();
$vet_criterio_descricao = Array();
$vet_criterio_resumo    = Array();
$vet_criterio_peso      = Array();
ForEach($rsl->data as $rowl) {
    $idt                = $rowl['idt'];
    $codigo             = $rowl['codigo'];
    $descricao          = $rowl['descricao'];
    $resumo             = $rowl['resumo'];
    $peso               = $rowl['peso'];
    $vet_criterio_idt[$codigo]        = $idt;
    $vet_criterio_codigo[$codigo]     = $codigo;
    $vet_criterio_descricao[$codigo]  = $descricao;
    $vet_criterio_resumo[$codigo]  = $resumo;
    $vet_criterio_peso[$codigo]         = $peso;
}


//p($vet_peso_img);

$patha='admin/obj_file/fornecedor_avaliacao/';


$paths='admin/obj_file/contrato_situacao/';

set_time_limit (120);

$sql   = 'select ';
$sql  .= '  em.idt            as em_idt, ';
$sql  .= '  em.descricao      as em_descricao, ';
$sql  .= '  co.idt            as co_idt, ';
$sql  .= '  co.idt_fornecedor as co_idt_fornecedor, ';
$sql  .= '  co.numero         as co_numero, ';
$sql  .= '  co.valor_contrato as co_valor_contrato, ';
$sql  .= '  co.valor_aditivo  as co_valor_aditivo, ';
$sql  .= '  co.valor_pago     as co_valor_pago, ';
$sql  .= '  co.parecer_contrato  as co_parecer_contrato, ';

$sql  .= '  cs.descricao      as cs_descricao,   ';

$sql  .= '  fo.fantasia      as fo_fantasia, ';
$sql  .= '  fo.razao_social  as fo_razao_social, ';
$sql  .= '  oi.descricao     as oi_descricao, ';
$sql  .= '  csi.imagem        as csi_imagem,   ';
$sql  .= '  csi.descricao        as csi_descricao,   ';
$sql  .= '  css.imagem       as css_imagem,   ';
$sql  .= '  cst.descricao     as cst_descricao, ';
$sql  .= '  cst.imagem       as cst_imagem,   ';
$sql  .= '  co.nota           as co_nota,   ';
$sql  .= '  foa.descricao      as foa_descricao,   ';
$sql  .= '  foa.imagem         as foa_imagem,   ';
$sql  .= '  ca.naoavaliados         as ca_naoavaliados   ';

$sql  .= '  from contrato co ';
$sql  .= '  inner join contrato_avaliacao ca  on ca.idt_contrato  = co.idt ';
$sql  .= '  inner join contrato_status    cst on cst.idt = co.idt_status_conclusao ';
$sql  .= '  inner join empreendimento     em  on em.idt           = co.idt_empreendimento ';
$sql  .= '  inner join fornecedor         fo  on fo.idt           = co.idt_fornecedor ';
$sql  .= '  left  join contrato_servico   cs  on cs.idt_contrato  = co.idt ';
$sql  .= '  left  join orcamento_item     oi  on oi.idt           = cs.idt_orcamento_item ';
$sql  .= '  left  join contrato_status    css on css.idt          = cs.idt_status_conclusao ';
$sql  .= '  inner join contrato_situacao  csi on csi.idt          = co.idt_situacao ';
$sql  .= '  inner join contrato_tipo      ct  on ct.idt           = co.idt_tipo     ';
$sql  .= '  left  join fornecedor_avaliacao  foa  on foa.idt     = co.idt_avaliacao     ';

/*
$sql .= ' where ';
$sql .= '    co.idt_empreendimento = '.null($_SESSION[CS]['g_idt_obra']);

if ($vetFiltro['fornecedor']['valor']!=-1)
{
    $sql .= ' and ';
    $sql .= '   co.idt_fornecedor = '.null($vetFiltro['fornecedor']['valor']);
}
$sql .= ' order by fo.razao_social ';

*/


$sqlc   = 'select ';
$sqlc  .= '  distinct co.idt ';

$sqlc  .= '  from contrato co ';
$sqlc  .= '  inner join contrato_avaliacao ca  on ca.idt_contrato  = co.idt ';
$sqlc  .= '  inner join contrato_status    cst on cst.idt = co.idt_status_conclusao ';
$sqlc  .= '  inner join empreendimento     em  on em.idt           = co.idt_empreendimento ';
$sqlc  .= '  inner join fornecedor         fo  on fo.idt           = co.idt_fornecedor ';
$sqlc  .= '  left  join contrato_servico   cs  on cs.idt_contrato  = co.idt ';
$sqlc  .= '  left  join orcamento_item     oi  on oi.idt           = cs.idt_orcamento_item ';
$sqlc  .= '  left  join contrato_status    css on css.idt          = cs.idt_status_conclusao ';
$sqlc  .= '  inner join contrato_situacao  csi on csi.idt          = co.idt_situacao ';
$sqlc  .= '  inner join contrato_tipo      ct  on ct.idt           = co.idt_tipo     ';
$sqlc  .= '  left  join fornecedor_avaliacao  foa  on foa.idt     = co.idt_avaliacao     ';




if ($vetFiltro['empreendimento']['valor']!=-1)
{
    $sql .= ' where ';
    $sql .= '    co.idt_empreendimento = '.null($vetFiltro['empreendimento']['valor']);
    $sql .= ' and ca.idt_periodo       = '.null($idt_periodo);
    $sql .= " and csi.avalia           = ".aspa('S');
    
    $sqlc .= ' where ';
    $sqlc .= '    co.idt_empreendimento = '.null($vetFiltro['empreendimento']['valor']);
    $sqlc .= ' and ca.idt_periodo       = '.null($idt_periodo);
    $sqlc .= " and csi.avalia           = ".aspa('S');

    
    if ($naoavaliados!='T')
    {
        if ($naoavaliados=='A')
        {
            $sql  .= " and ca.naoavaliados  = 0 ";
            $sqlc .= " and ca.naoavaliados  = 0 ";
        }
        else
        {
            $sql  .= " and ca.naoavaliados  > 0 ";
            $sqlc .= " and ca.naoavaliados  > 0 ";
        }


    }
}


if ($vetFiltro['fornecedor']['valor']!=-1)
{
    if ($vetFiltro['empreendimento']['valor']!=-1)
    {
       $sql  .= ' and ';
       $sqlc .= ' and ';
    }
    else
    {
       $sql  .= ' where ';
       $sqlc .= ' where ';
    }
    $sql  .= '   co.idt_fornecedor = '.null($vetFiltro['fornecedor']['valor']);
    $sqlc .= '   co.idt_fornecedor = '.null($vetFiltro['fornecedor']['valor']);
}

if ($vetFiltro['servico']['valor']!=-1 and $vetFiltro['servico']['valor']!=0)
{
    if ($vetFiltro['empreendimento']['valor']!=-1 or $vetFiltro['fornecedor']['valor']!=-1)
    {
       $sql  .= ' and ';
       $sqlc .= ' and ';
    }
    else
    {
       $sql  .= ' where ';
       $sqlc .= ' where ';
    }
    $sql  .= '   oi.idt = '.null($vetFiltro['servico']['valor']);
    $sqlc .= '   oi.idt = '.null($vetFiltro['servico']['valor']);
}

//$sql .= ' order by oi.descricao, cs.valor_unitario, cs.descricao,  fo.fantasia ';

$sql .= ' order by ';
//p($vetFiltro['empreendimento']['valor']);

if ($vetFiltro['empreendimento']['valor']!=-1)
{
    $sql .= ' em.descricao ';
    if ($vetFiltro['fornecedor']['valor']!=-1)
    {
        //$sql .= ', fo.razao_social ';
        $sql .= ', YEAR(data_inicio), co.numero ';
        if ($vetFiltro['servico']['valor']!=-1)
        {
            $sql .= ', oi.descricao, cs.valor_unitario, cs.descricao,  fo.fantasia ';
        }
        else
        {
            $sql .= ', oi.descricao, cs.valor_unitario, cs.descricao,  fo.fantasia ';
        }
    }
    else
    {
       // p($vetFiltro['servico']['valor']);
        if ($vetFiltro['servico']['valor']>0)
        {
            $sql .= ', YEAR(data_inicio), co.numero ';
            $sql .= ', oi.descricao, cs.valor_unitario, cs.descricao,  fo.fantasia ';
            //$sql .= ', fo.razao_social ';
           // $sql .= ', YEAR(data_inicio), co.numero ';
        }
        else
        {
            //$sql .= ', fo.razao_social ';
            $sql .= ', YEAR(data_inicio), co.numero ';
            $sql .= ', oi.descricao, cs.valor_unitario, cs.descricao,  fo.fantasia ';
        }

    }
}
else
{
    if ($vetFiltro['fornecedor']['valor']!=-1)
    {
        //$sql .= ' fo.razao_social ';
        $sql .= ' YEAR(data_inicio), co.numero ';
        if ($vetFiltro['servico']['valor']!=-1)
        {
            $sql .= ', oi.descricao, cs.valor_unitario, cs.descricao,  fo.fantasia ';
            //$sql .= ', fo.razao_social ';
            $sql .= ', YEAR(data_inicio), co.numero ';
        }
        else
        {
            //$sql .= ', fo.razao_social ';
            $sql .= ', YEAR(data_inicio), co.numero ';
            $sql .= ', oi.descricao, cs.valor_unitario, cs.descricao,  fo.fantasia ';
        }
    }
    else
    {
        if ($vetFiltro['servico']['valor']!=-1)
        {
            $sql .= ' oi.descricao, cs.valor_unitario, cs.descricao,  fo.fantasia ';
            $sql .= ', fo.razao_social ';
          //  $sql .= ', co.numero ';
        }
        else
        {
            //$sql .= ', fo.razao_social ';
           // $sql .= ', co.numero ';
            $sql .= ' em.descricao, YEAR(data_inicio), co.numero ';
            $sql .= ', oi.descricao, cs.valor_unitario, cs.descricao,  fo.fantasia ';
        }
    }
    $sql .= ', em.descricao ';
}
//p($sql);
//exit();
$rs = execsql($sql);
$path='admin/obj_file/contrato_status/';
if ($rs->rows == 0)
{

}
echo " <div id='contrato'> ";


//echo  "....... ".$sql;

//echo "<div id='contrato_c'> ";
//echo "</div>";

/*
echo "<div id='legenda'> ";
//echo "<table class='legenda_table' width='100%' border='0' cellspacing='0' cellpadding='0' vspace='0' hspace='0'> ";
//echo "<tr class='legenda_cab_tr'>  ";
$sqll   = 'select ';
$sqll  .= '  cst.descricao     as cst_descricao, ';
$sqll  .= '  cst.imagem        as cst_imagem   ';
$sqll  .= '  from contrato_status cst ';
$sqll  .= '  order by codigo desc ';
$rsl = execsql($sqll);
ForEach($rsl->data as $rowl) {
    $cst_imagem         = $rowl['cst_imagem'];
    $cst_descricao      = $rowl['cst_descricao'];
    $classe ='legenda_cab_td';
    $classer='legenda_cab_td';

    
    echo "<div id='legenda_i'> ";
//    echo "   <td class='{$classe}' >";
         ImagemProd(16 , 16, $path, $cst_imagem, $cst_descricao);
//    echo "</td> ";
//    echo "   <td class='{$classer}' >".$cst_descricao."</td> ";
      echo "   ".$cst_descricao." ";
      echo "</div>";
}

echo "<div id='legenda_l'> ";
echo "Legenda:";
echo "</div>";


//echo "</tr>";
//echo "</table>";
echo "</div>";

*/



echo " <div id='contrato_1'> ";

// avaliacao do fornecedor


$pg_posicao = $_GET['pg_pos'];
if ($pg_posicao=='')
{
    $pg_posicao = 1;
}
$rscount = execsql($sqlc);
$qt_linpg=10;
$separa='';
$oi_descricao_ac='';
$oi_descricao_ac_r='';
$is=0;
$qt_lin    = $rscount->rows;
$qt_pg_int = floor($qt_lin/$qt_linpg);
$qt_resto  = ($qt_lin % $qt_linpg);
$qt_pg     = $qt_pg_int;
if ($qt_resto!=0)
{
    $qt_pg=$qt_pg+1;
}
echo "<div style='background:#C0C0C0; color:#808080; text-align:center; font-size:16px; display:block; width:100%;'>";
if ($qt_resto!=0)
{
    echo " {$qt_lin} Contratos... {$qt_pg} Páginas sendo {$qt_pg_int} com {$qt_linpg} contratos e a última com {$qt_resto} ";
}
else
{
    echo " {$qt_lin} Contratos...  {$qt_pg} Páginas  com {$qt_linpg} contratos.";
}
echo "</div>";

$pgt=0;
echo "<div style='background:#C0C0C0; color:#FFFFFF; display:block; width:100%; sheight:50px;'>";
    for ($c = 0; $c < $qt_pg; $c++)
    {
        $pgt++;
        $pgtw  = floor($pgt/2);
        $pgtw  = $c+1;
        $idt0  = $vetFiltro['empreendimento']['valor'];
        $idt1  = $vetFiltro['fornecedor']['valor'];
        $idt2  = $vetFiltro['servico']['valor'];
        $idt3  = $vetFiltro['periodo']['valor'];
        $idt4  = $vetFiltro['nao_avaliados']['valor'];
        $hrefw = "conteudo.php?idt0={$idt0}&idt1={$idt1}&idt2={$idt2}&idt3={$idt3}&idt4={$idt4}&prefixo=inc&menu=contrato_avaliacao&pri=S&pg_pos={$pgtw}";
        echo "<a href='{$hrefw}' style='text-decoration:none; cursor:pointer; color:#000000; font-size:16px;' title='Posiciona na Página {$pgtw}' >";
        if($pg_posicao==$pgtw)
        {
            $bgcc='#CC0000';
            $cco ='#FFFFFF';
        }
        else
        {
            // $bgcc='#E2E2E2';
            $bgcc='#FFFFFF';
            $cco ='#666666';
        }
        echo "<div style='background:{$bgcc}; text-align:center; border:1px solid #F5F5F5; color:{$cco}; width:8%; float:left;'>";
        echo $pgtw;
        echo "</div>";
        echo "</a>";
     }
echo "</div>";

echo "<table class='contrato_table' width='100%' border='0' cellspacing='0' cellpadding='0' vspace='0' hspace='0'> ";
echo "<tr class='contrato_cab_tr'>  ";
//echo "   <td class='contrato_cab_td' >&nbsp;"."OBRA"."</td> ";
echo "   <td class='contrato_cab_td_r' >STATUS</td> ";
echo "   <td class='contrato_cab_td' width='10'>&nbsp;"."NÚMERO<br>CONTRATO"."</td> ";
echo "   <td class='contrato_cab_td' >&nbsp;"."EMPRESA"."</td> ";
echo "   <td class='contrato_cab_td' >&nbsp;"."SERVIÇO"."</td> ";
echo "   <td class='contrato_cab_td_r' >&nbsp;"."VALOR CONTRATO<br>(R$)"."</td> ";
echo "   <td class='contrato_cab_td_r' >&nbsp;"."VALOR ADITIVO<br>(R$)"."</td> ";
//echo "   <td class='contrato_cab_td_r' >&nbsp;"."VALOR PAGO<br>(R$)"."</td> ";
//echo "   <td class='contrato_cab_td_r' >&nbsp;"."SALDO<br>(R$)"."</td> ";
echo "   <td class='contrato_cab_td_r' >AVALIAÇÃO</td> ";
echo "</tr>";
$idt_contrato=0;


$qtd_contratos=0;
$qtd_contratos_avaliados=0;
$qtd_criterios_avaliados=0;

$qtd_contratos_av=0;

//p($sql);



$pg_lin  = 0;
$pg_calc = 0;
ForEach($rs->data as $row) {
   if ($em_descricao.$fo_razao_social.$idt_contrato!=$row['em_descricao'].$row['fo_razao_social'].$row['co_idt'] and $idt_contrato!=0)
   {
       $pg_lin    = $pg_lin+1;
       $pg_resto  = ($pg_lin % $qt_linpg);
       $pg_int    = floor($pg_lin/$qt_linpg);
       if ($pg_resto!=0)
       {
           $pg_int=$pg_int+1;
       }
       
       
       $qtd_contratos=$qtd_contratos+1;

       if ($ca_naoavaliados==0)
       {
           $qtd_contratos_av=$qtd_contratos_av+1;
       }

      // echo ' ppppppp '.$pg_int;
   if ($pg_int==$pg_posicao)
   {


       echo "<tr  class='contrato_linha_tr' >  ";
       $classe='contrato_linha_td_a';
       $classer='contrato_linha_td_a_r';
       
       
       echo "   <td class='{$classe}' >";
       echo "&nbsp;&nbsp;";
      //   ImagemProd_b64(16 , 16, $paths, $csi_imagem, '', False, $csi_descricao);
       ImagemProd(16 , 16, $paths, $csi_imagem, '', False, $csi_descricao);
       echo "</td> ";
/* // guy
       $qtd_contratos=$qtd_contratos+1;
       
        if ($ca_naoavaliados==0)
        {
            $qtd_contratos_av=$qtd_contratos_av+1;
        }
*/
       
//       echo "   <td class='{$classe}' >".$em_descricao."</td> ";
       
       
       $href='<a href="#" onclick="mostra_contrato('."'".$idt_contrato."'".');" >'.$co_numero.'</a>';
       $co_numero_e=$href;
       echo "   <td class='{$classer}' style='width:80px; sfont-size: 11px;'  >".$co_numero_e."</td> ";
       $tam = strlen($fo_razao_social);
       if ($tam>23)
       {
           $titw    = substr($fo_razao_social,0,23).'...';
           $titlew  = $fo_razao_social;
           $cursor  ="cursor:pointer;";
       }
       else
       {
           $titw=$fo_razao_social;
           $titlew  = '';
           $cursor  = '';
       }
       echo "   <td class='{$classe}' style='width:180px;' >"."<span style='{$cursor}' title='$titlew'>".$titw."</span></td> ";
       
       echo "   <td class='{$classe}' style='width:150px;'>";

 //    $tam = strlen($oi_descricao_ac_r);
       $is=$is+1;
       $id = 'servico_'.$is;
       $link2="<a href='#' style='color:#004080; text-decoration:none; cursor:pointer;' onclick='return abre_servico(".'"'.$id.'"'.")'>{$oi_descricao_ac_r}...</a>";
       $link1="<a href='#' style='color:#004080; text-decoration:none; cursor:pointer;' onclick='return abre_servico(".'"'.$id.'"'.")'><img onclick='desativa_contrato_edoc();' src='imagens/mais_menu.gif' border='0'></a>";

     //  $ajusta_txt=$link1. ' '. $link2;
       $ajusta_txt = $link2;
       echo $ajusta_txt;
       
       echo "<div id='{$id}' style='display:none'>";
       echo $oi_descricao_ac;
       echo "</div>";
       echo "</td> ";



       $saldo = ($co_valor_contrato_v + $co_valor_aditivo_v) - $co_valor_pago_v;
       
       
       $saldo_e = format_decimal($saldo);

       echo "   <td class='{$classer}' style=' font-weight: bold; '>".$co_valor_contrato."</td> ";
       
       if ($co_valor_aditivo_v>0)
       {
           $href='<a href="#" onclick="mostra_aditivo('."'".$idt_contrato."'".');" >'.$co_valor_aditivo.'</a>';
           $co_valor_aditivo_e=$href;
       }
       else
       {
           $co_valor_aditivo_e=$co_valor_aditivo;
       }
       echo "   <td class='{$classer}' >".$co_valor_aditivo_e."</td> ";
  //     echo "   <td class='{$classer}' >".$co_valor_pago."</td> ";
  //     echo "   <td class='{$classer}' >".$saldo_e."</td> ";
       
//       echo "   <td class='{$classe}' >";
//         echo "&nbsp;&nbsp;";
//         ImagemProd(21 , 21, $path, $cst_imagem, $cst_descricao);
//       echo "</td> ";

       echo "   <td class='{$classe}' style='text-align:center;'>";
//         echo '   <a href="#" onclick="mostra_avaliacao('."'".$idt_fornecedor."'".');" >';
         echo '   <a href="#" onclick="return mostra_criterios('."'".$idt_fornecedor."',"."'".$idt_contrato."');".'" >';
      //   ImagemProd_b64(16 , 16, $patha, $foa_imagem, '', False, $foa_descricao);
         ImagemProd(16 , 16, $patha, $foa_imagem, '', False, $foa_descricao);
         echo '   </a> ';
       echo "</td> ";


       
       
       echo "</tr>";
       

       $naoavaliado=0;
       //
       // Aqui vai a parte da avaliação
       //
       // Carregar avaliações do periodo escolhido
       //

       // contrato_avaliacao_criterio
       $sqll   = 'select ';
       $sqll  .= '  cac.idt            as cac_idt, ';
       $sqll  .= '  cac.idt_criterio   as cac_idt_criterio,   ';
       $sqll  .= '  cac.nota           as cac_nota,   ';
       $sqll  .= '  fc.codigo          as fc_codigo,   ';
       $sqll  .= '  fc.peso            as fc_peso,   ';
       $sqll  .= '  fc.descricao       as fc_descricao,   ';
       $sqll  .= '  ca.idt             as ca_idt,   ';
       $sqll  .= '  ca.idt_periodo     as ca_idt_periodo,   ';
       $sqll  .= '  ca.idt_avaliacao   as ca_idt_avaliacao,   ';
       $sqll  .= '  ca.nota            as ca_nota,   ';
       $sqll  .= '  ca.parecer_periodo as ca_parecer_periodo,   ';
       $sqll  .= '  fa.imagem          as fa_imagem,   ';
       $sqll  .= '  fa.descricao       as fa_descricao   ';
       
       $sqll  .= '  from contrato_avaliacao ca ';
       $sqll  .= '  inner join contrato_avaliacao_criterio cac on ca.idt = cac.idt_contrato_avaliacao';
       $sqll  .= '  inner join fornecedor_criterio fc on fc.idt = cac.idt_criterio';
       $sqll  .= '  left  join fornecedor_avaliacao fa on fa.idt = ca.idt_avaliacao';
       $sqll  .= '  where ca.idt_contrato = '.null($idt_contrato);
       $sqll  .= '    and ca.idt_periodo  = '.null($idt_periodo);
       $sqll  .= '  order by fc.codigo ';
       $rsl = execsql($sqll);
       
       // p($sqll);
       // para os critérios indicar o escolhido
       
       $kvet_nota_criterio                            = Array();
       $kvet_peso_criterio                            = Array();
       $kvet_contrato_avaliacao_criterio_idt          = Array();
       $kvet_contrato_avaliacao_criterio_idt_criterio = Array();
       $fc_peso = 0;
       $ca_idt_avaliacao = 0;
       
       $ca_nota_periodo = 0;

       ForEach($rsl->data as $rowl) {
           $cac_idt_criterio = $rowl['cac_idt_criterio'];
           $kvet_contrato_avaliacao_criterio_idt         [$cac_idt_criterio]  = $rowl['cac_idt'];
           $kvet_contrato_avaliacao_criterio_idt_criterio[$cac_idt_criterio]  = $rowl['cac_idt_criterio'];
           if ($rowl['cac_nota']<1 )
           {
                $rowl['cac_nota']   = 0;
           }
           else
           {
           }
           $kvet_nota_criterio [$cac_idt_criterio] = $rowl['cac_nota'];
           $kvet_peso_criterio [$cac_idt_criterio] = $rowl['fc_peso'];
           if ($rowl['fc_peso']>0)
           {
               $fc_peso            = format_decimal($rowl['fc_peso'],0);
               $ca_idt_avaliacao   = $rowl['ca_idt'];
               $ca_nota_periodo    = $rowl['ca_nota'];
               $ca_parecer_periodo = $rowl['ca_parecer_periodo'];
           }
       }
       
       //
       echo "<tr  class='contrato_linha_tr' >  ";
       $classe='contrato_linha_td_a';
       $classer='contrato_linha_td_a_r';
       

       
       echo "   <td class='criterios_contrato_{$idt_contrato}_{$idt_periodo}'  colspan='5' >";
       
       echo "<div style='width:100%; background:#FF0000; text-align:center;'> ";
      // echo " teste ";

       echo "<table class='contrato_tablesssss' style='width:100%; background:#F0F0F0; border-color:#C0C0C0' border='0' cellspacing='0' cellpadding='0' vspace='0' hspace='0'> ";
          //$vet_peso_img[$rowl['foa_peso']]=$rowl['foa_imagem'];
          //$vet_peso_des[$rowl['foa_peso']]=$rowl['foa_descricao'];
          echo "<tr  class='contrato_linha_tr' style='background:#F0F0F0;' >  ";
          //p($kvet_contrato_avaliacao_criterio_idt);
          ForEach ($vet_criterio_resumo as $idx => $criterio)
          {
              echo "   <td class='{$classe}' style='width:25%; background:#F0F0F0; border:0; border-right:2px solid #C0C0C0; border-bottom:4px solid #C0C0C0; text-align:center;'>";
//            echo "<div style='float:left;'>";
              // classificar a Nota geral
              $foa_imagemw    = '';
              $foa_descricaow = '';

              $ca_idt         = $kvet_contrato_avaliacao_criterio_idt [$vet_criterio_idt[$idx]];
              $t_img_p = "img_p_{$ca_idt}";
              if ($kvet_nota_criterio [$vet_criterio_idt[$idx]]=='')
              {
                  $nota_geralw = 0;
              }
              else
              {
                  $nota_geralw = $kvet_nota_criterio [$vet_criterio_idt[$idx]];
              }
              ForEach ($vet_peso_img as $peso => $Imagem) {
                 if ($peso<=$nota_geralw)
                 {
                     $foa_imagemw    =$Imagem;
                     $foa_descricaow =$vet_peso_des[$peso];
                     break;
                 }
              }
              $nota_geralwf=format_decimal($nota_geralw);
              $ed_criterio="<span style='color:#808080; font-weight: bold; font-size:14px;' >{$criterio}</span>";
            //  echo $ed_criterio.'&nbsp;&nbsp;&nbsp;&nbsp;'.$nota_geralwf;
              echo $ed_criterio;
              if ($nota_geralw>1)
              {
                  $qtd_contratos_avaliados=$qtd_contratos_avaliados+1;
              }




              
              $js  = " id = '{$t_img_p}' ";
           //   ImagemProd(21 , 21, $path_l, $foa_imagemw, '', False, $foa_descricaow, $js);
  //          echo "</div>";

    //         echo "<div style='float:left;'>";
             //$foa_imagem    = $vet_peso_img[0];
             //$foa_descricao = $vet_peso_des[0];
             //ImagemProd(16 , 16, $path_l, $foa_imagem, '', false, $foa_descricao);
             
          //   echo $kvet_nota_criterio [$idx];
             
      //       echo "</div>";
           //  echo "</td>";
             
             
           //  echo "   <td class='{$classe}' style='width:100%; text-align:center;'>";

             echo "<table class='contrato_tablesssss' style='width:100%; border-color:#C0C0C0' border='0' cellspacing='0' cellpadding='0' vspace='0' hspace='0'> ";

             echo "<tr  class='contrato_linha_tr' >  ";
             echo "   <td class='{$classe}' style='border:0; background:#F0F0F0; width:100%; text-align:center;'>";
             echo "<div id='legenda_iee' style='text-align:center;'> ";
             
             echo "<table class='contrato_tablesssss' style='width:100%; background:#F0F0F0; border-color:#C0C0C0' border='0' cellspacing='0' cellpadding='0' vspace='0' hspace='0'> ";
             echo "<tr  class='contrato_linha_tr' style='background:#F0F0F0;' >  ";



             ForEach ($vet_peso_imgs as $foa_peso => $foa_imagem)
             {
//                echo "<div id='legenda_iee' style=' float:left;'> ";
                  
                  $js  = " id = '{$t_img_p}' ";
                  
                 // $ca_idt=999999;
                  
                  $descricao = $vet_peso_dess[$foa_peso];

        //        echo "<table class='contrato_tablesssss' style='width:100%; border-color:#C0C0C0' border='1' cellspacing='0' cellpadding='0' vspace='0' hspace='0'> ";
                  echo "   <td class='xx{$classe}' style='border:0; width:20%; background:#F0F0F0; text-align:center;'>";

                  $foa_pesow=format_decimal($foa_peso,0);
                  $t_img_p  = "img_p_{$ca_idt}_$foa_pesow";
                  $idtcrp   = "idtcrp  = '{$ca_idt}'";
                  $pesocrp  = "pesocrp = '{$foa_pesow}'";
                  $fc_pesow = "fc_peso = '{$fc_peso}'";

                  $bg   = $vet_peso_cors[$foa_peso];
                  
                  $fo  =  'border:0; font-family: Arial, Verdana Helvetica, sans-serif; ';


                  
                  $class_c ="class='criterio_{$ca_idt}'";
                  echo  "<a href='#' title='{$descricao}'onclick='return marca_nota({$ca_idt}, {$foa_pesow}, {$idt_contrato}, {$idt_periodo}, {$ca_idt_avaliacao},{$avacontrato});' style='text-decoration:none;' >";
                  if ($nota_geralw!=$foa_peso)
                  {
                      echo  "<div {$class_c} id='{$t_img_p}' {$idtcrp} {$pesocrp}  {$fc_pesow} style=' {$fo} font-size:13px; sbackground:{$bg}; color:#004080;'>".$foa_pesow."</div>";
                  }
                  else
                  {
                      if   ($nota_geralw==0)
                      {
                          echo  "<div {$class_c} id='{$t_img_p}' {$idtcrp} {$pesocrp} {$fc_pesow} style=' {$fo} font-size:13px; sbackground:{$bg}; color:#004080; font-weight: bold;  border:1px solid #666666 ;'>".$foa_pesow."</div>";
                      }
                      else
                      {
                          echo  "<div {$class_c} id='{$t_img_p}' {$idtcrp} {$pesocrp} {$fc_pesow}  style=' {$fo} font-size:13px; sbackground:{$bg}; color:#004080; font-weight: bold;  border:1px solid #666666 ;'>".$foa_pesow."</div>";
                      }

                      if ($foa_peso>1)
                      {
                          $qtd_criterios_avaliados=$qtd_criterios_avaliados+1;
                      }
                      if ($foa_peso<1)
                      {
                          $naoavaliado=$naoavaliado+1;
                      }

                  }
                  echo  "</a>";
             //     $foa_descricao=$vet_peso_dess[$foa_peso];
             //     ImagemProd(16 , 16, $path_l, $foa_imagem, '', false, $foa_descricao);
             
             
             
        //          echo "</div>";
                  echo "</td>";
             }
             echo "</tr>  ";
             echo "</table>";

             
             
             echo "</div>";

             echo "</td>";
             
             echo "</tr>";
             echo "</table>";
             echo "<br />";
             echo "</td>";

          }
          echo "</tr>";

       echo "</table>";

       echo "</div>";


       
       echo "</td> ";
       


       
       // avaliação do periodo
       echo "   <td class='criterios_contrator_{$idt_contrato}_{$idt_periodo}'  colspan='2' style='background:#EBEBEB; border:0; sborder-top:0px solid C0C0C0; margin:0; padding:0; padding-bottom:3px; sborder-bottom:8px solid C0C0C0;'>";
       
       
           echo "<table class='contrato_table' style='width:100%; sborder-color:#C0C0C0' border='0' cellspacing='0' cellpadding='0' vspace='0' hspace='0'> ";
           echo "<tr  class='Vcontrato_linha_tr' >  ";
           echo "   <td class='{$classeV}' style='width:50%; border:0px; font-weight: bold; text-align:center; background:#EBEBEB;'>";
           //echo "<span style='font-size:12px; color:#600000;' >$anomes</span>";
           if ($naoavaliado==0)
           {
         //      echo "<span style='font-size:12px; color:#004080;' >$naoavaliado</span>";
               $idn = 'n_a_'.$ca_idt_avaliacao;
               $n_a  = "<input type='text' id='{$idn}' name='{$idn}' xsize='1' readonly='true'  title='Indica o número de critérios sem avaliação (=0)' value='{$naoavaliado}'  style='width:15px; font-weight: bold; text-align:center; color:#FFFFFF; border:0; background:#004080;'  />";
               echo $n_a;

           }
           else
           {
           //    echo "<span style='font-size:12px; color:#600000;' >$naoavaliado</span>";
               $idn = 'n_a_'.$ca_idt_avaliacao;
               $n_a  = "<input type='text' id='{$idn}' name='{$idn}' xsize='1' readonly='true' title='Indica o número de critérios sem avaliação (=0)' value='{$naoavaliado}'  style='width:15px; font-weight: bold; text-align:center; color:#FFFFFF; border:0; background:#FF0000;'  />";
               echo $n_a;
           }
           
           echo "</td>";
           
           
           echo "   <td class='{$classeV}' style='width:50%; border:0px; font-weight: bold; text-align:center; background:#EBEBEB;'>";

           $idn = 'nota_p_'.$ca_idt_avaliacao;
           //$nota_atuw=$nota_geralw;
           $nota_atuw=format_decimal($ca_nota_periodo,1);
           echo "<div >";

           $t_site  = "<input type='text'  title='Indica a Nota atribuida no periodo ao Contrato(somatorio notas / 4)'  id='{$idn}' name='{$idn}' size='3' readonly='true' value='{$nota_atuw}'  style='font-weight: bold; text-align:right; color:#004080; border:0; background:#D0D0D0;'  />";
           echo $t_site;
           echo "</div>";

           
           echo "</td>";
           
           
           $path_dir='imagens/';
           $foa_imagempw='parecer_contrato.gif';
           $foa_descricaopw='Parecer da Avaliação do Contrato';
           echo "   <td class='{$classe}' style='width:10%; text-align:center; border:0px solid #F0F0F0; background:#EBEBEB;' >";
//           echo '   <a href="#" onclick="return mostra_parecer_contrato('."'".$idt_contrato."'".');" >';
         //  ImagemProd_b64(21 , 21, $path_dir, $foa_imagempw, '', False, $foa_descricaopw);
//           ImagemProd(21 , 21, $path_dir, $foa_imagempw, '', False, $foa_descricaopw);
//           echo '   </a> ';
           
//guy           echo '   <a href="#" onclick="return mostra_parecer_contrato('."'".$idt_contrato."'".');" >';
//guy           ImagemProd(21 , 21, $path_dir, $foa_imagempw, '', False, $foa_descricaopw);
//guy           echo '   </a> ';

           echo "&nbsp;";

           
           echo "</td> ";

           
           
           
           
           echo "</tr>";

           echo "<tr  class='contrato_linha_tr' >  ";
           echo "   <td class='{$classe}' style='width:33%; border:0px; text-align:center; background:#EBEBEB;'>";
           echo "<span style='font-size:11px; color:#600000;' title='Indica a última Nota registrada no periodo ao Contrato(somatorio notas / 4)'>";
          // $fa_descricaop  = $rowl['fa_descricao'];
          // $fa_imagemp     = $rowl['fa_imagem'];
          // ImagemProd(16 , 16, $path_l, $fa_imagemp, '', false, $fa_descricaop);

          // echo $nota_atuw;

           $idn = 'nota_pan_'.$ca_idt_avaliacao;
           //$nota_atuw=$nota_geralw;
          // $nota_atuw=$ca_nota_periodo;
           echo "<div style='height:20px; ' >";
           if ($ca_naoavaliados>0)
           {
               $nota_atuw='';
           }
           $t_site  = "<input type='text'  title='Indica a última Nota registrada no periodo ao Contrato(somatorio notas / 4)'  id='{$idn}' name='{$idn}' size='2' readonly='true' value='{$nota_atuw}'  style=' font-weight: bold; text-align:right; color:#004080; border:0; background:#F2F2F2;'  />";
           echo $t_site;
           echo "</div>";




           echo "</span>";
           echo "</td>";
           
           
           echo "   <td class='{$classe}' style='margin:0; padding:0; width:33%; border:0px; sfont-weight: bold; text-align:center; background:#EBEBEB;'>";

           $btconfirma = "<input type='button' name='btnAcao' value='Salvar' title='Registrar Avaliação do Período'  style='width:50px; height:25px; margin:0; padding:0; smargin-left:10px; cursor: pointer;' onclick='return marca_nota_registro({$idt_contrato}, {$idt_periodo}, {$ca_idt_avaliacao},{$avacontrato});'  />";
           //$btdesiste  = "<input type='button' value='Desistir' name='btdesiste' id='btdesiste' style='width:150px; height:25px; margin-left:10px; cursor: pointer;'  onclick='javascript:top.close();'  />";
           echo "<table class='contrato_table' width='100%' border='0' cellspacing='0' cellpadding='0' vspace='0' hspace='0'> ";
           echo "<tr  class='contrato_linha_tr' >  ";
        //   echo "   <td class='{$classe}' colspan='2' style='color:#B00000; background:#E5E5E5; font-weight: bold; font-size:14px; text-align:right;' >&nbsp;</td> ";
           echo "   <td class='{$classe}' style='color:#B00000; background:#E5E5E5; sfont-weight: bold; font-size:9px; text-align:center; margin:0; padding:0;' >&nbsp;&nbsp;{$btconfirma}</td> ";
           echo "</tr>  ";
           echo "</table>";
           echo "</td>  ";


           $path_dir='imagens/';
           $foa_imagempw='parecer_periodo.gif';
           $foa_descricaopw='Parecer da Avaliação do Período do Contrato';
           echo "   <td class='{$classe}' style='text-align:center; border:0px solid #F0F0F0; background:#EBEBEB;' >";
           echo '   <a href="#" onclick="return mostra_parecer_periodo_av('."'".$ca_idt_avaliacao."'".');" >';
          // ImagemProd_b64(21 , 21, $path_dir, $foa_imagempw, '', False, $foa_descricaopw);
           ImagemProd(21 , 21, $path_dir, $foa_imagempw, '', False, $foa_descricaopw);
           echo '   </a> ';
           echo "</td> ";

           echo "</tr>";

           
           
           
           


           
           echo "</td>";
           echo "</tr>";
           echo "</table> ";

       echo "</td> ";
       
       echo "</tr>";

    // parecer contrato

    echo "<tr  id='parecer_contrato_dpc{$idt_contrato}' class='xxcontrato_linha_tr' style='display:none;' >  ";
    echo "<td class='vvv{$classe}' colspan='2' style='font-size:12px; background:#F2F2F2; text-align:right; padding-right:5px;  border-bottom:2px solid #666666;' >";
    echo  "Parecer Contrato: ";
    echo "</td> ";

    echo "<td class='vvv{$classe}' colspan='5' style='background:#F2F2F2; padding-left:5px;  border-bottom:2px solid #666666;' >";
    if ($co_parecer_contrato=='')
    {
      //  echo  " CONTRATO SEM PARECER ";
        $co_parecer_contrato=" CONTRATO SEM PARECER ";
    }
    $idta="idpaav_c{$idt_contrato}";
    
    $ronlyw=" enabled:true; ";
    $jsw=" readonly='readonly' ";

    if ($avacontrato==1)
    {
        $ronlyw='';
        $jsw="";
    }
    echo "<textarea id='".$idta."' rows='2' style='width:98%; $ronlyw ' ".$jsw.">";

    
   // echo '<textarea id="'.$idta.'" rows="2" style="width:98%;">';
    echo  $co_parecer_contrato;
    echo '</textarea>';


    if ($avacontrato==1)
    {
        $btconfirma = "<input type='button' name='btnAcao' value='Registrar Parecer' title='Registrar Parecer da Avaliação do Período do Contrato'  style='width:150px; height:25px; margin-left:10px; cursor: pointer;' onclick='return registra_parecer_contrato(".$idt_contrato.");'  />";
        echo "<table class='xxcontrato_table' width='100%' border='0' cellspacing='0' cellpadding='0' vspace='0' hspace='0'> ";
        echo "  <tr  class='xxcontrato_linha_tr' >  ";
        echo "    <td class='xx{$classe}' colspan='2' style='color:#B00000; background:#F2F2F2; font-weight: bold; font-size:14px; text-align:right;' >&nbsp;</td> ";
        echo "    <td class='xx{$classe}' colspan='3' style='color:#B00000; background:#F2F2F2; font-weight: bold; font-size:14px; text-align:center;' >{$btconfirma}<br /><br /></td> ";
        echo "  </tr>  ";
        echo "</table>";
    }
        
    echo "</td> ";
    echo "</tr>";




    // parecer periodo
       
    echo "<tr  id='parecer_contrato_dp{$ca_idt_avaliacao}' class='xxcontrato_linha_tr' style='display:none;' >  ";
    echo "<td class='vvv{$classe}' colspan='2' style='font-size:12px; background:#F2F2F2; text-align:right; padding-right:5px;  border-bottom:2px solid #666666;' >";
    echo  "Parecer Periodo: ";
    echo "</td> ";
    
    echo "<td class='vvv{$classe}' colspan='5' style='background:#F2F2F2; padding-left:5px;  border-bottom:2px solid #666666;' >";
    if ($ca_parecer_periodo=='')
    {
       // echo  " PERIODO AVALIAÇÃO CONTRATO SEM PARECER";
       $ca_parecer_periodo=" PERIODO AVALIAÇÃO CONTRATO SEM PARECER";
    }
    $idta="idpaav_{$ca_idt_avaliacao}";
    
    $ronlyw=" enabled:true; ";
    $jsw=" readonly='readonly' ";

    if ($avacontrato==1)
    {
        $ronlyw='';
        $jsw="";
    }
    echo "<textarea id='".$idta."' rows='2' style='width:98%; $ronlyw ' ".$jsw.">";

    
//    echo '<textarea id="'.$idta.'" rows="2" style="width:98%;">';
    echo  $ca_parecer_periodo;
    echo '</textarea>';

    if ($avacontrato==1)
    {
        $btfechar   = "<input type='button' name='btnFechar' value='Fechar' title='Fechar Registrar Parecer da Avaliação do Período do Contrato'  style='width:150px; height:25px; margin-left:10px; cursor: pointer;' onclick='return mostra_parecer_periodo_av(".$ca_idt_avaliacao.");'   />";
        $btconfirma = "<input type='button' name='btnAcao' value='Registrar Parecer' title='Registrar Parecer da Avaliação do Período do Contrato'  style='width:150px; height:25px; margin-left:10px; cursor: pointer;' onclick='return registra_parecer_avaliacao(".$ca_idt_avaliacao.");'  />";
        echo "<table class='xxcontrato_table' width='100%' border='0' cellspacing='0' cellpadding='0' vspace='0' hspace='0'> ";
        echo "  <tr  class='xxcontrato_linha_tr' >  ";
        echo "    <td class='xx{$classe}' colspan='2' style='color:#B00000; background:#F2F2F2; font-weight: bold; font-size:14px; text-align:right;' >&nbsp;</td> ";
        echo "    <td class='xx{$classe}' colspan='3' style='color:#B00000; background:#F2F2F2; font-weight: bold; font-size:14px; text-align:center;' >{$btconfirma}{$btfechar}<br /><br /></td> ";
        echo "  </tr>  ";
        echo "</table>";
    }
    echo "</td> ";
    echo "</tr>";

   } // fim de impressão de pagina
   else
   {
   }



       $separa='';
       $oi_descricao_ac='';
       $oi_descricao_ac_r='';
   }
   $em_idt             = $row['em_idt'];
   $em_descricao       = $row['em_descricao'];
   $idt_contrato       = $row['co_idt'];
   $idt_fornecedor     = $row['co_idt_fornecedor'];
   $co_numero          = $row['co_numero'];
   $fo_razao_social    = $row['fo_razao_social'];
   $fo_fantasia        = $row['fo_fantasia'];
   $oi_descricao       = $row['oi_descricao'];
   $cs_descricao       = $row['cs_descricao'];
   $co_valor_contrato  = format_decimal($row['co_valor_contrato']);
   $co_valor_contrato_v= $row['co_valor_contrato'];
   $co_valor_aditivo   = format_decimal($row['co_valor_aditivo']);
   $co_valor_aditivo_v = $row['co_valor_aditivo'];
   $co_valor_pago      = format_decimal($row['co_valor_pago']);
   $co_valor_pago_v    = $row['co_valor_pago'];
   $oi_descricao       = $oi_descricao.' - '.$cs_descricao;
   $oi_descricao_ac    = $oi_descricao_ac.$separa.$oi_descricao;
   if ($oi_descricao_ac_r=='')
   {
       $oi_descricao_ac_r=substr($oi_descricao,0,19);
   }
   $cst_imagem         = $row['cst_imagem'];
   $cst_descricao      = $row['cst_descricao'];


   $csi_imagem         = $row['csi_imagem'];
   $csi_descricao      = $row['csi_descricao'];

   
   $co_nota            = $row['co_nota'];
   $foa_descricao      = $row['foa_descricao'];
   $foa_imagem         = $row['foa_imagem'];

   $co_parecer_contrato = $row['co_parecer_contrato'];
//   $ca_idt_avaliacao   = $row['ca_idt_avaliacao'];
   $ca_naoavaliados     = $row['ca_naoavaliados'];
   
   $separa='<br>';

}


       $pg_lin    = $pg_lin+1;
       $pg_resto  = ($pg_lin % $qt_linpg);
       $pg_int    = floor($pg_lin/$qt_linpg);
       if ($pg_resto!=0)
       {
           $pg_int=$pg_int+1;
       }
       
       
              $qtd_contratos=$qtd_contratos+1;
       if ($ca_naoavaliados==0)
       {
           $qtd_contratos_av=$qtd_contratos_av+1;
       }

      // echo ' ppppppp '.$pg_int;
if ($pg_int==$pg_posicao)
{



if ($idt_contrato!=0)
{
      echo "<tr  class='contrato_linha_tr' >  ";
       $classe='contrato_linha_td_a';
       $classer='contrato_linha_td_a_r';


       echo "   <td class='{$classe}' >";
         echo "&nbsp;&nbsp;";
     //    ImagemProd_b64(16 , 16, $paths, $csi_imagem, '', False, $csi_descricao);
       ImagemProd(16 , 16, $paths, $csi_imagem, '', False, $csi_descricao);
       echo "</td> ";

//       $qtd_contratos=$qtd_contratos+1;
//       if ($ca_naoavaliados==0)
//       {
//           $qtd_contratos_av=$qtd_contratos_av+1;
//       }





//       echo "   <td class='{$classe}' >".$em_descricao."</td> ";


       $href='<a href="#" onclick="mostra_contrato('."'".$idt_contrato."'".');" >'.$co_numero.'</a>';
       $co_numero_e=$href;
       echo "   <td class='{$classer}' style='width:80px; sfont-size: 11px;' >".$co_numero_e."</td> ";
       $tam = strlen($fo_razao_social);
       if ($tam>23)
       {
           $titw    = substr($fo_razao_social,0,23).'...';
           $titlew  = $fo_razao_social;
           $cursor  ="cursor:pointer;";
       }
       else
       {
           $titw=$fo_razao_social;
           $titlew  = '';
           $cursor  = '';
       }
       echo "   <td class='{$classe}' style='width:200px;' >"."<span style='{$cursor}' title='$titlew'>".$titw."</span></td> ";

       echo "   <td class='{$classe}' style='width:150px;'>";

 //    $tam = strlen($oi_descricao_ac_r);
       $is=$is+1;
       $id = 'servico_'.$is;
       $link2="<a href='#' style='color:#004080; text-decoration:none; cursor:pointer;' onclick='return abre_servico(".'"'.$id.'"'.")'>{$oi_descricao_ac_r}...</a>";
       $link1="<a href='#' style='color:#004080; text-decoration:none; cursor:pointer;' onclick='return abre_servico(".'"'.$id.'"'.")'><img onclick='desativa_contrato_edoc();' src='imagens/mais_menu.gif' border='0'></a>";

     //  $ajusta_txt=$link1. ' '. $link2;
       $ajusta_txt = $link2;
       echo $ajusta_txt;

       echo "<div id='{$id}' style='display:none'>";
       echo $oi_descricao_ac;
       echo "</div>";
       echo "</td> ";



       $saldo = ($co_valor_contrato_v + $co_valor_aditivo_v) - $co_valor_pago_v;


       $saldo_e = format_decimal($saldo);

       echo "   <td class='{$classer}' >".$co_valor_contrato."</td> ";

       if ($co_valor_aditivo_v>0)
       {
           $href='<a href="#" onclick="mostra_aditivo('."'".$idt_contrato."'".');" >'.$co_valor_aditivo.'</a>';
           $co_valor_aditivo_e=$href;
       }
       else
       {
           $co_valor_aditivo_e=$co_valor_aditivo;
       }
       echo "   <td class='{$classer}' >".$co_valor_aditivo_e."</td> ";
  //     echo "   <td class='{$classer}' >".$co_valor_pago."</td> ";
  //     echo "   <td class='{$classer}' >".$saldo_e."</td> ";

//       echo "   <td class='{$classe}' >";
//         echo "&nbsp;&nbsp;";
//         ImagemProd(21 , 21, $path, $cst_imagem, $cst_descricao);
//       echo "</td> ";


// $imagedata = file_get_contents("/path/to/image.jpg");
// alternatively specify an URL, if PHP settings allow
// $base64 = base64_encode($imagedata);
// <img src="data:image/gif;base64,' . base64_decode($imagedata) . '" />


       echo "   <td class='{$classe}' style='text-align:center;'>";
//         echo '   <a href="#" onclick="mostra_avaliacao('."'".$idt_fornecedor."'".');" >';
         echo '   <a href="#" onclick="return mostra_criterios('."'".$idt_fornecedor."',"."'".$idt_contrato."');".'" >';
   //      ImagemProd_b64(16 , 16, $patha, $foa_imagem, '', False, $foa_descricao);
         ImagemProd(16 , 16, $patha, $foa_imagem, '', False, $foa_descricao);
         echo '   </a> ';
       echo "</td> ";




       echo "</tr>";


       $naoavaliado=0;
       //
       // Aqui vai a parte da avaliação
       //
       // Carregar avaliações do periodo escolhido
       //

       // contrato_avaliacao_criterio
       $sqll   = 'select ';
       $sqll  .= '  cac.idt            as cac_idt, ';
       $sqll  .= '  cac.idt_criterio   as cac_idt_criterio,   ';
       $sqll  .= '  cac.nota           as cac_nota,   ';
       $sqll  .= '  fc.codigo          as fc_codigo,   ';
       $sqll  .= '  fc.peso            as fc_peso,   ';
       $sqll  .= '  fc.descricao       as fc_descricao,   ';
       $sqll  .= '  ca.idt             as ca_idt,   ';
       $sqll  .= '  ca.idt_periodo     as ca_idt_periodo,   ';
       $sqll  .= '  ca.idt_avaliacao   as ca_idt_avaliacao,   ';
       $sqll  .= '  ca.nota            as ca_nota,   ';
       $sqll  .= '  ca.parecer_periodo as ca_parecer_periodo,   ';
       $sqll  .= '  fa.imagem          as fa_imagem,   ';
       $sqll  .= '  fa.descricao       as fa_descricao   ';

       $sqll  .= '  from contrato_avaliacao_criterio cac ';
       $sqll  .= '  left join contrato_avaliacao ca on ca.idt = cac.idt_contrato_avaliacao';
       $sqll  .= '  left join fornecedor_criterio fc on fc.idt = cac.idt_criterio';
       $sqll  .= '  left join fornecedor_avaliacao fa on fa.idt = ca.idt_avaliacao';
       $sqll  .= '  where ca.idt_contrato = '.null($idt_contrato);
       $sqll  .= '    and ca.idt_periodo  = '.null($idt_periodo);
       $sqll  .= '  order by fc.codigo ';
       $rsl = execsql($sqll);
       // para os critérios indicar o escolhido

       $kvet_nota_criterio                            = Array();
       $kvet_peso_criterio                            = Array();
       $kvet_contrato_avaliacao_criterio_idt          = Array();
       $kvet_contrato_avaliacao_criterio_idt_criterio = Array();
       $fc_peso = 0;
       $ca_idt_avaliacao = 0;

       $ca_nota_periodo = 0;

       ForEach($rsl->data as $rowl) {
           $cac_idt_criterio = $rowl['cac_idt_criterio'];
           $kvet_contrato_avaliacao_criterio_idt         [$cac_idt_criterio]  = $rowl['cac_idt'];
           $kvet_contrato_avaliacao_criterio_idt_criterio[$cac_idt_criterio]  = $rowl['cac_idt_criterio'];
           if ($rowl['cac_nota']<1 )
           {
                $rowl['cac_nota']   = 0;
           }
           else
           {
           }
           $kvet_nota_criterio [$cac_idt_criterio] = $rowl['cac_nota'];
           $kvet_peso_criterio [$cac_idt_criterio] = $rowl['fc_peso'];
           if ($rowl['fc_peso']>0)
           {
               $fc_peso            = format_decimal($rowl['fc_peso'],0);
               $ca_idt_avaliacao   = $rowl['ca_idt'];
               $ca_nota_periodo    = $rowl['ca_nota'];
               $ca_parecer_periodo = $rowl['ca_parecer_periodo'];
           }
       }

       //
       echo "<tr  class='contrato_linha_tr' >  ";
       $classe='contrato_linha_td_a';
       $classer='contrato_linha_td_a_r';



       echo "   <td class='criterios_contrato_{$idt_contrato}_{$idt_periodo}'  colspan='5' >";

       echo "<div style='width:100%; background:#FF0000; text-align:center;'> ";
      // echo " teste ";

       echo "<table class='contrato_tablesssss' style='width:100%; background:#F0F0F0; border-color:#C0C0C0' border='0' cellspacing='0' cellpadding='0' vspace='0' hspace='0'> ";
          //$vet_peso_img[$rowl['foa_peso']]=$rowl['foa_imagem'];
          //$vet_peso_des[$rowl['foa_peso']]=$rowl['foa_descricao'];
          echo "<tr  class='contrato_linha_tr' style='background:#F0F0F0;' >  ";
          //p($kvet_contrato_avaliacao_criterio_idt);
          ForEach ($vet_criterio_resumo as $idx => $criterio)
          {
              echo "   <td class='{$classe}' style='width:25%; background:#F0F0F0; border:0; border-right:2px solid #C0C0C0; border-bottom:4px solid #C0C0C0; text-align:center;'>";
//            echo "<div style='float:left;'>";
              // classificar a Nota geral
              $foa_imagemw    = '';
              $foa_descricaow = '';

              $ca_idt         = $kvet_contrato_avaliacao_criterio_idt [$vet_criterio_idt[$idx]];
              $t_img_p = "img_p_{$ca_idt}";
              if ($kvet_nota_criterio [$vet_criterio_idt[$idx]]=='')
              {
                  $nota_geralw = 0;
              }
              else
              {
                  $nota_geralw = $kvet_nota_criterio [$vet_criterio_idt[$idx]];
              }
              ForEach ($vet_peso_img as $peso => $Imagem) {
                 if ($peso<=$nota_geralw)
                 {
                     $foa_imagemw    =$Imagem;
                     $foa_descricaow =$vet_peso_des[$peso];
                     break;
                 }
              }
              $nota_geralwf=format_decimal($nota_geralw);
              $ed_criterio="<span style='color:#808080; font-weight: bold; font-size:14px;' >{$criterio}</span>";
            //  echo $ed_criterio.'&nbsp;&nbsp;&nbsp;&nbsp;'.$nota_geralwf;
              echo $ed_criterio;
              if ($nota_geralw>1)
              {
                  $qtd_contratos_avaliados=$qtd_contratos_avaliados+1;
              }





              $js  = " id = '{$t_img_p}' ";
           //   ImagemProd(21 , 21, $path_l, $foa_imagemw, '', False, $foa_descricaow, $js);
  //          echo "</div>";

    //         echo "<div style='float:left;'>";
             //$foa_imagem    = $vet_peso_img[0];
             //$foa_descricao = $vet_peso_des[0];
             //ImagemProd(16 , 16, $path_l, $foa_imagem, '', false, $foa_descricao);

          //   echo $kvet_nota_criterio [$idx];

      //       echo "</div>";
           //  echo "</td>";


           //  echo "   <td class='{$classe}' style='width:100%; text-align:center;'>";

             echo "<table class='contrato_tablesssss' style='width:100%; border-color:#C0C0C0' border='0' cellspacing='0' cellpadding='0' vspace='0' hspace='0'> ";

             echo "<tr  class='contrato_linha_tr' >  ";
             echo "   <td class='{$classe}' style='border:0; background:#F0F0F0; width:100%; text-align:center;'>";
             echo "<div id='legenda_iee' style='text-align:center;'> ";

             echo "<table class='contrato_tablesssss' style='width:100%; background:#F0F0F0; border-color:#C0C0C0' border='0' cellspacing='0' cellpadding='0' vspace='0' hspace='0'> ";
             echo "<tr  class='contrato_linha_tr' style='background:#F0F0F0;' >  ";



             ForEach ($vet_peso_imgs as $foa_peso => $foa_imagem)
             {
//                echo "<div id='legenda_iee' style=' float:left;'> ";

                  $js  = " id = '{$t_img_p}' ";

                 // $ca_idt=999999;

                  $descricao = $vet_peso_dess[$foa_peso];

        //        echo "<table class='contrato_tablesssss' style='width:100%; border-color:#C0C0C0' border='1' cellspacing='0' cellpadding='0' vspace='0' hspace='0'> ";
                  echo "   <td class='xx{$classe}' style='border:0; width:20%; background:#F0F0F0; text-align:center;'>";

                  $foa_pesow=format_decimal($foa_peso,0);
                  $t_img_p  = "img_p_{$ca_idt}_$foa_pesow";
                  $idtcrp   = "idtcrp  = '{$ca_idt}'";
                  $pesocrp  = "pesocrp = '{$foa_pesow}'";
                  $fc_pesow = "fc_peso = '{$fc_peso}'";

                  $bg   = $vet_peso_cors[$foa_peso];

                  $fo  =  'border:0; font-family: Arial, Verdana Helvetica, sans-serif; ';



                  $class_c ="class='criterio_{$ca_idt}'";
                  echo  "<a href='#' title='{$descricao}'onclick='return marca_nota({$ca_idt}, {$foa_pesow}, {$idt_contrato}, {$idt_periodo}, {$ca_idt_avaliacao},{$avacontrato});' style='text-decoration:none;' >";
                  if ($nota_geralw!=$foa_peso)
                  {
                      echo  "<div {$class_c} id='{$t_img_p}' {$idtcrp} {$pesocrp}  {$fc_pesow} style=' {$fo} font-size:13px; sbackground:{$bg}; color:#004080;'>".$foa_pesow."</div>";
                  }
                  else
                  {
                      if   ($nota_geralw==0)
                      {
                          echo  "<div {$class_c} id='{$t_img_p}' {$idtcrp} {$pesocrp} {$fc_pesow} style=' {$fo} font-size:13px; sbackground:{$bg}; color:#004080; font-weight: bold;  border:1px solid #666666 ;'>".$foa_pesow."</div>";
                      }
                      else
                      {
                          echo  "<div {$class_c} id='{$t_img_p}' {$idtcrp} {$pesocrp} {$fc_pesow}  style=' {$fo} font-size:13px; sbackground:{$bg}; color:#004080; font-weight: bold;  border:1px solid #666666 ;'>".$foa_pesow."</div>";
                      }

                      if ($foa_peso>1)
                      {
                          $qtd_criterios_avaliados=$qtd_criterios_avaliados+1;
                      }
                      if ($foa_peso<1)
                      {
                          $naoavaliado=$naoavaliado+1;
                      }

                  }
                  echo  "</a>";
             //     $foa_descricao=$vet_peso_dess[$foa_peso];
             //     ImagemProd(16 , 16, $path_l, $foa_imagem, '', false, $foa_descricao);



        //          echo "</div>";
                  echo "</td>";
             }
             echo "</tr>  ";
             echo "</table>";



             echo "</div>";

             echo "</td>";

             echo "</tr>";
             echo "</table>";
             echo "<br />";
             echo "</td>";

          }
          echo "</tr>";

       echo "</table>";

       echo "</div>";



       echo "</td> ";




       // avaliação do periodo
       echo "   <td class='criterios_contrator_{$idt_contrato}_{$idt_periodo}'  colspan='2' style='background:#EBEBEB; border:0; border-right:2px solid #C0C0C0; border-bottom:4px solid #C0C0C0;'>";
       
           echo "<table class='contrato_tablesssss' style='width:100%; border-color:#C0C0C0' border='0' cellspacing='0' cellpadding='0' vspace='0' hspace='0'> ";
           echo "<tr  class='contrato_linha_tr' >  ";
           echo "   <td class='{$classe}' style='width:50%; border:0px; font-weight: bold; text-align:center; background:#EBEBEB;'>";
           //echo "<span style='font-size:12px; color:#600000;' >$anomes</span>";
           if ($naoavaliado==0)
           {
         //      echo "<span style='font-size:12px; color:#004080;' >$naoavaliado</span>";
               $idn = 'n_a_'.$ca_idt_avaliacao;
               $n_a  = "<input type='text' id='{$idn}' name='{$idn}' xsize='1' readonly='true'  title='Indica o número de critérios sem avaliação (=0)' value='{$naoavaliado}'  style='width:15px; font-weight: bold; text-align:center; color:#FFFFFF; border:0; background:#004080;'  />";
               echo $n_a;

           }
           else
           {
           //    echo "<span style='font-size:12px; color:#600000;' >$naoavaliado</span>";
               $idn = 'n_a_'.$ca_idt_avaliacao;
               $n_a  = "<input type='text' id='{$idn}' name='{$idn}' xsize='1' readonly='true' title='Indica o número de critérios sem avaliação (=0)' value='{$naoavaliado}'  style='width:15px; font-weight: bold; text-align:center; color:#FFFFFF; border:0; background:#FF0000;'  />";
               echo $n_a;
           }

           echo "</td>";


           echo "   <td class='{$classe}' style='width:50%; border:0px; font-weight: bold; text-align:center; background:#EBEBEB;'>";

           $idn = 'nota_p_'.$ca_idt_avaliacao;
           //$nota_atuw=$nota_geralw;
           $nota_atuw=$ca_nota_periodo;
           echo "<div >";

           $t_site  = "<input type='text'  title='Indica a Nota atribuida no periodo ao Contrato(somatorio notas / 4)'  id='{$idn}' name='{$idn}' size='2' readonly='true' value='{$nota_atuw}'  style='font-weight: bold; text-align:right; color:#004080; border:0; background:#D0D0D0;'  />";
           echo $t_site;
           echo "</div>";


           echo "</td>";


           $path_dir='imagens/';
           $foa_imagempw='parecer_contrato.gif';
           $foa_descricaopw='Parecer da Avaliação do Contrato';
           echo "   <td class='{$classe}' style='width:10%; text-align:center; border:0px solid #F0F0F0; background:#EBEBEB;' >";
//guy           echo '   <a href="#" onclick="return mostra_parecer_contrato('."'".$idt_contrato."'".');" >';
//guy           ImagemProd(21 , 21, $path_dir, $foa_imagempw, '', False, $foa_descricaopw);
//guy           echo '   </a> ';

           echo "&nbsp;";
           echo "</td> ";





           echo "</tr>";

           echo "<tr  class='contrato_linha_tr' >  ";
           echo "   <td class='{$classe}' style='width:33%; border:0px; text-align:center; background:#EBEBEB;'>";
           echo "<span style='font-size:12px; color:#600000;' title='Indica a última Nota registrada no periodo ao Contrato(somatorio notas / 4)'>";
          // $fa_descricaop  = $rowl['fa_descricao'];
          // $fa_imagemp     = $rowl['fa_imagem'];
          // ImagemProd(16 , 16, $path_l, $fa_imagemp, '', false, $fa_descricaop);

          // echo $nota_atuw;

           $idn = 'nota_pan_'.$ca_idt_avaliacao;
           //$nota_atuw=$nota_geralw;
          // $nota_atuw=$ca_nota_periodo;
           echo "<div >";
           $t_site  = "<input type='text'  title='Indica a última Nota registrada no periodo ao Contrato(somatorio notas / 4)'  id='{$idn}' name='{$idn}' size='3' readonly='true' value='{$nota_atuw}'  style='font-weight: bold; text-align:right; color:#004080; border:0; background:#F2F2F2;'  />";
           echo $t_site;
           echo "</div>";




           echo "</span>";
           echo "</td>";


           echo "   <td class='{$classe}' style='width:33%; border:0px; sfont-weight: bold; text-align:center; background:#EBEBEB;'>";

           $btconfirma = "<input type='button' name='btnAcao' value='Salvar' title='Registrar Avaliação do Período'  style='width:50px; height:25px; margin:0; padding:0; smargin-left:10px; cursor: pointer;' onclick='return marca_nota_registro({$idt_contrato}, {$idt_periodo}, {$ca_idt_avaliacao},{$avacontrato});'  />";
           //$btdesiste  = "<input type='button' value='Desistir' name='btdesiste' id='btdesiste' style='width:150px; height:25px; margin-left:10px; cursor: pointer;'  onclick='javascript:top.close();'  />";
           echo "<table class='contrato_table' width='100%' border='0' cellspacing='0' cellpadding='0' vspace='0' hspace='0'> ";
           echo "<tr  class='contrato_linha_tr' >  ";
        //   echo "   <td class='{$classe}' colspan='2' style='color:#B00000; background:#E5E5E5; font-weight: bold; font-size:14px; text-align:right;' >&nbsp;</td> ";
           echo "   <td class='{$classe}' style='color:#B00000; background:#E5E5E5; sfont-weight: bold; font-size:9px; text-align:center; margin:0; padding:0;' >{$btconfirma}</td> ";
           echo "</tr>  ";
           echo "</table>";
           echo "</td>  ";


           $path_dir='imagens/';
           $foa_imagempw='parecer_periodo.gif';
           $foa_descricaopw='Parecer da Avaliação do Período do Contrato';
           echo "   <td class='{$classe}' style='text-align:center; sborder:1px solid #F0F0F0; background:#EBEBEB;' >";
           echo '   <a href="#" onclick="return mostra_parecer_periodo_av('."'".$ca_idt_avaliacao."'".');" >';
           ImagemProd(21 , 21, $path_dir, $foa_imagempw, '', False, $foa_descricaopw);
           echo '   </a> ';
           
           

           
           echo "</td> ";

           echo "</tr>";








           echo "</td>";
           echo "</tr>";
           echo "</table> ";

       echo "</td> ";

       echo "</tr>";

    // parecer contrato

    echo "<tr  id='parecer_contrato_dpc{$idt_contrato}' class='xxcontrato_linha_tr' style='display:none;' >  ";
    echo "<td class='vvv{$classe}' colspan='2' style='font-size:12px; background:#F2F2F2; text-align:right; padding-right:5px;  border-bottom:2px solid #666666;' >";
    echo  "Parecer Contrato: ";
    echo "</td> ";

    echo "<td class='vvv{$classe}' colspan='5' style='background:#F2F2F2; padding-left:5px;  border-bottom:2px solid #666666;' >";
    if ($co_parecer_contrato=='')
    {
        echo  " CONTRATO SEM PARECER ";
        $co_parecer_contrato=" CONTRATO SEM PARECER ";
    }
    $idta="idpaav_c{$idt_contrato}";
    
    $ronlyw=" enabled:true; ";
    $jsw=" readonly='readonly' ";

    if ($avacontrato==1)
    {
        $ronlyw='';
        $jsw="";
    }
    echo "<textarea id='".$idta."' rows='2' style='width:98%; $ronlyw ' ".$jsw.">";

    
//    echo '<textarea id="'.$idta.'" rows="2" style="width:98%;">';
    echo  $co_parecer_contrato;
    echo '</textarea>';
    
    
    if ($avacontrato==1)
    {
        $btconfirma = "<input type='button' name='btnAcao' value='Registrar Parecer' title='Registrar Parecer da Avaliação do Período do Contrato'  style='width:150px; height:25px; margin-left:10px; cursor: pointer;' onclick='return registra_parecer_contrato(".$idt_contrato.");'  />";
        echo "<table class='xxcontrato_table' width='100%' border='0' cellspacing='0' cellpadding='0' vspace='0' hspace='0'> ";
        echo "  <tr  class='xxcontrato_linha_tr' >  ";
        echo "    <td class='xx{$classe}' colspan='2' style='color:#B00000; background:#F2F2F2; font-weight: bold; font-size:14px; text-align:right;' >&nbsp;</td> ";
        echo "    <td class='xx{$classe}' colspan='3' style='color:#B00000; background:#F2F2F2; font-weight: bold; font-size:14px; text-align:center;' >{$btconfirma}<br /><br /></td> ";
        echo "  </tr>  ";
        echo "</table>";
    }
    echo "</td> ";
    echo "</tr>";




    // parecer periodo

    echo "<tr  id='parecer_contrato_dp{$ca_idt_avaliacao}' class='xxcontrato_linha_tr' style='display:none;' >  ";
    echo "<td class='vvv{$classe}' colspan='2' style='font-size:12px; background:#F2F2F2; text-align:right; padding-right:5px;  border-bottom:2px solid #666666;' >";
    echo  "Parecer Periodo: ";
    echo "</td> ";

    echo "<td class='vvv{$classe}' colspan='5' style='background:#F2F2F2; padding-left:5px;  border-bottom:2px solid #666666;' >";
    if ($ca_parecer_periodo=='')
    {
       // echo  " PERIODO AVALIAÇÃO CONTRATO SEM PARECER";
       $ca_parecer_periodo=" PERIODO AVALIAÇÃO CONTRATO SEM PARECER";
    }
    $idta="idpaav_{$ca_idt_avaliacao}";
    
    $ronlyw=" enabled:true; ";
    $jsw=" readonly='readonly' ";

    if ($avacontrato==1)
    {
        $ronlyw='';
        $jsw="";
    }
    echo "<textarea id='".$idta."' rows='2' style='width:98%; $ronlyw ' ".$jsw.">";

//    echo '<textarea id="'.$idta.'" rows="2" style="width:98%;">';
    echo  $ca_parecer_periodo;
    echo '</textarea>';
    
    if ($avacontrato==1)
    {

        $btfechar   = "<input type='button' name='btnFechar' value='Fechar' title='Fechar Registrar Parecer da Avaliação do Período do Contrato'  style='width:150px; height:25px; margin-left:10px; cursor: pointer;' onclick='return mostra_parecer_periodo_av(".$ca_idt_avaliacao.");'   />";
        $btconfirma = "<input type='button' name='btnAcao' value='Registrar Parecer' title='Registrar Parecer da Avaliação do Período do Contrato'  style='width:150px; height:25px; margin-left:10px; cursor: pointer;' onclick='return registra_parecer_avaliacao(".$ca_idt_avaliacao.");'  />";
        echo "<table class='xxcontrato_table' width='100%' border='0' cellspacing='0' cellpadding='0' vspace='0' hspace='0'> ";
        echo "  <tr  class='xxcontrato_linha_tr' >  ";
        echo "    <td class='xx{$classe}' colspan='2' style='color:#B00000; background:#F2F2F2; font-weight: bold; font-size:14px; text-align:right;' >&nbsp;</td> ";
        echo "    <td class='xx{$classe}' colspan='3' style='color:#B00000; background:#F2F2F2; font-weight: bold; font-size:14px; text-align:center;' >{$btconfirma}{$btfechar}<br /><br /></td> ";
        echo "  </tr>  ";
        echo "</table>";
    }
    echo "</td> ";
    echo "</tr>";

/*
       echo "<tr  class='contrato_linha_tr' >  ";
       $classe='contrato_linha_td_a';
       $classer='contrato_linha_td_a_r';
       
       
       echo "   <td class='{$classe}' >";
         echo "&nbsp;&nbsp;";
         ImagemProd(16 , 16, $paths, $csi_imagem, '', False, $csi_descricao);
       echo "</td> ";

    //   echo "   <td class='{$classe}' >".$em_descricao."</td> ";
       
       
       $href='<a href="#" onclick="mostra_contrato('."'".$idt_contrato."'".');" >'.$co_numero.'</a>';
       $co_numero_e=$href;
       echo "   <td class='{$classer}' >".$co_numero_e."</td> ";

       
//       echo "   <td class='{$classe}' >".$co_numero."</td> ";
       echo "   <td class='{$classe}' >".$fo_razao_social."</td> ";
//       echo "   <td class='{$classe}' >".$oi_descricao_ac."</td> ";
       echo "   <td class='{$classe}' style='width:150px;'>";

 //    $tam = strlen($oi_descricao_ac_r);
       $is=$is+1;
       $id = 'servico_'.$is;
       $link2="<a href='#' style='color:#004080; text-decoration:none; cursor:pointer;' onclick='return abre_servico(".'"'.$id.'"'.")'>{$oi_descricao_ac_r}...</a>";
       $link1="<a href='#' style='color:#004080; text-decoration:none; cursor:pointer;' onclick='return abre_servico(".'"'.$id.'"'.")'><img onclick='desativa_contrato_edoc();' src='imagens/mais_menu.gif' border='0'></a>";

     //  $ajusta_txt=$link1. ' '. $link2;
       $ajusta_txt = $link2;
       echo $ajusta_txt;

       echo "<div id='{$id}' style='display:none'>";
       echo $oi_descricao_ac;
       echo "</div>";
       echo "</td> ";

       $saldo = ($co_valor_contrato_v + $co_valor_aditivo_v) - $co_valor_pago_v;


       $saldo_e = format_decimal($saldo);

       echo "   <td class='{$classer}' >".$co_valor_contrato."</td> ";

       if ($co_valor_aditivo_v>0)
       {
           $href='<a href="#" onclick="mostra_aditivo('."'".$idt_contrato."'".');" >'.$co_valor_aditivo.'</a>';
           $co_valor_aditivo_e=$href;
       }
       else
       {
           $co_valor_aditivo_e=$co_valor_aditivo;
       }
       echo "   <td class='{$classer}' >".$co_valor_aditivo_e."</td> ";
    //   echo "   <td class='{$classer}' >".$co_valor_pago."</td> ";
    //   echo "   <td class='{$classer}' >".$saldo_e."</td> ";
       
  //     echo "   <td class='{$classe}' >";
 //        echo "&nbsp;&nbsp;";
 //        ImagemProd(21 , 21, $path, $cst_imagem, $cst_descricao);
 //      echo "</td> ";

       echo "   <td class='{$classe}' style='text-align:center;'>";
//       echo '   <a href="#" onclick="mostra_avaliacao('."'".$idt_fornecedor."'".');" >';
         echo '   <a href="#" onclick="return mostra_criterios('."'".$idt_fornecedor."',"."'".$idt_contrato."');".'" >';

         ImagemProd(16 , 16, $patha, $foa_imagem, '', False, $foa_descricao);
         echo '   </a> ';
       echo "</td> ";

       
       echo "</tr>";
*/






}


} // fim de se o registro esta na página

       // calcular aprovados
       $sqll   = 'select ';
       $sqll  .= '  count(idt) as qtd_avaliados ';
       $sqll  .= '  from contrato co ';
       $sqll  .= '  inner join contrato_avaliacao ca on ca.idt_contrato = co.idt';
       $sqll  .= '  where co.idt_empreendimento = '.null($em_idt);
       $sqll  .= '    and ca.naoavaliados = 0 ';
       $rsl = execsql($sqll);
       ForEach($rsl->data as $rowl)
       {
           $naoavaliado = $rowl['qtd_avaliados'];
       }

echo "</table>";

echo " </div> ";

// resumo

echo "<br /><br />";





echo "<div id='contrato_r'> ";
$resumo='';

$resumo .= "<br /><br />";

    $resumo .= "<table class='contrato_tab' style='width:100%; background:#F0F0F0; border-color:#C0C0C0' border='1' cellspacing='0' cellpadding='0' vspace='0' hspace='0'> ";
    $resumo .= "<tr  class='contrato_linha_tr' style='background:#F0F0F0;' >  ";
    $resumo .= "<td class='quantidade_contrato' style='font-size:16px; background:#CC0000; color:#FFFFFF; text-align:center;'>";
   // $resumo .= " RESUMO DA AVALIAÇÃO";
    
    
        if ($naoavaliados=='T')
        {
            $resumo .= " RESUMO GERAL DA AVALIAÇÃO DOS CONTRATOS DO PERIODO";
        }
        else
        {
            if ($naoavaliados=='A')
            {
                $resumo .= " RESUMO DA AVALIAÇÃO DOS CONTRATOS AVALIADOS DO PERIODO";
            }
            else
            {
                $resumo .= " RESUMO DA AVALIAÇÃO DOS CONTRATOS EM AVALIAÇÃO DO PERIODO";
            }
        }

    
    
    $resumo .= "</td>";
    $resumo .= "</tr>";
    $resumo .= "</table>";

$resumo .= "<br />";




$resumo .= "<table class='contrato_tab' style='width:100%; background:#F0F0F0; border-color:#C0C0C0' border='1' cellspacing='0' cellpadding='0' vspace='0' hspace='0'> ";
$resumo .= "<tr  class='contrato_linha_tr' style='background:#F0F0F0;' >  ";
$resumo .= "<td class='quantidade_contrato' style='width:40%; font-size:14px; color:#666666; text-align:right;'>";
$resumo .= " Contratos Ativos para Avaliação: ";
$resumo .= "</td>";
$resumo .= "<td class='quantidade_contrato' style='font-size:14px; color:#666666;  padding-right:220px;  text-align:right;'>";
$resumo .= $qtd_contratos;
$resumo .= "</td>";

$resumo .= "</tr>";

//$qtd_contratos_avaliadosw=$qtd_contratos_avaliados/4;

$qtd_contratos_avaliadosw=$qtd_contratos_av;

$resumo .= "<tr  class='contrato_linha_tr' style='background:#F0F0F0;' >  ";
$resumo .= "<td class='quantidade_contrato' style='width:40%; font-size:14px; color:#666666; text-align:right;'>";
$resumo .= " Contratos Avaliados: ";
$resumo .= "</td>";
$resumo .= "<td class='quantidade_contrato' style='font-size:14px; color:#666666; padding-right:220px;  text-align:right;'>";
$resumo .=  $qtd_contratos_avaliadosw;
$resumo .= "</td>";
$resumo .= "</tr>";



$dif     = $qtd_contratos - $qtd_contratos_avaliadosw;



$resumo .= "<tr  class='contrato_linha_tr' style='background:#F0F0F0;' >  ";
$resumo .= "<td class='quantidade_contrato' style='width:40%; font-size:16px; color:#666666; text-align:right;'>";
$resumo .= " Contratos a Avaliar: ";
$resumo .= "</td>";
$resumo .= "<td class='quantidade_contrato' style='font-size:14px; color:#666666; padding-right:220px;  text-align:right;'>";
$resumo .= $dif;
$resumo .= "</td>";

$resumo .= "</tr>";

/*
$resumo .= "<tr  class='contrato_linha_tr' style='background:#F0F0F0;' >  ";
$resumo .= "<td class='quantidade_contrato' style='width:40%; font-size:16px; color:#666666; text-align:right;'>";
$resumo .= "&nbsp;";
$resumo .= "</td>";
$resumo .= "<td class='quantidade_contrato' style='font-size:16px; color:#666666; padding-right:220px;  text-align:right;'>";
$resumo .= "&nbsp;";
$resumo .= "</td>";
$resumo .= "</tr>";
$resumo .= "<tr  class='contrato_linha_tr' style='background:#F0F0F0;' >  ";
$resumo .= "<td class='quantidade_contrato' style='width:40%; font-size:16px; color:#666666; text-align:right;'>";
$resumo .= " Critérios Avaliados: ";
$resumo .= "</td>";
$resumo .= "<td class='quantidade_contrato' style='font-size:16px; color:#666666; padding-right:220px;  text-align:right;'>";
$resumo .= $qtd_criterios_avaliados;
$resumo .= "</td>";

$resumo .= "</tr>";
*/

//$dif = ($qtd_contratos*16) - $qtd_criterios_avaliados;
//$dif = format_decimal($dif,0);


/*
$resumo .= "<tr  class='contrato_linha_tr' style='background:#F0F0F0;' >  ";
$resumo .= "<td class='quantidade_contrato' style='width:40%; font-size:16px; color:#666666; text-align:right;'>";
$resumo .= " Critérios a Avaliar: ";
$resumo .= "</td>";
$resumo .= "<td class='quantidade_contrato' style='font-size:16px; color:#666666; padding-left:20px; padding-right:220px;  text-align:right;'>";
$resumo .=  $dif;
$resumo .=  "</td>";
$resumo .=  "</tr>";
$resumo .=  "</table>";
*/


$resumo .=  "</table>";

if ($dif!=0)
{
    $resumo .=  "<br />";
    
    $resumo .=  "<div style='width:100%; text-align:center; color:#C00000; font-size:14px;' >ATENÇÃO! AINDA EXISTEM CONTRATOS PARA AVALIAÇÃO NO PERIODO!</div>";
    
    /*
    $resumo .=  "<table class='contrato_tab' style='width:100%; background:#F0F0F0; border-color:#C0C0C0' border='1' cellspacing='0' cellpadding='0' vspace='0' hspace='0'> ";
    $resumo .=  "<tr  class='contrato_linha_tr' style='background:#F0F0F0;' >  ";
    $resumo .=  "<td class='quantidade_contrato' style='font-size:14px; background:#CC0000; color:#FFFFFF; text-align:center;'>";
    $resumo .=  " ATENÇÃO...";
    $resumo .=  "</td>";
    $resumo .=  "</tr>";
    
    $resumo .=  "<tr  class='contrato_linha_tr' style='background:#F0F0F0;' >  ";
    $resumo .=  "<td class='quantidade_contrato' style='font-size:14px; background:#CC0000; color:#FFFFFF; text-align:center;'>";
    $pendencia = " AINDA EXISTEM CONTRATOS PARA AVALIAÇÃO NO PERIODO";
    $resumo .=  $pendencia ;
    $resumo .=  "</td>";
    $resumo .=  "</tr>";
    $resumo .=  "</table>";
    */
    
    $status_fecha='N';


    
}
else
{
    $status_fecha='S';
    $pendencia = "TODOS CONTRATOS JÁ ESTÃO AVALIADOS PARA O PERÍODO";

    $resumo .=  "<br />";

    $resumo .=  "<div style='width:100%; text-align:center; color:#004080; font-size:14px;' >ATENÇÃO! TODOS OS CONTRATOS JÁ ESTÃO AVALIADOS PARA O PERÍODO!</div>";



}

echo $resumo;

// acessar resumo
if ($naoavaliados=='T')
{

$idt_empreendimento = null($_SESSION[CS]['g_idt_obra']);
$sqlw   = 'select ';
$sqlw  .= '  epa.* ';
$sqlw  .= '  from empreendimento_periodo_avaliacao epa ';
$sqlw  .= ' where ';
$sqlw  .= '       epa.idt_empreendimento = '.null($idt_empreendimento);
$sqlw  .= '   and epa.idt_periodo        = '.null($idt_periodo);
$rsw = execsql($sqlw);
//p($sqlw);
if ($rsw->rows == 0)
{
    $status = $status_fecha;
    
    $data_fechamento = '';
    if ($status_fecha=='S')
    {
        $data = date('d/m/Y H:i:s');
        $data_fechamento = trata_data($data);
    }

    $sql_i  = ' insert into empreendimento_periodo_avaliacao ';
    $sql_i .= ' ( ';
    $sql_i .= '   idt_empreendimento, ';
    $sql_i .= '   idt_periodo, ';
    $sql_i .= '   status, ';
    $sql_i .= '   pendencia, ';
    $sql_i .= '   resumo, ';
    $sql_i .= '   data_fechamento, ';
    $sql_i .= '   quantidade_contratos ';
    $sql_i .= ' )  values  ( ';
    $sql_i .= "  $idt_empreendimento, ";
    $sql_i .= "  $idt_periodo,  ";
    $sql_i .= aspa($status).", ";
    $sql_i .= aspa($pendencia).", ";
    $sql_i .= aspa($resumo).", ";
    $sql_i .= aspa($data_fechamento).", ";
    $sql_i .= "  $qtd_contratos ";
    $sql_i .= "  )";
    $result = execsql($sql_i);
    $sqlw   = 'select ';
    $sqlw  .= '  epa.* ';
    $sqlw  .= '  from empreendimento_periodo_avaliacao epa ';
    $sqlw  .= ' where ';
    $sqlw  .= '       epa.idt_empreendimento = '.null($idt_empreendimento);
    $sqlw  .= '   and epa.idt_periodo        = '.null($idt_periodo);
    $rsw = execsql($sqlw);
    if ($rsw->rows == 0)
    {
        // erro  tratar esse caso
    }

}
else
{
    $data_fechamento = '';
    if ($status_fecha=='S')
    {

        $data = date('d/m/Y H:i:s');
        $data_fechamento = trata_data($data);
    }

    $sql_a = ' update empreendimento_periodo_avaliacao set ';
    $sql_a .= ' status               = '.aspa($status_fecha).',  ';
    $sql_a .= ' pendencia            = '.aspa($pendencia).',  ';
    $sql_a .= ' resumo               = '.aspa($resumo).',  ';
    $sql_a .= ' data_fechamento      = '.aspa($data_fechamento).',  ';
    $sql_a .= ' quantidade_contratos = '.null($qtd_contratos).'  ';

    $sql_a .= ' where ';
    $sql_a .= '       idt_empreendimento = '.null($idt_empreendimento);
    $sql_a .= '   and idt_periodo        = '.null($idt_periodo);
    $result = execsql($sql_a);
   // p($sql_a);

}


set_time_limit (30);


}

echo " </div> ";

if ($_GET['print'] != 's') {


$url_volta = 'conteudo'.$cont_arq.'.php';
echo ' <div id="voltar_full_m">';
echo ' <div class="voltar">';
echo '         <img src="imagens/menos_full_PCO.jpg" title="Voltar"  alt="Voltar" border="0" onclick="self.location = '."'".$url_volta."'".'" style="cursor: pointer;">';
echo ' </div>';
echo ' </div>';


}
else
{
    echo "<div style='height:25px; width:100%; background:#FF0000; display:block; '>";
    echo '&nbsp;&nbsp;<br />';
    echo '&nbsp;&nbsp;';
    echo "</div>";

}


?>



<script type="text/javascript" >
     function desativa_mostra_aditivo() {
        document.getElementById('mostra_aditivo').style.display='none';
     }
     function  mostra_aditivo(idt) {
         var msg = '';
         objd=document.getElementById('mostra_aditivo_det')
         objd.innerHTML=objd.innerHTML+msg;
         obj=document.getElementById('mostra_aditivo')
         obj.style.display='block';
         $.post('ajax.php?tipo=aditivo', {
            idt_contrato: idt
            } , function(str) {

                
                if (str == '') {

                   // objd.innerHTML=str;
                   // alert('Obra Posicionada em ');


                } else {
                   // alert(url_decode(str).replace(/<br>/gi, "\n"));
                    
                    jQuery('#mostra_aditivo_det').html(str);
                    
                    
                }
                
                
                
         });
         return false;

     }
     function desativa_contrato_edoc() {
        document.getElementById('contrato_edoc').style.display='none';
     }

     function  mostra_contrato(idt) {
         var msg = '';
         objd=document.getElementById('contrato_edoc_det')
         objd.innerHTML=objd.innerHTML+msg;
         obj=document.getElementById('contrato_edoc')
         obj.style.display='block';
         $.post('ajax.php?tipo=chama_edoc_contrato', {
            idt_contrato: idt
            } , function(str) {


                if (str == '') {

                   // objd.innerHTML=str;
                   // alert('Obra Posicionada em ');


                } else {
                   // alert(url_decode(str).replace(/<br>/gi, "\n"));

                    jQuery('#contrato_edoc_det').html(str);
                    desativa_contrato_edoc();

                }



         });
         return false;
     }

     
</script>
