
<style type="text/css">


div#contrato {
    soverflow:auto;
    soverflow:hidden;
    sheight: 380px;
    width : 680px;
    width : 100%;
    float:left;
    font-family : Calibri, Arial, Helvetica, sans-serif;
    font-style: normal;
    font-size: 12px;
    font-weight: bold;
    color:#FF5959;
    background: #FFFFFF;
    margin:0px;
    padding:0px;
}


div#contrato_1 {
    soverflow:auto;
    soverflow:hidden;
    sheight: 360px;
    width : 670px;
    width : 100%;
    float:left;
    font-family : Calibri, Arial, Helvetica, sans-serif;
    font-style: normal;
    font-size: 12px;
    font-weight: bold;
    color:#FF5959;
    padding:0px;
    background: #FFFFFF;
    margin:0px;
    padding:0px;


}


table.contrato_table{
    font-family : Calibri, Arial, Helvetica, sans-serif;
    font-style: normal;
    font-size: 12px;
    font-weight: bold;
    color:#000000;
    color:#FFFFFF;
    background: #EFEFEF;
    background: #A2A2A2;

}

tr.contrato_table_tr {


}
td.contrato_titulo_td {
    font-weight : bold;
    color       : #004080;
    color:#FFFFFF;
    text-align  :center;
    padding-top :5px;
    padding-left:5px;
    border-bottom:1px solid #9D0000;
}
tr.contrato_cab_tr {

}
td.contrato_cab_td {
    font-weight :bold;
    color       :#004080;
    color:#FFFFFF;
    

    
    text-align  :left;
    padding-top :5px;
    padding-left:5px;
    border-bottom:1px solid #9D0000;
}

td.contrato_cab_td_r {
    font-weight :bold;
    color       :#004080;
    color:#FFFFFF;

    text-align  :left;
    padding-top :5px;
    padding-left:5px;
    border-bottom:1px solid #9D0000;
    text-align: right;
}

tr.contrato_linha_tr {

}
td.contrato_linha_td_t {
    font-weight   : normal;
    color         : #640000;
    background    : #EAEAEA;
    padding-top   : 5px;
    padding-left  : 5px;
    border-bottom : 1px solid #C0C0C0;
}

td.contrato_linha_td_t1 {
    font-weight   : normal;
    color         : #640000;
    background    : #EEEEEE;
    padding-top   : 5px;
    padding-left  : 5px;
    border-bottom : 1px solid #C0C0C0;
}

td.contrato_linha_td_t2 {
    font-weight   : normal;
    color         : #640000;
    background    : #F0F0F0;
    padding-top   : 5px;
    padding-left  : 5px;
    border-bottom : 1px solid #C0C0C0;
}

td.contrato_linha_td_t3 {
    font-weight   : normal;
    color         : #640000;
    background    : #F0F0F0;
    padding-top   : 5px;
    padding-left  : 5px;
    border-bottom : 1px solid #C0C0C0;
}


td.contrato_linha_td_t_r {
    font-weight   : bold;
    color         : #640000;
    background    : #EAEAEA;
    padding-top   : 5px;
    padding-left  : 5px;
    border-bottom : 1px solid #C0C0C0;
    text-align    : right;
}

td.contrato_linha_td_t1_r {
    font-weight   : bold;
    color         : #640000;
    background    : #EEEEEE;
    padding-top   : 5px;
    padding-left  : 5px;
    border-bottom : 1px solid #C0C0C0;
    text-align    : right;
}

td.contrato_linha_td_t2_r {
    font-weight   : bold;
    color         : #640000;
    background    : #F0F0F0;
    padding-top   : 5px;
    padding-left  : 5px;
    border-bottom : 1px solid #C0C0C0;
    text-align    : right;
}

td.contrato_linha_td_t3_r {
    font-weight   : bold;
    color         : #640000;
    background    : #F0F0F0;
    padding-top   : 5px;
    padding-left  : 5px;
    border-bottom : 1px solid #C0C0C0;
    text-align    : right;
}



td.contrato_linha_td_a {
    font-weight :normal;
    color       :#575757;
    background  :#FFFFFF;
    padding-top :5px;
    padding-left:5px;
    border-bottom : 1px solid #C0C0C0;
}

td.contrato_linha_td_a_r {
    font-weight : bold;
    color       :#575757;
    background  :#FFFFFF;
    padding-top :5px;
    padding-left:5px;
    border-bottom : 1px solid #C0C0C0;
    text-align    : right;
}

td.contrato_linha_td_a_r a {
    color       :#800000;
    text-decoration: none;
}

div#contrato_c {
    background:#FFCCCC;
    background:#FFFFFF;
    width : 680px;
    height:10px;
    margin:0px;
}

div#contrato_r {
    background:#FFCCCC;
    background:#FFFFFF;
    width : 680px;
    height:10px;
    margin:0px;
    float:left;
}



div#mostra_preco {
    position:absolute;

    left:240px;
    top:150px;

    width :700px;
    height:200px;

    background-color: white;
    border:2px solid #808040;
    display:none;

    z-index:2000000;
    font-family : Calibri, Arial, Helvetica, sans-serif;
    font-size: 14px;
    font-style: normal;
    font-weight: bold;
    color: #004080;
    text-align:center;
    background: #EBEBEB;
    overflow:auto;
}

div#mostra_preco img{
    float:right;
    padding-top:5px;
    padding-right:5px;
    padding-bottom:5px;
}

div#mostra_preco_cab {
    width :696px;
    height:30px;
    border:2px solid #C0C0C0;
    color:white;
    background: #004080 ;
}

div#mostra_preco_det {
    padding-top:5px;
    padding-left:3px;
    font-family : Calibri, Arial, Helvetica, sans-serif;
    font-size: 14px;
    font-style: normal;
    font-weight: normal;
    color: #A6A6A6;
    text-align:left;

}

div#mostra_preco_det img {
    float:left;
    padding-top:0px;
    padding-left:10px;

}

td.linha_campo {
   color: #000000;
}


div#voltar_full_m  {
    float:left;
    height:25px;
    background:transparent;
    sbackground:red;
    margin:0px;
    padding:0px;
}

div#voltar_full_m img {
    cursor: pointer;
}

.voltar  {
    float:left;
}


div#area_imprime {
    float:left;
    background: #FFFFFF;
    text-align:right;
    background:blue;

}
div#area_imprime img {
    background: #FFFFFF;
    padding-right:5px;
    cursor: pointer;
}

div#area_excel {
    float:left;
    background: #FFFFFF;
    text-align:right;

}
div#area_excel img {
    background: #FFFFFF;
    padding-right:5px;
    cursor: pointer;
}

div#area_doc {
    float:left;
    background: #FFFFFF;
    text-align:right;

}
div#area_doc img {
    background: #FFFFFF;
    padding-right:5px;
    cursor: pointer;
}


</style>


<?php

if ($_GET['print'] != 's') {
    echo ' <div id="voltar_full_m">';

    echo ' <div class="voltar">';
    echo '         <img src="imagens/menos_full_pco.jpg" title="Voltar"   width="16" height="16"  style="padding:5px; " alt="Voltar" border="0" onclick="self.location = '."'".$url_volta."'".'" style="cursor: pointer;">';
    echo ' </div>';

    $nome_pr   = 'contrato_lista_precos';
    $nome_ex   = 'CONTRATO LISTA PREÇOS - ';
    $titulo_rl = 'Preços Praticados';
    echo "<div id='area_imprime' >";
   // echo '<a target="_blank" href="conteudo_print.php?prefixo=inc&menu='.$nome_pr.'&print=s&titulo_rel='.$titulo_rl.$parww.'" ><img style="padding:5px; "  src="imagens/impressora.gif" width="16" height="16" title="Preparar para Impressão" alt="Preparar para Impressão"  border="0" /></a>';
    echo '<a href="#"  onclick="return chama_orcamento('."'".$nome_pr."', "."'".$titulo_rl."'".');" ><img style="padding:5px; "  src="imagens/impressora.gif" width="16" height="16" title="Preparar para Impressão" alt="Preparar para Impressão"  border="0" /></a>';
    echo "</div>";

    echo ' </div>';
    echo "<br /><br /><br />";
}

$sql     = 'select  idt, estado, descricao from empreendimento ';
$sql    .= '    order by estado, descricao ';
$Filtro  = Array();
$Filtro['rs'] = execsql($sql);
//p('mmmmmmm'.$_GET['idt0']);

$par_auto=" onChange = 'document.frm.submit();' ";


//if ($_GET['idt0']!='')
//{
    //$Filtro['vlPadrao'] = '';
//}
//else
//{
    $Filtro['vlPadrao'] = $_SESSION[CS]['g_idt_obra'];
    $_GET['idt0'] = $_SESSION[CS]['g_idt_obra'];
    $_GET['pri']='S';
//}
$Filtro['LinhaUm']  = ' Listar Todas as Obras ';
$Filtro['id'] = 'idt';
$Filtro['nome'] = 'Empreendimento';
$Filtro['js'] = "style='width:400px;'".$par_auto;
$Filtro['valor'] = trata_id($Filtro);
$vetFiltro['empreendimento'] = $Filtro;



$sql     = 'select  idt, razao_social from fornecedor ';
$sql    .= '    order by razao_social ';
$Filtro  = Array();
$Filtro['rs'] = execsql($sql);
$Filtro['js'] = "style='width:400px;'".$par_auto;
$Filtro['LinhaUm'] = ' Listar Todos os Fornecedores ';
$Filtro['id'] = 'idt';
$Filtro['vlPadrao'] = -1;
$Filtro['nome'] = 'Fornecedor';
$Filtro['valor'] = trata_id($Filtro);
$vetFiltro['fornecedor'] = $Filtro;


/*
$sql     = 'select  distinct oi.idt , oi.descricao from orcamento_item oi ';
$sql    .= ' inner join contrato_servico cs on cs.idt_orcamento_item = oi.idt ';
$sql    .= '    order by oi.descricao ';
$Filtro  = Array();
$Filtro['rs'] = execsql($sql);
$Filtro['LinhaUm'] = ' Listar Todos os Serviços ';
$Filtro['id'] = 'idt';
$Filtro['nome'] = 'Serviços';
$Filtro['valor'] = trata_id($Filtro);
$vetFiltro['servico'] = $Filtro;
*/




$sql     = 'select  distinct oi.idt , oi.classificacao, oi.descricao from orcamento_item oi ';
$sql    .= ' inner join contrato_servico cs on cs.idt_orcamento_item = oi.idt ';
$sql    .= ' inner join contrato co on co.idt = cs.idt_contrato ';

//if ($vetFiltro['fornecedor']['valor']!=-1)
//{
//    $sql .= ' and  co.idt_fornecedor = '.null($vetFiltro['fornecedor']['valor']);
//}

if ($vetFiltro['empreendimento']['valor']!=-1)
{
    $sql .= ' where oi.idt_empreendimento = '.null($vetFiltro['empreendimento']['valor']);
    if ($vetFiltro['fornecedor']['valor']!=-1)
    {
        $sql .= ' and  co.idt_fornecedor = '.null($vetFiltro['fornecedor']['valor']);
    }
}
else
{
    if ($vetFiltro['fornecedor']['valor']!=-1)
    {
        $sql .= ' where co.idt_fornecedor = '.null($vetFiltro['fornecedor']['valor']);
    }
}


$sql    .= '    order by oi.classificacao ';


//$sql     = 'select  distinct oi.idt , oi.classificacao, oi.descricao from orcamento_item oi ';
//$sql    .= ' inner join contrato_servico cs on cs.idt_orcamento_item = oi.idt ';
//$sql    .= ' where idt_empreendimento = '.null($vetFiltro['empreendimento']['valor']);
//$sql    .= '    order by oi.classificacao ';
$Filtro  = Array();
$Filtro['rs'] = execsql($sql);
$Filtro['LinhaUm'] = ' Listar Todos os Serviços ';
$Filtro['id'] = 'idt';
$Filtro['vlPadrao'] = -1;
$Filtro['js'] = "style='width:400px;'".$par_auto;
$Filtro['nome'] = 'Serviços';
$Filtro['valor'] = trata_id($Filtro);
$vetFiltro['servico'] = $Filtro;




echo "<div id='mostra_preco'>";
echo "    <div id='mostra_preco_cab'>";
echo "         <img onclick='desativa_mostra_preco();' src='imagens/fechar.gif' border='0'>";
echo "          Condições do Preço Praticado";
echo "    </div>";
echo "    <div id='mostra_preco_det'>";
echo "    <img src='imagens/carregando_1.gif' />";
echo "    </div>";
echo "</div>";



echo '<form name="frm" target="_self" action="conteudo.php?'.substr(getParametro($strPara),1).'" method="post">';


if ($_GET['print'] != 's') {
    $Focus = '';
    codigo_filtro(false,false);
    onLoadPag($Focus);
}


$sql   = 'select ';
$sql  .= '  em.descricao      as em_descricao, ';
$sql  .= '  co.idt            as co_idt, ';
$sql  .= '  co.numero         as co_numero, ';
$sql  .= '  co.valor_contrato as co_valor_contrato, ';
$sql  .= '  co.valor_aditivo  as co_valor_aditivo, ';
$sql  .= '  co.valor_pago     as co_valor_pago, ';
$sql  .= '  cs.idt            as cs_idt,   ';
$sql  .= '  cs.descricao      as cs_descricao,   ';

$sql  .= '  cs.valor_unitario as cs_valor_unitario,   ';
$sql  .= '  um.codigo         as um_unidade,   ';
$sql  .= '  fo.fantasia       as fo_fantasia, ';
$sql  .= '  fo.razao_social   as fo_razao_social, ';
$sql  .= '  oi.descricao      as oi_descricao, ';
$sql  .= '  csi.imagem        as csi_imagem,   ';
$sql  .= '  css.imagem        as css_imagem   ';
$sql  .= '  from contrato co ';
$sql  .= '  inner join empreendimento    em  on em.idt           = co.idt_empreendimento ';
$sql  .= '  inner join fornecedor        fo  on fo.idt           = co.idt_fornecedor ';
$sql  .= '  left  join contrato_servico  cs  on cs.idt_contrato  = co.idt ';
$sql  .= '  left  join unidade_medida    um  on um.idt           = cs.idt_unidade_medida ';
$sql  .= '  left  join orcamento_item    oi  on oi.idt           = cs.idt_orcamento_item ';
$sql  .= '  left  join contrato_status   css on css.idt          = cs.idt_status_conclusao ';
$sql  .= '  inner join contrato_situacao csi on csi.idt          = co.idt_situacao ';
$sql  .= '  inner join contrato_tipo     ct  on ct.idt           = co.idt_tipo     ';

if ($vetFiltro['empreendimento']['valor']!=-1)
{
    $sql .= ' where ';
    $sql .= '    co.idt_empreendimento = '.null($vetFiltro['empreendimento']['valor']);
}


if ($vetFiltro['fornecedor']['valor']!=-1)
{
    if ($vetFiltro['empreendimento']['valor']!=-1)
    {
       $sql .= ' and ';
    }
    else
    {
       $sql .= ' where ';
    }
    $sql .= '   fo.idt = '.null($vetFiltro['fornecedor']['valor']);
}


//if ($vetFiltro['servico']['valor']!=-1)
if ($vetFiltro['servico']['valor']!=-1 and $vetFiltro['servico']['valor']!=0)
{
    if ($vetFiltro['empreendimento']['valor']!=-1 or $vetFiltro['fornecedor']['valor']!=-1)
    {
       $sql .= ' and ';
    }
    else
    {
       $sql .= ' where ';
    }
    $sql .= '   oi.idt = '.null($vetFiltro['servico']['valor']);
}

//$sql .= ' order by oi.descricao, cs.valor_unitario, cs.descricao,  fo.fantasia ';

$sql .= ' order by ';

if ($vetFiltro['empreendimento']['valor']!=-1)
{
    $sql .= ' em.descricao ';
    if ($vetFiltro['fornecedor']['valor']!=-1)
    {
        $sql .= ', fo.razao_social ';
        if ($vetFiltro['servico']['valor']!=-1)
        {
            $sql .= ', oi.descricao, cs.valor_unitario, cs.descricao,  fo.fantasia ';
            $sql .= ', fo.razao_social ';
        }
        else
        {
            $sql .= ', fo.razao_social ';
            $sql .= ', oi.descricao, cs.valor_unitario, cs.descricao,  fo.fantasia ';
        }
    }
    else
    {
        if ($vetFiltro['servico']['valor']!=-1)
        {
            $sql .= ', oi.descricao, cs.valor_unitario, cs.descricao,  fo.fantasia ';
            $sql .= ', fo.razao_social ';
        }
        else
        {
            $sql .= ', fo.razao_social ';
            $sql .= ', oi.descricao, cs.valor_unitario, cs.descricao,  fo.fantasia ';
        }

    }
}
else
{
    if ($vetFiltro['fornecedor']['valor']!=-1)
    {
        $sql .= ' fo.razao_social ';
        if ($vetFiltro['servico']['valor']!=-1)
        {
            $sql .= ', oi.descricao, cs.valor_unitario, cs.descricao,  fo.fantasia ';
        }
        else
        {
            $sql .= ', oi.descricao, cs.valor_unitario, cs.descricao,  fo.fantasia ';
        }
    }
    else
    {
        if ($vetFiltro['servico']['valor']!=-1)
        {
            $sql .= ' oi.descricao, cs.valor_unitario, cs.descricao,  fo.fantasia ';
        }
        else
        {
            $sql .= ' oi.descricao, cs.valor_unitario, cs.descricao,  fo.fantasia ';
        }
        $sql .= ', fo.razao_social ';
    }
    $sql .= ', em.descricao ';
}

$rs = execsql($sql);

if ($rs->rows == 0)
{
}
echo " <div id='contrato'> ";
//p($sql);
//echo "<div id='contrato_c'> ";
//echo "</div>";

echo " <div id='contrato_1'> ";

echo "<table class='contrato_table' width='100%' border='0' cellspacing='0' cellpadding='0' vspace='0' hspace='0'> ";
echo "<tr class='contrato_cab_tr'>  ";
echo "   <td class='contrato_cab_td' >&nbsp;"."OBRA"."</td> ";
echo "   <td class='contrato_cab_td' >&nbsp;"."SERVIÇO"."</td> ";
echo "   <td class='contrato_cab_td' >&nbsp;"."FORNECEDOR"."</td> ";
echo "   <td class='contrato_cab_td' >&nbsp;"."UN"."</td> ";
echo "   <td class='contrato_cab_td_r' >&nbsp;"."PREÇO<br>(R$)"."</td> ";
echo "</tr>";
$idt_contrato=0;
$separa='';
$oi_descricao_ac='';
ForEach($rs->data as $row) {
   $em_descricao       = $row['em_descricao'];
   $idt_contrato       = $row['co_idt'];
   $fantasia           = $row['fo_fantasia'];
   $oi_descricao       = $row['oi_descricao'];
   $cs_descricao       = $row['cs_descricao'];
   $cs_idt             = $row['cs_idt'];
   $um_unidade         = $row['um_unidade'];
   $cs_valor_unitario  = format_decimal($row['cs_valor_unitario']);
   $oi_descricao       = $oi_descricao.' - '.$cs_descricao;

   echo "<tr  class='contrato_linha_tr' >  ";
   $classe='contrato_linha_td_a';
   $classer='contrato_linha_td_a_r';
   echo "   <td class='{$classe}' >".$em_descricao."</td> ";
   echo "   <td class='{$classe}' >".$oi_descricao."</td> ";
   echo "   <td class='{$classe}' >".$fantasia."</td> ";
   echo "   <td class='{$classe}' >".$um_unidade."</td> ";
  // echo "   <td class='{$classer}' >".$cs_valor_unitario."</td> ";
   
   
   if ($cs_valor_unitario>0)
   {
       $href='<a href="#" onclick="mostra_preco('."'".$cs_idt."'".');" >'.$cs_valor_unitario.'</a>';
       $co_valor_preco_e=$href;
   }
   else
   {
       $co_valor_preco_e=$cs_valor_unitario;
   }
   echo "   <td class='{$classer}' >".$co_valor_preco_e."</td> ";

   
   
   echo "</tr>";

}
echo "</table>";

echo " </div> ";

//echo "<div id='contrato_r'> ";
//echo "</div>";

echo " </div> ";



if ($_GET['print'] != 's') {

$url_volta = 'conteudo'.$cont_arq.'.php';
echo ' <div id="voltar_full_m">';
echo ' <div class="voltar">';
echo '         <img src="imagens/menos_full_PCO.jpg" title="Voltar"  alt="Voltar" border="0" onclick="self.location = '."'".$url_volta."'".'" style="cursor: pointer;">';
echo ' </div>';
echo ' </div>';


}
else
{
    echo "<div style='height:25px; width:100%; background:#FF0000; display:block; '>";
    echo '&nbsp;&nbsp;<br />';
    echo '&nbsp;&nbsp;';
    echo "</div>";

}





echo '</form>';

?>

<script type="text/javascript" >
     function desativa_mostra_preco() {
        document.getElementById('mostra_preco').style.display='none';
     }
     function  mostra_preco(idt) {
         var msg = '';
         objd=document.getElementById('mostra_preco_det')
         objd.innerHTML=objd.innerHTML+msg;
         obj=document.getElementById('mostra_preco')
         obj.style.display='block';
         $.post('ajax.php?tipo=lista_preco', {
            idt_servico: idt
            } , function(str) {


                if (str == '') {

                   // objd.innerHTML=str;
                   // alert('Obra Posicionada em ');


                } else {
                   // alert(url_decode(str).replace(/<br>/gi, "\n"));

                    jQuery('#mostra_preco_det').html(str);


                }



         });
         return false;

     }
</script>
