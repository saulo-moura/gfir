
<style type="text/css">


div#despesa_direta {
    overflow:auto;
    sheight: 420px;
    width : 680px;
    width : 100%;
    float:left;
    font-family : Calibri, Arial, Helvetica, sans-serif;
    font-style: normal;
    font-size: 11px;
    font-weight: bold;
    color:#FF5959;
    background: #FFFFFF;
    margin-top:0px;
}


div#despesa_direta_1 {
    overflow:auto;
    sheight: 400px;
    swidth : 680px;
    width : 100%;
    float:left;
    font-family : Calibri, Arial, Helvetica, sans-serif;
    font-style: normal;
    font-size: 11px;
    font-weight: bold;
    color:#FF5959;
    padding:0px;
    background: #FFFFFF;
    sborder:1px solid #910000;
    sborder-top:1px solid #910000;
}


table.despesa_direta_table{
    font-family : Calibri, Arial, Helvetica, sans-serif;
    font-style: normal;
    font-size: 11px;
    font-weight: normal;
    color:#000000;
    background: #EFEFEF;
}

tr.despesa_direta_table_tr {


}
td.despesa_direta_titulo_td {
    font-weight : bold;
    color       : #000000;
    text-align  :center;
    padding-top :5px;
    padding-left:5px;
    border-bottom:1px solid #9D0000;
}
tr.despesa_direta_cab_tr {

}
td.despesa_direta_cab_td {
    background: #A8A8A8;
    font-weight :bold;
    color       :#EEEEEE;
    text-align  :left;
    padding-top :5px;
    padding-left:5px;
    border-bottom:1px solid #9D0000;
}
td.despesa_direta_cab_td_r {
    background: #A8A8A8;
    font-weight :bold;
    color       :#EEEEEE;
    text-align  :left;
    padding-top :5px;
    padding-left:5px;
    border-bottom:1px solid #9D0000;
    text-align: right;
}

tr.despesa_direta_linha_tr {

}


tr.despesa_direta_linha_tr_a {
   sbackground:red;
   background:white;
}
tr.despesa_direta_linha_tr_b {
   sbackground:yellow;
   background:white;
}
tr.despesa_direta_linha_tr_c {
   sbackground: #8CC6FF;
   background:white;
}
td.despesa_direta_linha_td_t {
    font-weight   : normal;
    color         : #000000;
    sbackground    : #EAEAEA;
    padding-top   : 5px;
    padding-left  : 5px;
    border-bottom : 1px solid #C0C0C0;
}

td.despesa_direta_linha_td_t1 {
    font-weight   : normal;
    color         : #000000;
    sbackground    : #EEEEEE;
    padding-top   : 5px;
    padding-left  : 5px;
    border-bottom : 1px solid #C0C0C0;
}

td.despesa_direta_linha_td_t2 {
    font-weight   : normal;
    color         : #000000;
    sbackground    : #F0F0F0;
    padding-top   : 5px;
    padding-left  : 5px;
    border-bottom : 1px solid #C0C0C0;
}

td.despesa_direta_linha_td_t_r {
    font-weight   : normal;
    color         : #000000;
    sbackground    : #EAEAEA;
    padding-top   : 5px;
    padding-left  : 5px;
    border-bottom : 1px solid #C0C0C0;
    text-align    : right;
}


td.despesa_direta_linha_td_a {
    font-weight :normal;
    color       :#000000;
    sbackground  :#FFFFFF;
    padding-top :5px;
    padding-left:5px;
    border-bottom : 1px solid #C0C0C0;
}

td.despesa_direta_linha_td_a_r {
    font-weight : normal;
    color       :#000000;
    sbackground  :#FFFFFF;
    padding-top :5px;
    padding-left:5px;
    border-bottom : 1px solid #C0C0C0;
    text-align    : right;
}

td.despesa_direta_linha_td_af {
    font-weight :bold;
    color       :#000000;
    background  :red;
    padding-top :5px;
    padding-left:5px;
    border-bottom : 1px solid #C0C0C0;
}
td.despesa_direta_linha_td_bf {
    font-weight :bold;
    color       :#000000;
    background  :yellow;
    padding-top :5px;
    padding-left:5px;
    border-bottom : 1px solid #C0C0C0;
}
td.despesa_direta_linha_td_cf {
    font-weight :bold;
    color       :#000000;
    background  :#80FF80;
    padding-top :5px;
    padding-left:5px;
    border-bottom : 1px solid #C0C0C0;
}





td.despesa_direta_linha_td_faixaa {
    font-weight   : normal;
    color         : #000000;
    sbackground    : #FF0000;
    padding-top   : 5px;
    padding-left  : 5px;
    border-bottom : 1px solid #C0C0C0;
    text-align    : center;
}
td.despesa_direta_linha_td_faixab {
    font-weight   : normal;
    color         : #000000;
    sbackground    : #E1E100;
    padding-top   : 5px;
    padding-left  : 5px;
    border-bottom : 1px solid #C0C0C0;
    text-align    : center;
}

td.despesa_direta_linha_td_faixac {
    font-weight   : normal;
    color         : #000000;
    sbackground    : #00C632;
    padding-top   : 5px;
    padding-left  : 5px;
    border-bottom : 1px solid #C0C0C0;
    text-align    : center;
}

div#despesa_direta_c {
    sbackground:#FFCCCC;
    width : 680px;
    height:10px;
    margin:0px;
}

div#despesa_direta_r {
    sbackground:#FFCCCC;
    width : 680px;
    height:10px;
    margin:0px;
    float:left;
}

div#voltar_full_m  {
    float:left;
    height:25px;
    background:transparent;
    sbackground:red;
    margin:0px;
    padding:0px;
}

div#voltar_full_m img {
    cursor: pointer;
}

.voltar  {
    float:left;
}


div#area_imprime {
    float:left;
    background: #FFFFFF;
    text-align:right;
    background:blue;

}
div#area_imprime img {
    background: #FFFFFF;
    padding-right:5px;
    cursor: pointer;
}

div#area_excel {
    float:left;
    background: #FFFFFF;
    text-align:right;

}
div#area_excel img {
    background: #FFFFFF;
    padding-right:5px;
    cursor: pointer;
}

div#area_doc {
    float:left;
    background: #FFFFFF;
    text-align:right;

}
div#area_doc img {
    background: #FFFFFF;
    padding-right:5px;
    cursor: pointer;
}


</style>


<?php

//$par_auto=" onChange = 'document.frm.submit();' ";
//$par_auto="";


if ($_GET['print'] != 's') {
    echo ' <div id="voltar_full_m">';

    echo ' <div class="voltar">';
    echo '         <img src="imagens/menos_full_pco.jpg" title="Voltar"   width="16" height="16"  style="padding:5px; " alt="Voltar" border="0" onclick="self.location = '."'".$url_volta."'".'" style="cursor: pointer;">';
    echo ' </div>';

    $nome_pr   = 'abc_servico';
    $nome_ex   = 'ABC SERVIÇO - ';
    $titulo_rl = 'ABC Serviço';
    echo "<div id='area_imprime' >";
   // echo '<a target="_blank" href="conteudo_print.php?prefixo=inc&menu='.$nome_pr.'&print=s&titulo_rel='.$titulo_rl.$parww.'" ><img style="padding:5px; "  src="imagens/impressora.gif" width="16" height="16" title="Preparar para Impressão" alt="Preparar para Impressão"  border="0" /></a>';
    echo '<a href="#"  onclick="return chama_orcamento('."'".$nome_pr."', "."'".$titulo_rl."'".');" ><img style="padding:5px; "  src="imagens/impressora.gif" width="16" height="16" title="Preparar para Impressão" alt="Preparar para Impressão"  border="0" /></a>';
    echo "</div>";

    echo ' </div>';
    echo "<br /><br /><br />";
}



$sql     = 'select  idt, estado, descricao from empreendimento ';
if ($veiosite=='S')
{
    $sql    .= '    where idt = '.null($_SESSION[CS]['g_idt_obra']);
}
$sql    .= '    order by estado, descricao ';
$Filtro  = Array();
$Filtro['rs'] = execsql($sql);
$Filtro['vlPadrao'] = $_SESSION[CS]['g_idt_obra'];
$Filtro['id'] = 'idt';
//$Filtro['js'] = "style='width:400px;'".$par_auto;
$Filtro['js'] = "style='width:300px;'";

$Filtro['nome'] = 'Empreendimento';
$Filtro['valor'] = trata_id($Filtro);
$vetFiltro['empreendimento'] = $Filtro;


$sql     = 'select  idt, identificador from orcamentos_empreendimento ';
//if ($veiosite=='S')
//{
    $sql    .= '    where idt_empreendimento = '.null($_SESSION[CS]['g_idt_obra']);
    $sql    .= '      and tipo = '.aspa('2');
//}
$sql    .= '    order by identificador ';
$Filtro  = Array();
$Filtro['rs'] = execsql($sql);
//$Filtro['vlPadrao'] = $_SESSION[CS]['g_idt_obra'];
//$Filtro['LinhaUm'] = ' Selecione um Orçamento ';
$Filtro['id'] = 'idt';
$Filtro['nome'] = 'Orçamentos';
//$Filtro['js'] = "style='width:400px;'".$par_auto;

$Filtro['js'] = "style='width:300px;'";

$Filtro['valor'] = trata_id($Filtro);
$vetFiltro['orcamentos'] = $Filtro;


$Filtro = Array();
$Filtro['rs'] = 'Texto';
$Filtro['id'] = 'texto';
$Filtro['js_tam'] = '0';
$Filtro['nome'] = 'Texto';
$Filtro['valor'] = trata_id($Filtro);
$vetFiltro['texto'] = $Filtro;




echo '<form name="frm" target="_self" action="conteudo.php?'.substr(getParametro($strPara),1).'" method="post">';


if ($_GET['print'] != 's') {
    $Focus = '';
    codigo_filtro(false,true);
    onLoadPag($Focus);
}

$sql  = 'select ';
$sql .= '  oas.* ';
$sql .= 'from orcamento_abc_servico oas ';
$sql .= ' where oas.idt_empreendimento = '.null($vetFiltro['empreendimento']['valor']);
$sql .= '   and oas.idt_orcamento_obra = '.null($vetFiltro['orcamentos']['valor']);

if ($vetFiltro['texto']['valor']!='')
{
    $sql .= ' and ( ';
    $sql .= ' lower(classificacao) like lower('.aspa($vetFiltro['texto']['valor'], '%', '%').')';
    $sql .= ' or lower(descricao) like lower('.aspa($vetFiltro['texto']['valor'], '%', '%').')';
    $sql .= ' or lower(unidade) like lower('.aspa($vetFiltro['texto']['valor'], '%', '%').')';
    $sql .= ' or lower(faixa) like lower('.aspa($vetFiltro['texto']['valor'], '%', '%').')';
    $sql .= ' ) ';
}




$sql .= ' order by oas.total desc';
$rs = execsql($sql);
if ($rs->rows == 0)
{
}
echo " <div id='despesa_direta'> ";

//echo "<div id='despesa_direta_c'> ";
//echo "</div>";

echo " <div id='despesa_direta_1'> ";

echo "<table class='despesa_direta_table' width='100%' border='0' cellspacing='0' cellpadding='0' vspace='0' hspace='0'> ";
echo "<tr class='despesa_direta_cab_tr'>  ";
//echo "   <td class='despesa_direta_cab_td' >&nbsp;"."Ítem"."</td> ";
echo "   <td class='despesa_direta_cab_td' >"."Classificação"."</td> ";
echo "   <td class='despesa_direta_cab_td' >"."Descrição"."</td> ";
echo "   <td class='despesa_direta_cab_td' >"."UN"."</td> ";
echo "   <td class='despesa_direta_cab_td_r' >"."Quant."."</td> ";
echo "   <td class='despesa_direta_cab_td_r' >"."Custo Unitário<br>(R$)"."</td> ";
echo "   <td class='despesa_direta_cab_td_r' >"."Custo Total<br>(R$)"."</td> ";
echo "   <td class='despesa_direta_cab_td_r' >"."Custo Acumulado<br>(R$)"."</td> ";
echo "   <td class='despesa_direta_cab_td_r' >"."%Item"."</td> ";
echo "   <td class='despesa_direta_cab_td_r' >"."%Acum."."</td> ";
echo "   <td class='despesa_direta_cab_td' >"."Faixa"."</td> ";
echo "</tr>";
$numitem=0;
$faixa_ant='1';
$valor_acumulado=0;
$percentual_acumulado=0;
ForEach($rs->data as $row) {
   $classificacao   = $row['classificacao'];
   $descricao       = $row['descricao'];
   $unidade         = $row['unidade'];
   $faixa           = $row['faixa'];

   $quantidade      = format_decimal($row['quantidade'],2);
   $custo_unitario  = format_decimal($row['custo_unitario'],2);
   $total           = format_decimal($row['total'],2);
   
   $custo_acumulado = format_decimal($row['custo_acumulado'],2);

   $percentual_item = format_decimal($row['percentual_item'],2);
   $percentual_acumulado      = format_decimal($row['percentual_acumulado'],2);

   if ($faixa=='A')
   {
       echo "<tr  class='despesa_direta_linha_tr_a' >  ";
       $classef='despesa_direta_linha_td_af';

   }
   else
   {
       if ($faixa=='B')
       {
           echo "<tr  class='despesa_direta_linha_tr_b' >  ";
           $classef='despesa_direta_linha_td_bf';

       }
       else
       {
           if ($faixa=='C')
           {
               echo "<tr  class='despesa_direta_linha_tr_c' >  ";
               $classef='despesa_direta_linha_td_cf';

           }
           else
           {
               echo "<tr  class='despesa_direta_linha_tr' >  ";
               $classef='despesa_direta_linha_td_a';

           }
       }
   }
   $classe='despesa_direta_linha_td_a';
   $classer='despesa_direta_linha_td_a_r';
   if  ($faixa_ant!=$faixa)
   {
       $numitem=1;
       $faixa_ant=$faixa;
   }
   echo "   <td class='{$classe}' >&nbsp;".$classificacao."</td> ";
   echo "   <td class='{$classe}' >&nbsp;".$descricao."</td> ";
   echo "   <td class='{$classe}' >&nbsp;".$unidade."</td> ";
   echo "   <td class='{$classer}' >&nbsp;".$quantidade."</td> ";
   echo "   <td class='{$classer}' >&nbsp;".$custo_unitario."</td> ";
   echo "   <td class='{$classer}' >&nbsp;".$total."</td> ";
   echo "   <td class='{$classer}' >&nbsp;".$custo_acumulado."</td> ";
   echo "   <td class='{$classer}' >&nbsp;".$percentual_item."</td> ";
   echo "   <td class='{$classer}' >&nbsp;".$percentual_acumulado."</td> ";
   echo "   <td class='{$classef}' >&nbsp;".$faixa."</td> ";
   echo "</tr>";
}
echo "</table>";

echo " </div> ";

//echo "<div id='despesa_direta_r'> ";
//echo "</div>";

echo " </div> ";

if ($_GET['print'] != 's') {
}
else
{
    echo "<div style='height:25px; width:100%; background:#FF0000; display:block; '>";
    echo '&nbsp;&nbsp;<br />';
    echo '&nbsp;&nbsp;';
    echo "</div>";

}


echo '</form>';

?>

